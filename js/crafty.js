




<!DOCTYPE html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Crafty/dist/crafty.js at release Â· craftyjs/Crafty</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png" />
    <meta property="fb:app_id" content="1401488693436528"/>

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="craftyjs/Crafty" name="twitter:title" /><meta content="Crafty - JavaScript Game Engine" name="twitter:description" /><meta content="https://avatars.githubusercontent.com/u/1334729" name="twitter:image:src" />
<meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars.githubusercontent.com/u/1334729" property="og:image" /><meta content="craftyjs/Crafty" property="og:title" /><meta content="https://github.com/craftyjs/Crafty" property="og:url" /><meta content="Crafty - JavaScript Game Engine" property="og:description" />

    <meta name="hostname" content="github-fe121-cp1-prd.iad.github.net">
    <meta name="ruby" content="ruby 2.1.0p0-github-tcmalloc (87c9373a41) [x86_64-linux]">
    <link rel="assets" href="https://github.global.ssl.fastly.net/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="/_sockets" />


    <meta name="msapplication-TileImage" content="/windows-tile.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="selected-link" value="repo_source" data-pjax-transient />
    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="8A1A4135:3E9C:356F556:53122519" name="octolytics-dimension-request_id" /><meta content="974567" name="octolytics-actor-id" /><meta content="erbycfischer" name="octolytics-actor-login" /><meta content="1b479ca71ad9deea4ffb462afbe47e093392056ec7265b004cf3d7322730f4d4" name="octolytics-actor-hash" />
    

    
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <meta content="authenticity_token" name="csrf-param" />
<meta content="zkpWN7st/go6szptDdypitnRsiCtPyaAymzl6umySMs=" name="csrf-token" />

    <link href="https://github.global.ssl.fastly.net/assets/github-3eb3754d4f9f6036875199a01278c6ad6cc3d2ad.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://github.global.ssl.fastly.net/assets/github2-cb91aec5b799e43ecbc2cb6ac665bc7289f0d01e.css" media="all" rel="stylesheet" type="text/css" />
    
    


      <script crossorigin="anonymous" src="https://github.global.ssl.fastly.net/assets/frameworks-75c3712476c7af863873362d0cdf06a94a4b4fa3.js" type="text/javascript"></script>
      <script async="async" crossorigin="anonymous" src="https://github.global.ssl.fastly.net/assets/github-0a9d4e294873972a56136b7a78254286688653c2.js" type="text/javascript"></script>
      
      <meta http-equiv="x-pjax-version" content="21b0158f79edcff84dd6f271606bd753">

        <link data-pjax-transient rel='permalink' href='/craftyjs/Crafty/blob/c59d9cdcdd045d05e5510820a5998da970d4cb8a/dist/crafty.js'>

  <meta name="description" content="Crafty - JavaScript Game Engine" />

  <meta content="1334729" name="octolytics-dimension-user_id" /><meta content="craftyjs" name="octolytics-dimension-user_login" /><meta content="1052675" name="octolytics-dimension-repository_id" /><meta content="craftyjs/Crafty" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="1052675" name="octolytics-dimension-repository_network_root_id" /><meta content="craftyjs/Crafty" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/craftyjs/Crafty/commits/release.atom" rel="alternate" title="Recent Commits to Crafty:release" type="application/atom+xml" />

  </head>


  <body class="logged_in  env-production linux vis-public page-blob tipsy-tooltips">
    <div class="wrapper">
      
      
      
      


      <div class="header header-logged-in true">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/orgs/UAB-ACM-Hackathon/dashboard">
  <span class="mega-octicon octicon-mark-github"></span>
</a>

    
    <a href="/notifications" aria-label="You have no unread notifications" class="notification-indicator tooltipped tooltipped-s" data-gotokey="n">
        <span class="mail-status all-read"></span>
</a>

      <div class="command-bar js-command-bar  in-repository">
          <form accept-charset="UTF-8" action="/search" class="command-bar-form" id="top_search_form" method="get">

<input type="text" data-hotkey="/ s" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" autocapitalize="off"
    
    data-username="erbycfischer"
      data-repo="craftyjs/Crafty"
      data-branch="release"
      data-sha="b871576f3c50619d7821d9e06d27c42a8ff1eeac"
  >

    <input type="hidden" name="nwo" value="craftyjs/Crafty" />

    <div class="select-menu js-menu-container js-select-menu search-context-select-menu">
      <span class="minibutton select-menu-button js-menu-target" role="button" aria-haspopup="true">
        <span class="js-select-button">This repository</span>
      </span>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container" aria-hidden="true">
        <div class="select-menu-modal">

          <div class="select-menu-item js-navigation-item js-this-repository-navigation-item selected">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" class="js-search-this-repository" name="search_target" value="repository" checked="checked" />
            <div class="select-menu-item-text js-select-button-text">This repository</div>
          </div> <!-- /.select-menu-item -->

          <div class="select-menu-item js-navigation-item js-all-repositories-navigation-item">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" name="search_target" value="global" />
            <div class="select-menu-item-text js-select-button-text">All repositories</div>
          </div> <!-- /.select-menu-item -->

        </div>
      </div>
    </div>

  <span class="help tooltipped tooltipped-s" aria-label="Show command bar help">
    <span class="octicon octicon-question"></span>
  </span>


  <input type="hidden" name="ref" value="cmdform">

</form>
        <ul class="top-nav">
          <li class="explore"><a href="/explore">Explore</a></li>
            <li><a href="https://gist.github.com">Gist</a></li>
            <li><a href="/blog">Blog</a></li>
          <li><a href="https://help.github.com">Help</a></li>
        </ul>
      </div>

    


  <ul id="user-links">
    <li>
      <a href="/erbycfischer" class="name">
        <img alt="Erby Fischer" class=" js-avatar" data-user="974567" height="20" src="https://avatars.githubusercontent.com/u/974567" width="20" /> erbycfischer
      </a>
    </li>

    <li class="new-menu dropdown-toggle js-menu-container">
      <a href="#" class="js-menu-target tooltipped tooltipped-s" aria-label="Create new...">
        <span class="octicon octicon-plus"></span>
        <span class="dropdown-arrow"></span>
      </a>

      <div class="new-menu-content js-menu-content">
      </div>
    </li>

    <li>
      <a href="/settings/profile" id="account_settings"
        class="tooltipped tooltipped-s"
        aria-label="Account settings ">
        <span class="octicon octicon-tools"></span>
      </a>
    </li>
    <li>
      <a class="tooltipped tooltipped-s" href="/logout" data-method="post" id="logout" aria-label="Sign out">
        <span class="octicon octicon-log-out"></span>
      </a>
    </li>

  </ul>

<div class="js-new-dropdown-contents hidden">
  

<ul class="dropdown-menu">
  <li>
    <a href="/new"><span class="octicon octicon-repo-create"></span> New repository</a>
  </li>
  <li>
    <a href="/organizations/new"><span class="octicon octicon-organization"></span> New organization</a>
  </li>


    <li class="section-title">
      <span title="craftyjs/Crafty">This repository</span>
    </li>
      <li>
        <a href="/craftyjs/Crafty/issues/new"><span class="octicon octicon-issue-opened"></span> New issue</a>
      </li>
</ul>

</div>


    
  </div>
</div>

      

        




          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        

<ul class="pagehead-actions">

    <li class="subscription">
      <form accept-charset="UTF-8" action="/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="zkpWN7st/go6szptDdypitnRsiCtPyaAymzl6umySMs=" /></div>  <input id="repository_id" name="repository_id" type="hidden" value="1052675" />

    <div class="select-menu js-menu-container js-select-menu">
      <a class="social-count js-social-count" href="/craftyjs/Crafty/watchers">
        97
      </a>
      <span class="minibutton select-menu-button with-count js-menu-target" role="button" tabindex="0" aria-haspopup="true">
        <span class="js-select-button">
          <span class="octicon octicon-eye-watch"></span>
          Watch
        </span>
      </span>

      <div class="select-menu-modal-holder">
        <div class="select-menu-modal subscription-menu-modal js-menu-content" aria-hidden="true">
          <div class="select-menu-header">
            <span class="select-menu-title">Notification status</span>
            <span class="octicon octicon-remove-close js-menu-close"></span>
          </div> <!-- /.select-menu-header -->

          <div class="select-menu-list js-navigation-container" role="menu">

            <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input checked="checked" id="do_included" name="do" type="radio" value="included" />
                <h4>Not watching</h4>
                <span class="description">You only receive notifications for conversations in which you participate or are @mentioned.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye-watch"></span>
                  Watch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_subscribed" name="do" type="radio" value="subscribed" />
                <h4>Watching</h4>
                <span class="description">You receive notifications for all conversations in this repository.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye-unwatch"></span>
                  Unwatch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_ignore" name="do" type="radio" value="ignore" />
                <h4>Ignoring</h4>
                <span class="description">You do not receive any notifications for conversations in this repository.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-mute"></span>
                  Stop ignoring
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

          </div> <!-- /.select-menu-list -->

        </div> <!-- /.select-menu-modal -->
      </div> <!-- /.select-menu-modal-holder -->
    </div> <!-- /.select-menu -->

</form>
    </li>

  <li>
  

  <div class="js-toggler-container js-social-container starring-container ">
    <a href="/craftyjs/Crafty/unstar"
      class="minibutton with-count js-toggler-target star-button starred"
      aria-label="Unstar this repository" data-remote="true" data-method="post" rel="nofollow">
      <span class="octicon octicon-star-delete"></span><span class="text">Unstar</span>
    </a>

    <a href="/craftyjs/Crafty/star"
      class="minibutton with-count js-toggler-target star-button unstarred"
      aria-label="Star this repository" data-remote="true" data-method="post" rel="nofollow">
      <span class="octicon octicon-star"></span><span class="text">Star</span>
    </a>

      <a class="social-count js-social-count" href="/craftyjs/Crafty/stargazers">
        1,229
      </a>
  </div>

  </li>


        <li>
          <a href="/craftyjs/Crafty/fork" class="minibutton with-count js-toggler-target fork-button lighter tooltipped-n" title="Fork this repo" rel="facebox nofollow">
            <span class="octicon octicon-git-branch-create"></span><span class="text">Fork</span>
          </a>
          <a href="/craftyjs/Crafty/network" class="social-count">294</a>
        </li>


</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="repo-label"><span>public</span></span>
          <span class="mega-octicon octicon-repo"></span>
          <span class="author">
            <a href="/craftyjs" class="url fn" itemprop="url" rel="author"><span itemprop="title">craftyjs</span></a>
          </span>
          <span class="repohead-name-divider">/</span>
          <strong><a href="/craftyjs/Crafty" class="js-current-repository js-repo-home-link">Crafty</a></strong>

          <span class="page-context-loader">
            <img alt="Octocat-spinner-32" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline js-new-discussion-timeline  ">
        <div class="repository-sidebar clearfix">
            

<div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders">
  <div class="sunken-menu-contents">
    <ul class="sunken-menu-group">
      <li class="tooltipped tooltipped-w" aria-label="Code">
        <a href="/craftyjs/Crafty/tree/release" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-gotokey="c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_tags repo_branches /craftyjs/Crafty/tree/release">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

        <li class="tooltipped tooltipped-w" aria-label="Issues">
          <a href="/craftyjs/Crafty/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="i" data-selected-links="repo_issues /craftyjs/Crafty/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class='counter'>42</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>

      <li class="tooltipped tooltipped-w" aria-label="Pull Requests">
        <a href="/craftyjs/Crafty/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="p" data-selected-links="repo_pulls /craftyjs/Crafty/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class='counter'>11</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>


        <li class="tooltipped tooltipped-w" aria-label="Wiki">
          <a href="/craftyjs/Crafty/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_wiki /craftyjs/Crafty/wiki">
            <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>
    </ul>
    <div class="sunken-menu-separator"></div>
    <ul class="sunken-menu-group">

      <li class="tooltipped tooltipped-w" aria-label="Pulse">
        <a href="/craftyjs/Crafty/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="pulse /craftyjs/Crafty/pulse">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Graphs">
        <a href="/craftyjs/Crafty/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_graphs repo_contributors /craftyjs/Crafty/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Network">
        <a href="/craftyjs/Crafty/network" aria-label="Network" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-selected-links="repo_network /craftyjs/Crafty/network">
          <span class="octicon octicon-git-branch"></span> <span class="full-word">Network</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>
    </ul>


  </div>
</div>

              <div class="only-with-full-nav">
                

  

<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><strong>HTTPS</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/craftyjs/Crafty.git" readonly="readonly">

    <span aria-label="copy to clipboard" class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/craftyjs/Crafty.git" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url "
  data-protocol-type="ssh"
  data-url="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=clone">
  <h3><strong>SSH</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="git@github.com:craftyjs/Crafty.git" readonly="readonly">

    <span aria-label="copy to clipboard" class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="git@github.com:craftyjs/Crafty.git" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><strong>Subversion</strong> checkout URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/craftyjs/Crafty" readonly="readonly">

    <span aria-label="copy to clipboard" class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/craftyjs/Crafty" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
      <a href="#" class="js-clone-selector" data-protocol="ssh">SSH</a>,
      or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <span class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <a href="https://help.github.com/articles/which-remote-url-should-i-use">
    <span class="octicon octicon-question"></span>
    </a>
  </span>
</p>



                <a href="/craftyjs/Crafty/archive/release.zip"
                   class="minibutton sidebar-button"
                   title="Download this repository as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          


<!-- blob contrib key: blob_contributors:v21:bd385e96241166d9bd1692b5582b451b -->

<p title="This is a placeholder element" class="js-history-link-replace hidden"></p>

<a href="/craftyjs/Crafty/find/release" data-pjax data-hotkey="t" class="js-show-file-finder" style="display:none">Show File Finder</a>

<div class="file-navigation">
  

<div class="select-menu js-menu-container js-select-menu" >
  <span class="minibutton select-menu-button js-menu-target" data-hotkey="w"
    data-master-branch="develop"
    data-ref="release"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button">release</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-remove-close js-menu-close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/blob/develop/dist/crafty.js"
                 data-name="develop"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="develop">develop</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/blob/release/dist/crafty.js"
                 data-name="release"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="release">release</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/blob/testing/dist/crafty.js"
                 data-name="testing"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="testing">testing</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6-beta/dist/crafty.js"
                 data-name="0.6-beta"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6-beta">0.6-beta</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.2-rc/dist/crafty.js"
                 data-name="0.6.2-rc"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.2-rc">0.6.2-rc</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.2-beta/dist/crafty.js"
                 data-name="0.6.2-beta"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.2-beta">0.6.2-beta</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.2/dist/crafty.js"
                 data-name="0.6.2"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.2">0.6.2</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.1/dist/crafty.js"
                 data-name="0.6.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.1">0.6.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.0-rc/dist/crafty.js"
                 data-name="0.6.0-rc"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.0-rc">0.6.0-rc</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.0-alpha2/dist/crafty.js"
                 data-name="0.6.0-alpha2"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.0-alpha2">0.6.0-alpha2</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.0-alpha/dist/crafty.js"
                 data-name="0.6.0-alpha"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.0-alpha">0.6.0-alpha</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.6.0/dist/crafty.js"
                 data-name="0.6.0"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.6.0">0.6.0</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.5.4/dist/crafty.js"
                 data-name="0.5.4"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.5.4">0.5.4</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.5.3/dist/crafty.js"
                 data-name="0.5.3"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.5.3">0.5.3</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.5.2/dist/crafty.js"
                 data-name="0.5.2"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.5.2">0.5.2</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.5.1/dist/crafty.js"
                 data-name="0.5.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.5.1">0.5.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.5.0/dist/crafty.js"
                 data-name="0.5.0"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.5.0">0.5.0</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.9/dist/crafty.js"
                 data-name="0.4.9"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.9">0.4.9</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.8/dist/crafty.js"
                 data-name="0.4.8"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.8">0.4.8</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.7/dist/crafty.js"
                 data-name="0.4.7"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.7">0.4.7</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.6/dist/crafty.js"
                 data-name="0.4.6"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.6">0.4.6</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.5/dist/crafty.js"
                 data-name="0.4.5"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.5">0.4.5</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.3/dist/crafty.js"
                 data-name="0.4.3"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.3">0.4.3</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.2/dist/crafty.js"
                 data-name="0.4.2"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.2">0.4.2</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4.1/dist/crafty.js"
                 data-name="0.4.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4.1">0.4.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.4/dist/crafty.js"
                 data-name="0.4"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.4">0.4</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.3.1/dist/crafty.js"
                 data-name="0.3.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.3.1">0.3.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.3/dist/crafty.js"
                 data-name="0.3"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.3">0.3</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.2.1/dist/crafty.js"
                 data-name="0.2.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.2.1">0.2.1</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.2/dist/crafty.js"
                 data-name="0.2"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.2">0.2</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/craftyjs/Crafty/tree/0.1/dist/crafty.js"
                 data-name="0.1"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="0.1">0.1</a>
            </div> <!-- /.select-menu-item -->
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->

  <div class="breadcrumb">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/craftyjs/Crafty/tree/release" data-branch="release" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">Crafty</span></a></span></span><span class="separator"> / </span><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/craftyjs/Crafty/tree/release/dist" data-branch="release" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">dist</span></a></span><span class="separator"> / </span><strong class="final-path">crafty.js</strong> <span aria-label="copy to clipboard" class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="dist/crafty.js" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


  <div class="commit file-history-tease">
    <img alt="starwed" class="main-avatar js-avatar" data-user="34907" height="24" src="https://2.gravatar.com/avatar/5b73cb6573d6fccb3529ac558ba1ce36?d=https%3A%2F%2Fidenticons.github.com%2Fbbe4bffdb46a85d01137ad4638d846a9.png&amp;r=x&amp;s=140" width="24" />
    <span class="author"><a href="/starwed" rel="author">starwed</a></span>
    <time class="js-relative-date" data-title-format="YYYY-MM-DD HH:mm:ss" datetime="2014-01-31T13:53:13-08:00" title="2014-01-31 13:53:13">January 31, 2014</time>
    <div class="commit-title">
        <a href="/craftyjs/Crafty/commit/c59d9cdcdd045d05e5510820a5998da970d4cb8a" class="message" data-pjax="true" title="Update distribution files">Update distribution files</a>
    </div>

    <div class="participation">
      <p class="quickstat"><a href="#blob_contributors_box" rel="facebox"><strong>2</strong> contributors</a></p>
          <a class="avatar tooltipped tooltipped-s" aria-label="starwed" href="/craftyjs/Crafty/commits/release/dist/crafty.js?author=starwed"><img alt="starwed" class=" js-avatar" data-user="34907" height="20" src="https://2.gravatar.com/avatar/5b73cb6573d6fccb3529ac558ba1ce36?d=https%3A%2F%2Fidenticons.github.com%2Fbbe4bffdb46a85d01137ad4638d846a9.png&amp;r=x&amp;s=140" width="20" /></a>
    <a class="avatar tooltipped tooltipped-s" aria-label="kevinsimper" href="/craftyjs/Crafty/commits/release/dist/crafty.js?author=kevinsimper"><img alt="Kevin Simper" class=" js-avatar" data-user="1126497" height="20" src="https://2.gravatar.com/avatar/b120b6c94e16f352c691849391324206?d=https%3A%2F%2Fidenticons.github.com%2Fd5510ec971fa9b95a53e1637f2d344d9.png&amp;r=x&amp;s=140" width="20" /></a>


    </div>
    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list">
          <li class="facebox-user-list-item">
            <img alt="starwed" class=" js-avatar" data-user="34907" height="24" src="https://2.gravatar.com/avatar/5b73cb6573d6fccb3529ac558ba1ce36?d=https%3A%2F%2Fidenticons.github.com%2Fbbe4bffdb46a85d01137ad4638d846a9.png&amp;r=x&amp;s=140" width="24" />
            <a href="/starwed">starwed</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="Kevin Simper" class=" js-avatar" data-user="1126497" height="24" src="https://2.gravatar.com/avatar/b120b6c94e16f352c691849391324206?d=https%3A%2F%2Fidenticons.github.com%2Fd5510ec971fa9b95a53e1637f2d344d9.png&amp;r=x&amp;s=140" width="24" />
            <a href="/kevinsimper">kevinsimper</a>
          </li>
      </ul>
    </div>
  </div>

<div class="file-box">
  <div class="file">
    <div class="meta clearfix">
      <div class="info file-name">
        <span class="icon"><b class="octicon octicon-file-text"></b></span>
        <span class="mode" title="File Mode">file</span>
        <span class="meta-divider"></span>
          <span>13262 lines (11823 sloc)</span>
          <span class="meta-divider"></span>
        <span>437.731 kb</span>
      </div>
      <div class="actions">
        <div class="button-group">
                <a class="minibutton tooltipped tooltipped-n js-update-url-with-hash"
                   aria-label="Clicking this button will automatically fork this project so you can edit the file"
                   href="/craftyjs/Crafty/edit/release/dist/crafty.js"
                   data-method="post" rel="nofollow">Edit</a>
          <a href="/craftyjs/Crafty/raw/release/dist/crafty.js" class="button minibutton " id="raw-url">Raw</a>
            <a href="/craftyjs/Crafty/blame/release/dist/crafty.js" class="button minibutton js-update-url-with-hash">Blame</a>
          <a href="/craftyjs/Crafty/commits/release/dist/crafty.js" class="button minibutton " rel="nofollow">History</a>
        </div><!-- /.button-group -->
          <a class="minibutton danger empty-icon tooltipped tooltipped-s"
             href="/craftyjs/Crafty/delete/release/dist/crafty.js"
             aria-label="Fork this project and delete file"
             data-method="post" data-test-id="delete-blob-file" rel="nofollow">
          Delete
        </a>
      </div><!-- /.actions -->
    </div>
        <div class="blob-wrapper data type-javascript js-blob-data">
        <table class="file-code file-diff tab-size-8">
          <tr class="file-code-line">
            <td class="blob-line-nums">
              <span id="L1" rel="#L1">1</span>
<span id="L2" rel="#L2">2</span>
<span id="L3" rel="#L3">3</span>
<span id="L4" rel="#L4">4</span>
<span id="L5" rel="#L5">5</span>
<span id="L6" rel="#L6">6</span>
<span id="L7" rel="#L7">7</span>
<span id="L8" rel="#L8">8</span>
<span id="L9" rel="#L9">9</span>
<span id="L10" rel="#L10">10</span>
<span id="L11" rel="#L11">11</span>
<span id="L12" rel="#L12">12</span>
<span id="L13" rel="#L13">13</span>
<span id="L14" rel="#L14">14</span>
<span id="L15" rel="#L15">15</span>
<span id="L16" rel="#L16">16</span>
<span id="L17" rel="#L17">17</span>
<span id="L18" rel="#L18">18</span>
<span id="L19" rel="#L19">19</span>
<span id="L20" rel="#L20">20</span>
<span id="L21" rel="#L21">21</span>
<span id="L22" rel="#L22">22</span>
<span id="L23" rel="#L23">23</span>
<span id="L24" rel="#L24">24</span>
<span id="L25" rel="#L25">25</span>
<span id="L26" rel="#L26">26</span>
<span id="L27" rel="#L27">27</span>
<span id="L28" rel="#L28">28</span>
<span id="L29" rel="#L29">29</span>
<span id="L30" rel="#L30">30</span>
<span id="L31" rel="#L31">31</span>
<span id="L32" rel="#L32">32</span>
<span id="L33" rel="#L33">33</span>
<span id="L34" rel="#L34">34</span>
<span id="L35" rel="#L35">35</span>
<span id="L36" rel="#L36">36</span>
<span id="L37" rel="#L37">37</span>
<span id="L38" rel="#L38">38</span>
<span id="L39" rel="#L39">39</span>
<span id="L40" rel="#L40">40</span>
<span id="L41" rel="#L41">41</span>
<span id="L42" rel="#L42">42</span>
<span id="L43" rel="#L43">43</span>
<span id="L44" rel="#L44">44</span>
<span id="L45" rel="#L45">45</span>
<span id="L46" rel="#L46">46</span>
<span id="L47" rel="#L47">47</span>
<span id="L48" rel="#L48">48</span>
<span id="L49" rel="#L49">49</span>
<span id="L50" rel="#L50">50</span>
<span id="L51" rel="#L51">51</span>
<span id="L52" rel="#L52">52</span>
<span id="L53" rel="#L53">53</span>
<span id="L54" rel="#L54">54</span>
<span id="L55" rel="#L55">55</span>
<span id="L56" rel="#L56">56</span>
<span id="L57" rel="#L57">57</span>
<span id="L58" rel="#L58">58</span>
<span id="L59" rel="#L59">59</span>
<span id="L60" rel="#L60">60</span>
<span id="L61" rel="#L61">61</span>
<span id="L62" rel="#L62">62</span>
<span id="L63" rel="#L63">63</span>
<span id="L64" rel="#L64">64</span>
<span id="L65" rel="#L65">65</span>
<span id="L66" rel="#L66">66</span>
<span id="L67" rel="#L67">67</span>
<span id="L68" rel="#L68">68</span>
<span id="L69" rel="#L69">69</span>
<span id="L70" rel="#L70">70</span>
<span id="L71" rel="#L71">71</span>
<span id="L72" rel="#L72">72</span>
<span id="L73" rel="#L73">73</span>
<span id="L74" rel="#L74">74</span>
<span id="L75" rel="#L75">75</span>
<span id="L76" rel="#L76">76</span>
<span id="L77" rel="#L77">77</span>
<span id="L78" rel="#L78">78</span>
<span id="L79" rel="#L79">79</span>
<span id="L80" rel="#L80">80</span>
<span id="L81" rel="#L81">81</span>
<span id="L82" rel="#L82">82</span>
<span id="L83" rel="#L83">83</span>
<span id="L84" rel="#L84">84</span>
<span id="L85" rel="#L85">85</span>
<span id="L86" rel="#L86">86</span>
<span id="L87" rel="#L87">87</span>
<span id="L88" rel="#L88">88</span>
<span id="L89" rel="#L89">89</span>
<span id="L90" rel="#L90">90</span>
<span id="L91" rel="#L91">91</span>
<span id="L92" rel="#L92">92</span>
<span id="L93" rel="#L93">93</span>
<span id="L94" rel="#L94">94</span>
<span id="L95" rel="#L95">95</span>
<span id="L96" rel="#L96">96</span>
<span id="L97" rel="#L97">97</span>
<span id="L98" rel="#L98">98</span>
<span id="L99" rel="#L99">99</span>
<span id="L100" rel="#L100">100</span>
<span id="L101" rel="#L101">101</span>
<span id="L102" rel="#L102">102</span>
<span id="L103" rel="#L103">103</span>
<span id="L104" rel="#L104">104</span>
<span id="L105" rel="#L105">105</span>
<span id="L106" rel="#L106">106</span>
<span id="L107" rel="#L107">107</span>
<span id="L108" rel="#L108">108</span>
<span id="L109" rel="#L109">109</span>
<span id="L110" rel="#L110">110</span>
<span id="L111" rel="#L111">111</span>
<span id="L112" rel="#L112">112</span>
<span id="L113" rel="#L113">113</span>
<span id="L114" rel="#L114">114</span>
<span id="L115" rel="#L115">115</span>
<span id="L116" rel="#L116">116</span>
<span id="L117" rel="#L117">117</span>
<span id="L118" rel="#L118">118</span>
<span id="L119" rel="#L119">119</span>
<span id="L120" rel="#L120">120</span>
<span id="L121" rel="#L121">121</span>
<span id="L122" rel="#L122">122</span>
<span id="L123" rel="#L123">123</span>
<span id="L124" rel="#L124">124</span>
<span id="L125" rel="#L125">125</span>
<span id="L126" rel="#L126">126</span>
<span id="L127" rel="#L127">127</span>
<span id="L128" rel="#L128">128</span>
<span id="L129" rel="#L129">129</span>
<span id="L130" rel="#L130">130</span>
<span id="L131" rel="#L131">131</span>
<span id="L132" rel="#L132">132</span>
<span id="L133" rel="#L133">133</span>
<span id="L134" rel="#L134">134</span>
<span id="L135" rel="#L135">135</span>
<span id="L136" rel="#L136">136</span>
<span id="L137" rel="#L137">137</span>
<span id="L138" rel="#L138">138</span>
<span id="L139" rel="#L139">139</span>
<span id="L140" rel="#L140">140</span>
<span id="L141" rel="#L141">141</span>
<span id="L142" rel="#L142">142</span>
<span id="L143" rel="#L143">143</span>
<span id="L144" rel="#L144">144</span>
<span id="L145" rel="#L145">145</span>
<span id="L146" rel="#L146">146</span>
<span id="L147" rel="#L147">147</span>
<span id="L148" rel="#L148">148</span>
<span id="L149" rel="#L149">149</span>
<span id="L150" rel="#L150">150</span>
<span id="L151" rel="#L151">151</span>
<span id="L152" rel="#L152">152</span>
<span id="L153" rel="#L153">153</span>
<span id="L154" rel="#L154">154</span>
<span id="L155" rel="#L155">155</span>
<span id="L156" rel="#L156">156</span>
<span id="L157" rel="#L157">157</span>
<span id="L158" rel="#L158">158</span>
<span id="L159" rel="#L159">159</span>
<span id="L160" rel="#L160">160</span>
<span id="L161" rel="#L161">161</span>
<span id="L162" rel="#L162">162</span>
<span id="L163" rel="#L163">163</span>
<span id="L164" rel="#L164">164</span>
<span id="L165" rel="#L165">165</span>
<span id="L166" rel="#L166">166</span>
<span id="L167" rel="#L167">167</span>
<span id="L168" rel="#L168">168</span>
<span id="L169" rel="#L169">169</span>
<span id="L170" rel="#L170">170</span>
<span id="L171" rel="#L171">171</span>
<span id="L172" rel="#L172">172</span>
<span id="L173" rel="#L173">173</span>
<span id="L174" rel="#L174">174</span>
<span id="L175" rel="#L175">175</span>
<span id="L176" rel="#L176">176</span>
<span id="L177" rel="#L177">177</span>
<span id="L178" rel="#L178">178</span>
<span id="L179" rel="#L179">179</span>
<span id="L180" rel="#L180">180</span>
<span id="L181" rel="#L181">181</span>
<span id="L182" rel="#L182">182</span>
<span id="L183" rel="#L183">183</span>
<span id="L184" rel="#L184">184</span>
<span id="L185" rel="#L185">185</span>
<span id="L186" rel="#L186">186</span>
<span id="L187" rel="#L187">187</span>
<span id="L188" rel="#L188">188</span>
<span id="L189" rel="#L189">189</span>
<span id="L190" rel="#L190">190</span>
<span id="L191" rel="#L191">191</span>
<span id="L192" rel="#L192">192</span>
<span id="L193" rel="#L193">193</span>
<span id="L194" rel="#L194">194</span>
<span id="L195" rel="#L195">195</span>
<span id="L196" rel="#L196">196</span>
<span id="L197" rel="#L197">197</span>
<span id="L198" rel="#L198">198</span>
<span id="L199" rel="#L199">199</span>
<span id="L200" rel="#L200">200</span>
<span id="L201" rel="#L201">201</span>
<span id="L202" rel="#L202">202</span>
<span id="L203" rel="#L203">203</span>
<span id="L204" rel="#L204">204</span>
<span id="L205" rel="#L205">205</span>
<span id="L206" rel="#L206">206</span>
<span id="L207" rel="#L207">207</span>
<span id="L208" rel="#L208">208</span>
<span id="L209" rel="#L209">209</span>
<span id="L210" rel="#L210">210</span>
<span id="L211" rel="#L211">211</span>
<span id="L212" rel="#L212">212</span>
<span id="L213" rel="#L213">213</span>
<span id="L214" rel="#L214">214</span>
<span id="L215" rel="#L215">215</span>
<span id="L216" rel="#L216">216</span>
<span id="L217" rel="#L217">217</span>
<span id="L218" rel="#L218">218</span>
<span id="L219" rel="#L219">219</span>
<span id="L220" rel="#L220">220</span>
<span id="L221" rel="#L221">221</span>
<span id="L222" rel="#L222">222</span>
<span id="L223" rel="#L223">223</span>
<span id="L224" rel="#L224">224</span>
<span id="L225" rel="#L225">225</span>
<span id="L226" rel="#L226">226</span>
<span id="L227" rel="#L227">227</span>
<span id="L228" rel="#L228">228</span>
<span id="L229" rel="#L229">229</span>
<span id="L230" rel="#L230">230</span>
<span id="L231" rel="#L231">231</span>
<span id="L232" rel="#L232">232</span>
<span id="L233" rel="#L233">233</span>
<span id="L234" rel="#L234">234</span>
<span id="L235" rel="#L235">235</span>
<span id="L236" rel="#L236">236</span>
<span id="L237" rel="#L237">237</span>
<span id="L238" rel="#L238">238</span>
<span id="L239" rel="#L239">239</span>
<span id="L240" rel="#L240">240</span>
<span id="L241" rel="#L241">241</span>
<span id="L242" rel="#L242">242</span>
<span id="L243" rel="#L243">243</span>
<span id="L244" rel="#L244">244</span>
<span id="L245" rel="#L245">245</span>
<span id="L246" rel="#L246">246</span>
<span id="L247" rel="#L247">247</span>
<span id="L248" rel="#L248">248</span>
<span id="L249" rel="#L249">249</span>
<span id="L250" rel="#L250">250</span>
<span id="L251" rel="#L251">251</span>
<span id="L252" rel="#L252">252</span>
<span id="L253" rel="#L253">253</span>
<span id="L254" rel="#L254">254</span>
<span id="L255" rel="#L255">255</span>
<span id="L256" rel="#L256">256</span>
<span id="L257" rel="#L257">257</span>
<span id="L258" rel="#L258">258</span>
<span id="L259" rel="#L259">259</span>
<span id="L260" rel="#L260">260</span>
<span id="L261" rel="#L261">261</span>
<span id="L262" rel="#L262">262</span>
<span id="L263" rel="#L263">263</span>
<span id="L264" rel="#L264">264</span>
<span id="L265" rel="#L265">265</span>
<span id="L266" rel="#L266">266</span>
<span id="L267" rel="#L267">267</span>
<span id="L268" rel="#L268">268</span>
<span id="L269" rel="#L269">269</span>
<span id="L270" rel="#L270">270</span>
<span id="L271" rel="#L271">271</span>
<span id="L272" rel="#L272">272</span>
<span id="L273" rel="#L273">273</span>
<span id="L274" rel="#L274">274</span>
<span id="L275" rel="#L275">275</span>
<span id="L276" rel="#L276">276</span>
<span id="L277" rel="#L277">277</span>
<span id="L278" rel="#L278">278</span>
<span id="L279" rel="#L279">279</span>
<span id="L280" rel="#L280">280</span>
<span id="L281" rel="#L281">281</span>
<span id="L282" rel="#L282">282</span>
<span id="L283" rel="#L283">283</span>
<span id="L284" rel="#L284">284</span>
<span id="L285" rel="#L285">285</span>
<span id="L286" rel="#L286">286</span>
<span id="L287" rel="#L287">287</span>
<span id="L288" rel="#L288">288</span>
<span id="L289" rel="#L289">289</span>
<span id="L290" rel="#L290">290</span>
<span id="L291" rel="#L291">291</span>
<span id="L292" rel="#L292">292</span>
<span id="L293" rel="#L293">293</span>
<span id="L294" rel="#L294">294</span>
<span id="L295" rel="#L295">295</span>
<span id="L296" rel="#L296">296</span>
<span id="L297" rel="#L297">297</span>
<span id="L298" rel="#L298">298</span>
<span id="L299" rel="#L299">299</span>
<span id="L300" rel="#L300">300</span>
<span id="L301" rel="#L301">301</span>
<span id="L302" rel="#L302">302</span>
<span id="L303" rel="#L303">303</span>
<span id="L304" rel="#L304">304</span>
<span id="L305" rel="#L305">305</span>
<span id="L306" rel="#L306">306</span>
<span id="L307" rel="#L307">307</span>
<span id="L308" rel="#L308">308</span>
<span id="L309" rel="#L309">309</span>
<span id="L310" rel="#L310">310</span>
<span id="L311" rel="#L311">311</span>
<span id="L312" rel="#L312">312</span>
<span id="L313" rel="#L313">313</span>
<span id="L314" rel="#L314">314</span>
<span id="L315" rel="#L315">315</span>
<span id="L316" rel="#L316">316</span>
<span id="L317" rel="#L317">317</span>
<span id="L318" rel="#L318">318</span>
<span id="L319" rel="#L319">319</span>
<span id="L320" rel="#L320">320</span>
<span id="L321" rel="#L321">321</span>
<span id="L322" rel="#L322">322</span>
<span id="L323" rel="#L323">323</span>
<span id="L324" rel="#L324">324</span>
<span id="L325" rel="#L325">325</span>
<span id="L326" rel="#L326">326</span>
<span id="L327" rel="#L327">327</span>
<span id="L328" rel="#L328">328</span>
<span id="L329" rel="#L329">329</span>
<span id="L330" rel="#L330">330</span>
<span id="L331" rel="#L331">331</span>
<span id="L332" rel="#L332">332</span>
<span id="L333" rel="#L333">333</span>
<span id="L334" rel="#L334">334</span>
<span id="L335" rel="#L335">335</span>
<span id="L336" rel="#L336">336</span>
<span id="L337" rel="#L337">337</span>
<span id="L338" rel="#L338">338</span>
<span id="L339" rel="#L339">339</span>
<span id="L340" rel="#L340">340</span>
<span id="L341" rel="#L341">341</span>
<span id="L342" rel="#L342">342</span>
<span id="L343" rel="#L343">343</span>
<span id="L344" rel="#L344">344</span>
<span id="L345" rel="#L345">345</span>
<span id="L346" rel="#L346">346</span>
<span id="L347" rel="#L347">347</span>
<span id="L348" rel="#L348">348</span>
<span id="L349" rel="#L349">349</span>
<span id="L350" rel="#L350">350</span>
<span id="L351" rel="#L351">351</span>
<span id="L352" rel="#L352">352</span>
<span id="L353" rel="#L353">353</span>
<span id="L354" rel="#L354">354</span>
<span id="L355" rel="#L355">355</span>
<span id="L356" rel="#L356">356</span>
<span id="L357" rel="#L357">357</span>
<span id="L358" rel="#L358">358</span>
<span id="L359" rel="#L359">359</span>
<span id="L360" rel="#L360">360</span>
<span id="L361" rel="#L361">361</span>
<span id="L362" rel="#L362">362</span>
<span id="L363" rel="#L363">363</span>
<span id="L364" rel="#L364">364</span>
<span id="L365" rel="#L365">365</span>
<span id="L366" rel="#L366">366</span>
<span id="L367" rel="#L367">367</span>
<span id="L368" rel="#L368">368</span>
<span id="L369" rel="#L369">369</span>
<span id="L370" rel="#L370">370</span>
<span id="L371" rel="#L371">371</span>
<span id="L372" rel="#L372">372</span>
<span id="L373" rel="#L373">373</span>
<span id="L374" rel="#L374">374</span>
<span id="L375" rel="#L375">375</span>
<span id="L376" rel="#L376">376</span>
<span id="L377" rel="#L377">377</span>
<span id="L378" rel="#L378">378</span>
<span id="L379" rel="#L379">379</span>
<span id="L380" rel="#L380">380</span>
<span id="L381" rel="#L381">381</span>
<span id="L382" rel="#L382">382</span>
<span id="L383" rel="#L383">383</span>
<span id="L384" rel="#L384">384</span>
<span id="L385" rel="#L385">385</span>
<span id="L386" rel="#L386">386</span>
<span id="L387" rel="#L387">387</span>
<span id="L388" rel="#L388">388</span>
<span id="L389" rel="#L389">389</span>
<span id="L390" rel="#L390">390</span>
<span id="L391" rel="#L391">391</span>
<span id="L392" rel="#L392">392</span>
<span id="L393" rel="#L393">393</span>
<span id="L394" rel="#L394">394</span>
<span id="L395" rel="#L395">395</span>
<span id="L396" rel="#L396">396</span>
<span id="L397" rel="#L397">397</span>
<span id="L398" rel="#L398">398</span>
<span id="L399" rel="#L399">399</span>
<span id="L400" rel="#L400">400</span>
<span id="L401" rel="#L401">401</span>
<span id="L402" rel="#L402">402</span>
<span id="L403" rel="#L403">403</span>
<span id="L404" rel="#L404">404</span>
<span id="L405" rel="#L405">405</span>
<span id="L406" rel="#L406">406</span>
<span id="L407" rel="#L407">407</span>
<span id="L408" rel="#L408">408</span>
<span id="L409" rel="#L409">409</span>
<span id="L410" rel="#L410">410</span>
<span id="L411" rel="#L411">411</span>
<span id="L412" rel="#L412">412</span>
<span id="L413" rel="#L413">413</span>
<span id="L414" rel="#L414">414</span>
<span id="L415" rel="#L415">415</span>
<span id="L416" rel="#L416">416</span>
<span id="L417" rel="#L417">417</span>
<span id="L418" rel="#L418">418</span>
<span id="L419" rel="#L419">419</span>
<span id="L420" rel="#L420">420</span>
<span id="L421" rel="#L421">421</span>
<span id="L422" rel="#L422">422</span>
<span id="L423" rel="#L423">423</span>
<span id="L424" rel="#L424">424</span>
<span id="L425" rel="#L425">425</span>
<span id="L426" rel="#L426">426</span>
<span id="L427" rel="#L427">427</span>
<span id="L428" rel="#L428">428</span>
<span id="L429" rel="#L429">429</span>
<span id="L430" rel="#L430">430</span>
<span id="L431" rel="#L431">431</span>
<span id="L432" rel="#L432">432</span>
<span id="L433" rel="#L433">433</span>
<span id="L434" rel="#L434">434</span>
<span id="L435" rel="#L435">435</span>
<span id="L436" rel="#L436">436</span>
<span id="L437" rel="#L437">437</span>
<span id="L438" rel="#L438">438</span>
<span id="L439" rel="#L439">439</span>
<span id="L440" rel="#L440">440</span>
<span id="L441" rel="#L441">441</span>
<span id="L442" rel="#L442">442</span>
<span id="L443" rel="#L443">443</span>
<span id="L444" rel="#L444">444</span>
<span id="L445" rel="#L445">445</span>
<span id="L446" rel="#L446">446</span>
<span id="L447" rel="#L447">447</span>
<span id="L448" rel="#L448">448</span>
<span id="L449" rel="#L449">449</span>
<span id="L450" rel="#L450">450</span>
<span id="L451" rel="#L451">451</span>
<span id="L452" rel="#L452">452</span>
<span id="L453" rel="#L453">453</span>
<span id="L454" rel="#L454">454</span>
<span id="L455" rel="#L455">455</span>
<span id="L456" rel="#L456">456</span>
<span id="L457" rel="#L457">457</span>
<span id="L458" rel="#L458">458</span>
<span id="L459" rel="#L459">459</span>
<span id="L460" rel="#L460">460</span>
<span id="L461" rel="#L461">461</span>
<span id="L462" rel="#L462">462</span>
<span id="L463" rel="#L463">463</span>
<span id="L464" rel="#L464">464</span>
<span id="L465" rel="#L465">465</span>
<span id="L466" rel="#L466">466</span>
<span id="L467" rel="#L467">467</span>
<span id="L468" rel="#L468">468</span>
<span id="L469" rel="#L469">469</span>
<span id="L470" rel="#L470">470</span>
<span id="L471" rel="#L471">471</span>
<span id="L472" rel="#L472">472</span>
<span id="L473" rel="#L473">473</span>
<span id="L474" rel="#L474">474</span>
<span id="L475" rel="#L475">475</span>
<span id="L476" rel="#L476">476</span>
<span id="L477" rel="#L477">477</span>
<span id="L478" rel="#L478">478</span>
<span id="L479" rel="#L479">479</span>
<span id="L480" rel="#L480">480</span>
<span id="L481" rel="#L481">481</span>
<span id="L482" rel="#L482">482</span>
<span id="L483" rel="#L483">483</span>
<span id="L484" rel="#L484">484</span>
<span id="L485" rel="#L485">485</span>
<span id="L486" rel="#L486">486</span>
<span id="L487" rel="#L487">487</span>
<span id="L488" rel="#L488">488</span>
<span id="L489" rel="#L489">489</span>
<span id="L490" rel="#L490">490</span>
<span id="L491" rel="#L491">491</span>
<span id="L492" rel="#L492">492</span>
<span id="L493" rel="#L493">493</span>
<span id="L494" rel="#L494">494</span>
<span id="L495" rel="#L495">495</span>
<span id="L496" rel="#L496">496</span>
<span id="L497" rel="#L497">497</span>
<span id="L498" rel="#L498">498</span>
<span id="L499" rel="#L499">499</span>
<span id="L500" rel="#L500">500</span>
<span id="L501" rel="#L501">501</span>
<span id="L502" rel="#L502">502</span>
<span id="L503" rel="#L503">503</span>
<span id="L504" rel="#L504">504</span>
<span id="L505" rel="#L505">505</span>
<span id="L506" rel="#L506">506</span>
<span id="L507" rel="#L507">507</span>
<span id="L508" rel="#L508">508</span>
<span id="L509" rel="#L509">509</span>
<span id="L510" rel="#L510">510</span>
<span id="L511" rel="#L511">511</span>
<span id="L512" rel="#L512">512</span>
<span id="L513" rel="#L513">513</span>
<span id="L514" rel="#L514">514</span>
<span id="L515" rel="#L515">515</span>
<span id="L516" rel="#L516">516</span>
<span id="L517" rel="#L517">517</span>
<span id="L518" rel="#L518">518</span>
<span id="L519" rel="#L519">519</span>
<span id="L520" rel="#L520">520</span>
<span id="L521" rel="#L521">521</span>
<span id="L522" rel="#L522">522</span>
<span id="L523" rel="#L523">523</span>
<span id="L524" rel="#L524">524</span>
<span id="L525" rel="#L525">525</span>
<span id="L526" rel="#L526">526</span>
<span id="L527" rel="#L527">527</span>
<span id="L528" rel="#L528">528</span>
<span id="L529" rel="#L529">529</span>
<span id="L530" rel="#L530">530</span>
<span id="L531" rel="#L531">531</span>
<span id="L532" rel="#L532">532</span>
<span id="L533" rel="#L533">533</span>
<span id="L534" rel="#L534">534</span>
<span id="L535" rel="#L535">535</span>
<span id="L536" rel="#L536">536</span>
<span id="L537" rel="#L537">537</span>
<span id="L538" rel="#L538">538</span>
<span id="L539" rel="#L539">539</span>
<span id="L540" rel="#L540">540</span>
<span id="L541" rel="#L541">541</span>
<span id="L542" rel="#L542">542</span>
<span id="L543" rel="#L543">543</span>
<span id="L544" rel="#L544">544</span>
<span id="L545" rel="#L545">545</span>
<span id="L546" rel="#L546">546</span>
<span id="L547" rel="#L547">547</span>
<span id="L548" rel="#L548">548</span>
<span id="L549" rel="#L549">549</span>
<span id="L550" rel="#L550">550</span>
<span id="L551" rel="#L551">551</span>
<span id="L552" rel="#L552">552</span>
<span id="L553" rel="#L553">553</span>
<span id="L554" rel="#L554">554</span>
<span id="L555" rel="#L555">555</span>
<span id="L556" rel="#L556">556</span>
<span id="L557" rel="#L557">557</span>
<span id="L558" rel="#L558">558</span>
<span id="L559" rel="#L559">559</span>
<span id="L560" rel="#L560">560</span>
<span id="L561" rel="#L561">561</span>
<span id="L562" rel="#L562">562</span>
<span id="L563" rel="#L563">563</span>
<span id="L564" rel="#L564">564</span>
<span id="L565" rel="#L565">565</span>
<span id="L566" rel="#L566">566</span>
<span id="L567" rel="#L567">567</span>
<span id="L568" rel="#L568">568</span>
<span id="L569" rel="#L569">569</span>
<span id="L570" rel="#L570">570</span>
<span id="L571" rel="#L571">571</span>
<span id="L572" rel="#L572">572</span>
<span id="L573" rel="#L573">573</span>
<span id="L574" rel="#L574">574</span>
<span id="L575" rel="#L575">575</span>
<span id="L576" rel="#L576">576</span>
<span id="L577" rel="#L577">577</span>
<span id="L578" rel="#L578">578</span>
<span id="L579" rel="#L579">579</span>
<span id="L580" rel="#L580">580</span>
<span id="L581" rel="#L581">581</span>
<span id="L582" rel="#L582">582</span>
<span id="L583" rel="#L583">583</span>
<span id="L584" rel="#L584">584</span>
<span id="L585" rel="#L585">585</span>
<span id="L586" rel="#L586">586</span>
<span id="L587" rel="#L587">587</span>
<span id="L588" rel="#L588">588</span>
<span id="L589" rel="#L589">589</span>
<span id="L590" rel="#L590">590</span>
<span id="L591" rel="#L591">591</span>
<span id="L592" rel="#L592">592</span>
<span id="L593" rel="#L593">593</span>
<span id="L594" rel="#L594">594</span>
<span id="L595" rel="#L595">595</span>
<span id="L596" rel="#L596">596</span>
<span id="L597" rel="#L597">597</span>
<span id="L598" rel="#L598">598</span>
<span id="L599" rel="#L599">599</span>
<span id="L600" rel="#L600">600</span>
<span id="L601" rel="#L601">601</span>
<span id="L602" rel="#L602">602</span>
<span id="L603" rel="#L603">603</span>
<span id="L604" rel="#L604">604</span>
<span id="L605" rel="#L605">605</span>
<span id="L606" rel="#L606">606</span>
<span id="L607" rel="#L607">607</span>
<span id="L608" rel="#L608">608</span>
<span id="L609" rel="#L609">609</span>
<span id="L610" rel="#L610">610</span>
<span id="L611" rel="#L611">611</span>
<span id="L612" rel="#L612">612</span>
<span id="L613" rel="#L613">613</span>
<span id="L614" rel="#L614">614</span>
<span id="L615" rel="#L615">615</span>
<span id="L616" rel="#L616">616</span>
<span id="L617" rel="#L617">617</span>
<span id="L618" rel="#L618">618</span>
<span id="L619" rel="#L619">619</span>
<span id="L620" rel="#L620">620</span>
<span id="L621" rel="#L621">621</span>
<span id="L622" rel="#L622">622</span>
<span id="L623" rel="#L623">623</span>
<span id="L624" rel="#L624">624</span>
<span id="L625" rel="#L625">625</span>
<span id="L626" rel="#L626">626</span>
<span id="L627" rel="#L627">627</span>
<span id="L628" rel="#L628">628</span>
<span id="L629" rel="#L629">629</span>
<span id="L630" rel="#L630">630</span>
<span id="L631" rel="#L631">631</span>
<span id="L632" rel="#L632">632</span>
<span id="L633" rel="#L633">633</span>
<span id="L634" rel="#L634">634</span>
<span id="L635" rel="#L635">635</span>
<span id="L636" rel="#L636">636</span>
<span id="L637" rel="#L637">637</span>
<span id="L638" rel="#L638">638</span>
<span id="L639" rel="#L639">639</span>
<span id="L640" rel="#L640">640</span>
<span id="L641" rel="#L641">641</span>
<span id="L642" rel="#L642">642</span>
<span id="L643" rel="#L643">643</span>
<span id="L644" rel="#L644">644</span>
<span id="L645" rel="#L645">645</span>
<span id="L646" rel="#L646">646</span>
<span id="L647" rel="#L647">647</span>
<span id="L648" rel="#L648">648</span>
<span id="L649" rel="#L649">649</span>
<span id="L650" rel="#L650">650</span>
<span id="L651" rel="#L651">651</span>
<span id="L652" rel="#L652">652</span>
<span id="L653" rel="#L653">653</span>
<span id="L654" rel="#L654">654</span>
<span id="L655" rel="#L655">655</span>
<span id="L656" rel="#L656">656</span>
<span id="L657" rel="#L657">657</span>
<span id="L658" rel="#L658">658</span>
<span id="L659" rel="#L659">659</span>
<span id="L660" rel="#L660">660</span>
<span id="L661" rel="#L661">661</span>
<span id="L662" rel="#L662">662</span>
<span id="L663" rel="#L663">663</span>
<span id="L664" rel="#L664">664</span>
<span id="L665" rel="#L665">665</span>
<span id="L666" rel="#L666">666</span>
<span id="L667" rel="#L667">667</span>
<span id="L668" rel="#L668">668</span>
<span id="L669" rel="#L669">669</span>
<span id="L670" rel="#L670">670</span>
<span id="L671" rel="#L671">671</span>
<span id="L672" rel="#L672">672</span>
<span id="L673" rel="#L673">673</span>
<span id="L674" rel="#L674">674</span>
<span id="L675" rel="#L675">675</span>
<span id="L676" rel="#L676">676</span>
<span id="L677" rel="#L677">677</span>
<span id="L678" rel="#L678">678</span>
<span id="L679" rel="#L679">679</span>
<span id="L680" rel="#L680">680</span>
<span id="L681" rel="#L681">681</span>
<span id="L682" rel="#L682">682</span>
<span id="L683" rel="#L683">683</span>
<span id="L684" rel="#L684">684</span>
<span id="L685" rel="#L685">685</span>
<span id="L686" rel="#L686">686</span>
<span id="L687" rel="#L687">687</span>
<span id="L688" rel="#L688">688</span>
<span id="L689" rel="#L689">689</span>
<span id="L690" rel="#L690">690</span>
<span id="L691" rel="#L691">691</span>
<span id="L692" rel="#L692">692</span>
<span id="L693" rel="#L693">693</span>
<span id="L694" rel="#L694">694</span>
<span id="L695" rel="#L695">695</span>
<span id="L696" rel="#L696">696</span>
<span id="L697" rel="#L697">697</span>
<span id="L698" rel="#L698">698</span>
<span id="L699" rel="#L699">699</span>
<span id="L700" rel="#L700">700</span>
<span id="L701" rel="#L701">701</span>
<span id="L702" rel="#L702">702</span>
<span id="L703" rel="#L703">703</span>
<span id="L704" rel="#L704">704</span>
<span id="L705" rel="#L705">705</span>
<span id="L706" rel="#L706">706</span>
<span id="L707" rel="#L707">707</span>
<span id="L708" rel="#L708">708</span>
<span id="L709" rel="#L709">709</span>
<span id="L710" rel="#L710">710</span>
<span id="L711" rel="#L711">711</span>
<span id="L712" rel="#L712">712</span>
<span id="L713" rel="#L713">713</span>
<span id="L714" rel="#L714">714</span>
<span id="L715" rel="#L715">715</span>
<span id="L716" rel="#L716">716</span>
<span id="L717" rel="#L717">717</span>
<span id="L718" rel="#L718">718</span>
<span id="L719" rel="#L719">719</span>
<span id="L720" rel="#L720">720</span>
<span id="L721" rel="#L721">721</span>
<span id="L722" rel="#L722">722</span>
<span id="L723" rel="#L723">723</span>
<span id="L724" rel="#L724">724</span>
<span id="L725" rel="#L725">725</span>
<span id="L726" rel="#L726">726</span>
<span id="L727" rel="#L727">727</span>
<span id="L728" rel="#L728">728</span>
<span id="L729" rel="#L729">729</span>
<span id="L730" rel="#L730">730</span>
<span id="L731" rel="#L731">731</span>
<span id="L732" rel="#L732">732</span>
<span id="L733" rel="#L733">733</span>
<span id="L734" rel="#L734">734</span>
<span id="L735" rel="#L735">735</span>
<span id="L736" rel="#L736">736</span>
<span id="L737" rel="#L737">737</span>
<span id="L738" rel="#L738">738</span>
<span id="L739" rel="#L739">739</span>
<span id="L740" rel="#L740">740</span>
<span id="L741" rel="#L741">741</span>
<span id="L742" rel="#L742">742</span>
<span id="L743" rel="#L743">743</span>
<span id="L744" rel="#L744">744</span>
<span id="L745" rel="#L745">745</span>
<span id="L746" rel="#L746">746</span>
<span id="L747" rel="#L747">747</span>
<span id="L748" rel="#L748">748</span>
<span id="L749" rel="#L749">749</span>
<span id="L750" rel="#L750">750</span>
<span id="L751" rel="#L751">751</span>
<span id="L752" rel="#L752">752</span>
<span id="L753" rel="#L753">753</span>
<span id="L754" rel="#L754">754</span>
<span id="L755" rel="#L755">755</span>
<span id="L756" rel="#L756">756</span>
<span id="L757" rel="#L757">757</span>
<span id="L758" rel="#L758">758</span>
<span id="L759" rel="#L759">759</span>
<span id="L760" rel="#L760">760</span>
<span id="L761" rel="#L761">761</span>
<span id="L762" rel="#L762">762</span>
<span id="L763" rel="#L763">763</span>
<span id="L764" rel="#L764">764</span>
<span id="L765" rel="#L765">765</span>
<span id="L766" rel="#L766">766</span>
<span id="L767" rel="#L767">767</span>
<span id="L768" rel="#L768">768</span>
<span id="L769" rel="#L769">769</span>
<span id="L770" rel="#L770">770</span>
<span id="L771" rel="#L771">771</span>
<span id="L772" rel="#L772">772</span>
<span id="L773" rel="#L773">773</span>
<span id="L774" rel="#L774">774</span>
<span id="L775" rel="#L775">775</span>
<span id="L776" rel="#L776">776</span>
<span id="L777" rel="#L777">777</span>
<span id="L778" rel="#L778">778</span>
<span id="L779" rel="#L779">779</span>
<span id="L780" rel="#L780">780</span>
<span id="L781" rel="#L781">781</span>
<span id="L782" rel="#L782">782</span>
<span id="L783" rel="#L783">783</span>
<span id="L784" rel="#L784">784</span>
<span id="L785" rel="#L785">785</span>
<span id="L786" rel="#L786">786</span>
<span id="L787" rel="#L787">787</span>
<span id="L788" rel="#L788">788</span>
<span id="L789" rel="#L789">789</span>
<span id="L790" rel="#L790">790</span>
<span id="L791" rel="#L791">791</span>
<span id="L792" rel="#L792">792</span>
<span id="L793" rel="#L793">793</span>
<span id="L794" rel="#L794">794</span>
<span id="L795" rel="#L795">795</span>
<span id="L796" rel="#L796">796</span>
<span id="L797" rel="#L797">797</span>
<span id="L798" rel="#L798">798</span>
<span id="L799" rel="#L799">799</span>
<span id="L800" rel="#L800">800</span>
<span id="L801" rel="#L801">801</span>
<span id="L802" rel="#L802">802</span>
<span id="L803" rel="#L803">803</span>
<span id="L804" rel="#L804">804</span>
<span id="L805" rel="#L805">805</span>
<span id="L806" rel="#L806">806</span>
<span id="L807" rel="#L807">807</span>
<span id="L808" rel="#L808">808</span>
<span id="L809" rel="#L809">809</span>
<span id="L810" rel="#L810">810</span>
<span id="L811" rel="#L811">811</span>
<span id="L812" rel="#L812">812</span>
<span id="L813" rel="#L813">813</span>
<span id="L814" rel="#L814">814</span>
<span id="L815" rel="#L815">815</span>
<span id="L816" rel="#L816">816</span>
<span id="L817" rel="#L817">817</span>
<span id="L818" rel="#L818">818</span>
<span id="L819" rel="#L819">819</span>
<span id="L820" rel="#L820">820</span>
<span id="L821" rel="#L821">821</span>
<span id="L822" rel="#L822">822</span>
<span id="L823" rel="#L823">823</span>
<span id="L824" rel="#L824">824</span>
<span id="L825" rel="#L825">825</span>
<span id="L826" rel="#L826">826</span>
<span id="L827" rel="#L827">827</span>
<span id="L828" rel="#L828">828</span>
<span id="L829" rel="#L829">829</span>
<span id="L830" rel="#L830">830</span>
<span id="L831" rel="#L831">831</span>
<span id="L832" rel="#L832">832</span>
<span id="L833" rel="#L833">833</span>
<span id="L834" rel="#L834">834</span>
<span id="L835" rel="#L835">835</span>
<span id="L836" rel="#L836">836</span>
<span id="L837" rel="#L837">837</span>
<span id="L838" rel="#L838">838</span>
<span id="L839" rel="#L839">839</span>
<span id="L840" rel="#L840">840</span>
<span id="L841" rel="#L841">841</span>
<span id="L842" rel="#L842">842</span>
<span id="L843" rel="#L843">843</span>
<span id="L844" rel="#L844">844</span>
<span id="L845" rel="#L845">845</span>
<span id="L846" rel="#L846">846</span>
<span id="L847" rel="#L847">847</span>
<span id="L848" rel="#L848">848</span>
<span id="L849" rel="#L849">849</span>
<span id="L850" rel="#L850">850</span>
<span id="L851" rel="#L851">851</span>
<span id="L852" rel="#L852">852</span>
<span id="L853" rel="#L853">853</span>
<span id="L854" rel="#L854">854</span>
<span id="L855" rel="#L855">855</span>
<span id="L856" rel="#L856">856</span>
<span id="L857" rel="#L857">857</span>
<span id="L858" rel="#L858">858</span>
<span id="L859" rel="#L859">859</span>
<span id="L860" rel="#L860">860</span>
<span id="L861" rel="#L861">861</span>
<span id="L862" rel="#L862">862</span>
<span id="L863" rel="#L863">863</span>
<span id="L864" rel="#L864">864</span>
<span id="L865" rel="#L865">865</span>
<span id="L866" rel="#L866">866</span>
<span id="L867" rel="#L867">867</span>
<span id="L868" rel="#L868">868</span>
<span id="L869" rel="#L869">869</span>
<span id="L870" rel="#L870">870</span>
<span id="L871" rel="#L871">871</span>
<span id="L872" rel="#L872">872</span>
<span id="L873" rel="#L873">873</span>
<span id="L874" rel="#L874">874</span>
<span id="L875" rel="#L875">875</span>
<span id="L876" rel="#L876">876</span>
<span id="L877" rel="#L877">877</span>
<span id="L878" rel="#L878">878</span>
<span id="L879" rel="#L879">879</span>
<span id="L880" rel="#L880">880</span>
<span id="L881" rel="#L881">881</span>
<span id="L882" rel="#L882">882</span>
<span id="L883" rel="#L883">883</span>
<span id="L884" rel="#L884">884</span>
<span id="L885" rel="#L885">885</span>
<span id="L886" rel="#L886">886</span>
<span id="L887" rel="#L887">887</span>
<span id="L888" rel="#L888">888</span>
<span id="L889" rel="#L889">889</span>
<span id="L890" rel="#L890">890</span>
<span id="L891" rel="#L891">891</span>
<span id="L892" rel="#L892">892</span>
<span id="L893" rel="#L893">893</span>
<span id="L894" rel="#L894">894</span>
<span id="L895" rel="#L895">895</span>
<span id="L896" rel="#L896">896</span>
<span id="L897" rel="#L897">897</span>
<span id="L898" rel="#L898">898</span>
<span id="L899" rel="#L899">899</span>
<span id="L900" rel="#L900">900</span>
<span id="L901" rel="#L901">901</span>
<span id="L902" rel="#L902">902</span>
<span id="L903" rel="#L903">903</span>
<span id="L904" rel="#L904">904</span>
<span id="L905" rel="#L905">905</span>
<span id="L906" rel="#L906">906</span>
<span id="L907" rel="#L907">907</span>
<span id="L908" rel="#L908">908</span>
<span id="L909" rel="#L909">909</span>
<span id="L910" rel="#L910">910</span>
<span id="L911" rel="#L911">911</span>
<span id="L912" rel="#L912">912</span>
<span id="L913" rel="#L913">913</span>
<span id="L914" rel="#L914">914</span>
<span id="L915" rel="#L915">915</span>
<span id="L916" rel="#L916">916</span>
<span id="L917" rel="#L917">917</span>
<span id="L918" rel="#L918">918</span>
<span id="L919" rel="#L919">919</span>
<span id="L920" rel="#L920">920</span>
<span id="L921" rel="#L921">921</span>
<span id="L922" rel="#L922">922</span>
<span id="L923" rel="#L923">923</span>
<span id="L924" rel="#L924">924</span>
<span id="L925" rel="#L925">925</span>
<span id="L926" rel="#L926">926</span>
<span id="L927" rel="#L927">927</span>
<span id="L928" rel="#L928">928</span>
<span id="L929" rel="#L929">929</span>
<span id="L930" rel="#L930">930</span>
<span id="L931" rel="#L931">931</span>
<span id="L932" rel="#L932">932</span>
<span id="L933" rel="#L933">933</span>
<span id="L934" rel="#L934">934</span>
<span id="L935" rel="#L935">935</span>
<span id="L936" rel="#L936">936</span>
<span id="L937" rel="#L937">937</span>
<span id="L938" rel="#L938">938</span>
<span id="L939" rel="#L939">939</span>
<span id="L940" rel="#L940">940</span>
<span id="L941" rel="#L941">941</span>
<span id="L942" rel="#L942">942</span>
<span id="L943" rel="#L943">943</span>
<span id="L944" rel="#L944">944</span>
<span id="L945" rel="#L945">945</span>
<span id="L946" rel="#L946">946</span>
<span id="L947" rel="#L947">947</span>
<span id="L948" rel="#L948">948</span>
<span id="L949" rel="#L949">949</span>
<span id="L950" rel="#L950">950</span>
<span id="L951" rel="#L951">951</span>
<span id="L952" rel="#L952">952</span>
<span id="L953" rel="#L953">953</span>
<span id="L954" rel="#L954">954</span>
<span id="L955" rel="#L955">955</span>
<span id="L956" rel="#L956">956</span>
<span id="L957" rel="#L957">957</span>
<span id="L958" rel="#L958">958</span>
<span id="L959" rel="#L959">959</span>
<span id="L960" rel="#L960">960</span>
<span id="L961" rel="#L961">961</span>
<span id="L962" rel="#L962">962</span>
<span id="L963" rel="#L963">963</span>
<span id="L964" rel="#L964">964</span>
<span id="L965" rel="#L965">965</span>
<span id="L966" rel="#L966">966</span>
<span id="L967" rel="#L967">967</span>
<span id="L968" rel="#L968">968</span>
<span id="L969" rel="#L969">969</span>
<span id="L970" rel="#L970">970</span>
<span id="L971" rel="#L971">971</span>
<span id="L972" rel="#L972">972</span>
<span id="L973" rel="#L973">973</span>
<span id="L974" rel="#L974">974</span>
<span id="L975" rel="#L975">975</span>
<span id="L976" rel="#L976">976</span>
<span id="L977" rel="#L977">977</span>
<span id="L978" rel="#L978">978</span>
<span id="L979" rel="#L979">979</span>
<span id="L980" rel="#L980">980</span>
<span id="L981" rel="#L981">981</span>
<span id="L982" rel="#L982">982</span>
<span id="L983" rel="#L983">983</span>
<span id="L984" rel="#L984">984</span>
<span id="L985" rel="#L985">985</span>
<span id="L986" rel="#L986">986</span>
<span id="L987" rel="#L987">987</span>
<span id="L988" rel="#L988">988</span>
<span id="L989" rel="#L989">989</span>
<span id="L990" rel="#L990">990</span>
<span id="L991" rel="#L991">991</span>
<span id="L992" rel="#L992">992</span>
<span id="L993" rel="#L993">993</span>
<span id="L994" rel="#L994">994</span>
<span id="L995" rel="#L995">995</span>
<span id="L996" rel="#L996">996</span>
<span id="L997" rel="#L997">997</span>
<span id="L998" rel="#L998">998</span>
<span id="L999" rel="#L999">999</span>
<span id="L1000" rel="#L1000">1000</span>
<span id="L1001" rel="#L1001">1001</span>
<span id="L1002" rel="#L1002">1002</span>
<span id="L1003" rel="#L1003">1003</span>
<span id="L1004" rel="#L1004">1004</span>
<span id="L1005" rel="#L1005">1005</span>
<span id="L1006" rel="#L1006">1006</span>
<span id="L1007" rel="#L1007">1007</span>
<span id="L1008" rel="#L1008">1008</span>
<span id="L1009" rel="#L1009">1009</span>
<span id="L1010" rel="#L1010">1010</span>
<span id="L1011" rel="#L1011">1011</span>
<span id="L1012" rel="#L1012">1012</span>
<span id="L1013" rel="#L1013">1013</span>
<span id="L1014" rel="#L1014">1014</span>
<span id="L1015" rel="#L1015">1015</span>
<span id="L1016" rel="#L1016">1016</span>
<span id="L1017" rel="#L1017">1017</span>
<span id="L1018" rel="#L1018">1018</span>
<span id="L1019" rel="#L1019">1019</span>
<span id="L1020" rel="#L1020">1020</span>
<span id="L1021" rel="#L1021">1021</span>
<span id="L1022" rel="#L1022">1022</span>
<span id="L1023" rel="#L1023">1023</span>
<span id="L1024" rel="#L1024">1024</span>
<span id="L1025" rel="#L1025">1025</span>
<span id="L1026" rel="#L1026">1026</span>
<span id="L1027" rel="#L1027">1027</span>
<span id="L1028" rel="#L1028">1028</span>
<span id="L1029" rel="#L1029">1029</span>
<span id="L1030" rel="#L1030">1030</span>
<span id="L1031" rel="#L1031">1031</span>
<span id="L1032" rel="#L1032">1032</span>
<span id="L1033" rel="#L1033">1033</span>
<span id="L1034" rel="#L1034">1034</span>
<span id="L1035" rel="#L1035">1035</span>
<span id="L1036" rel="#L1036">1036</span>
<span id="L1037" rel="#L1037">1037</span>
<span id="L1038" rel="#L1038">1038</span>
<span id="L1039" rel="#L1039">1039</span>
<span id="L1040" rel="#L1040">1040</span>
<span id="L1041" rel="#L1041">1041</span>
<span id="L1042" rel="#L1042">1042</span>
<span id="L1043" rel="#L1043">1043</span>
<span id="L1044" rel="#L1044">1044</span>
<span id="L1045" rel="#L1045">1045</span>
<span id="L1046" rel="#L1046">1046</span>
<span id="L1047" rel="#L1047">1047</span>
<span id="L1048" rel="#L1048">1048</span>
<span id="L1049" rel="#L1049">1049</span>
<span id="L1050" rel="#L1050">1050</span>
<span id="L1051" rel="#L1051">1051</span>
<span id="L1052" rel="#L1052">1052</span>
<span id="L1053" rel="#L1053">1053</span>
<span id="L1054" rel="#L1054">1054</span>
<span id="L1055" rel="#L1055">1055</span>
<span id="L1056" rel="#L1056">1056</span>
<span id="L1057" rel="#L1057">1057</span>
<span id="L1058" rel="#L1058">1058</span>
<span id="L1059" rel="#L1059">1059</span>
<span id="L1060" rel="#L1060">1060</span>
<span id="L1061" rel="#L1061">1061</span>
<span id="L1062" rel="#L1062">1062</span>
<span id="L1063" rel="#L1063">1063</span>
<span id="L1064" rel="#L1064">1064</span>
<span id="L1065" rel="#L1065">1065</span>
<span id="L1066" rel="#L1066">1066</span>
<span id="L1067" rel="#L1067">1067</span>
<span id="L1068" rel="#L1068">1068</span>
<span id="L1069" rel="#L1069">1069</span>
<span id="L1070" rel="#L1070">1070</span>
<span id="L1071" rel="#L1071">1071</span>
<span id="L1072" rel="#L1072">1072</span>
<span id="L1073" rel="#L1073">1073</span>
<span id="L1074" rel="#L1074">1074</span>
<span id="L1075" rel="#L1075">1075</span>
<span id="L1076" rel="#L1076">1076</span>
<span id="L1077" rel="#L1077">1077</span>
<span id="L1078" rel="#L1078">1078</span>
<span id="L1079" rel="#L1079">1079</span>
<span id="L1080" rel="#L1080">1080</span>
<span id="L1081" rel="#L1081">1081</span>
<span id="L1082" rel="#L1082">1082</span>
<span id="L1083" rel="#L1083">1083</span>
<span id="L1084" rel="#L1084">1084</span>
<span id="L1085" rel="#L1085">1085</span>
<span id="L1086" rel="#L1086">1086</span>
<span id="L1087" rel="#L1087">1087</span>
<span id="L1088" rel="#L1088">1088</span>
<span id="L1089" rel="#L1089">1089</span>
<span id="L1090" rel="#L1090">1090</span>
<span id="L1091" rel="#L1091">1091</span>
<span id="L1092" rel="#L1092">1092</span>
<span id="L1093" rel="#L1093">1093</span>
<span id="L1094" rel="#L1094">1094</span>
<span id="L1095" rel="#L1095">1095</span>
<span id="L1096" rel="#L1096">1096</span>
<span id="L1097" rel="#L1097">1097</span>
<span id="L1098" rel="#L1098">1098</span>
<span id="L1099" rel="#L1099">1099</span>
<span id="L1100" rel="#L1100">1100</span>
<span id="L1101" rel="#L1101">1101</span>
<span id="L1102" rel="#L1102">1102</span>
<span id="L1103" rel="#L1103">1103</span>
<span id="L1104" rel="#L1104">1104</span>
<span id="L1105" rel="#L1105">1105</span>
<span id="L1106" rel="#L1106">1106</span>
<span id="L1107" rel="#L1107">1107</span>
<span id="L1108" rel="#L1108">1108</span>
<span id="L1109" rel="#L1109">1109</span>
<span id="L1110" rel="#L1110">1110</span>
<span id="L1111" rel="#L1111">1111</span>
<span id="L1112" rel="#L1112">1112</span>
<span id="L1113" rel="#L1113">1113</span>
<span id="L1114" rel="#L1114">1114</span>
<span id="L1115" rel="#L1115">1115</span>
<span id="L1116" rel="#L1116">1116</span>
<span id="L1117" rel="#L1117">1117</span>
<span id="L1118" rel="#L1118">1118</span>
<span id="L1119" rel="#L1119">1119</span>
<span id="L1120" rel="#L1120">1120</span>
<span id="L1121" rel="#L1121">1121</span>
<span id="L1122" rel="#L1122">1122</span>
<span id="L1123" rel="#L1123">1123</span>
<span id="L1124" rel="#L1124">1124</span>
<span id="L1125" rel="#L1125">1125</span>
<span id="L1126" rel="#L1126">1126</span>
<span id="L1127" rel="#L1127">1127</span>
<span id="L1128" rel="#L1128">1128</span>
<span id="L1129" rel="#L1129">1129</span>
<span id="L1130" rel="#L1130">1130</span>
<span id="L1131" rel="#L1131">1131</span>
<span id="L1132" rel="#L1132">1132</span>
<span id="L1133" rel="#L1133">1133</span>
<span id="L1134" rel="#L1134">1134</span>
<span id="L1135" rel="#L1135">1135</span>
<span id="L1136" rel="#L1136">1136</span>
<span id="L1137" rel="#L1137">1137</span>
<span id="L1138" rel="#L1138">1138</span>
<span id="L1139" rel="#L1139">1139</span>
<span id="L1140" rel="#L1140">1140</span>
<span id="L1141" rel="#L1141">1141</span>
<span id="L1142" rel="#L1142">1142</span>
<span id="L1143" rel="#L1143">1143</span>
<span id="L1144" rel="#L1144">1144</span>
<span id="L1145" rel="#L1145">1145</span>
<span id="L1146" rel="#L1146">1146</span>
<span id="L1147" rel="#L1147">1147</span>
<span id="L1148" rel="#L1148">1148</span>
<span id="L1149" rel="#L1149">1149</span>
<span id="L1150" rel="#L1150">1150</span>
<span id="L1151" rel="#L1151">1151</span>
<span id="L1152" rel="#L1152">1152</span>
<span id="L1153" rel="#L1153">1153</span>
<span id="L1154" rel="#L1154">1154</span>
<span id="L1155" rel="#L1155">1155</span>
<span id="L1156" rel="#L1156">1156</span>
<span id="L1157" rel="#L1157">1157</span>
<span id="L1158" rel="#L1158">1158</span>
<span id="L1159" rel="#L1159">1159</span>
<span id="L1160" rel="#L1160">1160</span>
<span id="L1161" rel="#L1161">1161</span>
<span id="L1162" rel="#L1162">1162</span>
<span id="L1163" rel="#L1163">1163</span>
<span id="L1164" rel="#L1164">1164</span>
<span id="L1165" rel="#L1165">1165</span>
<span id="L1166" rel="#L1166">1166</span>
<span id="L1167" rel="#L1167">1167</span>
<span id="L1168" rel="#L1168">1168</span>
<span id="L1169" rel="#L1169">1169</span>
<span id="L1170" rel="#L1170">1170</span>
<span id="L1171" rel="#L1171">1171</span>
<span id="L1172" rel="#L1172">1172</span>
<span id="L1173" rel="#L1173">1173</span>
<span id="L1174" rel="#L1174">1174</span>
<span id="L1175" rel="#L1175">1175</span>
<span id="L1176" rel="#L1176">1176</span>
<span id="L1177" rel="#L1177">1177</span>
<span id="L1178" rel="#L1178">1178</span>
<span id="L1179" rel="#L1179">1179</span>
<span id="L1180" rel="#L1180">1180</span>
<span id="L1181" rel="#L1181">1181</span>
<span id="L1182" rel="#L1182">1182</span>
<span id="L1183" rel="#L1183">1183</span>
<span id="L1184" rel="#L1184">1184</span>
<span id="L1185" rel="#L1185">1185</span>
<span id="L1186" rel="#L1186">1186</span>
<span id="L1187" rel="#L1187">1187</span>
<span id="L1188" rel="#L1188">1188</span>
<span id="L1189" rel="#L1189">1189</span>
<span id="L1190" rel="#L1190">1190</span>
<span id="L1191" rel="#L1191">1191</span>
<span id="L1192" rel="#L1192">1192</span>
<span id="L1193" rel="#L1193">1193</span>
<span id="L1194" rel="#L1194">1194</span>
<span id="L1195" rel="#L1195">1195</span>
<span id="L1196" rel="#L1196">1196</span>
<span id="L1197" rel="#L1197">1197</span>
<span id="L1198" rel="#L1198">1198</span>
<span id="L1199" rel="#L1199">1199</span>
<span id="L1200" rel="#L1200">1200</span>
<span id="L1201" rel="#L1201">1201</span>
<span id="L1202" rel="#L1202">1202</span>
<span id="L1203" rel="#L1203">1203</span>
<span id="L1204" rel="#L1204">1204</span>
<span id="L1205" rel="#L1205">1205</span>
<span id="L1206" rel="#L1206">1206</span>
<span id="L1207" rel="#L1207">1207</span>
<span id="L1208" rel="#L1208">1208</span>
<span id="L1209" rel="#L1209">1209</span>
<span id="L1210" rel="#L1210">1210</span>
<span id="L1211" rel="#L1211">1211</span>
<span id="L1212" rel="#L1212">1212</span>
<span id="L1213" rel="#L1213">1213</span>
<span id="L1214" rel="#L1214">1214</span>
<span id="L1215" rel="#L1215">1215</span>
<span id="L1216" rel="#L1216">1216</span>
<span id="L1217" rel="#L1217">1217</span>
<span id="L1218" rel="#L1218">1218</span>
<span id="L1219" rel="#L1219">1219</span>
<span id="L1220" rel="#L1220">1220</span>
<span id="L1221" rel="#L1221">1221</span>
<span id="L1222" rel="#L1222">1222</span>
<span id="L1223" rel="#L1223">1223</span>
<span id="L1224" rel="#L1224">1224</span>
<span id="L1225" rel="#L1225">1225</span>
<span id="L1226" rel="#L1226">1226</span>
<span id="L1227" rel="#L1227">1227</span>
<span id="L1228" rel="#L1228">1228</span>
<span id="L1229" rel="#L1229">1229</span>
<span id="L1230" rel="#L1230">1230</span>
<span id="L1231" rel="#L1231">1231</span>
<span id="L1232" rel="#L1232">1232</span>
<span id="L1233" rel="#L1233">1233</span>
<span id="L1234" rel="#L1234">1234</span>
<span id="L1235" rel="#L1235">1235</span>
<span id="L1236" rel="#L1236">1236</span>
<span id="L1237" rel="#L1237">1237</span>
<span id="L1238" rel="#L1238">1238</span>
<span id="L1239" rel="#L1239">1239</span>
<span id="L1240" rel="#L1240">1240</span>
<span id="L1241" rel="#L1241">1241</span>
<span id="L1242" rel="#L1242">1242</span>
<span id="L1243" rel="#L1243">1243</span>
<span id="L1244" rel="#L1244">1244</span>
<span id="L1245" rel="#L1245">1245</span>
<span id="L1246" rel="#L1246">1246</span>
<span id="L1247" rel="#L1247">1247</span>
<span id="L1248" rel="#L1248">1248</span>
<span id="L1249" rel="#L1249">1249</span>
<span id="L1250" rel="#L1250">1250</span>
<span id="L1251" rel="#L1251">1251</span>
<span id="L1252" rel="#L1252">1252</span>
<span id="L1253" rel="#L1253">1253</span>
<span id="L1254" rel="#L1254">1254</span>
<span id="L1255" rel="#L1255">1255</span>
<span id="L1256" rel="#L1256">1256</span>
<span id="L1257" rel="#L1257">1257</span>
<span id="L1258" rel="#L1258">1258</span>
<span id="L1259" rel="#L1259">1259</span>
<span id="L1260" rel="#L1260">1260</span>
<span id="L1261" rel="#L1261">1261</span>
<span id="L1262" rel="#L1262">1262</span>
<span id="L1263" rel="#L1263">1263</span>
<span id="L1264" rel="#L1264">1264</span>
<span id="L1265" rel="#L1265">1265</span>
<span id="L1266" rel="#L1266">1266</span>
<span id="L1267" rel="#L1267">1267</span>
<span id="L1268" rel="#L1268">1268</span>
<span id="L1269" rel="#L1269">1269</span>
<span id="L1270" rel="#L1270">1270</span>
<span id="L1271" rel="#L1271">1271</span>
<span id="L1272" rel="#L1272">1272</span>
<span id="L1273" rel="#L1273">1273</span>
<span id="L1274" rel="#L1274">1274</span>
<span id="L1275" rel="#L1275">1275</span>
<span id="L1276" rel="#L1276">1276</span>
<span id="L1277" rel="#L1277">1277</span>
<span id="L1278" rel="#L1278">1278</span>
<span id="L1279" rel="#L1279">1279</span>
<span id="L1280" rel="#L1280">1280</span>
<span id="L1281" rel="#L1281">1281</span>
<span id="L1282" rel="#L1282">1282</span>
<span id="L1283" rel="#L1283">1283</span>
<span id="L1284" rel="#L1284">1284</span>
<span id="L1285" rel="#L1285">1285</span>
<span id="L1286" rel="#L1286">1286</span>
<span id="L1287" rel="#L1287">1287</span>
<span id="L1288" rel="#L1288">1288</span>
<span id="L1289" rel="#L1289">1289</span>
<span id="L1290" rel="#L1290">1290</span>
<span id="L1291" rel="#L1291">1291</span>
<span id="L1292" rel="#L1292">1292</span>
<span id="L1293" rel="#L1293">1293</span>
<span id="L1294" rel="#L1294">1294</span>
<span id="L1295" rel="#L1295">1295</span>
<span id="L1296" rel="#L1296">1296</span>
<span id="L1297" rel="#L1297">1297</span>
<span id="L1298" rel="#L1298">1298</span>
<span id="L1299" rel="#L1299">1299</span>
<span id="L1300" rel="#L1300">1300</span>
<span id="L1301" rel="#L1301">1301</span>
<span id="L1302" rel="#L1302">1302</span>
<span id="L1303" rel="#L1303">1303</span>
<span id="L1304" rel="#L1304">1304</span>
<span id="L1305" rel="#L1305">1305</span>
<span id="L1306" rel="#L1306">1306</span>
<span id="L1307" rel="#L1307">1307</span>
<span id="L1308" rel="#L1308">1308</span>
<span id="L1309" rel="#L1309">1309</span>
<span id="L1310" rel="#L1310">1310</span>
<span id="L1311" rel="#L1311">1311</span>
<span id="L1312" rel="#L1312">1312</span>
<span id="L1313" rel="#L1313">1313</span>
<span id="L1314" rel="#L1314">1314</span>
<span id="L1315" rel="#L1315">1315</span>
<span id="L1316" rel="#L1316">1316</span>
<span id="L1317" rel="#L1317">1317</span>
<span id="L1318" rel="#L1318">1318</span>
<span id="L1319" rel="#L1319">1319</span>
<span id="L1320" rel="#L1320">1320</span>
<span id="L1321" rel="#L1321">1321</span>
<span id="L1322" rel="#L1322">1322</span>
<span id="L1323" rel="#L1323">1323</span>
<span id="L1324" rel="#L1324">1324</span>
<span id="L1325" rel="#L1325">1325</span>
<span id="L1326" rel="#L1326">1326</span>
<span id="L1327" rel="#L1327">1327</span>
<span id="L1328" rel="#L1328">1328</span>
<span id="L1329" rel="#L1329">1329</span>
<span id="L1330" rel="#L1330">1330</span>
<span id="L1331" rel="#L1331">1331</span>
<span id="L1332" rel="#L1332">1332</span>
<span id="L1333" rel="#L1333">1333</span>
<span id="L1334" rel="#L1334">1334</span>
<span id="L1335" rel="#L1335">1335</span>
<span id="L1336" rel="#L1336">1336</span>
<span id="L1337" rel="#L1337">1337</span>
<span id="L1338" rel="#L1338">1338</span>
<span id="L1339" rel="#L1339">1339</span>
<span id="L1340" rel="#L1340">1340</span>
<span id="L1341" rel="#L1341">1341</span>
<span id="L1342" rel="#L1342">1342</span>
<span id="L1343" rel="#L1343">1343</span>
<span id="L1344" rel="#L1344">1344</span>
<span id="L1345" rel="#L1345">1345</span>
<span id="L1346" rel="#L1346">1346</span>
<span id="L1347" rel="#L1347">1347</span>
<span id="L1348" rel="#L1348">1348</span>
<span id="L1349" rel="#L1349">1349</span>
<span id="L1350" rel="#L1350">1350</span>
<span id="L1351" rel="#L1351">1351</span>
<span id="L1352" rel="#L1352">1352</span>
<span id="L1353" rel="#L1353">1353</span>
<span id="L1354" rel="#L1354">1354</span>
<span id="L1355" rel="#L1355">1355</span>
<span id="L1356" rel="#L1356">1356</span>
<span id="L1357" rel="#L1357">1357</span>
<span id="L1358" rel="#L1358">1358</span>
<span id="L1359" rel="#L1359">1359</span>
<span id="L1360" rel="#L1360">1360</span>
<span id="L1361" rel="#L1361">1361</span>
<span id="L1362" rel="#L1362">1362</span>
<span id="L1363" rel="#L1363">1363</span>
<span id="L1364" rel="#L1364">1364</span>
<span id="L1365" rel="#L1365">1365</span>
<span id="L1366" rel="#L1366">1366</span>
<span id="L1367" rel="#L1367">1367</span>
<span id="L1368" rel="#L1368">1368</span>
<span id="L1369" rel="#L1369">1369</span>
<span id="L1370" rel="#L1370">1370</span>
<span id="L1371" rel="#L1371">1371</span>
<span id="L1372" rel="#L1372">1372</span>
<span id="L1373" rel="#L1373">1373</span>
<span id="L1374" rel="#L1374">1374</span>
<span id="L1375" rel="#L1375">1375</span>
<span id="L1376" rel="#L1376">1376</span>
<span id="L1377" rel="#L1377">1377</span>
<span id="L1378" rel="#L1378">1378</span>
<span id="L1379" rel="#L1379">1379</span>
<span id="L1380" rel="#L1380">1380</span>
<span id="L1381" rel="#L1381">1381</span>
<span id="L1382" rel="#L1382">1382</span>
<span id="L1383" rel="#L1383">1383</span>
<span id="L1384" rel="#L1384">1384</span>
<span id="L1385" rel="#L1385">1385</span>
<span id="L1386" rel="#L1386">1386</span>
<span id="L1387" rel="#L1387">1387</span>
<span id="L1388" rel="#L1388">1388</span>
<span id="L1389" rel="#L1389">1389</span>
<span id="L1390" rel="#L1390">1390</span>
<span id="L1391" rel="#L1391">1391</span>
<span id="L1392" rel="#L1392">1392</span>
<span id="L1393" rel="#L1393">1393</span>
<span id="L1394" rel="#L1394">1394</span>
<span id="L1395" rel="#L1395">1395</span>
<span id="L1396" rel="#L1396">1396</span>
<span id="L1397" rel="#L1397">1397</span>
<span id="L1398" rel="#L1398">1398</span>
<span id="L1399" rel="#L1399">1399</span>
<span id="L1400" rel="#L1400">1400</span>
<span id="L1401" rel="#L1401">1401</span>
<span id="L1402" rel="#L1402">1402</span>
<span id="L1403" rel="#L1403">1403</span>
<span id="L1404" rel="#L1404">1404</span>
<span id="L1405" rel="#L1405">1405</span>
<span id="L1406" rel="#L1406">1406</span>
<span id="L1407" rel="#L1407">1407</span>
<span id="L1408" rel="#L1408">1408</span>
<span id="L1409" rel="#L1409">1409</span>
<span id="L1410" rel="#L1410">1410</span>
<span id="L1411" rel="#L1411">1411</span>
<span id="L1412" rel="#L1412">1412</span>
<span id="L1413" rel="#L1413">1413</span>
<span id="L1414" rel="#L1414">1414</span>
<span id="L1415" rel="#L1415">1415</span>
<span id="L1416" rel="#L1416">1416</span>
<span id="L1417" rel="#L1417">1417</span>
<span id="L1418" rel="#L1418">1418</span>
<span id="L1419" rel="#L1419">1419</span>
<span id="L1420" rel="#L1420">1420</span>
<span id="L1421" rel="#L1421">1421</span>
<span id="L1422" rel="#L1422">1422</span>
<span id="L1423" rel="#L1423">1423</span>
<span id="L1424" rel="#L1424">1424</span>
<span id="L1425" rel="#L1425">1425</span>
<span id="L1426" rel="#L1426">1426</span>
<span id="L1427" rel="#L1427">1427</span>
<span id="L1428" rel="#L1428">1428</span>
<span id="L1429" rel="#L1429">1429</span>
<span id="L1430" rel="#L1430">1430</span>
<span id="L1431" rel="#L1431">1431</span>
<span id="L1432" rel="#L1432">1432</span>
<span id="L1433" rel="#L1433">1433</span>
<span id="L1434" rel="#L1434">1434</span>
<span id="L1435" rel="#L1435">1435</span>
<span id="L1436" rel="#L1436">1436</span>
<span id="L1437" rel="#L1437">1437</span>
<span id="L1438" rel="#L1438">1438</span>
<span id="L1439" rel="#L1439">1439</span>
<span id="L1440" rel="#L1440">1440</span>
<span id="L1441" rel="#L1441">1441</span>
<span id="L1442" rel="#L1442">1442</span>
<span id="L1443" rel="#L1443">1443</span>
<span id="L1444" rel="#L1444">1444</span>
<span id="L1445" rel="#L1445">1445</span>
<span id="L1446" rel="#L1446">1446</span>
<span id="L1447" rel="#L1447">1447</span>
<span id="L1448" rel="#L1448">1448</span>
<span id="L1449" rel="#L1449">1449</span>
<span id="L1450" rel="#L1450">1450</span>
<span id="L1451" rel="#L1451">1451</span>
<span id="L1452" rel="#L1452">1452</span>
<span id="L1453" rel="#L1453">1453</span>
<span id="L1454" rel="#L1454">1454</span>
<span id="L1455" rel="#L1455">1455</span>
<span id="L1456" rel="#L1456">1456</span>
<span id="L1457" rel="#L1457">1457</span>
<span id="L1458" rel="#L1458">1458</span>
<span id="L1459" rel="#L1459">1459</span>
<span id="L1460" rel="#L1460">1460</span>
<span id="L1461" rel="#L1461">1461</span>
<span id="L1462" rel="#L1462">1462</span>
<span id="L1463" rel="#L1463">1463</span>
<span id="L1464" rel="#L1464">1464</span>
<span id="L1465" rel="#L1465">1465</span>
<span id="L1466" rel="#L1466">1466</span>
<span id="L1467" rel="#L1467">1467</span>
<span id="L1468" rel="#L1468">1468</span>
<span id="L1469" rel="#L1469">1469</span>
<span id="L1470" rel="#L1470">1470</span>
<span id="L1471" rel="#L1471">1471</span>
<span id="L1472" rel="#L1472">1472</span>
<span id="L1473" rel="#L1473">1473</span>
<span id="L1474" rel="#L1474">1474</span>
<span id="L1475" rel="#L1475">1475</span>
<span id="L1476" rel="#L1476">1476</span>
<span id="L1477" rel="#L1477">1477</span>
<span id="L1478" rel="#L1478">1478</span>
<span id="L1479" rel="#L1479">1479</span>
<span id="L1480" rel="#L1480">1480</span>
<span id="L1481" rel="#L1481">1481</span>
<span id="L1482" rel="#L1482">1482</span>
<span id="L1483" rel="#L1483">1483</span>
<span id="L1484" rel="#L1484">1484</span>
<span id="L1485" rel="#L1485">1485</span>
<span id="L1486" rel="#L1486">1486</span>
<span id="L1487" rel="#L1487">1487</span>
<span id="L1488" rel="#L1488">1488</span>
<span id="L1489" rel="#L1489">1489</span>
<span id="L1490" rel="#L1490">1490</span>
<span id="L1491" rel="#L1491">1491</span>
<span id="L1492" rel="#L1492">1492</span>
<span id="L1493" rel="#L1493">1493</span>
<span id="L1494" rel="#L1494">1494</span>
<span id="L1495" rel="#L1495">1495</span>
<span id="L1496" rel="#L1496">1496</span>
<span id="L1497" rel="#L1497">1497</span>
<span id="L1498" rel="#L1498">1498</span>
<span id="L1499" rel="#L1499">1499</span>
<span id="L1500" rel="#L1500">1500</span>
<span id="L1501" rel="#L1501">1501</span>
<span id="L1502" rel="#L1502">1502</span>
<span id="L1503" rel="#L1503">1503</span>
<span id="L1504" rel="#L1504">1504</span>
<span id="L1505" rel="#L1505">1505</span>
<span id="L1506" rel="#L1506">1506</span>
<span id="L1507" rel="#L1507">1507</span>
<span id="L1508" rel="#L1508">1508</span>
<span id="L1509" rel="#L1509">1509</span>
<span id="L1510" rel="#L1510">1510</span>
<span id="L1511" rel="#L1511">1511</span>
<span id="L1512" rel="#L1512">1512</span>
<span id="L1513" rel="#L1513">1513</span>
<span id="L1514" rel="#L1514">1514</span>
<span id="L1515" rel="#L1515">1515</span>
<span id="L1516" rel="#L1516">1516</span>
<span id="L1517" rel="#L1517">1517</span>
<span id="L1518" rel="#L1518">1518</span>
<span id="L1519" rel="#L1519">1519</span>
<span id="L1520" rel="#L1520">1520</span>
<span id="L1521" rel="#L1521">1521</span>
<span id="L1522" rel="#L1522">1522</span>
<span id="L1523" rel="#L1523">1523</span>
<span id="L1524" rel="#L1524">1524</span>
<span id="L1525" rel="#L1525">1525</span>
<span id="L1526" rel="#L1526">1526</span>
<span id="L1527" rel="#L1527">1527</span>
<span id="L1528" rel="#L1528">1528</span>
<span id="L1529" rel="#L1529">1529</span>
<span id="L1530" rel="#L1530">1530</span>
<span id="L1531" rel="#L1531">1531</span>
<span id="L1532" rel="#L1532">1532</span>
<span id="L1533" rel="#L1533">1533</span>
<span id="L1534" rel="#L1534">1534</span>
<span id="L1535" rel="#L1535">1535</span>
<span id="L1536" rel="#L1536">1536</span>
<span id="L1537" rel="#L1537">1537</span>
<span id="L1538" rel="#L1538">1538</span>
<span id="L1539" rel="#L1539">1539</span>
<span id="L1540" rel="#L1540">1540</span>
<span id="L1541" rel="#L1541">1541</span>
<span id="L1542" rel="#L1542">1542</span>
<span id="L1543" rel="#L1543">1543</span>
<span id="L1544" rel="#L1544">1544</span>
<span id="L1545" rel="#L1545">1545</span>
<span id="L1546" rel="#L1546">1546</span>
<span id="L1547" rel="#L1547">1547</span>
<span id="L1548" rel="#L1548">1548</span>
<span id="L1549" rel="#L1549">1549</span>
<span id="L1550" rel="#L1550">1550</span>
<span id="L1551" rel="#L1551">1551</span>
<span id="L1552" rel="#L1552">1552</span>
<span id="L1553" rel="#L1553">1553</span>
<span id="L1554" rel="#L1554">1554</span>
<span id="L1555" rel="#L1555">1555</span>
<span id="L1556" rel="#L1556">1556</span>
<span id="L1557" rel="#L1557">1557</span>
<span id="L1558" rel="#L1558">1558</span>
<span id="L1559" rel="#L1559">1559</span>
<span id="L1560" rel="#L1560">1560</span>
<span id="L1561" rel="#L1561">1561</span>
<span id="L1562" rel="#L1562">1562</span>
<span id="L1563" rel="#L1563">1563</span>
<span id="L1564" rel="#L1564">1564</span>
<span id="L1565" rel="#L1565">1565</span>
<span id="L1566" rel="#L1566">1566</span>
<span id="L1567" rel="#L1567">1567</span>
<span id="L1568" rel="#L1568">1568</span>
<span id="L1569" rel="#L1569">1569</span>
<span id="L1570" rel="#L1570">1570</span>
<span id="L1571" rel="#L1571">1571</span>
<span id="L1572" rel="#L1572">1572</span>
<span id="L1573" rel="#L1573">1573</span>
<span id="L1574" rel="#L1574">1574</span>
<span id="L1575" rel="#L1575">1575</span>
<span id="L1576" rel="#L1576">1576</span>
<span id="L1577" rel="#L1577">1577</span>
<span id="L1578" rel="#L1578">1578</span>
<span id="L1579" rel="#L1579">1579</span>
<span id="L1580" rel="#L1580">1580</span>
<span id="L1581" rel="#L1581">1581</span>
<span id="L1582" rel="#L1582">1582</span>
<span id="L1583" rel="#L1583">1583</span>
<span id="L1584" rel="#L1584">1584</span>
<span id="L1585" rel="#L1585">1585</span>
<span id="L1586" rel="#L1586">1586</span>
<span id="L1587" rel="#L1587">1587</span>
<span id="L1588" rel="#L1588">1588</span>
<span id="L1589" rel="#L1589">1589</span>
<span id="L1590" rel="#L1590">1590</span>
<span id="L1591" rel="#L1591">1591</span>
<span id="L1592" rel="#L1592">1592</span>
<span id="L1593" rel="#L1593">1593</span>
<span id="L1594" rel="#L1594">1594</span>
<span id="L1595" rel="#L1595">1595</span>
<span id="L1596" rel="#L1596">1596</span>
<span id="L1597" rel="#L1597">1597</span>
<span id="L1598" rel="#L1598">1598</span>
<span id="L1599" rel="#L1599">1599</span>
<span id="L1600" rel="#L1600">1600</span>
<span id="L1601" rel="#L1601">1601</span>
<span id="L1602" rel="#L1602">1602</span>
<span id="L1603" rel="#L1603">1603</span>
<span id="L1604" rel="#L1604">1604</span>
<span id="L1605" rel="#L1605">1605</span>
<span id="L1606" rel="#L1606">1606</span>
<span id="L1607" rel="#L1607">1607</span>
<span id="L1608" rel="#L1608">1608</span>
<span id="L1609" rel="#L1609">1609</span>
<span id="L1610" rel="#L1610">1610</span>
<span id="L1611" rel="#L1611">1611</span>
<span id="L1612" rel="#L1612">1612</span>
<span id="L1613" rel="#L1613">1613</span>
<span id="L1614" rel="#L1614">1614</span>
<span id="L1615" rel="#L1615">1615</span>
<span id="L1616" rel="#L1616">1616</span>
<span id="L1617" rel="#L1617">1617</span>
<span id="L1618" rel="#L1618">1618</span>
<span id="L1619" rel="#L1619">1619</span>
<span id="L1620" rel="#L1620">1620</span>
<span id="L1621" rel="#L1621">1621</span>
<span id="L1622" rel="#L1622">1622</span>
<span id="L1623" rel="#L1623">1623</span>
<span id="L1624" rel="#L1624">1624</span>
<span id="L1625" rel="#L1625">1625</span>
<span id="L1626" rel="#L1626">1626</span>
<span id="L1627" rel="#L1627">1627</span>
<span id="L1628" rel="#L1628">1628</span>
<span id="L1629" rel="#L1629">1629</span>
<span id="L1630" rel="#L1630">1630</span>
<span id="L1631" rel="#L1631">1631</span>
<span id="L1632" rel="#L1632">1632</span>
<span id="L1633" rel="#L1633">1633</span>
<span id="L1634" rel="#L1634">1634</span>
<span id="L1635" rel="#L1635">1635</span>
<span id="L1636" rel="#L1636">1636</span>
<span id="L1637" rel="#L1637">1637</span>
<span id="L1638" rel="#L1638">1638</span>
<span id="L1639" rel="#L1639">1639</span>
<span id="L1640" rel="#L1640">1640</span>
<span id="L1641" rel="#L1641">1641</span>
<span id="L1642" rel="#L1642">1642</span>
<span id="L1643" rel="#L1643">1643</span>
<span id="L1644" rel="#L1644">1644</span>
<span id="L1645" rel="#L1645">1645</span>
<span id="L1646" rel="#L1646">1646</span>
<span id="L1647" rel="#L1647">1647</span>
<span id="L1648" rel="#L1648">1648</span>
<span id="L1649" rel="#L1649">1649</span>
<span id="L1650" rel="#L1650">1650</span>
<span id="L1651" rel="#L1651">1651</span>
<span id="L1652" rel="#L1652">1652</span>
<span id="L1653" rel="#L1653">1653</span>
<span id="L1654" rel="#L1654">1654</span>
<span id="L1655" rel="#L1655">1655</span>
<span id="L1656" rel="#L1656">1656</span>
<span id="L1657" rel="#L1657">1657</span>
<span id="L1658" rel="#L1658">1658</span>
<span id="L1659" rel="#L1659">1659</span>
<span id="L1660" rel="#L1660">1660</span>
<span id="L1661" rel="#L1661">1661</span>
<span id="L1662" rel="#L1662">1662</span>
<span id="L1663" rel="#L1663">1663</span>
<span id="L1664" rel="#L1664">1664</span>
<span id="L1665" rel="#L1665">1665</span>
<span id="L1666" rel="#L1666">1666</span>
<span id="L1667" rel="#L1667">1667</span>
<span id="L1668" rel="#L1668">1668</span>
<span id="L1669" rel="#L1669">1669</span>
<span id="L1670" rel="#L1670">1670</span>
<span id="L1671" rel="#L1671">1671</span>
<span id="L1672" rel="#L1672">1672</span>
<span id="L1673" rel="#L1673">1673</span>
<span id="L1674" rel="#L1674">1674</span>
<span id="L1675" rel="#L1675">1675</span>
<span id="L1676" rel="#L1676">1676</span>
<span id="L1677" rel="#L1677">1677</span>
<span id="L1678" rel="#L1678">1678</span>
<span id="L1679" rel="#L1679">1679</span>
<span id="L1680" rel="#L1680">1680</span>
<span id="L1681" rel="#L1681">1681</span>
<span id="L1682" rel="#L1682">1682</span>
<span id="L1683" rel="#L1683">1683</span>
<span id="L1684" rel="#L1684">1684</span>
<span id="L1685" rel="#L1685">1685</span>
<span id="L1686" rel="#L1686">1686</span>
<span id="L1687" rel="#L1687">1687</span>
<span id="L1688" rel="#L1688">1688</span>
<span id="L1689" rel="#L1689">1689</span>
<span id="L1690" rel="#L1690">1690</span>
<span id="L1691" rel="#L1691">1691</span>
<span id="L1692" rel="#L1692">1692</span>
<span id="L1693" rel="#L1693">1693</span>
<span id="L1694" rel="#L1694">1694</span>
<span id="L1695" rel="#L1695">1695</span>
<span id="L1696" rel="#L1696">1696</span>
<span id="L1697" rel="#L1697">1697</span>
<span id="L1698" rel="#L1698">1698</span>
<span id="L1699" rel="#L1699">1699</span>
<span id="L1700" rel="#L1700">1700</span>
<span id="L1701" rel="#L1701">1701</span>
<span id="L1702" rel="#L1702">1702</span>
<span id="L1703" rel="#L1703">1703</span>
<span id="L1704" rel="#L1704">1704</span>
<span id="L1705" rel="#L1705">1705</span>
<span id="L1706" rel="#L1706">1706</span>
<span id="L1707" rel="#L1707">1707</span>
<span id="L1708" rel="#L1708">1708</span>
<span id="L1709" rel="#L1709">1709</span>
<span id="L1710" rel="#L1710">1710</span>
<span id="L1711" rel="#L1711">1711</span>
<span id="L1712" rel="#L1712">1712</span>
<span id="L1713" rel="#L1713">1713</span>
<span id="L1714" rel="#L1714">1714</span>
<span id="L1715" rel="#L1715">1715</span>
<span id="L1716" rel="#L1716">1716</span>
<span id="L1717" rel="#L1717">1717</span>
<span id="L1718" rel="#L1718">1718</span>
<span id="L1719" rel="#L1719">1719</span>
<span id="L1720" rel="#L1720">1720</span>
<span id="L1721" rel="#L1721">1721</span>
<span id="L1722" rel="#L1722">1722</span>
<span id="L1723" rel="#L1723">1723</span>
<span id="L1724" rel="#L1724">1724</span>
<span id="L1725" rel="#L1725">1725</span>
<span id="L1726" rel="#L1726">1726</span>
<span id="L1727" rel="#L1727">1727</span>
<span id="L1728" rel="#L1728">1728</span>
<span id="L1729" rel="#L1729">1729</span>
<span id="L1730" rel="#L1730">1730</span>
<span id="L1731" rel="#L1731">1731</span>
<span id="L1732" rel="#L1732">1732</span>
<span id="L1733" rel="#L1733">1733</span>
<span id="L1734" rel="#L1734">1734</span>
<span id="L1735" rel="#L1735">1735</span>
<span id="L1736" rel="#L1736">1736</span>
<span id="L1737" rel="#L1737">1737</span>
<span id="L1738" rel="#L1738">1738</span>
<span id="L1739" rel="#L1739">1739</span>
<span id="L1740" rel="#L1740">1740</span>
<span id="L1741" rel="#L1741">1741</span>
<span id="L1742" rel="#L1742">1742</span>
<span id="L1743" rel="#L1743">1743</span>
<span id="L1744" rel="#L1744">1744</span>
<span id="L1745" rel="#L1745">1745</span>
<span id="L1746" rel="#L1746">1746</span>
<span id="L1747" rel="#L1747">1747</span>
<span id="L1748" rel="#L1748">1748</span>
<span id="L1749" rel="#L1749">1749</span>
<span id="L1750" rel="#L1750">1750</span>
<span id="L1751" rel="#L1751">1751</span>
<span id="L1752" rel="#L1752">1752</span>
<span id="L1753" rel="#L1753">1753</span>
<span id="L1754" rel="#L1754">1754</span>
<span id="L1755" rel="#L1755">1755</span>
<span id="L1756" rel="#L1756">1756</span>
<span id="L1757" rel="#L1757">1757</span>
<span id="L1758" rel="#L1758">1758</span>
<span id="L1759" rel="#L1759">1759</span>
<span id="L1760" rel="#L1760">1760</span>
<span id="L1761" rel="#L1761">1761</span>
<span id="L1762" rel="#L1762">1762</span>
<span id="L1763" rel="#L1763">1763</span>
<span id="L1764" rel="#L1764">1764</span>
<span id="L1765" rel="#L1765">1765</span>
<span id="L1766" rel="#L1766">1766</span>
<span id="L1767" rel="#L1767">1767</span>
<span id="L1768" rel="#L1768">1768</span>
<span id="L1769" rel="#L1769">1769</span>
<span id="L1770" rel="#L1770">1770</span>
<span id="L1771" rel="#L1771">1771</span>
<span id="L1772" rel="#L1772">1772</span>
<span id="L1773" rel="#L1773">1773</span>
<span id="L1774" rel="#L1774">1774</span>
<span id="L1775" rel="#L1775">1775</span>
<span id="L1776" rel="#L1776">1776</span>
<span id="L1777" rel="#L1777">1777</span>
<span id="L1778" rel="#L1778">1778</span>
<span id="L1779" rel="#L1779">1779</span>
<span id="L1780" rel="#L1780">1780</span>
<span id="L1781" rel="#L1781">1781</span>
<span id="L1782" rel="#L1782">1782</span>
<span id="L1783" rel="#L1783">1783</span>
<span id="L1784" rel="#L1784">1784</span>
<span id="L1785" rel="#L1785">1785</span>
<span id="L1786" rel="#L1786">1786</span>
<span id="L1787" rel="#L1787">1787</span>
<span id="L1788" rel="#L1788">1788</span>
<span id="L1789" rel="#L1789">1789</span>
<span id="L1790" rel="#L1790">1790</span>
<span id="L1791" rel="#L1791">1791</span>
<span id="L1792" rel="#L1792">1792</span>
<span id="L1793" rel="#L1793">1793</span>
<span id="L1794" rel="#L1794">1794</span>
<span id="L1795" rel="#L1795">1795</span>
<span id="L1796" rel="#L1796">1796</span>
<span id="L1797" rel="#L1797">1797</span>
<span id="L1798" rel="#L1798">1798</span>
<span id="L1799" rel="#L1799">1799</span>
<span id="L1800" rel="#L1800">1800</span>
<span id="L1801" rel="#L1801">1801</span>
<span id="L1802" rel="#L1802">1802</span>
<span id="L1803" rel="#L1803">1803</span>
<span id="L1804" rel="#L1804">1804</span>
<span id="L1805" rel="#L1805">1805</span>
<span id="L1806" rel="#L1806">1806</span>
<span id="L1807" rel="#L1807">1807</span>
<span id="L1808" rel="#L1808">1808</span>
<span id="L1809" rel="#L1809">1809</span>
<span id="L1810" rel="#L1810">1810</span>
<span id="L1811" rel="#L1811">1811</span>
<span id="L1812" rel="#L1812">1812</span>
<span id="L1813" rel="#L1813">1813</span>
<span id="L1814" rel="#L1814">1814</span>
<span id="L1815" rel="#L1815">1815</span>
<span id="L1816" rel="#L1816">1816</span>
<span id="L1817" rel="#L1817">1817</span>
<span id="L1818" rel="#L1818">1818</span>
<span id="L1819" rel="#L1819">1819</span>
<span id="L1820" rel="#L1820">1820</span>
<span id="L1821" rel="#L1821">1821</span>
<span id="L1822" rel="#L1822">1822</span>
<span id="L1823" rel="#L1823">1823</span>
<span id="L1824" rel="#L1824">1824</span>
<span id="L1825" rel="#L1825">1825</span>
<span id="L1826" rel="#L1826">1826</span>
<span id="L1827" rel="#L1827">1827</span>
<span id="L1828" rel="#L1828">1828</span>
<span id="L1829" rel="#L1829">1829</span>
<span id="L1830" rel="#L1830">1830</span>
<span id="L1831" rel="#L1831">1831</span>
<span id="L1832" rel="#L1832">1832</span>
<span id="L1833" rel="#L1833">1833</span>
<span id="L1834" rel="#L1834">1834</span>
<span id="L1835" rel="#L1835">1835</span>
<span id="L1836" rel="#L1836">1836</span>
<span id="L1837" rel="#L1837">1837</span>
<span id="L1838" rel="#L1838">1838</span>
<span id="L1839" rel="#L1839">1839</span>
<span id="L1840" rel="#L1840">1840</span>
<span id="L1841" rel="#L1841">1841</span>
<span id="L1842" rel="#L1842">1842</span>
<span id="L1843" rel="#L1843">1843</span>
<span id="L1844" rel="#L1844">1844</span>
<span id="L1845" rel="#L1845">1845</span>
<span id="L1846" rel="#L1846">1846</span>
<span id="L1847" rel="#L1847">1847</span>
<span id="L1848" rel="#L1848">1848</span>
<span id="L1849" rel="#L1849">1849</span>
<span id="L1850" rel="#L1850">1850</span>
<span id="L1851" rel="#L1851">1851</span>
<span id="L1852" rel="#L1852">1852</span>
<span id="L1853" rel="#L1853">1853</span>
<span id="L1854" rel="#L1854">1854</span>
<span id="L1855" rel="#L1855">1855</span>
<span id="L1856" rel="#L1856">1856</span>
<span id="L1857" rel="#L1857">1857</span>
<span id="L1858" rel="#L1858">1858</span>
<span id="L1859" rel="#L1859">1859</span>
<span id="L1860" rel="#L1860">1860</span>
<span id="L1861" rel="#L1861">1861</span>
<span id="L1862" rel="#L1862">1862</span>
<span id="L1863" rel="#L1863">1863</span>
<span id="L1864" rel="#L1864">1864</span>
<span id="L1865" rel="#L1865">1865</span>
<span id="L1866" rel="#L1866">1866</span>
<span id="L1867" rel="#L1867">1867</span>
<span id="L1868" rel="#L1868">1868</span>
<span id="L1869" rel="#L1869">1869</span>
<span id="L1870" rel="#L1870">1870</span>
<span id="L1871" rel="#L1871">1871</span>
<span id="L1872" rel="#L1872">1872</span>
<span id="L1873" rel="#L1873">1873</span>
<span id="L1874" rel="#L1874">1874</span>
<span id="L1875" rel="#L1875">1875</span>
<span id="L1876" rel="#L1876">1876</span>
<span id="L1877" rel="#L1877">1877</span>
<span id="L1878" rel="#L1878">1878</span>
<span id="L1879" rel="#L1879">1879</span>
<span id="L1880" rel="#L1880">1880</span>
<span id="L1881" rel="#L1881">1881</span>
<span id="L1882" rel="#L1882">1882</span>
<span id="L1883" rel="#L1883">1883</span>
<span id="L1884" rel="#L1884">1884</span>
<span id="L1885" rel="#L1885">1885</span>
<span id="L1886" rel="#L1886">1886</span>
<span id="L1887" rel="#L1887">1887</span>
<span id="L1888" rel="#L1888">1888</span>
<span id="L1889" rel="#L1889">1889</span>
<span id="L1890" rel="#L1890">1890</span>
<span id="L1891" rel="#L1891">1891</span>
<span id="L1892" rel="#L1892">1892</span>
<span id="L1893" rel="#L1893">1893</span>
<span id="L1894" rel="#L1894">1894</span>
<span id="L1895" rel="#L1895">1895</span>
<span id="L1896" rel="#L1896">1896</span>
<span id="L1897" rel="#L1897">1897</span>
<span id="L1898" rel="#L1898">1898</span>
<span id="L1899" rel="#L1899">1899</span>
<span id="L1900" rel="#L1900">1900</span>
<span id="L1901" rel="#L1901">1901</span>
<span id="L1902" rel="#L1902">1902</span>
<span id="L1903" rel="#L1903">1903</span>
<span id="L1904" rel="#L1904">1904</span>
<span id="L1905" rel="#L1905">1905</span>
<span id="L1906" rel="#L1906">1906</span>
<span id="L1907" rel="#L1907">1907</span>
<span id="L1908" rel="#L1908">1908</span>
<span id="L1909" rel="#L1909">1909</span>
<span id="L1910" rel="#L1910">1910</span>
<span id="L1911" rel="#L1911">1911</span>
<span id="L1912" rel="#L1912">1912</span>
<span id="L1913" rel="#L1913">1913</span>
<span id="L1914" rel="#L1914">1914</span>
<span id="L1915" rel="#L1915">1915</span>
<span id="L1916" rel="#L1916">1916</span>
<span id="L1917" rel="#L1917">1917</span>
<span id="L1918" rel="#L1918">1918</span>
<span id="L1919" rel="#L1919">1919</span>
<span id="L1920" rel="#L1920">1920</span>
<span id="L1921" rel="#L1921">1921</span>
<span id="L1922" rel="#L1922">1922</span>
<span id="L1923" rel="#L1923">1923</span>
<span id="L1924" rel="#L1924">1924</span>
<span id="L1925" rel="#L1925">1925</span>
<span id="L1926" rel="#L1926">1926</span>
<span id="L1927" rel="#L1927">1927</span>
<span id="L1928" rel="#L1928">1928</span>
<span id="L1929" rel="#L1929">1929</span>
<span id="L1930" rel="#L1930">1930</span>
<span id="L1931" rel="#L1931">1931</span>
<span id="L1932" rel="#L1932">1932</span>
<span id="L1933" rel="#L1933">1933</span>
<span id="L1934" rel="#L1934">1934</span>
<span id="L1935" rel="#L1935">1935</span>
<span id="L1936" rel="#L1936">1936</span>
<span id="L1937" rel="#L1937">1937</span>
<span id="L1938" rel="#L1938">1938</span>
<span id="L1939" rel="#L1939">1939</span>
<span id="L1940" rel="#L1940">1940</span>
<span id="L1941" rel="#L1941">1941</span>
<span id="L1942" rel="#L1942">1942</span>
<span id="L1943" rel="#L1943">1943</span>
<span id="L1944" rel="#L1944">1944</span>
<span id="L1945" rel="#L1945">1945</span>
<span id="L1946" rel="#L1946">1946</span>
<span id="L1947" rel="#L1947">1947</span>
<span id="L1948" rel="#L1948">1948</span>
<span id="L1949" rel="#L1949">1949</span>
<span id="L1950" rel="#L1950">1950</span>
<span id="L1951" rel="#L1951">1951</span>
<span id="L1952" rel="#L1952">1952</span>
<span id="L1953" rel="#L1953">1953</span>
<span id="L1954" rel="#L1954">1954</span>
<span id="L1955" rel="#L1955">1955</span>
<span id="L1956" rel="#L1956">1956</span>
<span id="L1957" rel="#L1957">1957</span>
<span id="L1958" rel="#L1958">1958</span>
<span id="L1959" rel="#L1959">1959</span>
<span id="L1960" rel="#L1960">1960</span>
<span id="L1961" rel="#L1961">1961</span>
<span id="L1962" rel="#L1962">1962</span>
<span id="L1963" rel="#L1963">1963</span>
<span id="L1964" rel="#L1964">1964</span>
<span id="L1965" rel="#L1965">1965</span>
<span id="L1966" rel="#L1966">1966</span>
<span id="L1967" rel="#L1967">1967</span>
<span id="L1968" rel="#L1968">1968</span>
<span id="L1969" rel="#L1969">1969</span>
<span id="L1970" rel="#L1970">1970</span>
<span id="L1971" rel="#L1971">1971</span>
<span id="L1972" rel="#L1972">1972</span>
<span id="L1973" rel="#L1973">1973</span>
<span id="L1974" rel="#L1974">1974</span>
<span id="L1975" rel="#L1975">1975</span>
<span id="L1976" rel="#L1976">1976</span>
<span id="L1977" rel="#L1977">1977</span>
<span id="L1978" rel="#L1978">1978</span>
<span id="L1979" rel="#L1979">1979</span>
<span id="L1980" rel="#L1980">1980</span>
<span id="L1981" rel="#L1981">1981</span>
<span id="L1982" rel="#L1982">1982</span>
<span id="L1983" rel="#L1983">1983</span>
<span id="L1984" rel="#L1984">1984</span>
<span id="L1985" rel="#L1985">1985</span>
<span id="L1986" rel="#L1986">1986</span>
<span id="L1987" rel="#L1987">1987</span>
<span id="L1988" rel="#L1988">1988</span>
<span id="L1989" rel="#L1989">1989</span>
<span id="L1990" rel="#L1990">1990</span>
<span id="L1991" rel="#L1991">1991</span>
<span id="L1992" rel="#L1992">1992</span>
<span id="L1993" rel="#L1993">1993</span>
<span id="L1994" rel="#L1994">1994</span>
<span id="L1995" rel="#L1995">1995</span>
<span id="L1996" rel="#L1996">1996</span>
<span id="L1997" rel="#L1997">1997</span>
<span id="L1998" rel="#L1998">1998</span>
<span id="L1999" rel="#L1999">1999</span>
<span id="L2000" rel="#L2000">2000</span>
<span id="L2001" rel="#L2001">2001</span>
<span id="L2002" rel="#L2002">2002</span>
<span id="L2003" rel="#L2003">2003</span>
<span id="L2004" rel="#L2004">2004</span>
<span id="L2005" rel="#L2005">2005</span>
<span id="L2006" rel="#L2006">2006</span>
<span id="L2007" rel="#L2007">2007</span>
<span id="L2008" rel="#L2008">2008</span>
<span id="L2009" rel="#L2009">2009</span>
<span id="L2010" rel="#L2010">2010</span>
<span id="L2011" rel="#L2011">2011</span>
<span id="L2012" rel="#L2012">2012</span>
<span id="L2013" rel="#L2013">2013</span>
<span id="L2014" rel="#L2014">2014</span>
<span id="L2015" rel="#L2015">2015</span>
<span id="L2016" rel="#L2016">2016</span>
<span id="L2017" rel="#L2017">2017</span>
<span id="L2018" rel="#L2018">2018</span>
<span id="L2019" rel="#L2019">2019</span>
<span id="L2020" rel="#L2020">2020</span>
<span id="L2021" rel="#L2021">2021</span>
<span id="L2022" rel="#L2022">2022</span>
<span id="L2023" rel="#L2023">2023</span>
<span id="L2024" rel="#L2024">2024</span>
<span id="L2025" rel="#L2025">2025</span>
<span id="L2026" rel="#L2026">2026</span>
<span id="L2027" rel="#L2027">2027</span>
<span id="L2028" rel="#L2028">2028</span>
<span id="L2029" rel="#L2029">2029</span>
<span id="L2030" rel="#L2030">2030</span>
<span id="L2031" rel="#L2031">2031</span>
<span id="L2032" rel="#L2032">2032</span>
<span id="L2033" rel="#L2033">2033</span>
<span id="L2034" rel="#L2034">2034</span>
<span id="L2035" rel="#L2035">2035</span>
<span id="L2036" rel="#L2036">2036</span>
<span id="L2037" rel="#L2037">2037</span>
<span id="L2038" rel="#L2038">2038</span>
<span id="L2039" rel="#L2039">2039</span>
<span id="L2040" rel="#L2040">2040</span>
<span id="L2041" rel="#L2041">2041</span>
<span id="L2042" rel="#L2042">2042</span>
<span id="L2043" rel="#L2043">2043</span>
<span id="L2044" rel="#L2044">2044</span>
<span id="L2045" rel="#L2045">2045</span>
<span id="L2046" rel="#L2046">2046</span>
<span id="L2047" rel="#L2047">2047</span>
<span id="L2048" rel="#L2048">2048</span>
<span id="L2049" rel="#L2049">2049</span>
<span id="L2050" rel="#L2050">2050</span>
<span id="L2051" rel="#L2051">2051</span>
<span id="L2052" rel="#L2052">2052</span>
<span id="L2053" rel="#L2053">2053</span>
<span id="L2054" rel="#L2054">2054</span>
<span id="L2055" rel="#L2055">2055</span>
<span id="L2056" rel="#L2056">2056</span>
<span id="L2057" rel="#L2057">2057</span>
<span id="L2058" rel="#L2058">2058</span>
<span id="L2059" rel="#L2059">2059</span>
<span id="L2060" rel="#L2060">2060</span>
<span id="L2061" rel="#L2061">2061</span>
<span id="L2062" rel="#L2062">2062</span>
<span id="L2063" rel="#L2063">2063</span>
<span id="L2064" rel="#L2064">2064</span>
<span id="L2065" rel="#L2065">2065</span>
<span id="L2066" rel="#L2066">2066</span>
<span id="L2067" rel="#L2067">2067</span>
<span id="L2068" rel="#L2068">2068</span>
<span id="L2069" rel="#L2069">2069</span>
<span id="L2070" rel="#L2070">2070</span>
<span id="L2071" rel="#L2071">2071</span>
<span id="L2072" rel="#L2072">2072</span>
<span id="L2073" rel="#L2073">2073</span>
<span id="L2074" rel="#L2074">2074</span>
<span id="L2075" rel="#L2075">2075</span>
<span id="L2076" rel="#L2076">2076</span>
<span id="L2077" rel="#L2077">2077</span>
<span id="L2078" rel="#L2078">2078</span>
<span id="L2079" rel="#L2079">2079</span>
<span id="L2080" rel="#L2080">2080</span>
<span id="L2081" rel="#L2081">2081</span>
<span id="L2082" rel="#L2082">2082</span>
<span id="L2083" rel="#L2083">2083</span>
<span id="L2084" rel="#L2084">2084</span>
<span id="L2085" rel="#L2085">2085</span>
<span id="L2086" rel="#L2086">2086</span>
<span id="L2087" rel="#L2087">2087</span>
<span id="L2088" rel="#L2088">2088</span>
<span id="L2089" rel="#L2089">2089</span>
<span id="L2090" rel="#L2090">2090</span>
<span id="L2091" rel="#L2091">2091</span>
<span id="L2092" rel="#L2092">2092</span>
<span id="L2093" rel="#L2093">2093</span>
<span id="L2094" rel="#L2094">2094</span>
<span id="L2095" rel="#L2095">2095</span>
<span id="L2096" rel="#L2096">2096</span>
<span id="L2097" rel="#L2097">2097</span>
<span id="L2098" rel="#L2098">2098</span>
<span id="L2099" rel="#L2099">2099</span>
<span id="L2100" rel="#L2100">2100</span>
<span id="L2101" rel="#L2101">2101</span>
<span id="L2102" rel="#L2102">2102</span>
<span id="L2103" rel="#L2103">2103</span>
<span id="L2104" rel="#L2104">2104</span>
<span id="L2105" rel="#L2105">2105</span>
<span id="L2106" rel="#L2106">2106</span>
<span id="L2107" rel="#L2107">2107</span>
<span id="L2108" rel="#L2108">2108</span>
<span id="L2109" rel="#L2109">2109</span>
<span id="L2110" rel="#L2110">2110</span>
<span id="L2111" rel="#L2111">2111</span>
<span id="L2112" rel="#L2112">2112</span>
<span id="L2113" rel="#L2113">2113</span>
<span id="L2114" rel="#L2114">2114</span>
<span id="L2115" rel="#L2115">2115</span>
<span id="L2116" rel="#L2116">2116</span>
<span id="L2117" rel="#L2117">2117</span>
<span id="L2118" rel="#L2118">2118</span>
<span id="L2119" rel="#L2119">2119</span>
<span id="L2120" rel="#L2120">2120</span>
<span id="L2121" rel="#L2121">2121</span>
<span id="L2122" rel="#L2122">2122</span>
<span id="L2123" rel="#L2123">2123</span>
<span id="L2124" rel="#L2124">2124</span>
<span id="L2125" rel="#L2125">2125</span>
<span id="L2126" rel="#L2126">2126</span>
<span id="L2127" rel="#L2127">2127</span>
<span id="L2128" rel="#L2128">2128</span>
<span id="L2129" rel="#L2129">2129</span>
<span id="L2130" rel="#L2130">2130</span>
<span id="L2131" rel="#L2131">2131</span>
<span id="L2132" rel="#L2132">2132</span>
<span id="L2133" rel="#L2133">2133</span>
<span id="L2134" rel="#L2134">2134</span>
<span id="L2135" rel="#L2135">2135</span>
<span id="L2136" rel="#L2136">2136</span>
<span id="L2137" rel="#L2137">2137</span>
<span id="L2138" rel="#L2138">2138</span>
<span id="L2139" rel="#L2139">2139</span>
<span id="L2140" rel="#L2140">2140</span>
<span id="L2141" rel="#L2141">2141</span>
<span id="L2142" rel="#L2142">2142</span>
<span id="L2143" rel="#L2143">2143</span>
<span id="L2144" rel="#L2144">2144</span>
<span id="L2145" rel="#L2145">2145</span>
<span id="L2146" rel="#L2146">2146</span>
<span id="L2147" rel="#L2147">2147</span>
<span id="L2148" rel="#L2148">2148</span>
<span id="L2149" rel="#L2149">2149</span>
<span id="L2150" rel="#L2150">2150</span>
<span id="L2151" rel="#L2151">2151</span>
<span id="L2152" rel="#L2152">2152</span>
<span id="L2153" rel="#L2153">2153</span>
<span id="L2154" rel="#L2154">2154</span>
<span id="L2155" rel="#L2155">2155</span>
<span id="L2156" rel="#L2156">2156</span>
<span id="L2157" rel="#L2157">2157</span>
<span id="L2158" rel="#L2158">2158</span>
<span id="L2159" rel="#L2159">2159</span>
<span id="L2160" rel="#L2160">2160</span>
<span id="L2161" rel="#L2161">2161</span>
<span id="L2162" rel="#L2162">2162</span>
<span id="L2163" rel="#L2163">2163</span>
<span id="L2164" rel="#L2164">2164</span>
<span id="L2165" rel="#L2165">2165</span>
<span id="L2166" rel="#L2166">2166</span>
<span id="L2167" rel="#L2167">2167</span>
<span id="L2168" rel="#L2168">2168</span>
<span id="L2169" rel="#L2169">2169</span>
<span id="L2170" rel="#L2170">2170</span>
<span id="L2171" rel="#L2171">2171</span>
<span id="L2172" rel="#L2172">2172</span>
<span id="L2173" rel="#L2173">2173</span>
<span id="L2174" rel="#L2174">2174</span>
<span id="L2175" rel="#L2175">2175</span>
<span id="L2176" rel="#L2176">2176</span>
<span id="L2177" rel="#L2177">2177</span>
<span id="L2178" rel="#L2178">2178</span>
<span id="L2179" rel="#L2179">2179</span>
<span id="L2180" rel="#L2180">2180</span>
<span id="L2181" rel="#L2181">2181</span>
<span id="L2182" rel="#L2182">2182</span>
<span id="L2183" rel="#L2183">2183</span>
<span id="L2184" rel="#L2184">2184</span>
<span id="L2185" rel="#L2185">2185</span>
<span id="L2186" rel="#L2186">2186</span>
<span id="L2187" rel="#L2187">2187</span>
<span id="L2188" rel="#L2188">2188</span>
<span id="L2189" rel="#L2189">2189</span>
<span id="L2190" rel="#L2190">2190</span>
<span id="L2191" rel="#L2191">2191</span>
<span id="L2192" rel="#L2192">2192</span>
<span id="L2193" rel="#L2193">2193</span>
<span id="L2194" rel="#L2194">2194</span>
<span id="L2195" rel="#L2195">2195</span>
<span id="L2196" rel="#L2196">2196</span>
<span id="L2197" rel="#L2197">2197</span>
<span id="L2198" rel="#L2198">2198</span>
<span id="L2199" rel="#L2199">2199</span>
<span id="L2200" rel="#L2200">2200</span>
<span id="L2201" rel="#L2201">2201</span>
<span id="L2202" rel="#L2202">2202</span>
<span id="L2203" rel="#L2203">2203</span>
<span id="L2204" rel="#L2204">2204</span>
<span id="L2205" rel="#L2205">2205</span>
<span id="L2206" rel="#L2206">2206</span>
<span id="L2207" rel="#L2207">2207</span>
<span id="L2208" rel="#L2208">2208</span>
<span id="L2209" rel="#L2209">2209</span>
<span id="L2210" rel="#L2210">2210</span>
<span id="L2211" rel="#L2211">2211</span>
<span id="L2212" rel="#L2212">2212</span>
<span id="L2213" rel="#L2213">2213</span>
<span id="L2214" rel="#L2214">2214</span>
<span id="L2215" rel="#L2215">2215</span>
<span id="L2216" rel="#L2216">2216</span>
<span id="L2217" rel="#L2217">2217</span>
<span id="L2218" rel="#L2218">2218</span>
<span id="L2219" rel="#L2219">2219</span>
<span id="L2220" rel="#L2220">2220</span>
<span id="L2221" rel="#L2221">2221</span>
<span id="L2222" rel="#L2222">2222</span>
<span id="L2223" rel="#L2223">2223</span>
<span id="L2224" rel="#L2224">2224</span>
<span id="L2225" rel="#L2225">2225</span>
<span id="L2226" rel="#L2226">2226</span>
<span id="L2227" rel="#L2227">2227</span>
<span id="L2228" rel="#L2228">2228</span>
<span id="L2229" rel="#L2229">2229</span>
<span id="L2230" rel="#L2230">2230</span>
<span id="L2231" rel="#L2231">2231</span>
<span id="L2232" rel="#L2232">2232</span>
<span id="L2233" rel="#L2233">2233</span>
<span id="L2234" rel="#L2234">2234</span>
<span id="L2235" rel="#L2235">2235</span>
<span id="L2236" rel="#L2236">2236</span>
<span id="L2237" rel="#L2237">2237</span>
<span id="L2238" rel="#L2238">2238</span>
<span id="L2239" rel="#L2239">2239</span>
<span id="L2240" rel="#L2240">2240</span>
<span id="L2241" rel="#L2241">2241</span>
<span id="L2242" rel="#L2242">2242</span>
<span id="L2243" rel="#L2243">2243</span>
<span id="L2244" rel="#L2244">2244</span>
<span id="L2245" rel="#L2245">2245</span>
<span id="L2246" rel="#L2246">2246</span>
<span id="L2247" rel="#L2247">2247</span>
<span id="L2248" rel="#L2248">2248</span>
<span id="L2249" rel="#L2249">2249</span>
<span id="L2250" rel="#L2250">2250</span>
<span id="L2251" rel="#L2251">2251</span>
<span id="L2252" rel="#L2252">2252</span>
<span id="L2253" rel="#L2253">2253</span>
<span id="L2254" rel="#L2254">2254</span>
<span id="L2255" rel="#L2255">2255</span>
<span id="L2256" rel="#L2256">2256</span>
<span id="L2257" rel="#L2257">2257</span>
<span id="L2258" rel="#L2258">2258</span>
<span id="L2259" rel="#L2259">2259</span>
<span id="L2260" rel="#L2260">2260</span>
<span id="L2261" rel="#L2261">2261</span>
<span id="L2262" rel="#L2262">2262</span>
<span id="L2263" rel="#L2263">2263</span>
<span id="L2264" rel="#L2264">2264</span>
<span id="L2265" rel="#L2265">2265</span>
<span id="L2266" rel="#L2266">2266</span>
<span id="L2267" rel="#L2267">2267</span>
<span id="L2268" rel="#L2268">2268</span>
<span id="L2269" rel="#L2269">2269</span>
<span id="L2270" rel="#L2270">2270</span>
<span id="L2271" rel="#L2271">2271</span>
<span id="L2272" rel="#L2272">2272</span>
<span id="L2273" rel="#L2273">2273</span>
<span id="L2274" rel="#L2274">2274</span>
<span id="L2275" rel="#L2275">2275</span>
<span id="L2276" rel="#L2276">2276</span>
<span id="L2277" rel="#L2277">2277</span>
<span id="L2278" rel="#L2278">2278</span>
<span id="L2279" rel="#L2279">2279</span>
<span id="L2280" rel="#L2280">2280</span>
<span id="L2281" rel="#L2281">2281</span>
<span id="L2282" rel="#L2282">2282</span>
<span id="L2283" rel="#L2283">2283</span>
<span id="L2284" rel="#L2284">2284</span>
<span id="L2285" rel="#L2285">2285</span>
<span id="L2286" rel="#L2286">2286</span>
<span id="L2287" rel="#L2287">2287</span>
<span id="L2288" rel="#L2288">2288</span>
<span id="L2289" rel="#L2289">2289</span>
<span id="L2290" rel="#L2290">2290</span>
<span id="L2291" rel="#L2291">2291</span>
<span id="L2292" rel="#L2292">2292</span>
<span id="L2293" rel="#L2293">2293</span>
<span id="L2294" rel="#L2294">2294</span>
<span id="L2295" rel="#L2295">2295</span>
<span id="L2296" rel="#L2296">2296</span>
<span id="L2297" rel="#L2297">2297</span>
<span id="L2298" rel="#L2298">2298</span>
<span id="L2299" rel="#L2299">2299</span>
<span id="L2300" rel="#L2300">2300</span>
<span id="L2301" rel="#L2301">2301</span>
<span id="L2302" rel="#L2302">2302</span>
<span id="L2303" rel="#L2303">2303</span>
<span id="L2304" rel="#L2304">2304</span>
<span id="L2305" rel="#L2305">2305</span>
<span id="L2306" rel="#L2306">2306</span>
<span id="L2307" rel="#L2307">2307</span>
<span id="L2308" rel="#L2308">2308</span>
<span id="L2309" rel="#L2309">2309</span>
<span id="L2310" rel="#L2310">2310</span>
<span id="L2311" rel="#L2311">2311</span>
<span id="L2312" rel="#L2312">2312</span>
<span id="L2313" rel="#L2313">2313</span>
<span id="L2314" rel="#L2314">2314</span>
<span id="L2315" rel="#L2315">2315</span>
<span id="L2316" rel="#L2316">2316</span>
<span id="L2317" rel="#L2317">2317</span>
<span id="L2318" rel="#L2318">2318</span>
<span id="L2319" rel="#L2319">2319</span>
<span id="L2320" rel="#L2320">2320</span>
<span id="L2321" rel="#L2321">2321</span>
<span id="L2322" rel="#L2322">2322</span>
<span id="L2323" rel="#L2323">2323</span>
<span id="L2324" rel="#L2324">2324</span>
<span id="L2325" rel="#L2325">2325</span>
<span id="L2326" rel="#L2326">2326</span>
<span id="L2327" rel="#L2327">2327</span>
<span id="L2328" rel="#L2328">2328</span>
<span id="L2329" rel="#L2329">2329</span>
<span id="L2330" rel="#L2330">2330</span>
<span id="L2331" rel="#L2331">2331</span>
<span id="L2332" rel="#L2332">2332</span>
<span id="L2333" rel="#L2333">2333</span>
<span id="L2334" rel="#L2334">2334</span>
<span id="L2335" rel="#L2335">2335</span>
<span id="L2336" rel="#L2336">2336</span>
<span id="L2337" rel="#L2337">2337</span>
<span id="L2338" rel="#L2338">2338</span>
<span id="L2339" rel="#L2339">2339</span>
<span id="L2340" rel="#L2340">2340</span>
<span id="L2341" rel="#L2341">2341</span>
<span id="L2342" rel="#L2342">2342</span>
<span id="L2343" rel="#L2343">2343</span>
<span id="L2344" rel="#L2344">2344</span>
<span id="L2345" rel="#L2345">2345</span>
<span id="L2346" rel="#L2346">2346</span>
<span id="L2347" rel="#L2347">2347</span>
<span id="L2348" rel="#L2348">2348</span>
<span id="L2349" rel="#L2349">2349</span>
<span id="L2350" rel="#L2350">2350</span>
<span id="L2351" rel="#L2351">2351</span>
<span id="L2352" rel="#L2352">2352</span>
<span id="L2353" rel="#L2353">2353</span>
<span id="L2354" rel="#L2354">2354</span>
<span id="L2355" rel="#L2355">2355</span>
<span id="L2356" rel="#L2356">2356</span>
<span id="L2357" rel="#L2357">2357</span>
<span id="L2358" rel="#L2358">2358</span>
<span id="L2359" rel="#L2359">2359</span>
<span id="L2360" rel="#L2360">2360</span>
<span id="L2361" rel="#L2361">2361</span>
<span id="L2362" rel="#L2362">2362</span>
<span id="L2363" rel="#L2363">2363</span>
<span id="L2364" rel="#L2364">2364</span>
<span id="L2365" rel="#L2365">2365</span>
<span id="L2366" rel="#L2366">2366</span>
<span id="L2367" rel="#L2367">2367</span>
<span id="L2368" rel="#L2368">2368</span>
<span id="L2369" rel="#L2369">2369</span>
<span id="L2370" rel="#L2370">2370</span>
<span id="L2371" rel="#L2371">2371</span>
<span id="L2372" rel="#L2372">2372</span>
<span id="L2373" rel="#L2373">2373</span>
<span id="L2374" rel="#L2374">2374</span>
<span id="L2375" rel="#L2375">2375</span>
<span id="L2376" rel="#L2376">2376</span>
<span id="L2377" rel="#L2377">2377</span>
<span id="L2378" rel="#L2378">2378</span>
<span id="L2379" rel="#L2379">2379</span>
<span id="L2380" rel="#L2380">2380</span>
<span id="L2381" rel="#L2381">2381</span>
<span id="L2382" rel="#L2382">2382</span>
<span id="L2383" rel="#L2383">2383</span>
<span id="L2384" rel="#L2384">2384</span>
<span id="L2385" rel="#L2385">2385</span>
<span id="L2386" rel="#L2386">2386</span>
<span id="L2387" rel="#L2387">2387</span>
<span id="L2388" rel="#L2388">2388</span>
<span id="L2389" rel="#L2389">2389</span>
<span id="L2390" rel="#L2390">2390</span>
<span id="L2391" rel="#L2391">2391</span>
<span id="L2392" rel="#L2392">2392</span>
<span id="L2393" rel="#L2393">2393</span>
<span id="L2394" rel="#L2394">2394</span>
<span id="L2395" rel="#L2395">2395</span>
<span id="L2396" rel="#L2396">2396</span>
<span id="L2397" rel="#L2397">2397</span>
<span id="L2398" rel="#L2398">2398</span>
<span id="L2399" rel="#L2399">2399</span>
<span id="L2400" rel="#L2400">2400</span>
<span id="L2401" rel="#L2401">2401</span>
<span id="L2402" rel="#L2402">2402</span>
<span id="L2403" rel="#L2403">2403</span>
<span id="L2404" rel="#L2404">2404</span>
<span id="L2405" rel="#L2405">2405</span>
<span id="L2406" rel="#L2406">2406</span>
<span id="L2407" rel="#L2407">2407</span>
<span id="L2408" rel="#L2408">2408</span>
<span id="L2409" rel="#L2409">2409</span>
<span id="L2410" rel="#L2410">2410</span>
<span id="L2411" rel="#L2411">2411</span>
<span id="L2412" rel="#L2412">2412</span>
<span id="L2413" rel="#L2413">2413</span>
<span id="L2414" rel="#L2414">2414</span>
<span id="L2415" rel="#L2415">2415</span>
<span id="L2416" rel="#L2416">2416</span>
<span id="L2417" rel="#L2417">2417</span>
<span id="L2418" rel="#L2418">2418</span>
<span id="L2419" rel="#L2419">2419</span>
<span id="L2420" rel="#L2420">2420</span>
<span id="L2421" rel="#L2421">2421</span>
<span id="L2422" rel="#L2422">2422</span>
<span id="L2423" rel="#L2423">2423</span>
<span id="L2424" rel="#L2424">2424</span>
<span id="L2425" rel="#L2425">2425</span>
<span id="L2426" rel="#L2426">2426</span>
<span id="L2427" rel="#L2427">2427</span>
<span id="L2428" rel="#L2428">2428</span>
<span id="L2429" rel="#L2429">2429</span>
<span id="L2430" rel="#L2430">2430</span>
<span id="L2431" rel="#L2431">2431</span>
<span id="L2432" rel="#L2432">2432</span>
<span id="L2433" rel="#L2433">2433</span>
<span id="L2434" rel="#L2434">2434</span>
<span id="L2435" rel="#L2435">2435</span>
<span id="L2436" rel="#L2436">2436</span>
<span id="L2437" rel="#L2437">2437</span>
<span id="L2438" rel="#L2438">2438</span>
<span id="L2439" rel="#L2439">2439</span>
<span id="L2440" rel="#L2440">2440</span>
<span id="L2441" rel="#L2441">2441</span>
<span id="L2442" rel="#L2442">2442</span>
<span id="L2443" rel="#L2443">2443</span>
<span id="L2444" rel="#L2444">2444</span>
<span id="L2445" rel="#L2445">2445</span>
<span id="L2446" rel="#L2446">2446</span>
<span id="L2447" rel="#L2447">2447</span>
<span id="L2448" rel="#L2448">2448</span>
<span id="L2449" rel="#L2449">2449</span>
<span id="L2450" rel="#L2450">2450</span>
<span id="L2451" rel="#L2451">2451</span>
<span id="L2452" rel="#L2452">2452</span>
<span id="L2453" rel="#L2453">2453</span>
<span id="L2454" rel="#L2454">2454</span>
<span id="L2455" rel="#L2455">2455</span>
<span id="L2456" rel="#L2456">2456</span>
<span id="L2457" rel="#L2457">2457</span>
<span id="L2458" rel="#L2458">2458</span>
<span id="L2459" rel="#L2459">2459</span>
<span id="L2460" rel="#L2460">2460</span>
<span id="L2461" rel="#L2461">2461</span>
<span id="L2462" rel="#L2462">2462</span>
<span id="L2463" rel="#L2463">2463</span>
<span id="L2464" rel="#L2464">2464</span>
<span id="L2465" rel="#L2465">2465</span>
<span id="L2466" rel="#L2466">2466</span>
<span id="L2467" rel="#L2467">2467</span>
<span id="L2468" rel="#L2468">2468</span>
<span id="L2469" rel="#L2469">2469</span>
<span id="L2470" rel="#L2470">2470</span>
<span id="L2471" rel="#L2471">2471</span>
<span id="L2472" rel="#L2472">2472</span>
<span id="L2473" rel="#L2473">2473</span>
<span id="L2474" rel="#L2474">2474</span>
<span id="L2475" rel="#L2475">2475</span>
<span id="L2476" rel="#L2476">2476</span>
<span id="L2477" rel="#L2477">2477</span>
<span id="L2478" rel="#L2478">2478</span>
<span id="L2479" rel="#L2479">2479</span>
<span id="L2480" rel="#L2480">2480</span>
<span id="L2481" rel="#L2481">2481</span>
<span id="L2482" rel="#L2482">2482</span>
<span id="L2483" rel="#L2483">2483</span>
<span id="L2484" rel="#L2484">2484</span>
<span id="L2485" rel="#L2485">2485</span>
<span id="L2486" rel="#L2486">2486</span>
<span id="L2487" rel="#L2487">2487</span>
<span id="L2488" rel="#L2488">2488</span>
<span id="L2489" rel="#L2489">2489</span>
<span id="L2490" rel="#L2490">2490</span>
<span id="L2491" rel="#L2491">2491</span>
<span id="L2492" rel="#L2492">2492</span>
<span id="L2493" rel="#L2493">2493</span>
<span id="L2494" rel="#L2494">2494</span>
<span id="L2495" rel="#L2495">2495</span>
<span id="L2496" rel="#L2496">2496</span>
<span id="L2497" rel="#L2497">2497</span>
<span id="L2498" rel="#L2498">2498</span>
<span id="L2499" rel="#L2499">2499</span>
<span id="L2500" rel="#L2500">2500</span>
<span id="L2501" rel="#L2501">2501</span>
<span id="L2502" rel="#L2502">2502</span>
<span id="L2503" rel="#L2503">2503</span>
<span id="L2504" rel="#L2504">2504</span>
<span id="L2505" rel="#L2505">2505</span>
<span id="L2506" rel="#L2506">2506</span>
<span id="L2507" rel="#L2507">2507</span>
<span id="L2508" rel="#L2508">2508</span>
<span id="L2509" rel="#L2509">2509</span>
<span id="L2510" rel="#L2510">2510</span>
<span id="L2511" rel="#L2511">2511</span>
<span id="L2512" rel="#L2512">2512</span>
<span id="L2513" rel="#L2513">2513</span>
<span id="L2514" rel="#L2514">2514</span>
<span id="L2515" rel="#L2515">2515</span>
<span id="L2516" rel="#L2516">2516</span>
<span id="L2517" rel="#L2517">2517</span>
<span id="L2518" rel="#L2518">2518</span>
<span id="L2519" rel="#L2519">2519</span>
<span id="L2520" rel="#L2520">2520</span>
<span id="L2521" rel="#L2521">2521</span>
<span id="L2522" rel="#L2522">2522</span>
<span id="L2523" rel="#L2523">2523</span>
<span id="L2524" rel="#L2524">2524</span>
<span id="L2525" rel="#L2525">2525</span>
<span id="L2526" rel="#L2526">2526</span>
<span id="L2527" rel="#L2527">2527</span>
<span id="L2528" rel="#L2528">2528</span>
<span id="L2529" rel="#L2529">2529</span>
<span id="L2530" rel="#L2530">2530</span>
<span id="L2531" rel="#L2531">2531</span>
<span id="L2532" rel="#L2532">2532</span>
<span id="L2533" rel="#L2533">2533</span>
<span id="L2534" rel="#L2534">2534</span>
<span id="L2535" rel="#L2535">2535</span>
<span id="L2536" rel="#L2536">2536</span>
<span id="L2537" rel="#L2537">2537</span>
<span id="L2538" rel="#L2538">2538</span>
<span id="L2539" rel="#L2539">2539</span>
<span id="L2540" rel="#L2540">2540</span>
<span id="L2541" rel="#L2541">2541</span>
<span id="L2542" rel="#L2542">2542</span>
<span id="L2543" rel="#L2543">2543</span>
<span id="L2544" rel="#L2544">2544</span>
<span id="L2545" rel="#L2545">2545</span>
<span id="L2546" rel="#L2546">2546</span>
<span id="L2547" rel="#L2547">2547</span>
<span id="L2548" rel="#L2548">2548</span>
<span id="L2549" rel="#L2549">2549</span>
<span id="L2550" rel="#L2550">2550</span>
<span id="L2551" rel="#L2551">2551</span>
<span id="L2552" rel="#L2552">2552</span>
<span id="L2553" rel="#L2553">2553</span>
<span id="L2554" rel="#L2554">2554</span>
<span id="L2555" rel="#L2555">2555</span>
<span id="L2556" rel="#L2556">2556</span>
<span id="L2557" rel="#L2557">2557</span>
<span id="L2558" rel="#L2558">2558</span>
<span id="L2559" rel="#L2559">2559</span>
<span id="L2560" rel="#L2560">2560</span>
<span id="L2561" rel="#L2561">2561</span>
<span id="L2562" rel="#L2562">2562</span>
<span id="L2563" rel="#L2563">2563</span>
<span id="L2564" rel="#L2564">2564</span>
<span id="L2565" rel="#L2565">2565</span>
<span id="L2566" rel="#L2566">2566</span>
<span id="L2567" rel="#L2567">2567</span>
<span id="L2568" rel="#L2568">2568</span>
<span id="L2569" rel="#L2569">2569</span>
<span id="L2570" rel="#L2570">2570</span>
<span id="L2571" rel="#L2571">2571</span>
<span id="L2572" rel="#L2572">2572</span>
<span id="L2573" rel="#L2573">2573</span>
<span id="L2574" rel="#L2574">2574</span>
<span id="L2575" rel="#L2575">2575</span>
<span id="L2576" rel="#L2576">2576</span>
<span id="L2577" rel="#L2577">2577</span>
<span id="L2578" rel="#L2578">2578</span>
<span id="L2579" rel="#L2579">2579</span>
<span id="L2580" rel="#L2580">2580</span>
<span id="L2581" rel="#L2581">2581</span>
<span id="L2582" rel="#L2582">2582</span>
<span id="L2583" rel="#L2583">2583</span>
<span id="L2584" rel="#L2584">2584</span>
<span id="L2585" rel="#L2585">2585</span>
<span id="L2586" rel="#L2586">2586</span>
<span id="L2587" rel="#L2587">2587</span>
<span id="L2588" rel="#L2588">2588</span>
<span id="L2589" rel="#L2589">2589</span>
<span id="L2590" rel="#L2590">2590</span>
<span id="L2591" rel="#L2591">2591</span>
<span id="L2592" rel="#L2592">2592</span>
<span id="L2593" rel="#L2593">2593</span>
<span id="L2594" rel="#L2594">2594</span>
<span id="L2595" rel="#L2595">2595</span>
<span id="L2596" rel="#L2596">2596</span>
<span id="L2597" rel="#L2597">2597</span>
<span id="L2598" rel="#L2598">2598</span>
<span id="L2599" rel="#L2599">2599</span>
<span id="L2600" rel="#L2600">2600</span>
<span id="L2601" rel="#L2601">2601</span>
<span id="L2602" rel="#L2602">2602</span>
<span id="L2603" rel="#L2603">2603</span>
<span id="L2604" rel="#L2604">2604</span>
<span id="L2605" rel="#L2605">2605</span>
<span id="L2606" rel="#L2606">2606</span>
<span id="L2607" rel="#L2607">2607</span>
<span id="L2608" rel="#L2608">2608</span>
<span id="L2609" rel="#L2609">2609</span>
<span id="L2610" rel="#L2610">2610</span>
<span id="L2611" rel="#L2611">2611</span>
<span id="L2612" rel="#L2612">2612</span>
<span id="L2613" rel="#L2613">2613</span>
<span id="L2614" rel="#L2614">2614</span>
<span id="L2615" rel="#L2615">2615</span>
<span id="L2616" rel="#L2616">2616</span>
<span id="L2617" rel="#L2617">2617</span>
<span id="L2618" rel="#L2618">2618</span>
<span id="L2619" rel="#L2619">2619</span>
<span id="L2620" rel="#L2620">2620</span>
<span id="L2621" rel="#L2621">2621</span>
<span id="L2622" rel="#L2622">2622</span>
<span id="L2623" rel="#L2623">2623</span>
<span id="L2624" rel="#L2624">2624</span>
<span id="L2625" rel="#L2625">2625</span>
<span id="L2626" rel="#L2626">2626</span>
<span id="L2627" rel="#L2627">2627</span>
<span id="L2628" rel="#L2628">2628</span>
<span id="L2629" rel="#L2629">2629</span>
<span id="L2630" rel="#L2630">2630</span>
<span id="L2631" rel="#L2631">2631</span>
<span id="L2632" rel="#L2632">2632</span>
<span id="L2633" rel="#L2633">2633</span>
<span id="L2634" rel="#L2634">2634</span>
<span id="L2635" rel="#L2635">2635</span>
<span id="L2636" rel="#L2636">2636</span>
<span id="L2637" rel="#L2637">2637</span>
<span id="L2638" rel="#L2638">2638</span>
<span id="L2639" rel="#L2639">2639</span>
<span id="L2640" rel="#L2640">2640</span>
<span id="L2641" rel="#L2641">2641</span>
<span id="L2642" rel="#L2642">2642</span>
<span id="L2643" rel="#L2643">2643</span>
<span id="L2644" rel="#L2644">2644</span>
<span id="L2645" rel="#L2645">2645</span>
<span id="L2646" rel="#L2646">2646</span>
<span id="L2647" rel="#L2647">2647</span>
<span id="L2648" rel="#L2648">2648</span>
<span id="L2649" rel="#L2649">2649</span>
<span id="L2650" rel="#L2650">2650</span>
<span id="L2651" rel="#L2651">2651</span>
<span id="L2652" rel="#L2652">2652</span>
<span id="L2653" rel="#L2653">2653</span>
<span id="L2654" rel="#L2654">2654</span>
<span id="L2655" rel="#L2655">2655</span>
<span id="L2656" rel="#L2656">2656</span>
<span id="L2657" rel="#L2657">2657</span>
<span id="L2658" rel="#L2658">2658</span>
<span id="L2659" rel="#L2659">2659</span>
<span id="L2660" rel="#L2660">2660</span>
<span id="L2661" rel="#L2661">2661</span>
<span id="L2662" rel="#L2662">2662</span>
<span id="L2663" rel="#L2663">2663</span>
<span id="L2664" rel="#L2664">2664</span>
<span id="L2665" rel="#L2665">2665</span>
<span id="L2666" rel="#L2666">2666</span>
<span id="L2667" rel="#L2667">2667</span>
<span id="L2668" rel="#L2668">2668</span>
<span id="L2669" rel="#L2669">2669</span>
<span id="L2670" rel="#L2670">2670</span>
<span id="L2671" rel="#L2671">2671</span>
<span id="L2672" rel="#L2672">2672</span>
<span id="L2673" rel="#L2673">2673</span>
<span id="L2674" rel="#L2674">2674</span>
<span id="L2675" rel="#L2675">2675</span>
<span id="L2676" rel="#L2676">2676</span>
<span id="L2677" rel="#L2677">2677</span>
<span id="L2678" rel="#L2678">2678</span>
<span id="L2679" rel="#L2679">2679</span>
<span id="L2680" rel="#L2680">2680</span>
<span id="L2681" rel="#L2681">2681</span>
<span id="L2682" rel="#L2682">2682</span>
<span id="L2683" rel="#L2683">2683</span>
<span id="L2684" rel="#L2684">2684</span>
<span id="L2685" rel="#L2685">2685</span>
<span id="L2686" rel="#L2686">2686</span>
<span id="L2687" rel="#L2687">2687</span>
<span id="L2688" rel="#L2688">2688</span>
<span id="L2689" rel="#L2689">2689</span>
<span id="L2690" rel="#L2690">2690</span>
<span id="L2691" rel="#L2691">2691</span>
<span id="L2692" rel="#L2692">2692</span>
<span id="L2693" rel="#L2693">2693</span>
<span id="L2694" rel="#L2694">2694</span>
<span id="L2695" rel="#L2695">2695</span>
<span id="L2696" rel="#L2696">2696</span>
<span id="L2697" rel="#L2697">2697</span>
<span id="L2698" rel="#L2698">2698</span>
<span id="L2699" rel="#L2699">2699</span>
<span id="L2700" rel="#L2700">2700</span>
<span id="L2701" rel="#L2701">2701</span>
<span id="L2702" rel="#L2702">2702</span>
<span id="L2703" rel="#L2703">2703</span>
<span id="L2704" rel="#L2704">2704</span>
<span id="L2705" rel="#L2705">2705</span>
<span id="L2706" rel="#L2706">2706</span>
<span id="L2707" rel="#L2707">2707</span>
<span id="L2708" rel="#L2708">2708</span>
<span id="L2709" rel="#L2709">2709</span>
<span id="L2710" rel="#L2710">2710</span>
<span id="L2711" rel="#L2711">2711</span>
<span id="L2712" rel="#L2712">2712</span>
<span id="L2713" rel="#L2713">2713</span>
<span id="L2714" rel="#L2714">2714</span>
<span id="L2715" rel="#L2715">2715</span>
<span id="L2716" rel="#L2716">2716</span>
<span id="L2717" rel="#L2717">2717</span>
<span id="L2718" rel="#L2718">2718</span>
<span id="L2719" rel="#L2719">2719</span>
<span id="L2720" rel="#L2720">2720</span>
<span id="L2721" rel="#L2721">2721</span>
<span id="L2722" rel="#L2722">2722</span>
<span id="L2723" rel="#L2723">2723</span>
<span id="L2724" rel="#L2724">2724</span>
<span id="L2725" rel="#L2725">2725</span>
<span id="L2726" rel="#L2726">2726</span>
<span id="L2727" rel="#L2727">2727</span>
<span id="L2728" rel="#L2728">2728</span>
<span id="L2729" rel="#L2729">2729</span>
<span id="L2730" rel="#L2730">2730</span>
<span id="L2731" rel="#L2731">2731</span>
<span id="L2732" rel="#L2732">2732</span>
<span id="L2733" rel="#L2733">2733</span>
<span id="L2734" rel="#L2734">2734</span>
<span id="L2735" rel="#L2735">2735</span>
<span id="L2736" rel="#L2736">2736</span>
<span id="L2737" rel="#L2737">2737</span>
<span id="L2738" rel="#L2738">2738</span>
<span id="L2739" rel="#L2739">2739</span>
<span id="L2740" rel="#L2740">2740</span>
<span id="L2741" rel="#L2741">2741</span>
<span id="L2742" rel="#L2742">2742</span>
<span id="L2743" rel="#L2743">2743</span>
<span id="L2744" rel="#L2744">2744</span>
<span id="L2745" rel="#L2745">2745</span>
<span id="L2746" rel="#L2746">2746</span>
<span id="L2747" rel="#L2747">2747</span>
<span id="L2748" rel="#L2748">2748</span>
<span id="L2749" rel="#L2749">2749</span>
<span id="L2750" rel="#L2750">2750</span>
<span id="L2751" rel="#L2751">2751</span>
<span id="L2752" rel="#L2752">2752</span>
<span id="L2753" rel="#L2753">2753</span>
<span id="L2754" rel="#L2754">2754</span>
<span id="L2755" rel="#L2755">2755</span>
<span id="L2756" rel="#L2756">2756</span>
<span id="L2757" rel="#L2757">2757</span>
<span id="L2758" rel="#L2758">2758</span>
<span id="L2759" rel="#L2759">2759</span>
<span id="L2760" rel="#L2760">2760</span>
<span id="L2761" rel="#L2761">2761</span>
<span id="L2762" rel="#L2762">2762</span>
<span id="L2763" rel="#L2763">2763</span>
<span id="L2764" rel="#L2764">2764</span>
<span id="L2765" rel="#L2765">2765</span>
<span id="L2766" rel="#L2766">2766</span>
<span id="L2767" rel="#L2767">2767</span>
<span id="L2768" rel="#L2768">2768</span>
<span id="L2769" rel="#L2769">2769</span>
<span id="L2770" rel="#L2770">2770</span>
<span id="L2771" rel="#L2771">2771</span>
<span id="L2772" rel="#L2772">2772</span>
<span id="L2773" rel="#L2773">2773</span>
<span id="L2774" rel="#L2774">2774</span>
<span id="L2775" rel="#L2775">2775</span>
<span id="L2776" rel="#L2776">2776</span>
<span id="L2777" rel="#L2777">2777</span>
<span id="L2778" rel="#L2778">2778</span>
<span id="L2779" rel="#L2779">2779</span>
<span id="L2780" rel="#L2780">2780</span>
<span id="L2781" rel="#L2781">2781</span>
<span id="L2782" rel="#L2782">2782</span>
<span id="L2783" rel="#L2783">2783</span>
<span id="L2784" rel="#L2784">2784</span>
<span id="L2785" rel="#L2785">2785</span>
<span id="L2786" rel="#L2786">2786</span>
<span id="L2787" rel="#L2787">2787</span>
<span id="L2788" rel="#L2788">2788</span>
<span id="L2789" rel="#L2789">2789</span>
<span id="L2790" rel="#L2790">2790</span>
<span id="L2791" rel="#L2791">2791</span>
<span id="L2792" rel="#L2792">2792</span>
<span id="L2793" rel="#L2793">2793</span>
<span id="L2794" rel="#L2794">2794</span>
<span id="L2795" rel="#L2795">2795</span>
<span id="L2796" rel="#L2796">2796</span>
<span id="L2797" rel="#L2797">2797</span>
<span id="L2798" rel="#L2798">2798</span>
<span id="L2799" rel="#L2799">2799</span>
<span id="L2800" rel="#L2800">2800</span>
<span id="L2801" rel="#L2801">2801</span>
<span id="L2802" rel="#L2802">2802</span>
<span id="L2803" rel="#L2803">2803</span>
<span id="L2804" rel="#L2804">2804</span>
<span id="L2805" rel="#L2805">2805</span>
<span id="L2806" rel="#L2806">2806</span>
<span id="L2807" rel="#L2807">2807</span>
<span id="L2808" rel="#L2808">2808</span>
<span id="L2809" rel="#L2809">2809</span>
<span id="L2810" rel="#L2810">2810</span>
<span id="L2811" rel="#L2811">2811</span>
<span id="L2812" rel="#L2812">2812</span>
<span id="L2813" rel="#L2813">2813</span>
<span id="L2814" rel="#L2814">2814</span>
<span id="L2815" rel="#L2815">2815</span>
<span id="L2816" rel="#L2816">2816</span>
<span id="L2817" rel="#L2817">2817</span>
<span id="L2818" rel="#L2818">2818</span>
<span id="L2819" rel="#L2819">2819</span>
<span id="L2820" rel="#L2820">2820</span>
<span id="L2821" rel="#L2821">2821</span>
<span id="L2822" rel="#L2822">2822</span>
<span id="L2823" rel="#L2823">2823</span>
<span id="L2824" rel="#L2824">2824</span>
<span id="L2825" rel="#L2825">2825</span>
<span id="L2826" rel="#L2826">2826</span>
<span id="L2827" rel="#L2827">2827</span>
<span id="L2828" rel="#L2828">2828</span>
<span id="L2829" rel="#L2829">2829</span>
<span id="L2830" rel="#L2830">2830</span>
<span id="L2831" rel="#L2831">2831</span>
<span id="L2832" rel="#L2832">2832</span>
<span id="L2833" rel="#L2833">2833</span>
<span id="L2834" rel="#L2834">2834</span>
<span id="L2835" rel="#L2835">2835</span>
<span id="L2836" rel="#L2836">2836</span>
<span id="L2837" rel="#L2837">2837</span>
<span id="L2838" rel="#L2838">2838</span>
<span id="L2839" rel="#L2839">2839</span>
<span id="L2840" rel="#L2840">2840</span>
<span id="L2841" rel="#L2841">2841</span>
<span id="L2842" rel="#L2842">2842</span>
<span id="L2843" rel="#L2843">2843</span>
<span id="L2844" rel="#L2844">2844</span>
<span id="L2845" rel="#L2845">2845</span>
<span id="L2846" rel="#L2846">2846</span>
<span id="L2847" rel="#L2847">2847</span>
<span id="L2848" rel="#L2848">2848</span>
<span id="L2849" rel="#L2849">2849</span>
<span id="L2850" rel="#L2850">2850</span>
<span id="L2851" rel="#L2851">2851</span>
<span id="L2852" rel="#L2852">2852</span>
<span id="L2853" rel="#L2853">2853</span>
<span id="L2854" rel="#L2854">2854</span>
<span id="L2855" rel="#L2855">2855</span>
<span id="L2856" rel="#L2856">2856</span>
<span id="L2857" rel="#L2857">2857</span>
<span id="L2858" rel="#L2858">2858</span>
<span id="L2859" rel="#L2859">2859</span>
<span id="L2860" rel="#L2860">2860</span>
<span id="L2861" rel="#L2861">2861</span>
<span id="L2862" rel="#L2862">2862</span>
<span id="L2863" rel="#L2863">2863</span>
<span id="L2864" rel="#L2864">2864</span>
<span id="L2865" rel="#L2865">2865</span>
<span id="L2866" rel="#L2866">2866</span>
<span id="L2867" rel="#L2867">2867</span>
<span id="L2868" rel="#L2868">2868</span>
<span id="L2869" rel="#L2869">2869</span>
<span id="L2870" rel="#L2870">2870</span>
<span id="L2871" rel="#L2871">2871</span>
<span id="L2872" rel="#L2872">2872</span>
<span id="L2873" rel="#L2873">2873</span>
<span id="L2874" rel="#L2874">2874</span>
<span id="L2875" rel="#L2875">2875</span>
<span id="L2876" rel="#L2876">2876</span>
<span id="L2877" rel="#L2877">2877</span>
<span id="L2878" rel="#L2878">2878</span>
<span id="L2879" rel="#L2879">2879</span>
<span id="L2880" rel="#L2880">2880</span>
<span id="L2881" rel="#L2881">2881</span>
<span id="L2882" rel="#L2882">2882</span>
<span id="L2883" rel="#L2883">2883</span>
<span id="L2884" rel="#L2884">2884</span>
<span id="L2885" rel="#L2885">2885</span>
<span id="L2886" rel="#L2886">2886</span>
<span id="L2887" rel="#L2887">2887</span>
<span id="L2888" rel="#L2888">2888</span>
<span id="L2889" rel="#L2889">2889</span>
<span id="L2890" rel="#L2890">2890</span>
<span id="L2891" rel="#L2891">2891</span>
<span id="L2892" rel="#L2892">2892</span>
<span id="L2893" rel="#L2893">2893</span>
<span id="L2894" rel="#L2894">2894</span>
<span id="L2895" rel="#L2895">2895</span>
<span id="L2896" rel="#L2896">2896</span>
<span id="L2897" rel="#L2897">2897</span>
<span id="L2898" rel="#L2898">2898</span>
<span id="L2899" rel="#L2899">2899</span>
<span id="L2900" rel="#L2900">2900</span>
<span id="L2901" rel="#L2901">2901</span>
<span id="L2902" rel="#L2902">2902</span>
<span id="L2903" rel="#L2903">2903</span>
<span id="L2904" rel="#L2904">2904</span>
<span id="L2905" rel="#L2905">2905</span>
<span id="L2906" rel="#L2906">2906</span>
<span id="L2907" rel="#L2907">2907</span>
<span id="L2908" rel="#L2908">2908</span>
<span id="L2909" rel="#L2909">2909</span>
<span id="L2910" rel="#L2910">2910</span>
<span id="L2911" rel="#L2911">2911</span>
<span id="L2912" rel="#L2912">2912</span>
<span id="L2913" rel="#L2913">2913</span>
<span id="L2914" rel="#L2914">2914</span>
<span id="L2915" rel="#L2915">2915</span>
<span id="L2916" rel="#L2916">2916</span>
<span id="L2917" rel="#L2917">2917</span>
<span id="L2918" rel="#L2918">2918</span>
<span id="L2919" rel="#L2919">2919</span>
<span id="L2920" rel="#L2920">2920</span>
<span id="L2921" rel="#L2921">2921</span>
<span id="L2922" rel="#L2922">2922</span>
<span id="L2923" rel="#L2923">2923</span>
<span id="L2924" rel="#L2924">2924</span>
<span id="L2925" rel="#L2925">2925</span>
<span id="L2926" rel="#L2926">2926</span>
<span id="L2927" rel="#L2927">2927</span>
<span id="L2928" rel="#L2928">2928</span>
<span id="L2929" rel="#L2929">2929</span>
<span id="L2930" rel="#L2930">2930</span>
<span id="L2931" rel="#L2931">2931</span>
<span id="L2932" rel="#L2932">2932</span>
<span id="L2933" rel="#L2933">2933</span>
<span id="L2934" rel="#L2934">2934</span>
<span id="L2935" rel="#L2935">2935</span>
<span id="L2936" rel="#L2936">2936</span>
<span id="L2937" rel="#L2937">2937</span>
<span id="L2938" rel="#L2938">2938</span>
<span id="L2939" rel="#L2939">2939</span>
<span id="L2940" rel="#L2940">2940</span>
<span id="L2941" rel="#L2941">2941</span>
<span id="L2942" rel="#L2942">2942</span>
<span id="L2943" rel="#L2943">2943</span>
<span id="L2944" rel="#L2944">2944</span>
<span id="L2945" rel="#L2945">2945</span>
<span id="L2946" rel="#L2946">2946</span>
<span id="L2947" rel="#L2947">2947</span>
<span id="L2948" rel="#L2948">2948</span>
<span id="L2949" rel="#L2949">2949</span>
<span id="L2950" rel="#L2950">2950</span>
<span id="L2951" rel="#L2951">2951</span>
<span id="L2952" rel="#L2952">2952</span>
<span id="L2953" rel="#L2953">2953</span>
<span id="L2954" rel="#L2954">2954</span>
<span id="L2955" rel="#L2955">2955</span>
<span id="L2956" rel="#L2956">2956</span>
<span id="L2957" rel="#L2957">2957</span>
<span id="L2958" rel="#L2958">2958</span>
<span id="L2959" rel="#L2959">2959</span>
<span id="L2960" rel="#L2960">2960</span>
<span id="L2961" rel="#L2961">2961</span>
<span id="L2962" rel="#L2962">2962</span>
<span id="L2963" rel="#L2963">2963</span>
<span id="L2964" rel="#L2964">2964</span>
<span id="L2965" rel="#L2965">2965</span>
<span id="L2966" rel="#L2966">2966</span>
<span id="L2967" rel="#L2967">2967</span>
<span id="L2968" rel="#L2968">2968</span>
<span id="L2969" rel="#L2969">2969</span>
<span id="L2970" rel="#L2970">2970</span>
<span id="L2971" rel="#L2971">2971</span>
<span id="L2972" rel="#L2972">2972</span>
<span id="L2973" rel="#L2973">2973</span>
<span id="L2974" rel="#L2974">2974</span>
<span id="L2975" rel="#L2975">2975</span>
<span id="L2976" rel="#L2976">2976</span>
<span id="L2977" rel="#L2977">2977</span>
<span id="L2978" rel="#L2978">2978</span>
<span id="L2979" rel="#L2979">2979</span>
<span id="L2980" rel="#L2980">2980</span>
<span id="L2981" rel="#L2981">2981</span>
<span id="L2982" rel="#L2982">2982</span>
<span id="L2983" rel="#L2983">2983</span>
<span id="L2984" rel="#L2984">2984</span>
<span id="L2985" rel="#L2985">2985</span>
<span id="L2986" rel="#L2986">2986</span>
<span id="L2987" rel="#L2987">2987</span>
<span id="L2988" rel="#L2988">2988</span>
<span id="L2989" rel="#L2989">2989</span>
<span id="L2990" rel="#L2990">2990</span>
<span id="L2991" rel="#L2991">2991</span>
<span id="L2992" rel="#L2992">2992</span>
<span id="L2993" rel="#L2993">2993</span>
<span id="L2994" rel="#L2994">2994</span>
<span id="L2995" rel="#L2995">2995</span>
<span id="L2996" rel="#L2996">2996</span>
<span id="L2997" rel="#L2997">2997</span>
<span id="L2998" rel="#L2998">2998</span>
<span id="L2999" rel="#L2999">2999</span>
<span id="L3000" rel="#L3000">3000</span>
<span id="L3001" rel="#L3001">3001</span>
<span id="L3002" rel="#L3002">3002</span>
<span id="L3003" rel="#L3003">3003</span>
<span id="L3004" rel="#L3004">3004</span>
<span id="L3005" rel="#L3005">3005</span>
<span id="L3006" rel="#L3006">3006</span>
<span id="L3007" rel="#L3007">3007</span>
<span id="L3008" rel="#L3008">3008</span>
<span id="L3009" rel="#L3009">3009</span>
<span id="L3010" rel="#L3010">3010</span>
<span id="L3011" rel="#L3011">3011</span>
<span id="L3012" rel="#L3012">3012</span>
<span id="L3013" rel="#L3013">3013</span>
<span id="L3014" rel="#L3014">3014</span>
<span id="L3015" rel="#L3015">3015</span>
<span id="L3016" rel="#L3016">3016</span>
<span id="L3017" rel="#L3017">3017</span>
<span id="L3018" rel="#L3018">3018</span>
<span id="L3019" rel="#L3019">3019</span>
<span id="L3020" rel="#L3020">3020</span>
<span id="L3021" rel="#L3021">3021</span>
<span id="L3022" rel="#L3022">3022</span>
<span id="L3023" rel="#L3023">3023</span>
<span id="L3024" rel="#L3024">3024</span>
<span id="L3025" rel="#L3025">3025</span>
<span id="L3026" rel="#L3026">3026</span>
<span id="L3027" rel="#L3027">3027</span>
<span id="L3028" rel="#L3028">3028</span>
<span id="L3029" rel="#L3029">3029</span>
<span id="L3030" rel="#L3030">3030</span>
<span id="L3031" rel="#L3031">3031</span>
<span id="L3032" rel="#L3032">3032</span>
<span id="L3033" rel="#L3033">3033</span>
<span id="L3034" rel="#L3034">3034</span>
<span id="L3035" rel="#L3035">3035</span>
<span id="L3036" rel="#L3036">3036</span>
<span id="L3037" rel="#L3037">3037</span>
<span id="L3038" rel="#L3038">3038</span>
<span id="L3039" rel="#L3039">3039</span>
<span id="L3040" rel="#L3040">3040</span>
<span id="L3041" rel="#L3041">3041</span>
<span id="L3042" rel="#L3042">3042</span>
<span id="L3043" rel="#L3043">3043</span>
<span id="L3044" rel="#L3044">3044</span>
<span id="L3045" rel="#L3045">3045</span>
<span id="L3046" rel="#L3046">3046</span>
<span id="L3047" rel="#L3047">3047</span>
<span id="L3048" rel="#L3048">3048</span>
<span id="L3049" rel="#L3049">3049</span>
<span id="L3050" rel="#L3050">3050</span>
<span id="L3051" rel="#L3051">3051</span>
<span id="L3052" rel="#L3052">3052</span>
<span id="L3053" rel="#L3053">3053</span>
<span id="L3054" rel="#L3054">3054</span>
<span id="L3055" rel="#L3055">3055</span>
<span id="L3056" rel="#L3056">3056</span>
<span id="L3057" rel="#L3057">3057</span>
<span id="L3058" rel="#L3058">3058</span>
<span id="L3059" rel="#L3059">3059</span>
<span id="L3060" rel="#L3060">3060</span>
<span id="L3061" rel="#L3061">3061</span>
<span id="L3062" rel="#L3062">3062</span>
<span id="L3063" rel="#L3063">3063</span>
<span id="L3064" rel="#L3064">3064</span>
<span id="L3065" rel="#L3065">3065</span>
<span id="L3066" rel="#L3066">3066</span>
<span id="L3067" rel="#L3067">3067</span>
<span id="L3068" rel="#L3068">3068</span>
<span id="L3069" rel="#L3069">3069</span>
<span id="L3070" rel="#L3070">3070</span>
<span id="L3071" rel="#L3071">3071</span>
<span id="L3072" rel="#L3072">3072</span>
<span id="L3073" rel="#L3073">3073</span>
<span id="L3074" rel="#L3074">3074</span>
<span id="L3075" rel="#L3075">3075</span>
<span id="L3076" rel="#L3076">3076</span>
<span id="L3077" rel="#L3077">3077</span>
<span id="L3078" rel="#L3078">3078</span>
<span id="L3079" rel="#L3079">3079</span>
<span id="L3080" rel="#L3080">3080</span>
<span id="L3081" rel="#L3081">3081</span>
<span id="L3082" rel="#L3082">3082</span>
<span id="L3083" rel="#L3083">3083</span>
<span id="L3084" rel="#L3084">3084</span>
<span id="L3085" rel="#L3085">3085</span>
<span id="L3086" rel="#L3086">3086</span>
<span id="L3087" rel="#L3087">3087</span>
<span id="L3088" rel="#L3088">3088</span>
<span id="L3089" rel="#L3089">3089</span>
<span id="L3090" rel="#L3090">3090</span>
<span id="L3091" rel="#L3091">3091</span>
<span id="L3092" rel="#L3092">3092</span>
<span id="L3093" rel="#L3093">3093</span>
<span id="L3094" rel="#L3094">3094</span>
<span id="L3095" rel="#L3095">3095</span>
<span id="L3096" rel="#L3096">3096</span>
<span id="L3097" rel="#L3097">3097</span>
<span id="L3098" rel="#L3098">3098</span>
<span id="L3099" rel="#L3099">3099</span>
<span id="L3100" rel="#L3100">3100</span>
<span id="L3101" rel="#L3101">3101</span>
<span id="L3102" rel="#L3102">3102</span>
<span id="L3103" rel="#L3103">3103</span>
<span id="L3104" rel="#L3104">3104</span>
<span id="L3105" rel="#L3105">3105</span>
<span id="L3106" rel="#L3106">3106</span>
<span id="L3107" rel="#L3107">3107</span>
<span id="L3108" rel="#L3108">3108</span>
<span id="L3109" rel="#L3109">3109</span>
<span id="L3110" rel="#L3110">3110</span>
<span id="L3111" rel="#L3111">3111</span>
<span id="L3112" rel="#L3112">3112</span>
<span id="L3113" rel="#L3113">3113</span>
<span id="L3114" rel="#L3114">3114</span>
<span id="L3115" rel="#L3115">3115</span>
<span id="L3116" rel="#L3116">3116</span>
<span id="L3117" rel="#L3117">3117</span>
<span id="L3118" rel="#L3118">3118</span>
<span id="L3119" rel="#L3119">3119</span>
<span id="L3120" rel="#L3120">3120</span>
<span id="L3121" rel="#L3121">3121</span>
<span id="L3122" rel="#L3122">3122</span>
<span id="L3123" rel="#L3123">3123</span>
<span id="L3124" rel="#L3124">3124</span>
<span id="L3125" rel="#L3125">3125</span>
<span id="L3126" rel="#L3126">3126</span>
<span id="L3127" rel="#L3127">3127</span>
<span id="L3128" rel="#L3128">3128</span>
<span id="L3129" rel="#L3129">3129</span>
<span id="L3130" rel="#L3130">3130</span>
<span id="L3131" rel="#L3131">3131</span>
<span id="L3132" rel="#L3132">3132</span>
<span id="L3133" rel="#L3133">3133</span>
<span id="L3134" rel="#L3134">3134</span>
<span id="L3135" rel="#L3135">3135</span>
<span id="L3136" rel="#L3136">3136</span>
<span id="L3137" rel="#L3137">3137</span>
<span id="L3138" rel="#L3138">3138</span>
<span id="L3139" rel="#L3139">3139</span>
<span id="L3140" rel="#L3140">3140</span>
<span id="L3141" rel="#L3141">3141</span>
<span id="L3142" rel="#L3142">3142</span>
<span id="L3143" rel="#L3143">3143</span>
<span id="L3144" rel="#L3144">3144</span>
<span id="L3145" rel="#L3145">3145</span>
<span id="L3146" rel="#L3146">3146</span>
<span id="L3147" rel="#L3147">3147</span>
<span id="L3148" rel="#L3148">3148</span>
<span id="L3149" rel="#L3149">3149</span>
<span id="L3150" rel="#L3150">3150</span>
<span id="L3151" rel="#L3151">3151</span>
<span id="L3152" rel="#L3152">3152</span>
<span id="L3153" rel="#L3153">3153</span>
<span id="L3154" rel="#L3154">3154</span>
<span id="L3155" rel="#L3155">3155</span>
<span id="L3156" rel="#L3156">3156</span>
<span id="L3157" rel="#L3157">3157</span>
<span id="L3158" rel="#L3158">3158</span>
<span id="L3159" rel="#L3159">3159</span>
<span id="L3160" rel="#L3160">3160</span>
<span id="L3161" rel="#L3161">3161</span>
<span id="L3162" rel="#L3162">3162</span>
<span id="L3163" rel="#L3163">3163</span>
<span id="L3164" rel="#L3164">3164</span>
<span id="L3165" rel="#L3165">3165</span>
<span id="L3166" rel="#L3166">3166</span>
<span id="L3167" rel="#L3167">3167</span>
<span id="L3168" rel="#L3168">3168</span>
<span id="L3169" rel="#L3169">3169</span>
<span id="L3170" rel="#L3170">3170</span>
<span id="L3171" rel="#L3171">3171</span>
<span id="L3172" rel="#L3172">3172</span>
<span id="L3173" rel="#L3173">3173</span>
<span id="L3174" rel="#L3174">3174</span>
<span id="L3175" rel="#L3175">3175</span>
<span id="L3176" rel="#L3176">3176</span>
<span id="L3177" rel="#L3177">3177</span>
<span id="L3178" rel="#L3178">3178</span>
<span id="L3179" rel="#L3179">3179</span>
<span id="L3180" rel="#L3180">3180</span>
<span id="L3181" rel="#L3181">3181</span>
<span id="L3182" rel="#L3182">3182</span>
<span id="L3183" rel="#L3183">3183</span>
<span id="L3184" rel="#L3184">3184</span>
<span id="L3185" rel="#L3185">3185</span>
<span id="L3186" rel="#L3186">3186</span>
<span id="L3187" rel="#L3187">3187</span>
<span id="L3188" rel="#L3188">3188</span>
<span id="L3189" rel="#L3189">3189</span>
<span id="L3190" rel="#L3190">3190</span>
<span id="L3191" rel="#L3191">3191</span>
<span id="L3192" rel="#L3192">3192</span>
<span id="L3193" rel="#L3193">3193</span>
<span id="L3194" rel="#L3194">3194</span>
<span id="L3195" rel="#L3195">3195</span>
<span id="L3196" rel="#L3196">3196</span>
<span id="L3197" rel="#L3197">3197</span>
<span id="L3198" rel="#L3198">3198</span>
<span id="L3199" rel="#L3199">3199</span>
<span id="L3200" rel="#L3200">3200</span>
<span id="L3201" rel="#L3201">3201</span>
<span id="L3202" rel="#L3202">3202</span>
<span id="L3203" rel="#L3203">3203</span>
<span id="L3204" rel="#L3204">3204</span>
<span id="L3205" rel="#L3205">3205</span>
<span id="L3206" rel="#L3206">3206</span>
<span id="L3207" rel="#L3207">3207</span>
<span id="L3208" rel="#L3208">3208</span>
<span id="L3209" rel="#L3209">3209</span>
<span id="L3210" rel="#L3210">3210</span>
<span id="L3211" rel="#L3211">3211</span>
<span id="L3212" rel="#L3212">3212</span>
<span id="L3213" rel="#L3213">3213</span>
<span id="L3214" rel="#L3214">3214</span>
<span id="L3215" rel="#L3215">3215</span>
<span id="L3216" rel="#L3216">3216</span>
<span id="L3217" rel="#L3217">3217</span>
<span id="L3218" rel="#L3218">3218</span>
<span id="L3219" rel="#L3219">3219</span>
<span id="L3220" rel="#L3220">3220</span>
<span id="L3221" rel="#L3221">3221</span>
<span id="L3222" rel="#L3222">3222</span>
<span id="L3223" rel="#L3223">3223</span>
<span id="L3224" rel="#L3224">3224</span>
<span id="L3225" rel="#L3225">3225</span>
<span id="L3226" rel="#L3226">3226</span>
<span id="L3227" rel="#L3227">3227</span>
<span id="L3228" rel="#L3228">3228</span>
<span id="L3229" rel="#L3229">3229</span>
<span id="L3230" rel="#L3230">3230</span>
<span id="L3231" rel="#L3231">3231</span>
<span id="L3232" rel="#L3232">3232</span>
<span id="L3233" rel="#L3233">3233</span>
<span id="L3234" rel="#L3234">3234</span>
<span id="L3235" rel="#L3235">3235</span>
<span id="L3236" rel="#L3236">3236</span>
<span id="L3237" rel="#L3237">3237</span>
<span id="L3238" rel="#L3238">3238</span>
<span id="L3239" rel="#L3239">3239</span>
<span id="L3240" rel="#L3240">3240</span>
<span id="L3241" rel="#L3241">3241</span>
<span id="L3242" rel="#L3242">3242</span>
<span id="L3243" rel="#L3243">3243</span>
<span id="L3244" rel="#L3244">3244</span>
<span id="L3245" rel="#L3245">3245</span>
<span id="L3246" rel="#L3246">3246</span>
<span id="L3247" rel="#L3247">3247</span>
<span id="L3248" rel="#L3248">3248</span>
<span id="L3249" rel="#L3249">3249</span>
<span id="L3250" rel="#L3250">3250</span>
<span id="L3251" rel="#L3251">3251</span>
<span id="L3252" rel="#L3252">3252</span>
<span id="L3253" rel="#L3253">3253</span>
<span id="L3254" rel="#L3254">3254</span>
<span id="L3255" rel="#L3255">3255</span>
<span id="L3256" rel="#L3256">3256</span>
<span id="L3257" rel="#L3257">3257</span>
<span id="L3258" rel="#L3258">3258</span>
<span id="L3259" rel="#L3259">3259</span>
<span id="L3260" rel="#L3260">3260</span>
<span id="L3261" rel="#L3261">3261</span>
<span id="L3262" rel="#L3262">3262</span>
<span id="L3263" rel="#L3263">3263</span>
<span id="L3264" rel="#L3264">3264</span>
<span id="L3265" rel="#L3265">3265</span>
<span id="L3266" rel="#L3266">3266</span>
<span id="L3267" rel="#L3267">3267</span>
<span id="L3268" rel="#L3268">3268</span>
<span id="L3269" rel="#L3269">3269</span>
<span id="L3270" rel="#L3270">3270</span>
<span id="L3271" rel="#L3271">3271</span>
<span id="L3272" rel="#L3272">3272</span>
<span id="L3273" rel="#L3273">3273</span>
<span id="L3274" rel="#L3274">3274</span>
<span id="L3275" rel="#L3275">3275</span>
<span id="L3276" rel="#L3276">3276</span>
<span id="L3277" rel="#L3277">3277</span>
<span id="L3278" rel="#L3278">3278</span>
<span id="L3279" rel="#L3279">3279</span>
<span id="L3280" rel="#L3280">3280</span>
<span id="L3281" rel="#L3281">3281</span>
<span id="L3282" rel="#L3282">3282</span>
<span id="L3283" rel="#L3283">3283</span>
<span id="L3284" rel="#L3284">3284</span>
<span id="L3285" rel="#L3285">3285</span>
<span id="L3286" rel="#L3286">3286</span>
<span id="L3287" rel="#L3287">3287</span>
<span id="L3288" rel="#L3288">3288</span>
<span id="L3289" rel="#L3289">3289</span>
<span id="L3290" rel="#L3290">3290</span>
<span id="L3291" rel="#L3291">3291</span>
<span id="L3292" rel="#L3292">3292</span>
<span id="L3293" rel="#L3293">3293</span>
<span id="L3294" rel="#L3294">3294</span>
<span id="L3295" rel="#L3295">3295</span>
<span id="L3296" rel="#L3296">3296</span>
<span id="L3297" rel="#L3297">3297</span>
<span id="L3298" rel="#L3298">3298</span>
<span id="L3299" rel="#L3299">3299</span>
<span id="L3300" rel="#L3300">3300</span>
<span id="L3301" rel="#L3301">3301</span>
<span id="L3302" rel="#L3302">3302</span>
<span id="L3303" rel="#L3303">3303</span>
<span id="L3304" rel="#L3304">3304</span>
<span id="L3305" rel="#L3305">3305</span>
<span id="L3306" rel="#L3306">3306</span>
<span id="L3307" rel="#L3307">3307</span>
<span id="L3308" rel="#L3308">3308</span>
<span id="L3309" rel="#L3309">3309</span>
<span id="L3310" rel="#L3310">3310</span>
<span id="L3311" rel="#L3311">3311</span>
<span id="L3312" rel="#L3312">3312</span>
<span id="L3313" rel="#L3313">3313</span>
<span id="L3314" rel="#L3314">3314</span>
<span id="L3315" rel="#L3315">3315</span>
<span id="L3316" rel="#L3316">3316</span>
<span id="L3317" rel="#L3317">3317</span>
<span id="L3318" rel="#L3318">3318</span>
<span id="L3319" rel="#L3319">3319</span>
<span id="L3320" rel="#L3320">3320</span>
<span id="L3321" rel="#L3321">3321</span>
<span id="L3322" rel="#L3322">3322</span>
<span id="L3323" rel="#L3323">3323</span>
<span id="L3324" rel="#L3324">3324</span>
<span id="L3325" rel="#L3325">3325</span>
<span id="L3326" rel="#L3326">3326</span>
<span id="L3327" rel="#L3327">3327</span>
<span id="L3328" rel="#L3328">3328</span>
<span id="L3329" rel="#L3329">3329</span>
<span id="L3330" rel="#L3330">3330</span>
<span id="L3331" rel="#L3331">3331</span>
<span id="L3332" rel="#L3332">3332</span>
<span id="L3333" rel="#L3333">3333</span>
<span id="L3334" rel="#L3334">3334</span>
<span id="L3335" rel="#L3335">3335</span>
<span id="L3336" rel="#L3336">3336</span>
<span id="L3337" rel="#L3337">3337</span>
<span id="L3338" rel="#L3338">3338</span>
<span id="L3339" rel="#L3339">3339</span>
<span id="L3340" rel="#L3340">3340</span>
<span id="L3341" rel="#L3341">3341</span>
<span id="L3342" rel="#L3342">3342</span>
<span id="L3343" rel="#L3343">3343</span>
<span id="L3344" rel="#L3344">3344</span>
<span id="L3345" rel="#L3345">3345</span>
<span id="L3346" rel="#L3346">3346</span>
<span id="L3347" rel="#L3347">3347</span>
<span id="L3348" rel="#L3348">3348</span>
<span id="L3349" rel="#L3349">3349</span>
<span id="L3350" rel="#L3350">3350</span>
<span id="L3351" rel="#L3351">3351</span>
<span id="L3352" rel="#L3352">3352</span>
<span id="L3353" rel="#L3353">3353</span>
<span id="L3354" rel="#L3354">3354</span>
<span id="L3355" rel="#L3355">3355</span>
<span id="L3356" rel="#L3356">3356</span>
<span id="L3357" rel="#L3357">3357</span>
<span id="L3358" rel="#L3358">3358</span>
<span id="L3359" rel="#L3359">3359</span>
<span id="L3360" rel="#L3360">3360</span>
<span id="L3361" rel="#L3361">3361</span>
<span id="L3362" rel="#L3362">3362</span>
<span id="L3363" rel="#L3363">3363</span>
<span id="L3364" rel="#L3364">3364</span>
<span id="L3365" rel="#L3365">3365</span>
<span id="L3366" rel="#L3366">3366</span>
<span id="L3367" rel="#L3367">3367</span>
<span id="L3368" rel="#L3368">3368</span>
<span id="L3369" rel="#L3369">3369</span>
<span id="L3370" rel="#L3370">3370</span>
<span id="L3371" rel="#L3371">3371</span>
<span id="L3372" rel="#L3372">3372</span>
<span id="L3373" rel="#L3373">3373</span>
<span id="L3374" rel="#L3374">3374</span>
<span id="L3375" rel="#L3375">3375</span>
<span id="L3376" rel="#L3376">3376</span>
<span id="L3377" rel="#L3377">3377</span>
<span id="L3378" rel="#L3378">3378</span>
<span id="L3379" rel="#L3379">3379</span>
<span id="L3380" rel="#L3380">3380</span>
<span id="L3381" rel="#L3381">3381</span>
<span id="L3382" rel="#L3382">3382</span>
<span id="L3383" rel="#L3383">3383</span>
<span id="L3384" rel="#L3384">3384</span>
<span id="L3385" rel="#L3385">3385</span>
<span id="L3386" rel="#L3386">3386</span>
<span id="L3387" rel="#L3387">3387</span>
<span id="L3388" rel="#L3388">3388</span>
<span id="L3389" rel="#L3389">3389</span>
<span id="L3390" rel="#L3390">3390</span>
<span id="L3391" rel="#L3391">3391</span>
<span id="L3392" rel="#L3392">3392</span>
<span id="L3393" rel="#L3393">3393</span>
<span id="L3394" rel="#L3394">3394</span>
<span id="L3395" rel="#L3395">3395</span>
<span id="L3396" rel="#L3396">3396</span>
<span id="L3397" rel="#L3397">3397</span>
<span id="L3398" rel="#L3398">3398</span>
<span id="L3399" rel="#L3399">3399</span>
<span id="L3400" rel="#L3400">3400</span>
<span id="L3401" rel="#L3401">3401</span>
<span id="L3402" rel="#L3402">3402</span>
<span id="L3403" rel="#L3403">3403</span>
<span id="L3404" rel="#L3404">3404</span>
<span id="L3405" rel="#L3405">3405</span>
<span id="L3406" rel="#L3406">3406</span>
<span id="L3407" rel="#L3407">3407</span>
<span id="L3408" rel="#L3408">3408</span>
<span id="L3409" rel="#L3409">3409</span>
<span id="L3410" rel="#L3410">3410</span>
<span id="L3411" rel="#L3411">3411</span>
<span id="L3412" rel="#L3412">3412</span>
<span id="L3413" rel="#L3413">3413</span>
<span id="L3414" rel="#L3414">3414</span>
<span id="L3415" rel="#L3415">3415</span>
<span id="L3416" rel="#L3416">3416</span>
<span id="L3417" rel="#L3417">3417</span>
<span id="L3418" rel="#L3418">3418</span>
<span id="L3419" rel="#L3419">3419</span>
<span id="L3420" rel="#L3420">3420</span>
<span id="L3421" rel="#L3421">3421</span>
<span id="L3422" rel="#L3422">3422</span>
<span id="L3423" rel="#L3423">3423</span>
<span id="L3424" rel="#L3424">3424</span>
<span id="L3425" rel="#L3425">3425</span>
<span id="L3426" rel="#L3426">3426</span>
<span id="L3427" rel="#L3427">3427</span>
<span id="L3428" rel="#L3428">3428</span>
<span id="L3429" rel="#L3429">3429</span>
<span id="L3430" rel="#L3430">3430</span>
<span id="L3431" rel="#L3431">3431</span>
<span id="L3432" rel="#L3432">3432</span>
<span id="L3433" rel="#L3433">3433</span>
<span id="L3434" rel="#L3434">3434</span>
<span id="L3435" rel="#L3435">3435</span>
<span id="L3436" rel="#L3436">3436</span>
<span id="L3437" rel="#L3437">3437</span>
<span id="L3438" rel="#L3438">3438</span>
<span id="L3439" rel="#L3439">3439</span>
<span id="L3440" rel="#L3440">3440</span>
<span id="L3441" rel="#L3441">3441</span>
<span id="L3442" rel="#L3442">3442</span>
<span id="L3443" rel="#L3443">3443</span>
<span id="L3444" rel="#L3444">3444</span>
<span id="L3445" rel="#L3445">3445</span>
<span id="L3446" rel="#L3446">3446</span>
<span id="L3447" rel="#L3447">3447</span>
<span id="L3448" rel="#L3448">3448</span>
<span id="L3449" rel="#L3449">3449</span>
<span id="L3450" rel="#L3450">3450</span>
<span id="L3451" rel="#L3451">3451</span>
<span id="L3452" rel="#L3452">3452</span>
<span id="L3453" rel="#L3453">3453</span>
<span id="L3454" rel="#L3454">3454</span>
<span id="L3455" rel="#L3455">3455</span>
<span id="L3456" rel="#L3456">3456</span>
<span id="L3457" rel="#L3457">3457</span>
<span id="L3458" rel="#L3458">3458</span>
<span id="L3459" rel="#L3459">3459</span>
<span id="L3460" rel="#L3460">3460</span>
<span id="L3461" rel="#L3461">3461</span>
<span id="L3462" rel="#L3462">3462</span>
<span id="L3463" rel="#L3463">3463</span>
<span id="L3464" rel="#L3464">3464</span>
<span id="L3465" rel="#L3465">3465</span>
<span id="L3466" rel="#L3466">3466</span>
<span id="L3467" rel="#L3467">3467</span>
<span id="L3468" rel="#L3468">3468</span>
<span id="L3469" rel="#L3469">3469</span>
<span id="L3470" rel="#L3470">3470</span>
<span id="L3471" rel="#L3471">3471</span>
<span id="L3472" rel="#L3472">3472</span>
<span id="L3473" rel="#L3473">3473</span>
<span id="L3474" rel="#L3474">3474</span>
<span id="L3475" rel="#L3475">3475</span>
<span id="L3476" rel="#L3476">3476</span>
<span id="L3477" rel="#L3477">3477</span>
<span id="L3478" rel="#L3478">3478</span>
<span id="L3479" rel="#L3479">3479</span>
<span id="L3480" rel="#L3480">3480</span>
<span id="L3481" rel="#L3481">3481</span>
<span id="L3482" rel="#L3482">3482</span>
<span id="L3483" rel="#L3483">3483</span>
<span id="L3484" rel="#L3484">3484</span>
<span id="L3485" rel="#L3485">3485</span>
<span id="L3486" rel="#L3486">3486</span>
<span id="L3487" rel="#L3487">3487</span>
<span id="L3488" rel="#L3488">3488</span>
<span id="L3489" rel="#L3489">3489</span>
<span id="L3490" rel="#L3490">3490</span>
<span id="L3491" rel="#L3491">3491</span>
<span id="L3492" rel="#L3492">3492</span>
<span id="L3493" rel="#L3493">3493</span>
<span id="L3494" rel="#L3494">3494</span>
<span id="L3495" rel="#L3495">3495</span>
<span id="L3496" rel="#L3496">3496</span>
<span id="L3497" rel="#L3497">3497</span>
<span id="L3498" rel="#L3498">3498</span>
<span id="L3499" rel="#L3499">3499</span>
<span id="L3500" rel="#L3500">3500</span>
<span id="L3501" rel="#L3501">3501</span>
<span id="L3502" rel="#L3502">3502</span>
<span id="L3503" rel="#L3503">3503</span>
<span id="L3504" rel="#L3504">3504</span>
<span id="L3505" rel="#L3505">3505</span>
<span id="L3506" rel="#L3506">3506</span>
<span id="L3507" rel="#L3507">3507</span>
<span id="L3508" rel="#L3508">3508</span>
<span id="L3509" rel="#L3509">3509</span>
<span id="L3510" rel="#L3510">3510</span>
<span id="L3511" rel="#L3511">3511</span>
<span id="L3512" rel="#L3512">3512</span>
<span id="L3513" rel="#L3513">3513</span>
<span id="L3514" rel="#L3514">3514</span>
<span id="L3515" rel="#L3515">3515</span>
<span id="L3516" rel="#L3516">3516</span>
<span id="L3517" rel="#L3517">3517</span>
<span id="L3518" rel="#L3518">3518</span>
<span id="L3519" rel="#L3519">3519</span>
<span id="L3520" rel="#L3520">3520</span>
<span id="L3521" rel="#L3521">3521</span>
<span id="L3522" rel="#L3522">3522</span>
<span id="L3523" rel="#L3523">3523</span>
<span id="L3524" rel="#L3524">3524</span>
<span id="L3525" rel="#L3525">3525</span>
<span id="L3526" rel="#L3526">3526</span>
<span id="L3527" rel="#L3527">3527</span>
<span id="L3528" rel="#L3528">3528</span>
<span id="L3529" rel="#L3529">3529</span>
<span id="L3530" rel="#L3530">3530</span>
<span id="L3531" rel="#L3531">3531</span>
<span id="L3532" rel="#L3532">3532</span>
<span id="L3533" rel="#L3533">3533</span>
<span id="L3534" rel="#L3534">3534</span>
<span id="L3535" rel="#L3535">3535</span>
<span id="L3536" rel="#L3536">3536</span>
<span id="L3537" rel="#L3537">3537</span>
<span id="L3538" rel="#L3538">3538</span>
<span id="L3539" rel="#L3539">3539</span>
<span id="L3540" rel="#L3540">3540</span>
<span id="L3541" rel="#L3541">3541</span>
<span id="L3542" rel="#L3542">3542</span>
<span id="L3543" rel="#L3543">3543</span>
<span id="L3544" rel="#L3544">3544</span>
<span id="L3545" rel="#L3545">3545</span>
<span id="L3546" rel="#L3546">3546</span>
<span id="L3547" rel="#L3547">3547</span>
<span id="L3548" rel="#L3548">3548</span>
<span id="L3549" rel="#L3549">3549</span>
<span id="L3550" rel="#L3550">3550</span>
<span id="L3551" rel="#L3551">3551</span>
<span id="L3552" rel="#L3552">3552</span>
<span id="L3553" rel="#L3553">3553</span>
<span id="L3554" rel="#L3554">3554</span>
<span id="L3555" rel="#L3555">3555</span>
<span id="L3556" rel="#L3556">3556</span>
<span id="L3557" rel="#L3557">3557</span>
<span id="L3558" rel="#L3558">3558</span>
<span id="L3559" rel="#L3559">3559</span>
<span id="L3560" rel="#L3560">3560</span>
<span id="L3561" rel="#L3561">3561</span>
<span id="L3562" rel="#L3562">3562</span>
<span id="L3563" rel="#L3563">3563</span>
<span id="L3564" rel="#L3564">3564</span>
<span id="L3565" rel="#L3565">3565</span>
<span id="L3566" rel="#L3566">3566</span>
<span id="L3567" rel="#L3567">3567</span>
<span id="L3568" rel="#L3568">3568</span>
<span id="L3569" rel="#L3569">3569</span>
<span id="L3570" rel="#L3570">3570</span>
<span id="L3571" rel="#L3571">3571</span>
<span id="L3572" rel="#L3572">3572</span>
<span id="L3573" rel="#L3573">3573</span>
<span id="L3574" rel="#L3574">3574</span>
<span id="L3575" rel="#L3575">3575</span>
<span id="L3576" rel="#L3576">3576</span>
<span id="L3577" rel="#L3577">3577</span>
<span id="L3578" rel="#L3578">3578</span>
<span id="L3579" rel="#L3579">3579</span>
<span id="L3580" rel="#L3580">3580</span>
<span id="L3581" rel="#L3581">3581</span>
<span id="L3582" rel="#L3582">3582</span>
<span id="L3583" rel="#L3583">3583</span>
<span id="L3584" rel="#L3584">3584</span>
<span id="L3585" rel="#L3585">3585</span>
<span id="L3586" rel="#L3586">3586</span>
<span id="L3587" rel="#L3587">3587</span>
<span id="L3588" rel="#L3588">3588</span>
<span id="L3589" rel="#L3589">3589</span>
<span id="L3590" rel="#L3590">3590</span>
<span id="L3591" rel="#L3591">3591</span>
<span id="L3592" rel="#L3592">3592</span>
<span id="L3593" rel="#L3593">3593</span>
<span id="L3594" rel="#L3594">3594</span>
<span id="L3595" rel="#L3595">3595</span>
<span id="L3596" rel="#L3596">3596</span>
<span id="L3597" rel="#L3597">3597</span>
<span id="L3598" rel="#L3598">3598</span>
<span id="L3599" rel="#L3599">3599</span>
<span id="L3600" rel="#L3600">3600</span>
<span id="L3601" rel="#L3601">3601</span>
<span id="L3602" rel="#L3602">3602</span>
<span id="L3603" rel="#L3603">3603</span>
<span id="L3604" rel="#L3604">3604</span>
<span id="L3605" rel="#L3605">3605</span>
<span id="L3606" rel="#L3606">3606</span>
<span id="L3607" rel="#L3607">3607</span>
<span id="L3608" rel="#L3608">3608</span>
<span id="L3609" rel="#L3609">3609</span>
<span id="L3610" rel="#L3610">3610</span>
<span id="L3611" rel="#L3611">3611</span>
<span id="L3612" rel="#L3612">3612</span>
<span id="L3613" rel="#L3613">3613</span>
<span id="L3614" rel="#L3614">3614</span>
<span id="L3615" rel="#L3615">3615</span>
<span id="L3616" rel="#L3616">3616</span>
<span id="L3617" rel="#L3617">3617</span>
<span id="L3618" rel="#L3618">3618</span>
<span id="L3619" rel="#L3619">3619</span>
<span id="L3620" rel="#L3620">3620</span>
<span id="L3621" rel="#L3621">3621</span>
<span id="L3622" rel="#L3622">3622</span>
<span id="L3623" rel="#L3623">3623</span>
<span id="L3624" rel="#L3624">3624</span>
<span id="L3625" rel="#L3625">3625</span>
<span id="L3626" rel="#L3626">3626</span>
<span id="L3627" rel="#L3627">3627</span>
<span id="L3628" rel="#L3628">3628</span>
<span id="L3629" rel="#L3629">3629</span>
<span id="L3630" rel="#L3630">3630</span>
<span id="L3631" rel="#L3631">3631</span>
<span id="L3632" rel="#L3632">3632</span>
<span id="L3633" rel="#L3633">3633</span>
<span id="L3634" rel="#L3634">3634</span>
<span id="L3635" rel="#L3635">3635</span>
<span id="L3636" rel="#L3636">3636</span>
<span id="L3637" rel="#L3637">3637</span>
<span id="L3638" rel="#L3638">3638</span>
<span id="L3639" rel="#L3639">3639</span>
<span id="L3640" rel="#L3640">3640</span>
<span id="L3641" rel="#L3641">3641</span>
<span id="L3642" rel="#L3642">3642</span>
<span id="L3643" rel="#L3643">3643</span>
<span id="L3644" rel="#L3644">3644</span>
<span id="L3645" rel="#L3645">3645</span>
<span id="L3646" rel="#L3646">3646</span>
<span id="L3647" rel="#L3647">3647</span>
<span id="L3648" rel="#L3648">3648</span>
<span id="L3649" rel="#L3649">3649</span>
<span id="L3650" rel="#L3650">3650</span>
<span id="L3651" rel="#L3651">3651</span>
<span id="L3652" rel="#L3652">3652</span>
<span id="L3653" rel="#L3653">3653</span>
<span id="L3654" rel="#L3654">3654</span>
<span id="L3655" rel="#L3655">3655</span>
<span id="L3656" rel="#L3656">3656</span>
<span id="L3657" rel="#L3657">3657</span>
<span id="L3658" rel="#L3658">3658</span>
<span id="L3659" rel="#L3659">3659</span>
<span id="L3660" rel="#L3660">3660</span>
<span id="L3661" rel="#L3661">3661</span>
<span id="L3662" rel="#L3662">3662</span>
<span id="L3663" rel="#L3663">3663</span>
<span id="L3664" rel="#L3664">3664</span>
<span id="L3665" rel="#L3665">3665</span>
<span id="L3666" rel="#L3666">3666</span>
<span id="L3667" rel="#L3667">3667</span>
<span id="L3668" rel="#L3668">3668</span>
<span id="L3669" rel="#L3669">3669</span>
<span id="L3670" rel="#L3670">3670</span>
<span id="L3671" rel="#L3671">3671</span>
<span id="L3672" rel="#L3672">3672</span>
<span id="L3673" rel="#L3673">3673</span>
<span id="L3674" rel="#L3674">3674</span>
<span id="L3675" rel="#L3675">3675</span>
<span id="L3676" rel="#L3676">3676</span>
<span id="L3677" rel="#L3677">3677</span>
<span id="L3678" rel="#L3678">3678</span>
<span id="L3679" rel="#L3679">3679</span>
<span id="L3680" rel="#L3680">3680</span>
<span id="L3681" rel="#L3681">3681</span>
<span id="L3682" rel="#L3682">3682</span>
<span id="L3683" rel="#L3683">3683</span>
<span id="L3684" rel="#L3684">3684</span>
<span id="L3685" rel="#L3685">3685</span>
<span id="L3686" rel="#L3686">3686</span>
<span id="L3687" rel="#L3687">3687</span>
<span id="L3688" rel="#L3688">3688</span>
<span id="L3689" rel="#L3689">3689</span>
<span id="L3690" rel="#L3690">3690</span>
<span id="L3691" rel="#L3691">3691</span>
<span id="L3692" rel="#L3692">3692</span>
<span id="L3693" rel="#L3693">3693</span>
<span id="L3694" rel="#L3694">3694</span>
<span id="L3695" rel="#L3695">3695</span>
<span id="L3696" rel="#L3696">3696</span>
<span id="L3697" rel="#L3697">3697</span>
<span id="L3698" rel="#L3698">3698</span>
<span id="L3699" rel="#L3699">3699</span>
<span id="L3700" rel="#L3700">3700</span>
<span id="L3701" rel="#L3701">3701</span>
<span id="L3702" rel="#L3702">3702</span>
<span id="L3703" rel="#L3703">3703</span>
<span id="L3704" rel="#L3704">3704</span>
<span id="L3705" rel="#L3705">3705</span>
<span id="L3706" rel="#L3706">3706</span>
<span id="L3707" rel="#L3707">3707</span>
<span id="L3708" rel="#L3708">3708</span>
<span id="L3709" rel="#L3709">3709</span>
<span id="L3710" rel="#L3710">3710</span>
<span id="L3711" rel="#L3711">3711</span>
<span id="L3712" rel="#L3712">3712</span>
<span id="L3713" rel="#L3713">3713</span>
<span id="L3714" rel="#L3714">3714</span>
<span id="L3715" rel="#L3715">3715</span>
<span id="L3716" rel="#L3716">3716</span>
<span id="L3717" rel="#L3717">3717</span>
<span id="L3718" rel="#L3718">3718</span>
<span id="L3719" rel="#L3719">3719</span>
<span id="L3720" rel="#L3720">3720</span>
<span id="L3721" rel="#L3721">3721</span>
<span id="L3722" rel="#L3722">3722</span>
<span id="L3723" rel="#L3723">3723</span>
<span id="L3724" rel="#L3724">3724</span>
<span id="L3725" rel="#L3725">3725</span>
<span id="L3726" rel="#L3726">3726</span>
<span id="L3727" rel="#L3727">3727</span>
<span id="L3728" rel="#L3728">3728</span>
<span id="L3729" rel="#L3729">3729</span>
<span id="L3730" rel="#L3730">3730</span>
<span id="L3731" rel="#L3731">3731</span>
<span id="L3732" rel="#L3732">3732</span>
<span id="L3733" rel="#L3733">3733</span>
<span id="L3734" rel="#L3734">3734</span>
<span id="L3735" rel="#L3735">3735</span>
<span id="L3736" rel="#L3736">3736</span>
<span id="L3737" rel="#L3737">3737</span>
<span id="L3738" rel="#L3738">3738</span>
<span id="L3739" rel="#L3739">3739</span>
<span id="L3740" rel="#L3740">3740</span>
<span id="L3741" rel="#L3741">3741</span>
<span id="L3742" rel="#L3742">3742</span>
<span id="L3743" rel="#L3743">3743</span>
<span id="L3744" rel="#L3744">3744</span>
<span id="L3745" rel="#L3745">3745</span>
<span id="L3746" rel="#L3746">3746</span>
<span id="L3747" rel="#L3747">3747</span>
<span id="L3748" rel="#L3748">3748</span>
<span id="L3749" rel="#L3749">3749</span>
<span id="L3750" rel="#L3750">3750</span>
<span id="L3751" rel="#L3751">3751</span>
<span id="L3752" rel="#L3752">3752</span>
<span id="L3753" rel="#L3753">3753</span>
<span id="L3754" rel="#L3754">3754</span>
<span id="L3755" rel="#L3755">3755</span>
<span id="L3756" rel="#L3756">3756</span>
<span id="L3757" rel="#L3757">3757</span>
<span id="L3758" rel="#L3758">3758</span>
<span id="L3759" rel="#L3759">3759</span>
<span id="L3760" rel="#L3760">3760</span>
<span id="L3761" rel="#L3761">3761</span>
<span id="L3762" rel="#L3762">3762</span>
<span id="L3763" rel="#L3763">3763</span>
<span id="L3764" rel="#L3764">3764</span>
<span id="L3765" rel="#L3765">3765</span>
<span id="L3766" rel="#L3766">3766</span>
<span id="L3767" rel="#L3767">3767</span>
<span id="L3768" rel="#L3768">3768</span>
<span id="L3769" rel="#L3769">3769</span>
<span id="L3770" rel="#L3770">3770</span>
<span id="L3771" rel="#L3771">3771</span>
<span id="L3772" rel="#L3772">3772</span>
<span id="L3773" rel="#L3773">3773</span>
<span id="L3774" rel="#L3774">3774</span>
<span id="L3775" rel="#L3775">3775</span>
<span id="L3776" rel="#L3776">3776</span>
<span id="L3777" rel="#L3777">3777</span>
<span id="L3778" rel="#L3778">3778</span>
<span id="L3779" rel="#L3779">3779</span>
<span id="L3780" rel="#L3780">3780</span>
<span id="L3781" rel="#L3781">3781</span>
<span id="L3782" rel="#L3782">3782</span>
<span id="L3783" rel="#L3783">3783</span>
<span id="L3784" rel="#L3784">3784</span>
<span id="L3785" rel="#L3785">3785</span>
<span id="L3786" rel="#L3786">3786</span>
<span id="L3787" rel="#L3787">3787</span>
<span id="L3788" rel="#L3788">3788</span>
<span id="L3789" rel="#L3789">3789</span>
<span id="L3790" rel="#L3790">3790</span>
<span id="L3791" rel="#L3791">3791</span>
<span id="L3792" rel="#L3792">3792</span>
<span id="L3793" rel="#L3793">3793</span>
<span id="L3794" rel="#L3794">3794</span>
<span id="L3795" rel="#L3795">3795</span>
<span id="L3796" rel="#L3796">3796</span>
<span id="L3797" rel="#L3797">3797</span>
<span id="L3798" rel="#L3798">3798</span>
<span id="L3799" rel="#L3799">3799</span>
<span id="L3800" rel="#L3800">3800</span>
<span id="L3801" rel="#L3801">3801</span>
<span id="L3802" rel="#L3802">3802</span>
<span id="L3803" rel="#L3803">3803</span>
<span id="L3804" rel="#L3804">3804</span>
<span id="L3805" rel="#L3805">3805</span>
<span id="L3806" rel="#L3806">3806</span>
<span id="L3807" rel="#L3807">3807</span>
<span id="L3808" rel="#L3808">3808</span>
<span id="L3809" rel="#L3809">3809</span>
<span id="L3810" rel="#L3810">3810</span>
<span id="L3811" rel="#L3811">3811</span>
<span id="L3812" rel="#L3812">3812</span>
<span id="L3813" rel="#L3813">3813</span>
<span id="L3814" rel="#L3814">3814</span>
<span id="L3815" rel="#L3815">3815</span>
<span id="L3816" rel="#L3816">3816</span>
<span id="L3817" rel="#L3817">3817</span>
<span id="L3818" rel="#L3818">3818</span>
<span id="L3819" rel="#L3819">3819</span>
<span id="L3820" rel="#L3820">3820</span>
<span id="L3821" rel="#L3821">3821</span>
<span id="L3822" rel="#L3822">3822</span>
<span id="L3823" rel="#L3823">3823</span>
<span id="L3824" rel="#L3824">3824</span>
<span id="L3825" rel="#L3825">3825</span>
<span id="L3826" rel="#L3826">3826</span>
<span id="L3827" rel="#L3827">3827</span>
<span id="L3828" rel="#L3828">3828</span>
<span id="L3829" rel="#L3829">3829</span>
<span id="L3830" rel="#L3830">3830</span>
<span id="L3831" rel="#L3831">3831</span>
<span id="L3832" rel="#L3832">3832</span>
<span id="L3833" rel="#L3833">3833</span>
<span id="L3834" rel="#L3834">3834</span>
<span id="L3835" rel="#L3835">3835</span>
<span id="L3836" rel="#L3836">3836</span>
<span id="L3837" rel="#L3837">3837</span>
<span id="L3838" rel="#L3838">3838</span>
<span id="L3839" rel="#L3839">3839</span>
<span id="L3840" rel="#L3840">3840</span>
<span id="L3841" rel="#L3841">3841</span>
<span id="L3842" rel="#L3842">3842</span>
<span id="L3843" rel="#L3843">3843</span>
<span id="L3844" rel="#L3844">3844</span>
<span id="L3845" rel="#L3845">3845</span>
<span id="L3846" rel="#L3846">3846</span>
<span id="L3847" rel="#L3847">3847</span>
<span id="L3848" rel="#L3848">3848</span>
<span id="L3849" rel="#L3849">3849</span>
<span id="L3850" rel="#L3850">3850</span>
<span id="L3851" rel="#L3851">3851</span>
<span id="L3852" rel="#L3852">3852</span>
<span id="L3853" rel="#L3853">3853</span>
<span id="L3854" rel="#L3854">3854</span>
<span id="L3855" rel="#L3855">3855</span>
<span id="L3856" rel="#L3856">3856</span>
<span id="L3857" rel="#L3857">3857</span>
<span id="L3858" rel="#L3858">3858</span>
<span id="L3859" rel="#L3859">3859</span>
<span id="L3860" rel="#L3860">3860</span>
<span id="L3861" rel="#L3861">3861</span>
<span id="L3862" rel="#L3862">3862</span>
<span id="L3863" rel="#L3863">3863</span>
<span id="L3864" rel="#L3864">3864</span>
<span id="L3865" rel="#L3865">3865</span>
<span id="L3866" rel="#L3866">3866</span>
<span id="L3867" rel="#L3867">3867</span>
<span id="L3868" rel="#L3868">3868</span>
<span id="L3869" rel="#L3869">3869</span>
<span id="L3870" rel="#L3870">3870</span>
<span id="L3871" rel="#L3871">3871</span>
<span id="L3872" rel="#L3872">3872</span>
<span id="L3873" rel="#L3873">3873</span>
<span id="L3874" rel="#L3874">3874</span>
<span id="L3875" rel="#L3875">3875</span>
<span id="L3876" rel="#L3876">3876</span>
<span id="L3877" rel="#L3877">3877</span>
<span id="L3878" rel="#L3878">3878</span>
<span id="L3879" rel="#L3879">3879</span>
<span id="L3880" rel="#L3880">3880</span>
<span id="L3881" rel="#L3881">3881</span>
<span id="L3882" rel="#L3882">3882</span>
<span id="L3883" rel="#L3883">3883</span>
<span id="L3884" rel="#L3884">3884</span>
<span id="L3885" rel="#L3885">3885</span>
<span id="L3886" rel="#L3886">3886</span>
<span id="L3887" rel="#L3887">3887</span>
<span id="L3888" rel="#L3888">3888</span>
<span id="L3889" rel="#L3889">3889</span>
<span id="L3890" rel="#L3890">3890</span>
<span id="L3891" rel="#L3891">3891</span>
<span id="L3892" rel="#L3892">3892</span>
<span id="L3893" rel="#L3893">3893</span>
<span id="L3894" rel="#L3894">3894</span>
<span id="L3895" rel="#L3895">3895</span>
<span id="L3896" rel="#L3896">3896</span>
<span id="L3897" rel="#L3897">3897</span>
<span id="L3898" rel="#L3898">3898</span>
<span id="L3899" rel="#L3899">3899</span>
<span id="L3900" rel="#L3900">3900</span>
<span id="L3901" rel="#L3901">3901</span>
<span id="L3902" rel="#L3902">3902</span>
<span id="L3903" rel="#L3903">3903</span>
<span id="L3904" rel="#L3904">3904</span>
<span id="L3905" rel="#L3905">3905</span>
<span id="L3906" rel="#L3906">3906</span>
<span id="L3907" rel="#L3907">3907</span>
<span id="L3908" rel="#L3908">3908</span>
<span id="L3909" rel="#L3909">3909</span>
<span id="L3910" rel="#L3910">3910</span>
<span id="L3911" rel="#L3911">3911</span>
<span id="L3912" rel="#L3912">3912</span>
<span id="L3913" rel="#L3913">3913</span>
<span id="L3914" rel="#L3914">3914</span>
<span id="L3915" rel="#L3915">3915</span>
<span id="L3916" rel="#L3916">3916</span>
<span id="L3917" rel="#L3917">3917</span>
<span id="L3918" rel="#L3918">3918</span>
<span id="L3919" rel="#L3919">3919</span>
<span id="L3920" rel="#L3920">3920</span>
<span id="L3921" rel="#L3921">3921</span>
<span id="L3922" rel="#L3922">3922</span>
<span id="L3923" rel="#L3923">3923</span>
<span id="L3924" rel="#L3924">3924</span>
<span id="L3925" rel="#L3925">3925</span>
<span id="L3926" rel="#L3926">3926</span>
<span id="L3927" rel="#L3927">3927</span>
<span id="L3928" rel="#L3928">3928</span>
<span id="L3929" rel="#L3929">3929</span>
<span id="L3930" rel="#L3930">3930</span>
<span id="L3931" rel="#L3931">3931</span>
<span id="L3932" rel="#L3932">3932</span>
<span id="L3933" rel="#L3933">3933</span>
<span id="L3934" rel="#L3934">3934</span>
<span id="L3935" rel="#L3935">3935</span>
<span id="L3936" rel="#L3936">3936</span>
<span id="L3937" rel="#L3937">3937</span>
<span id="L3938" rel="#L3938">3938</span>
<span id="L3939" rel="#L3939">3939</span>
<span id="L3940" rel="#L3940">3940</span>
<span id="L3941" rel="#L3941">3941</span>
<span id="L3942" rel="#L3942">3942</span>
<span id="L3943" rel="#L3943">3943</span>
<span id="L3944" rel="#L3944">3944</span>
<span id="L3945" rel="#L3945">3945</span>
<span id="L3946" rel="#L3946">3946</span>
<span id="L3947" rel="#L3947">3947</span>
<span id="L3948" rel="#L3948">3948</span>
<span id="L3949" rel="#L3949">3949</span>
<span id="L3950" rel="#L3950">3950</span>
<span id="L3951" rel="#L3951">3951</span>
<span id="L3952" rel="#L3952">3952</span>
<span id="L3953" rel="#L3953">3953</span>
<span id="L3954" rel="#L3954">3954</span>
<span id="L3955" rel="#L3955">3955</span>
<span id="L3956" rel="#L3956">3956</span>
<span id="L3957" rel="#L3957">3957</span>
<span id="L3958" rel="#L3958">3958</span>
<span id="L3959" rel="#L3959">3959</span>
<span id="L3960" rel="#L3960">3960</span>
<span id="L3961" rel="#L3961">3961</span>
<span id="L3962" rel="#L3962">3962</span>
<span id="L3963" rel="#L3963">3963</span>
<span id="L3964" rel="#L3964">3964</span>
<span id="L3965" rel="#L3965">3965</span>
<span id="L3966" rel="#L3966">3966</span>
<span id="L3967" rel="#L3967">3967</span>
<span id="L3968" rel="#L3968">3968</span>
<span id="L3969" rel="#L3969">3969</span>
<span id="L3970" rel="#L3970">3970</span>
<span id="L3971" rel="#L3971">3971</span>
<span id="L3972" rel="#L3972">3972</span>
<span id="L3973" rel="#L3973">3973</span>
<span id="L3974" rel="#L3974">3974</span>
<span id="L3975" rel="#L3975">3975</span>
<span id="L3976" rel="#L3976">3976</span>
<span id="L3977" rel="#L3977">3977</span>
<span id="L3978" rel="#L3978">3978</span>
<span id="L3979" rel="#L3979">3979</span>
<span id="L3980" rel="#L3980">3980</span>
<span id="L3981" rel="#L3981">3981</span>
<span id="L3982" rel="#L3982">3982</span>
<span id="L3983" rel="#L3983">3983</span>
<span id="L3984" rel="#L3984">3984</span>
<span id="L3985" rel="#L3985">3985</span>
<span id="L3986" rel="#L3986">3986</span>
<span id="L3987" rel="#L3987">3987</span>
<span id="L3988" rel="#L3988">3988</span>
<span id="L3989" rel="#L3989">3989</span>
<span id="L3990" rel="#L3990">3990</span>
<span id="L3991" rel="#L3991">3991</span>
<span id="L3992" rel="#L3992">3992</span>
<span id="L3993" rel="#L3993">3993</span>
<span id="L3994" rel="#L3994">3994</span>
<span id="L3995" rel="#L3995">3995</span>
<span id="L3996" rel="#L3996">3996</span>
<span id="L3997" rel="#L3997">3997</span>
<span id="L3998" rel="#L3998">3998</span>
<span id="L3999" rel="#L3999">3999</span>
<span id="L4000" rel="#L4000">4000</span>
<span id="L4001" rel="#L4001">4001</span>
<span id="L4002" rel="#L4002">4002</span>
<span id="L4003" rel="#L4003">4003</span>
<span id="L4004" rel="#L4004">4004</span>
<span id="L4005" rel="#L4005">4005</span>
<span id="L4006" rel="#L4006">4006</span>
<span id="L4007" rel="#L4007">4007</span>
<span id="L4008" rel="#L4008">4008</span>
<span id="L4009" rel="#L4009">4009</span>
<span id="L4010" rel="#L4010">4010</span>
<span id="L4011" rel="#L4011">4011</span>
<span id="L4012" rel="#L4012">4012</span>
<span id="L4013" rel="#L4013">4013</span>
<span id="L4014" rel="#L4014">4014</span>
<span id="L4015" rel="#L4015">4015</span>
<span id="L4016" rel="#L4016">4016</span>
<span id="L4017" rel="#L4017">4017</span>
<span id="L4018" rel="#L4018">4018</span>
<span id="L4019" rel="#L4019">4019</span>
<span id="L4020" rel="#L4020">4020</span>
<span id="L4021" rel="#L4021">4021</span>
<span id="L4022" rel="#L4022">4022</span>
<span id="L4023" rel="#L4023">4023</span>
<span id="L4024" rel="#L4024">4024</span>
<span id="L4025" rel="#L4025">4025</span>
<span id="L4026" rel="#L4026">4026</span>
<span id="L4027" rel="#L4027">4027</span>
<span id="L4028" rel="#L4028">4028</span>
<span id="L4029" rel="#L4029">4029</span>
<span id="L4030" rel="#L4030">4030</span>
<span id="L4031" rel="#L4031">4031</span>
<span id="L4032" rel="#L4032">4032</span>
<span id="L4033" rel="#L4033">4033</span>
<span id="L4034" rel="#L4034">4034</span>
<span id="L4035" rel="#L4035">4035</span>
<span id="L4036" rel="#L4036">4036</span>
<span id="L4037" rel="#L4037">4037</span>
<span id="L4038" rel="#L4038">4038</span>
<span id="L4039" rel="#L4039">4039</span>
<span id="L4040" rel="#L4040">4040</span>
<span id="L4041" rel="#L4041">4041</span>
<span id="L4042" rel="#L4042">4042</span>
<span id="L4043" rel="#L4043">4043</span>
<span id="L4044" rel="#L4044">4044</span>
<span id="L4045" rel="#L4045">4045</span>
<span id="L4046" rel="#L4046">4046</span>
<span id="L4047" rel="#L4047">4047</span>
<span id="L4048" rel="#L4048">4048</span>
<span id="L4049" rel="#L4049">4049</span>
<span id="L4050" rel="#L4050">4050</span>
<span id="L4051" rel="#L4051">4051</span>
<span id="L4052" rel="#L4052">4052</span>
<span id="L4053" rel="#L4053">4053</span>
<span id="L4054" rel="#L4054">4054</span>
<span id="L4055" rel="#L4055">4055</span>
<span id="L4056" rel="#L4056">4056</span>
<span id="L4057" rel="#L4057">4057</span>
<span id="L4058" rel="#L4058">4058</span>
<span id="L4059" rel="#L4059">4059</span>
<span id="L4060" rel="#L4060">4060</span>
<span id="L4061" rel="#L4061">4061</span>
<span id="L4062" rel="#L4062">4062</span>
<span id="L4063" rel="#L4063">4063</span>
<span id="L4064" rel="#L4064">4064</span>
<span id="L4065" rel="#L4065">4065</span>
<span id="L4066" rel="#L4066">4066</span>
<span id="L4067" rel="#L4067">4067</span>
<span id="L4068" rel="#L4068">4068</span>
<span id="L4069" rel="#L4069">4069</span>
<span id="L4070" rel="#L4070">4070</span>
<span id="L4071" rel="#L4071">4071</span>
<span id="L4072" rel="#L4072">4072</span>
<span id="L4073" rel="#L4073">4073</span>
<span id="L4074" rel="#L4074">4074</span>
<span id="L4075" rel="#L4075">4075</span>
<span id="L4076" rel="#L4076">4076</span>
<span id="L4077" rel="#L4077">4077</span>
<span id="L4078" rel="#L4078">4078</span>
<span id="L4079" rel="#L4079">4079</span>
<span id="L4080" rel="#L4080">4080</span>
<span id="L4081" rel="#L4081">4081</span>
<span id="L4082" rel="#L4082">4082</span>
<span id="L4083" rel="#L4083">4083</span>
<span id="L4084" rel="#L4084">4084</span>
<span id="L4085" rel="#L4085">4085</span>
<span id="L4086" rel="#L4086">4086</span>
<span id="L4087" rel="#L4087">4087</span>
<span id="L4088" rel="#L4088">4088</span>
<span id="L4089" rel="#L4089">4089</span>
<span id="L4090" rel="#L4090">4090</span>
<span id="L4091" rel="#L4091">4091</span>
<span id="L4092" rel="#L4092">4092</span>
<span id="L4093" rel="#L4093">4093</span>
<span id="L4094" rel="#L4094">4094</span>
<span id="L4095" rel="#L4095">4095</span>
<span id="L4096" rel="#L4096">4096</span>
<span id="L4097" rel="#L4097">4097</span>
<span id="L4098" rel="#L4098">4098</span>
<span id="L4099" rel="#L4099">4099</span>
<span id="L4100" rel="#L4100">4100</span>
<span id="L4101" rel="#L4101">4101</span>
<span id="L4102" rel="#L4102">4102</span>
<span id="L4103" rel="#L4103">4103</span>
<span id="L4104" rel="#L4104">4104</span>
<span id="L4105" rel="#L4105">4105</span>
<span id="L4106" rel="#L4106">4106</span>
<span id="L4107" rel="#L4107">4107</span>
<span id="L4108" rel="#L4108">4108</span>
<span id="L4109" rel="#L4109">4109</span>
<span id="L4110" rel="#L4110">4110</span>
<span id="L4111" rel="#L4111">4111</span>
<span id="L4112" rel="#L4112">4112</span>
<span id="L4113" rel="#L4113">4113</span>
<span id="L4114" rel="#L4114">4114</span>
<span id="L4115" rel="#L4115">4115</span>
<span id="L4116" rel="#L4116">4116</span>
<span id="L4117" rel="#L4117">4117</span>
<span id="L4118" rel="#L4118">4118</span>
<span id="L4119" rel="#L4119">4119</span>
<span id="L4120" rel="#L4120">4120</span>
<span id="L4121" rel="#L4121">4121</span>
<span id="L4122" rel="#L4122">4122</span>
<span id="L4123" rel="#L4123">4123</span>
<span id="L4124" rel="#L4124">4124</span>
<span id="L4125" rel="#L4125">4125</span>
<span id="L4126" rel="#L4126">4126</span>
<span id="L4127" rel="#L4127">4127</span>
<span id="L4128" rel="#L4128">4128</span>
<span id="L4129" rel="#L4129">4129</span>
<span id="L4130" rel="#L4130">4130</span>
<span id="L4131" rel="#L4131">4131</span>
<span id="L4132" rel="#L4132">4132</span>
<span id="L4133" rel="#L4133">4133</span>
<span id="L4134" rel="#L4134">4134</span>
<span id="L4135" rel="#L4135">4135</span>
<span id="L4136" rel="#L4136">4136</span>
<span id="L4137" rel="#L4137">4137</span>
<span id="L4138" rel="#L4138">4138</span>
<span id="L4139" rel="#L4139">4139</span>
<span id="L4140" rel="#L4140">4140</span>
<span id="L4141" rel="#L4141">4141</span>
<span id="L4142" rel="#L4142">4142</span>
<span id="L4143" rel="#L4143">4143</span>
<span id="L4144" rel="#L4144">4144</span>
<span id="L4145" rel="#L4145">4145</span>
<span id="L4146" rel="#L4146">4146</span>
<span id="L4147" rel="#L4147">4147</span>
<span id="L4148" rel="#L4148">4148</span>
<span id="L4149" rel="#L4149">4149</span>
<span id="L4150" rel="#L4150">4150</span>
<span id="L4151" rel="#L4151">4151</span>
<span id="L4152" rel="#L4152">4152</span>
<span id="L4153" rel="#L4153">4153</span>
<span id="L4154" rel="#L4154">4154</span>
<span id="L4155" rel="#L4155">4155</span>
<span id="L4156" rel="#L4156">4156</span>
<span id="L4157" rel="#L4157">4157</span>
<span id="L4158" rel="#L4158">4158</span>
<span id="L4159" rel="#L4159">4159</span>
<span id="L4160" rel="#L4160">4160</span>
<span id="L4161" rel="#L4161">4161</span>
<span id="L4162" rel="#L4162">4162</span>
<span id="L4163" rel="#L4163">4163</span>
<span id="L4164" rel="#L4164">4164</span>
<span id="L4165" rel="#L4165">4165</span>
<span id="L4166" rel="#L4166">4166</span>
<span id="L4167" rel="#L4167">4167</span>
<span id="L4168" rel="#L4168">4168</span>
<span id="L4169" rel="#L4169">4169</span>
<span id="L4170" rel="#L4170">4170</span>
<span id="L4171" rel="#L4171">4171</span>
<span id="L4172" rel="#L4172">4172</span>
<span id="L4173" rel="#L4173">4173</span>
<span id="L4174" rel="#L4174">4174</span>
<span id="L4175" rel="#L4175">4175</span>
<span id="L4176" rel="#L4176">4176</span>
<span id="L4177" rel="#L4177">4177</span>
<span id="L4178" rel="#L4178">4178</span>
<span id="L4179" rel="#L4179">4179</span>
<span id="L4180" rel="#L4180">4180</span>
<span id="L4181" rel="#L4181">4181</span>
<span id="L4182" rel="#L4182">4182</span>
<span id="L4183" rel="#L4183">4183</span>
<span id="L4184" rel="#L4184">4184</span>
<span id="L4185" rel="#L4185">4185</span>
<span id="L4186" rel="#L4186">4186</span>
<span id="L4187" rel="#L4187">4187</span>
<span id="L4188" rel="#L4188">4188</span>
<span id="L4189" rel="#L4189">4189</span>
<span id="L4190" rel="#L4190">4190</span>
<span id="L4191" rel="#L4191">4191</span>
<span id="L4192" rel="#L4192">4192</span>
<span id="L4193" rel="#L4193">4193</span>
<span id="L4194" rel="#L4194">4194</span>
<span id="L4195" rel="#L4195">4195</span>
<span id="L4196" rel="#L4196">4196</span>
<span id="L4197" rel="#L4197">4197</span>
<span id="L4198" rel="#L4198">4198</span>
<span id="L4199" rel="#L4199">4199</span>
<span id="L4200" rel="#L4200">4200</span>
<span id="L4201" rel="#L4201">4201</span>
<span id="L4202" rel="#L4202">4202</span>
<span id="L4203" rel="#L4203">4203</span>
<span id="L4204" rel="#L4204">4204</span>
<span id="L4205" rel="#L4205">4205</span>
<span id="L4206" rel="#L4206">4206</span>
<span id="L4207" rel="#L4207">4207</span>
<span id="L4208" rel="#L4208">4208</span>
<span id="L4209" rel="#L4209">4209</span>
<span id="L4210" rel="#L4210">4210</span>
<span id="L4211" rel="#L4211">4211</span>
<span id="L4212" rel="#L4212">4212</span>
<span id="L4213" rel="#L4213">4213</span>
<span id="L4214" rel="#L4214">4214</span>
<span id="L4215" rel="#L4215">4215</span>
<span id="L4216" rel="#L4216">4216</span>
<span id="L4217" rel="#L4217">4217</span>
<span id="L4218" rel="#L4218">4218</span>
<span id="L4219" rel="#L4219">4219</span>
<span id="L4220" rel="#L4220">4220</span>
<span id="L4221" rel="#L4221">4221</span>
<span id="L4222" rel="#L4222">4222</span>
<span id="L4223" rel="#L4223">4223</span>
<span id="L4224" rel="#L4224">4224</span>
<span id="L4225" rel="#L4225">4225</span>
<span id="L4226" rel="#L4226">4226</span>
<span id="L4227" rel="#L4227">4227</span>
<span id="L4228" rel="#L4228">4228</span>
<span id="L4229" rel="#L4229">4229</span>
<span id="L4230" rel="#L4230">4230</span>
<span id="L4231" rel="#L4231">4231</span>
<span id="L4232" rel="#L4232">4232</span>
<span id="L4233" rel="#L4233">4233</span>
<span id="L4234" rel="#L4234">4234</span>
<span id="L4235" rel="#L4235">4235</span>
<span id="L4236" rel="#L4236">4236</span>
<span id="L4237" rel="#L4237">4237</span>
<span id="L4238" rel="#L4238">4238</span>
<span id="L4239" rel="#L4239">4239</span>
<span id="L4240" rel="#L4240">4240</span>
<span id="L4241" rel="#L4241">4241</span>
<span id="L4242" rel="#L4242">4242</span>
<span id="L4243" rel="#L4243">4243</span>
<span id="L4244" rel="#L4244">4244</span>
<span id="L4245" rel="#L4245">4245</span>
<span id="L4246" rel="#L4246">4246</span>
<span id="L4247" rel="#L4247">4247</span>
<span id="L4248" rel="#L4248">4248</span>
<span id="L4249" rel="#L4249">4249</span>
<span id="L4250" rel="#L4250">4250</span>
<span id="L4251" rel="#L4251">4251</span>
<span id="L4252" rel="#L4252">4252</span>
<span id="L4253" rel="#L4253">4253</span>
<span id="L4254" rel="#L4254">4254</span>
<span id="L4255" rel="#L4255">4255</span>
<span id="L4256" rel="#L4256">4256</span>
<span id="L4257" rel="#L4257">4257</span>
<span id="L4258" rel="#L4258">4258</span>
<span id="L4259" rel="#L4259">4259</span>
<span id="L4260" rel="#L4260">4260</span>
<span id="L4261" rel="#L4261">4261</span>
<span id="L4262" rel="#L4262">4262</span>
<span id="L4263" rel="#L4263">4263</span>
<span id="L4264" rel="#L4264">4264</span>
<span id="L4265" rel="#L4265">4265</span>
<span id="L4266" rel="#L4266">4266</span>
<span id="L4267" rel="#L4267">4267</span>
<span id="L4268" rel="#L4268">4268</span>
<span id="L4269" rel="#L4269">4269</span>
<span id="L4270" rel="#L4270">4270</span>
<span id="L4271" rel="#L4271">4271</span>
<span id="L4272" rel="#L4272">4272</span>
<span id="L4273" rel="#L4273">4273</span>
<span id="L4274" rel="#L4274">4274</span>
<span id="L4275" rel="#L4275">4275</span>
<span id="L4276" rel="#L4276">4276</span>
<span id="L4277" rel="#L4277">4277</span>
<span id="L4278" rel="#L4278">4278</span>
<span id="L4279" rel="#L4279">4279</span>
<span id="L4280" rel="#L4280">4280</span>
<span id="L4281" rel="#L4281">4281</span>
<span id="L4282" rel="#L4282">4282</span>
<span id="L4283" rel="#L4283">4283</span>
<span id="L4284" rel="#L4284">4284</span>
<span id="L4285" rel="#L4285">4285</span>
<span id="L4286" rel="#L4286">4286</span>
<span id="L4287" rel="#L4287">4287</span>
<span id="L4288" rel="#L4288">4288</span>
<span id="L4289" rel="#L4289">4289</span>
<span id="L4290" rel="#L4290">4290</span>
<span id="L4291" rel="#L4291">4291</span>
<span id="L4292" rel="#L4292">4292</span>
<span id="L4293" rel="#L4293">4293</span>
<span id="L4294" rel="#L4294">4294</span>
<span id="L4295" rel="#L4295">4295</span>
<span id="L4296" rel="#L4296">4296</span>
<span id="L4297" rel="#L4297">4297</span>
<span id="L4298" rel="#L4298">4298</span>
<span id="L4299" rel="#L4299">4299</span>
<span id="L4300" rel="#L4300">4300</span>
<span id="L4301" rel="#L4301">4301</span>
<span id="L4302" rel="#L4302">4302</span>
<span id="L4303" rel="#L4303">4303</span>
<span id="L4304" rel="#L4304">4304</span>
<span id="L4305" rel="#L4305">4305</span>
<span id="L4306" rel="#L4306">4306</span>
<span id="L4307" rel="#L4307">4307</span>
<span id="L4308" rel="#L4308">4308</span>
<span id="L4309" rel="#L4309">4309</span>
<span id="L4310" rel="#L4310">4310</span>
<span id="L4311" rel="#L4311">4311</span>
<span id="L4312" rel="#L4312">4312</span>
<span id="L4313" rel="#L4313">4313</span>
<span id="L4314" rel="#L4314">4314</span>
<span id="L4315" rel="#L4315">4315</span>
<span id="L4316" rel="#L4316">4316</span>
<span id="L4317" rel="#L4317">4317</span>
<span id="L4318" rel="#L4318">4318</span>
<span id="L4319" rel="#L4319">4319</span>
<span id="L4320" rel="#L4320">4320</span>
<span id="L4321" rel="#L4321">4321</span>
<span id="L4322" rel="#L4322">4322</span>
<span id="L4323" rel="#L4323">4323</span>
<span id="L4324" rel="#L4324">4324</span>
<span id="L4325" rel="#L4325">4325</span>
<span id="L4326" rel="#L4326">4326</span>
<span id="L4327" rel="#L4327">4327</span>
<span id="L4328" rel="#L4328">4328</span>
<span id="L4329" rel="#L4329">4329</span>
<span id="L4330" rel="#L4330">4330</span>
<span id="L4331" rel="#L4331">4331</span>
<span id="L4332" rel="#L4332">4332</span>
<span id="L4333" rel="#L4333">4333</span>
<span id="L4334" rel="#L4334">4334</span>
<span id="L4335" rel="#L4335">4335</span>
<span id="L4336" rel="#L4336">4336</span>
<span id="L4337" rel="#L4337">4337</span>
<span id="L4338" rel="#L4338">4338</span>
<span id="L4339" rel="#L4339">4339</span>
<span id="L4340" rel="#L4340">4340</span>
<span id="L4341" rel="#L4341">4341</span>
<span id="L4342" rel="#L4342">4342</span>
<span id="L4343" rel="#L4343">4343</span>
<span id="L4344" rel="#L4344">4344</span>
<span id="L4345" rel="#L4345">4345</span>
<span id="L4346" rel="#L4346">4346</span>
<span id="L4347" rel="#L4347">4347</span>
<span id="L4348" rel="#L4348">4348</span>
<span id="L4349" rel="#L4349">4349</span>
<span id="L4350" rel="#L4350">4350</span>
<span id="L4351" rel="#L4351">4351</span>
<span id="L4352" rel="#L4352">4352</span>
<span id="L4353" rel="#L4353">4353</span>
<span id="L4354" rel="#L4354">4354</span>
<span id="L4355" rel="#L4355">4355</span>
<span id="L4356" rel="#L4356">4356</span>
<span id="L4357" rel="#L4357">4357</span>
<span id="L4358" rel="#L4358">4358</span>
<span id="L4359" rel="#L4359">4359</span>
<span id="L4360" rel="#L4360">4360</span>
<span id="L4361" rel="#L4361">4361</span>
<span id="L4362" rel="#L4362">4362</span>
<span id="L4363" rel="#L4363">4363</span>
<span id="L4364" rel="#L4364">4364</span>
<span id="L4365" rel="#L4365">4365</span>
<span id="L4366" rel="#L4366">4366</span>
<span id="L4367" rel="#L4367">4367</span>
<span id="L4368" rel="#L4368">4368</span>
<span id="L4369" rel="#L4369">4369</span>
<span id="L4370" rel="#L4370">4370</span>
<span id="L4371" rel="#L4371">4371</span>
<span id="L4372" rel="#L4372">4372</span>
<span id="L4373" rel="#L4373">4373</span>
<span id="L4374" rel="#L4374">4374</span>
<span id="L4375" rel="#L4375">4375</span>
<span id="L4376" rel="#L4376">4376</span>
<span id="L4377" rel="#L4377">4377</span>
<span id="L4378" rel="#L4378">4378</span>
<span id="L4379" rel="#L4379">4379</span>
<span id="L4380" rel="#L4380">4380</span>
<span id="L4381" rel="#L4381">4381</span>
<span id="L4382" rel="#L4382">4382</span>
<span id="L4383" rel="#L4383">4383</span>
<span id="L4384" rel="#L4384">4384</span>
<span id="L4385" rel="#L4385">4385</span>
<span id="L4386" rel="#L4386">4386</span>
<span id="L4387" rel="#L4387">4387</span>
<span id="L4388" rel="#L4388">4388</span>
<span id="L4389" rel="#L4389">4389</span>
<span id="L4390" rel="#L4390">4390</span>
<span id="L4391" rel="#L4391">4391</span>
<span id="L4392" rel="#L4392">4392</span>
<span id="L4393" rel="#L4393">4393</span>
<span id="L4394" rel="#L4394">4394</span>
<span id="L4395" rel="#L4395">4395</span>
<span id="L4396" rel="#L4396">4396</span>
<span id="L4397" rel="#L4397">4397</span>
<span id="L4398" rel="#L4398">4398</span>
<span id="L4399" rel="#L4399">4399</span>
<span id="L4400" rel="#L4400">4400</span>
<span id="L4401" rel="#L4401">4401</span>
<span id="L4402" rel="#L4402">4402</span>
<span id="L4403" rel="#L4403">4403</span>
<span id="L4404" rel="#L4404">4404</span>
<span id="L4405" rel="#L4405">4405</span>
<span id="L4406" rel="#L4406">4406</span>
<span id="L4407" rel="#L4407">4407</span>
<span id="L4408" rel="#L4408">4408</span>
<span id="L4409" rel="#L4409">4409</span>
<span id="L4410" rel="#L4410">4410</span>
<span id="L4411" rel="#L4411">4411</span>
<span id="L4412" rel="#L4412">4412</span>
<span id="L4413" rel="#L4413">4413</span>
<span id="L4414" rel="#L4414">4414</span>
<span id="L4415" rel="#L4415">4415</span>
<span id="L4416" rel="#L4416">4416</span>
<span id="L4417" rel="#L4417">4417</span>
<span id="L4418" rel="#L4418">4418</span>
<span id="L4419" rel="#L4419">4419</span>
<span id="L4420" rel="#L4420">4420</span>
<span id="L4421" rel="#L4421">4421</span>
<span id="L4422" rel="#L4422">4422</span>
<span id="L4423" rel="#L4423">4423</span>
<span id="L4424" rel="#L4424">4424</span>
<span id="L4425" rel="#L4425">4425</span>
<span id="L4426" rel="#L4426">4426</span>
<span id="L4427" rel="#L4427">4427</span>
<span id="L4428" rel="#L4428">4428</span>
<span id="L4429" rel="#L4429">4429</span>
<span id="L4430" rel="#L4430">4430</span>
<span id="L4431" rel="#L4431">4431</span>
<span id="L4432" rel="#L4432">4432</span>
<span id="L4433" rel="#L4433">4433</span>
<span id="L4434" rel="#L4434">4434</span>
<span id="L4435" rel="#L4435">4435</span>
<span id="L4436" rel="#L4436">4436</span>
<span id="L4437" rel="#L4437">4437</span>
<span id="L4438" rel="#L4438">4438</span>
<span id="L4439" rel="#L4439">4439</span>
<span id="L4440" rel="#L4440">4440</span>
<span id="L4441" rel="#L4441">4441</span>
<span id="L4442" rel="#L4442">4442</span>
<span id="L4443" rel="#L4443">4443</span>
<span id="L4444" rel="#L4444">4444</span>
<span id="L4445" rel="#L4445">4445</span>
<span id="L4446" rel="#L4446">4446</span>
<span id="L4447" rel="#L4447">4447</span>
<span id="L4448" rel="#L4448">4448</span>
<span id="L4449" rel="#L4449">4449</span>
<span id="L4450" rel="#L4450">4450</span>
<span id="L4451" rel="#L4451">4451</span>
<span id="L4452" rel="#L4452">4452</span>
<span id="L4453" rel="#L4453">4453</span>
<span id="L4454" rel="#L4454">4454</span>
<span id="L4455" rel="#L4455">4455</span>
<span id="L4456" rel="#L4456">4456</span>
<span id="L4457" rel="#L4457">4457</span>
<span id="L4458" rel="#L4458">4458</span>
<span id="L4459" rel="#L4459">4459</span>
<span id="L4460" rel="#L4460">4460</span>
<span id="L4461" rel="#L4461">4461</span>
<span id="L4462" rel="#L4462">4462</span>
<span id="L4463" rel="#L4463">4463</span>
<span id="L4464" rel="#L4464">4464</span>
<span id="L4465" rel="#L4465">4465</span>
<span id="L4466" rel="#L4466">4466</span>
<span id="L4467" rel="#L4467">4467</span>
<span id="L4468" rel="#L4468">4468</span>
<span id="L4469" rel="#L4469">4469</span>
<span id="L4470" rel="#L4470">4470</span>
<span id="L4471" rel="#L4471">4471</span>
<span id="L4472" rel="#L4472">4472</span>
<span id="L4473" rel="#L4473">4473</span>
<span id="L4474" rel="#L4474">4474</span>
<span id="L4475" rel="#L4475">4475</span>
<span id="L4476" rel="#L4476">4476</span>
<span id="L4477" rel="#L4477">4477</span>
<span id="L4478" rel="#L4478">4478</span>
<span id="L4479" rel="#L4479">4479</span>
<span id="L4480" rel="#L4480">4480</span>
<span id="L4481" rel="#L4481">4481</span>
<span id="L4482" rel="#L4482">4482</span>
<span id="L4483" rel="#L4483">4483</span>
<span id="L4484" rel="#L4484">4484</span>
<span id="L4485" rel="#L4485">4485</span>
<span id="L4486" rel="#L4486">4486</span>
<span id="L4487" rel="#L4487">4487</span>
<span id="L4488" rel="#L4488">4488</span>
<span id="L4489" rel="#L4489">4489</span>
<span id="L4490" rel="#L4490">4490</span>
<span id="L4491" rel="#L4491">4491</span>
<span id="L4492" rel="#L4492">4492</span>
<span id="L4493" rel="#L4493">4493</span>
<span id="L4494" rel="#L4494">4494</span>
<span id="L4495" rel="#L4495">4495</span>
<span id="L4496" rel="#L4496">4496</span>
<span id="L4497" rel="#L4497">4497</span>
<span id="L4498" rel="#L4498">4498</span>
<span id="L4499" rel="#L4499">4499</span>
<span id="L4500" rel="#L4500">4500</span>
<span id="L4501" rel="#L4501">4501</span>
<span id="L4502" rel="#L4502">4502</span>
<span id="L4503" rel="#L4503">4503</span>
<span id="L4504" rel="#L4504">4504</span>
<span id="L4505" rel="#L4505">4505</span>
<span id="L4506" rel="#L4506">4506</span>
<span id="L4507" rel="#L4507">4507</span>
<span id="L4508" rel="#L4508">4508</span>
<span id="L4509" rel="#L4509">4509</span>
<span id="L4510" rel="#L4510">4510</span>
<span id="L4511" rel="#L4511">4511</span>
<span id="L4512" rel="#L4512">4512</span>
<span id="L4513" rel="#L4513">4513</span>
<span id="L4514" rel="#L4514">4514</span>
<span id="L4515" rel="#L4515">4515</span>
<span id="L4516" rel="#L4516">4516</span>
<span id="L4517" rel="#L4517">4517</span>
<span id="L4518" rel="#L4518">4518</span>
<span id="L4519" rel="#L4519">4519</span>
<span id="L4520" rel="#L4520">4520</span>
<span id="L4521" rel="#L4521">4521</span>
<span id="L4522" rel="#L4522">4522</span>
<span id="L4523" rel="#L4523">4523</span>
<span id="L4524" rel="#L4524">4524</span>
<span id="L4525" rel="#L4525">4525</span>
<span id="L4526" rel="#L4526">4526</span>
<span id="L4527" rel="#L4527">4527</span>
<span id="L4528" rel="#L4528">4528</span>
<span id="L4529" rel="#L4529">4529</span>
<span id="L4530" rel="#L4530">4530</span>
<span id="L4531" rel="#L4531">4531</span>
<span id="L4532" rel="#L4532">4532</span>
<span id="L4533" rel="#L4533">4533</span>
<span id="L4534" rel="#L4534">4534</span>
<span id="L4535" rel="#L4535">4535</span>
<span id="L4536" rel="#L4536">4536</span>
<span id="L4537" rel="#L4537">4537</span>
<span id="L4538" rel="#L4538">4538</span>
<span id="L4539" rel="#L4539">4539</span>
<span id="L4540" rel="#L4540">4540</span>
<span id="L4541" rel="#L4541">4541</span>
<span id="L4542" rel="#L4542">4542</span>
<span id="L4543" rel="#L4543">4543</span>
<span id="L4544" rel="#L4544">4544</span>
<span id="L4545" rel="#L4545">4545</span>
<span id="L4546" rel="#L4546">4546</span>
<span id="L4547" rel="#L4547">4547</span>
<span id="L4548" rel="#L4548">4548</span>
<span id="L4549" rel="#L4549">4549</span>
<span id="L4550" rel="#L4550">4550</span>
<span id="L4551" rel="#L4551">4551</span>
<span id="L4552" rel="#L4552">4552</span>
<span id="L4553" rel="#L4553">4553</span>
<span id="L4554" rel="#L4554">4554</span>
<span id="L4555" rel="#L4555">4555</span>
<span id="L4556" rel="#L4556">4556</span>
<span id="L4557" rel="#L4557">4557</span>
<span id="L4558" rel="#L4558">4558</span>
<span id="L4559" rel="#L4559">4559</span>
<span id="L4560" rel="#L4560">4560</span>
<span id="L4561" rel="#L4561">4561</span>
<span id="L4562" rel="#L4562">4562</span>
<span id="L4563" rel="#L4563">4563</span>
<span id="L4564" rel="#L4564">4564</span>
<span id="L4565" rel="#L4565">4565</span>
<span id="L4566" rel="#L4566">4566</span>
<span id="L4567" rel="#L4567">4567</span>
<span id="L4568" rel="#L4568">4568</span>
<span id="L4569" rel="#L4569">4569</span>
<span id="L4570" rel="#L4570">4570</span>
<span id="L4571" rel="#L4571">4571</span>
<span id="L4572" rel="#L4572">4572</span>
<span id="L4573" rel="#L4573">4573</span>
<span id="L4574" rel="#L4574">4574</span>
<span id="L4575" rel="#L4575">4575</span>
<span id="L4576" rel="#L4576">4576</span>
<span id="L4577" rel="#L4577">4577</span>
<span id="L4578" rel="#L4578">4578</span>
<span id="L4579" rel="#L4579">4579</span>
<span id="L4580" rel="#L4580">4580</span>
<span id="L4581" rel="#L4581">4581</span>
<span id="L4582" rel="#L4582">4582</span>
<span id="L4583" rel="#L4583">4583</span>
<span id="L4584" rel="#L4584">4584</span>
<span id="L4585" rel="#L4585">4585</span>
<span id="L4586" rel="#L4586">4586</span>
<span id="L4587" rel="#L4587">4587</span>
<span id="L4588" rel="#L4588">4588</span>
<span id="L4589" rel="#L4589">4589</span>
<span id="L4590" rel="#L4590">4590</span>
<span id="L4591" rel="#L4591">4591</span>
<span id="L4592" rel="#L4592">4592</span>
<span id="L4593" rel="#L4593">4593</span>
<span id="L4594" rel="#L4594">4594</span>
<span id="L4595" rel="#L4595">4595</span>
<span id="L4596" rel="#L4596">4596</span>
<span id="L4597" rel="#L4597">4597</span>
<span id="L4598" rel="#L4598">4598</span>
<span id="L4599" rel="#L4599">4599</span>
<span id="L4600" rel="#L4600">4600</span>
<span id="L4601" rel="#L4601">4601</span>
<span id="L4602" rel="#L4602">4602</span>
<span id="L4603" rel="#L4603">4603</span>
<span id="L4604" rel="#L4604">4604</span>
<span id="L4605" rel="#L4605">4605</span>
<span id="L4606" rel="#L4606">4606</span>
<span id="L4607" rel="#L4607">4607</span>
<span id="L4608" rel="#L4608">4608</span>
<span id="L4609" rel="#L4609">4609</span>
<span id="L4610" rel="#L4610">4610</span>
<span id="L4611" rel="#L4611">4611</span>
<span id="L4612" rel="#L4612">4612</span>
<span id="L4613" rel="#L4613">4613</span>
<span id="L4614" rel="#L4614">4614</span>
<span id="L4615" rel="#L4615">4615</span>
<span id="L4616" rel="#L4616">4616</span>
<span id="L4617" rel="#L4617">4617</span>
<span id="L4618" rel="#L4618">4618</span>
<span id="L4619" rel="#L4619">4619</span>
<span id="L4620" rel="#L4620">4620</span>
<span id="L4621" rel="#L4621">4621</span>
<span id="L4622" rel="#L4622">4622</span>
<span id="L4623" rel="#L4623">4623</span>
<span id="L4624" rel="#L4624">4624</span>
<span id="L4625" rel="#L4625">4625</span>
<span id="L4626" rel="#L4626">4626</span>
<span id="L4627" rel="#L4627">4627</span>
<span id="L4628" rel="#L4628">4628</span>
<span id="L4629" rel="#L4629">4629</span>
<span id="L4630" rel="#L4630">4630</span>
<span id="L4631" rel="#L4631">4631</span>
<span id="L4632" rel="#L4632">4632</span>
<span id="L4633" rel="#L4633">4633</span>
<span id="L4634" rel="#L4634">4634</span>
<span id="L4635" rel="#L4635">4635</span>
<span id="L4636" rel="#L4636">4636</span>
<span id="L4637" rel="#L4637">4637</span>
<span id="L4638" rel="#L4638">4638</span>
<span id="L4639" rel="#L4639">4639</span>
<span id="L4640" rel="#L4640">4640</span>
<span id="L4641" rel="#L4641">4641</span>
<span id="L4642" rel="#L4642">4642</span>
<span id="L4643" rel="#L4643">4643</span>
<span id="L4644" rel="#L4644">4644</span>
<span id="L4645" rel="#L4645">4645</span>
<span id="L4646" rel="#L4646">4646</span>
<span id="L4647" rel="#L4647">4647</span>
<span id="L4648" rel="#L4648">4648</span>
<span id="L4649" rel="#L4649">4649</span>
<span id="L4650" rel="#L4650">4650</span>
<span id="L4651" rel="#L4651">4651</span>
<span id="L4652" rel="#L4652">4652</span>
<span id="L4653" rel="#L4653">4653</span>
<span id="L4654" rel="#L4654">4654</span>
<span id="L4655" rel="#L4655">4655</span>
<span id="L4656" rel="#L4656">4656</span>
<span id="L4657" rel="#L4657">4657</span>
<span id="L4658" rel="#L4658">4658</span>
<span id="L4659" rel="#L4659">4659</span>
<span id="L4660" rel="#L4660">4660</span>
<span id="L4661" rel="#L4661">4661</span>
<span id="L4662" rel="#L4662">4662</span>
<span id="L4663" rel="#L4663">4663</span>
<span id="L4664" rel="#L4664">4664</span>
<span id="L4665" rel="#L4665">4665</span>
<span id="L4666" rel="#L4666">4666</span>
<span id="L4667" rel="#L4667">4667</span>
<span id="L4668" rel="#L4668">4668</span>
<span id="L4669" rel="#L4669">4669</span>
<span id="L4670" rel="#L4670">4670</span>
<span id="L4671" rel="#L4671">4671</span>
<span id="L4672" rel="#L4672">4672</span>
<span id="L4673" rel="#L4673">4673</span>
<span id="L4674" rel="#L4674">4674</span>
<span id="L4675" rel="#L4675">4675</span>
<span id="L4676" rel="#L4676">4676</span>
<span id="L4677" rel="#L4677">4677</span>
<span id="L4678" rel="#L4678">4678</span>
<span id="L4679" rel="#L4679">4679</span>
<span id="L4680" rel="#L4680">4680</span>
<span id="L4681" rel="#L4681">4681</span>
<span id="L4682" rel="#L4682">4682</span>
<span id="L4683" rel="#L4683">4683</span>
<span id="L4684" rel="#L4684">4684</span>
<span id="L4685" rel="#L4685">4685</span>
<span id="L4686" rel="#L4686">4686</span>
<span id="L4687" rel="#L4687">4687</span>
<span id="L4688" rel="#L4688">4688</span>
<span id="L4689" rel="#L4689">4689</span>
<span id="L4690" rel="#L4690">4690</span>
<span id="L4691" rel="#L4691">4691</span>
<span id="L4692" rel="#L4692">4692</span>
<span id="L4693" rel="#L4693">4693</span>
<span id="L4694" rel="#L4694">4694</span>
<span id="L4695" rel="#L4695">4695</span>
<span id="L4696" rel="#L4696">4696</span>
<span id="L4697" rel="#L4697">4697</span>
<span id="L4698" rel="#L4698">4698</span>
<span id="L4699" rel="#L4699">4699</span>
<span id="L4700" rel="#L4700">4700</span>
<span id="L4701" rel="#L4701">4701</span>
<span id="L4702" rel="#L4702">4702</span>
<span id="L4703" rel="#L4703">4703</span>
<span id="L4704" rel="#L4704">4704</span>
<span id="L4705" rel="#L4705">4705</span>
<span id="L4706" rel="#L4706">4706</span>
<span id="L4707" rel="#L4707">4707</span>
<span id="L4708" rel="#L4708">4708</span>
<span id="L4709" rel="#L4709">4709</span>
<span id="L4710" rel="#L4710">4710</span>
<span id="L4711" rel="#L4711">4711</span>
<span id="L4712" rel="#L4712">4712</span>
<span id="L4713" rel="#L4713">4713</span>
<span id="L4714" rel="#L4714">4714</span>
<span id="L4715" rel="#L4715">4715</span>
<span id="L4716" rel="#L4716">4716</span>
<span id="L4717" rel="#L4717">4717</span>
<span id="L4718" rel="#L4718">4718</span>
<span id="L4719" rel="#L4719">4719</span>
<span id="L4720" rel="#L4720">4720</span>
<span id="L4721" rel="#L4721">4721</span>
<span id="L4722" rel="#L4722">4722</span>
<span id="L4723" rel="#L4723">4723</span>
<span id="L4724" rel="#L4724">4724</span>
<span id="L4725" rel="#L4725">4725</span>
<span id="L4726" rel="#L4726">4726</span>
<span id="L4727" rel="#L4727">4727</span>
<span id="L4728" rel="#L4728">4728</span>
<span id="L4729" rel="#L4729">4729</span>
<span id="L4730" rel="#L4730">4730</span>
<span id="L4731" rel="#L4731">4731</span>
<span id="L4732" rel="#L4732">4732</span>
<span id="L4733" rel="#L4733">4733</span>
<span id="L4734" rel="#L4734">4734</span>
<span id="L4735" rel="#L4735">4735</span>
<span id="L4736" rel="#L4736">4736</span>
<span id="L4737" rel="#L4737">4737</span>
<span id="L4738" rel="#L4738">4738</span>
<span id="L4739" rel="#L4739">4739</span>
<span id="L4740" rel="#L4740">4740</span>
<span id="L4741" rel="#L4741">4741</span>
<span id="L4742" rel="#L4742">4742</span>
<span id="L4743" rel="#L4743">4743</span>
<span id="L4744" rel="#L4744">4744</span>
<span id="L4745" rel="#L4745">4745</span>
<span id="L4746" rel="#L4746">4746</span>
<span id="L4747" rel="#L4747">4747</span>
<span id="L4748" rel="#L4748">4748</span>
<span id="L4749" rel="#L4749">4749</span>
<span id="L4750" rel="#L4750">4750</span>
<span id="L4751" rel="#L4751">4751</span>
<span id="L4752" rel="#L4752">4752</span>
<span id="L4753" rel="#L4753">4753</span>
<span id="L4754" rel="#L4754">4754</span>
<span id="L4755" rel="#L4755">4755</span>
<span id="L4756" rel="#L4756">4756</span>
<span id="L4757" rel="#L4757">4757</span>
<span id="L4758" rel="#L4758">4758</span>
<span id="L4759" rel="#L4759">4759</span>
<span id="L4760" rel="#L4760">4760</span>
<span id="L4761" rel="#L4761">4761</span>
<span id="L4762" rel="#L4762">4762</span>
<span id="L4763" rel="#L4763">4763</span>
<span id="L4764" rel="#L4764">4764</span>
<span id="L4765" rel="#L4765">4765</span>
<span id="L4766" rel="#L4766">4766</span>
<span id="L4767" rel="#L4767">4767</span>
<span id="L4768" rel="#L4768">4768</span>
<span id="L4769" rel="#L4769">4769</span>
<span id="L4770" rel="#L4770">4770</span>
<span id="L4771" rel="#L4771">4771</span>
<span id="L4772" rel="#L4772">4772</span>
<span id="L4773" rel="#L4773">4773</span>
<span id="L4774" rel="#L4774">4774</span>
<span id="L4775" rel="#L4775">4775</span>
<span id="L4776" rel="#L4776">4776</span>
<span id="L4777" rel="#L4777">4777</span>
<span id="L4778" rel="#L4778">4778</span>
<span id="L4779" rel="#L4779">4779</span>
<span id="L4780" rel="#L4780">4780</span>
<span id="L4781" rel="#L4781">4781</span>
<span id="L4782" rel="#L4782">4782</span>
<span id="L4783" rel="#L4783">4783</span>
<span id="L4784" rel="#L4784">4784</span>
<span id="L4785" rel="#L4785">4785</span>
<span id="L4786" rel="#L4786">4786</span>
<span id="L4787" rel="#L4787">4787</span>
<span id="L4788" rel="#L4788">4788</span>
<span id="L4789" rel="#L4789">4789</span>
<span id="L4790" rel="#L4790">4790</span>
<span id="L4791" rel="#L4791">4791</span>
<span id="L4792" rel="#L4792">4792</span>
<span id="L4793" rel="#L4793">4793</span>
<span id="L4794" rel="#L4794">4794</span>
<span id="L4795" rel="#L4795">4795</span>
<span id="L4796" rel="#L4796">4796</span>
<span id="L4797" rel="#L4797">4797</span>
<span id="L4798" rel="#L4798">4798</span>
<span id="L4799" rel="#L4799">4799</span>
<span id="L4800" rel="#L4800">4800</span>
<span id="L4801" rel="#L4801">4801</span>
<span id="L4802" rel="#L4802">4802</span>
<span id="L4803" rel="#L4803">4803</span>
<span id="L4804" rel="#L4804">4804</span>
<span id="L4805" rel="#L4805">4805</span>
<span id="L4806" rel="#L4806">4806</span>
<span id="L4807" rel="#L4807">4807</span>
<span id="L4808" rel="#L4808">4808</span>
<span id="L4809" rel="#L4809">4809</span>
<span id="L4810" rel="#L4810">4810</span>
<span id="L4811" rel="#L4811">4811</span>
<span id="L4812" rel="#L4812">4812</span>
<span id="L4813" rel="#L4813">4813</span>
<span id="L4814" rel="#L4814">4814</span>
<span id="L4815" rel="#L4815">4815</span>
<span id="L4816" rel="#L4816">4816</span>
<span id="L4817" rel="#L4817">4817</span>
<span id="L4818" rel="#L4818">4818</span>
<span id="L4819" rel="#L4819">4819</span>
<span id="L4820" rel="#L4820">4820</span>
<span id="L4821" rel="#L4821">4821</span>
<span id="L4822" rel="#L4822">4822</span>
<span id="L4823" rel="#L4823">4823</span>
<span id="L4824" rel="#L4824">4824</span>
<span id="L4825" rel="#L4825">4825</span>
<span id="L4826" rel="#L4826">4826</span>
<span id="L4827" rel="#L4827">4827</span>
<span id="L4828" rel="#L4828">4828</span>
<span id="L4829" rel="#L4829">4829</span>
<span id="L4830" rel="#L4830">4830</span>
<span id="L4831" rel="#L4831">4831</span>
<span id="L4832" rel="#L4832">4832</span>
<span id="L4833" rel="#L4833">4833</span>
<span id="L4834" rel="#L4834">4834</span>
<span id="L4835" rel="#L4835">4835</span>
<span id="L4836" rel="#L4836">4836</span>
<span id="L4837" rel="#L4837">4837</span>
<span id="L4838" rel="#L4838">4838</span>
<span id="L4839" rel="#L4839">4839</span>
<span id="L4840" rel="#L4840">4840</span>
<span id="L4841" rel="#L4841">4841</span>
<span id="L4842" rel="#L4842">4842</span>
<span id="L4843" rel="#L4843">4843</span>
<span id="L4844" rel="#L4844">4844</span>
<span id="L4845" rel="#L4845">4845</span>
<span id="L4846" rel="#L4846">4846</span>
<span id="L4847" rel="#L4847">4847</span>
<span id="L4848" rel="#L4848">4848</span>
<span id="L4849" rel="#L4849">4849</span>
<span id="L4850" rel="#L4850">4850</span>
<span id="L4851" rel="#L4851">4851</span>
<span id="L4852" rel="#L4852">4852</span>
<span id="L4853" rel="#L4853">4853</span>
<span id="L4854" rel="#L4854">4854</span>
<span id="L4855" rel="#L4855">4855</span>
<span id="L4856" rel="#L4856">4856</span>
<span id="L4857" rel="#L4857">4857</span>
<span id="L4858" rel="#L4858">4858</span>
<span id="L4859" rel="#L4859">4859</span>
<span id="L4860" rel="#L4860">4860</span>
<span id="L4861" rel="#L4861">4861</span>
<span id="L4862" rel="#L4862">4862</span>
<span id="L4863" rel="#L4863">4863</span>
<span id="L4864" rel="#L4864">4864</span>
<span id="L4865" rel="#L4865">4865</span>
<span id="L4866" rel="#L4866">4866</span>
<span id="L4867" rel="#L4867">4867</span>
<span id="L4868" rel="#L4868">4868</span>
<span id="L4869" rel="#L4869">4869</span>
<span id="L4870" rel="#L4870">4870</span>
<span id="L4871" rel="#L4871">4871</span>
<span id="L4872" rel="#L4872">4872</span>
<span id="L4873" rel="#L4873">4873</span>
<span id="L4874" rel="#L4874">4874</span>
<span id="L4875" rel="#L4875">4875</span>
<span id="L4876" rel="#L4876">4876</span>
<span id="L4877" rel="#L4877">4877</span>
<span id="L4878" rel="#L4878">4878</span>
<span id="L4879" rel="#L4879">4879</span>
<span id="L4880" rel="#L4880">4880</span>
<span id="L4881" rel="#L4881">4881</span>
<span id="L4882" rel="#L4882">4882</span>
<span id="L4883" rel="#L4883">4883</span>
<span id="L4884" rel="#L4884">4884</span>
<span id="L4885" rel="#L4885">4885</span>
<span id="L4886" rel="#L4886">4886</span>
<span id="L4887" rel="#L4887">4887</span>
<span id="L4888" rel="#L4888">4888</span>
<span id="L4889" rel="#L4889">4889</span>
<span id="L4890" rel="#L4890">4890</span>
<span id="L4891" rel="#L4891">4891</span>
<span id="L4892" rel="#L4892">4892</span>
<span id="L4893" rel="#L4893">4893</span>
<span id="L4894" rel="#L4894">4894</span>
<span id="L4895" rel="#L4895">4895</span>
<span id="L4896" rel="#L4896">4896</span>
<span id="L4897" rel="#L4897">4897</span>
<span id="L4898" rel="#L4898">4898</span>
<span id="L4899" rel="#L4899">4899</span>
<span id="L4900" rel="#L4900">4900</span>
<span id="L4901" rel="#L4901">4901</span>
<span id="L4902" rel="#L4902">4902</span>
<span id="L4903" rel="#L4903">4903</span>
<span id="L4904" rel="#L4904">4904</span>
<span id="L4905" rel="#L4905">4905</span>
<span id="L4906" rel="#L4906">4906</span>
<span id="L4907" rel="#L4907">4907</span>
<span id="L4908" rel="#L4908">4908</span>
<span id="L4909" rel="#L4909">4909</span>
<span id="L4910" rel="#L4910">4910</span>
<span id="L4911" rel="#L4911">4911</span>
<span id="L4912" rel="#L4912">4912</span>
<span id="L4913" rel="#L4913">4913</span>
<span id="L4914" rel="#L4914">4914</span>
<span id="L4915" rel="#L4915">4915</span>
<span id="L4916" rel="#L4916">4916</span>
<span id="L4917" rel="#L4917">4917</span>
<span id="L4918" rel="#L4918">4918</span>
<span id="L4919" rel="#L4919">4919</span>
<span id="L4920" rel="#L4920">4920</span>
<span id="L4921" rel="#L4921">4921</span>
<span id="L4922" rel="#L4922">4922</span>
<span id="L4923" rel="#L4923">4923</span>
<span id="L4924" rel="#L4924">4924</span>
<span id="L4925" rel="#L4925">4925</span>
<span id="L4926" rel="#L4926">4926</span>
<span id="L4927" rel="#L4927">4927</span>
<span id="L4928" rel="#L4928">4928</span>
<span id="L4929" rel="#L4929">4929</span>
<span id="L4930" rel="#L4930">4930</span>
<span id="L4931" rel="#L4931">4931</span>
<span id="L4932" rel="#L4932">4932</span>
<span id="L4933" rel="#L4933">4933</span>
<span id="L4934" rel="#L4934">4934</span>
<span id="L4935" rel="#L4935">4935</span>
<span id="L4936" rel="#L4936">4936</span>
<span id="L4937" rel="#L4937">4937</span>
<span id="L4938" rel="#L4938">4938</span>
<span id="L4939" rel="#L4939">4939</span>
<span id="L4940" rel="#L4940">4940</span>
<span id="L4941" rel="#L4941">4941</span>
<span id="L4942" rel="#L4942">4942</span>
<span id="L4943" rel="#L4943">4943</span>
<span id="L4944" rel="#L4944">4944</span>
<span id="L4945" rel="#L4945">4945</span>
<span id="L4946" rel="#L4946">4946</span>
<span id="L4947" rel="#L4947">4947</span>
<span id="L4948" rel="#L4948">4948</span>
<span id="L4949" rel="#L4949">4949</span>
<span id="L4950" rel="#L4950">4950</span>
<span id="L4951" rel="#L4951">4951</span>
<span id="L4952" rel="#L4952">4952</span>
<span id="L4953" rel="#L4953">4953</span>
<span id="L4954" rel="#L4954">4954</span>
<span id="L4955" rel="#L4955">4955</span>
<span id="L4956" rel="#L4956">4956</span>
<span id="L4957" rel="#L4957">4957</span>
<span id="L4958" rel="#L4958">4958</span>
<span id="L4959" rel="#L4959">4959</span>
<span id="L4960" rel="#L4960">4960</span>
<span id="L4961" rel="#L4961">4961</span>
<span id="L4962" rel="#L4962">4962</span>
<span id="L4963" rel="#L4963">4963</span>
<span id="L4964" rel="#L4964">4964</span>
<span id="L4965" rel="#L4965">4965</span>
<span id="L4966" rel="#L4966">4966</span>
<span id="L4967" rel="#L4967">4967</span>
<span id="L4968" rel="#L4968">4968</span>
<span id="L4969" rel="#L4969">4969</span>
<span id="L4970" rel="#L4970">4970</span>
<span id="L4971" rel="#L4971">4971</span>
<span id="L4972" rel="#L4972">4972</span>
<span id="L4973" rel="#L4973">4973</span>
<span id="L4974" rel="#L4974">4974</span>
<span id="L4975" rel="#L4975">4975</span>
<span id="L4976" rel="#L4976">4976</span>
<span id="L4977" rel="#L4977">4977</span>
<span id="L4978" rel="#L4978">4978</span>
<span id="L4979" rel="#L4979">4979</span>
<span id="L4980" rel="#L4980">4980</span>
<span id="L4981" rel="#L4981">4981</span>
<span id="L4982" rel="#L4982">4982</span>
<span id="L4983" rel="#L4983">4983</span>
<span id="L4984" rel="#L4984">4984</span>
<span id="L4985" rel="#L4985">4985</span>
<span id="L4986" rel="#L4986">4986</span>
<span id="L4987" rel="#L4987">4987</span>
<span id="L4988" rel="#L4988">4988</span>
<span id="L4989" rel="#L4989">4989</span>
<span id="L4990" rel="#L4990">4990</span>
<span id="L4991" rel="#L4991">4991</span>
<span id="L4992" rel="#L4992">4992</span>
<span id="L4993" rel="#L4993">4993</span>
<span id="L4994" rel="#L4994">4994</span>
<span id="L4995" rel="#L4995">4995</span>
<span id="L4996" rel="#L4996">4996</span>
<span id="L4997" rel="#L4997">4997</span>
<span id="L4998" rel="#L4998">4998</span>
<span id="L4999" rel="#L4999">4999</span>
<span id="L5000" rel="#L5000">5000</span>
<span id="L5001" rel="#L5001">5001</span>
<span id="L5002" rel="#L5002">5002</span>
<span id="L5003" rel="#L5003">5003</span>
<span id="L5004" rel="#L5004">5004</span>
<span id="L5005" rel="#L5005">5005</span>
<span id="L5006" rel="#L5006">5006</span>
<span id="L5007" rel="#L5007">5007</span>
<span id="L5008" rel="#L5008">5008</span>
<span id="L5009" rel="#L5009">5009</span>
<span id="L5010" rel="#L5010">5010</span>
<span id="L5011" rel="#L5011">5011</span>
<span id="L5012" rel="#L5012">5012</span>
<span id="L5013" rel="#L5013">5013</span>
<span id="L5014" rel="#L5014">5014</span>
<span id="L5015" rel="#L5015">5015</span>
<span id="L5016" rel="#L5016">5016</span>
<span id="L5017" rel="#L5017">5017</span>
<span id="L5018" rel="#L5018">5018</span>
<span id="L5019" rel="#L5019">5019</span>
<span id="L5020" rel="#L5020">5020</span>
<span id="L5021" rel="#L5021">5021</span>
<span id="L5022" rel="#L5022">5022</span>
<span id="L5023" rel="#L5023">5023</span>
<span id="L5024" rel="#L5024">5024</span>
<span id="L5025" rel="#L5025">5025</span>
<span id="L5026" rel="#L5026">5026</span>
<span id="L5027" rel="#L5027">5027</span>
<span id="L5028" rel="#L5028">5028</span>
<span id="L5029" rel="#L5029">5029</span>
<span id="L5030" rel="#L5030">5030</span>
<span id="L5031" rel="#L5031">5031</span>
<span id="L5032" rel="#L5032">5032</span>
<span id="L5033" rel="#L5033">5033</span>
<span id="L5034" rel="#L5034">5034</span>
<span id="L5035" rel="#L5035">5035</span>
<span id="L5036" rel="#L5036">5036</span>
<span id="L5037" rel="#L5037">5037</span>
<span id="L5038" rel="#L5038">5038</span>
<span id="L5039" rel="#L5039">5039</span>
<span id="L5040" rel="#L5040">5040</span>
<span id="L5041" rel="#L5041">5041</span>
<span id="L5042" rel="#L5042">5042</span>
<span id="L5043" rel="#L5043">5043</span>
<span id="L5044" rel="#L5044">5044</span>
<span id="L5045" rel="#L5045">5045</span>
<span id="L5046" rel="#L5046">5046</span>
<span id="L5047" rel="#L5047">5047</span>
<span id="L5048" rel="#L5048">5048</span>
<span id="L5049" rel="#L5049">5049</span>
<span id="L5050" rel="#L5050">5050</span>
<span id="L5051" rel="#L5051">5051</span>
<span id="L5052" rel="#L5052">5052</span>
<span id="L5053" rel="#L5053">5053</span>
<span id="L5054" rel="#L5054">5054</span>
<span id="L5055" rel="#L5055">5055</span>
<span id="L5056" rel="#L5056">5056</span>
<span id="L5057" rel="#L5057">5057</span>
<span id="L5058" rel="#L5058">5058</span>
<span id="L5059" rel="#L5059">5059</span>
<span id="L5060" rel="#L5060">5060</span>
<span id="L5061" rel="#L5061">5061</span>
<span id="L5062" rel="#L5062">5062</span>
<span id="L5063" rel="#L5063">5063</span>
<span id="L5064" rel="#L5064">5064</span>
<span id="L5065" rel="#L5065">5065</span>
<span id="L5066" rel="#L5066">5066</span>
<span id="L5067" rel="#L5067">5067</span>
<span id="L5068" rel="#L5068">5068</span>
<span id="L5069" rel="#L5069">5069</span>
<span id="L5070" rel="#L5070">5070</span>
<span id="L5071" rel="#L5071">5071</span>
<span id="L5072" rel="#L5072">5072</span>
<span id="L5073" rel="#L5073">5073</span>
<span id="L5074" rel="#L5074">5074</span>
<span id="L5075" rel="#L5075">5075</span>
<span id="L5076" rel="#L5076">5076</span>
<span id="L5077" rel="#L5077">5077</span>
<span id="L5078" rel="#L5078">5078</span>
<span id="L5079" rel="#L5079">5079</span>
<span id="L5080" rel="#L5080">5080</span>
<span id="L5081" rel="#L5081">5081</span>
<span id="L5082" rel="#L5082">5082</span>
<span id="L5083" rel="#L5083">5083</span>
<span id="L5084" rel="#L5084">5084</span>
<span id="L5085" rel="#L5085">5085</span>
<span id="L5086" rel="#L5086">5086</span>
<span id="L5087" rel="#L5087">5087</span>
<span id="L5088" rel="#L5088">5088</span>
<span id="L5089" rel="#L5089">5089</span>
<span id="L5090" rel="#L5090">5090</span>
<span id="L5091" rel="#L5091">5091</span>
<span id="L5092" rel="#L5092">5092</span>
<span id="L5093" rel="#L5093">5093</span>
<span id="L5094" rel="#L5094">5094</span>
<span id="L5095" rel="#L5095">5095</span>
<span id="L5096" rel="#L5096">5096</span>
<span id="L5097" rel="#L5097">5097</span>
<span id="L5098" rel="#L5098">5098</span>
<span id="L5099" rel="#L5099">5099</span>
<span id="L5100" rel="#L5100">5100</span>
<span id="L5101" rel="#L5101">5101</span>
<span id="L5102" rel="#L5102">5102</span>
<span id="L5103" rel="#L5103">5103</span>
<span id="L5104" rel="#L5104">5104</span>
<span id="L5105" rel="#L5105">5105</span>
<span id="L5106" rel="#L5106">5106</span>
<span id="L5107" rel="#L5107">5107</span>
<span id="L5108" rel="#L5108">5108</span>
<span id="L5109" rel="#L5109">5109</span>
<span id="L5110" rel="#L5110">5110</span>
<span id="L5111" rel="#L5111">5111</span>
<span id="L5112" rel="#L5112">5112</span>
<span id="L5113" rel="#L5113">5113</span>
<span id="L5114" rel="#L5114">5114</span>
<span id="L5115" rel="#L5115">5115</span>
<span id="L5116" rel="#L5116">5116</span>
<span id="L5117" rel="#L5117">5117</span>
<span id="L5118" rel="#L5118">5118</span>
<span id="L5119" rel="#L5119">5119</span>
<span id="L5120" rel="#L5120">5120</span>
<span id="L5121" rel="#L5121">5121</span>
<span id="L5122" rel="#L5122">5122</span>
<span id="L5123" rel="#L5123">5123</span>
<span id="L5124" rel="#L5124">5124</span>
<span id="L5125" rel="#L5125">5125</span>
<span id="L5126" rel="#L5126">5126</span>
<span id="L5127" rel="#L5127">5127</span>
<span id="L5128" rel="#L5128">5128</span>
<span id="L5129" rel="#L5129">5129</span>
<span id="L5130" rel="#L5130">5130</span>
<span id="L5131" rel="#L5131">5131</span>
<span id="L5132" rel="#L5132">5132</span>
<span id="L5133" rel="#L5133">5133</span>
<span id="L5134" rel="#L5134">5134</span>
<span id="L5135" rel="#L5135">5135</span>
<span id="L5136" rel="#L5136">5136</span>
<span id="L5137" rel="#L5137">5137</span>
<span id="L5138" rel="#L5138">5138</span>
<span id="L5139" rel="#L5139">5139</span>
<span id="L5140" rel="#L5140">5140</span>
<span id="L5141" rel="#L5141">5141</span>
<span id="L5142" rel="#L5142">5142</span>
<span id="L5143" rel="#L5143">5143</span>
<span id="L5144" rel="#L5144">5144</span>
<span id="L5145" rel="#L5145">5145</span>
<span id="L5146" rel="#L5146">5146</span>
<span id="L5147" rel="#L5147">5147</span>
<span id="L5148" rel="#L5148">5148</span>
<span id="L5149" rel="#L5149">5149</span>
<span id="L5150" rel="#L5150">5150</span>
<span id="L5151" rel="#L5151">5151</span>
<span id="L5152" rel="#L5152">5152</span>
<span id="L5153" rel="#L5153">5153</span>
<span id="L5154" rel="#L5154">5154</span>
<span id="L5155" rel="#L5155">5155</span>
<span id="L5156" rel="#L5156">5156</span>
<span id="L5157" rel="#L5157">5157</span>
<span id="L5158" rel="#L5158">5158</span>
<span id="L5159" rel="#L5159">5159</span>
<span id="L5160" rel="#L5160">5160</span>
<span id="L5161" rel="#L5161">5161</span>
<span id="L5162" rel="#L5162">5162</span>
<span id="L5163" rel="#L5163">5163</span>
<span id="L5164" rel="#L5164">5164</span>
<span id="L5165" rel="#L5165">5165</span>
<span id="L5166" rel="#L5166">5166</span>
<span id="L5167" rel="#L5167">5167</span>
<span id="L5168" rel="#L5168">5168</span>
<span id="L5169" rel="#L5169">5169</span>
<span id="L5170" rel="#L5170">5170</span>
<span id="L5171" rel="#L5171">5171</span>
<span id="L5172" rel="#L5172">5172</span>
<span id="L5173" rel="#L5173">5173</span>
<span id="L5174" rel="#L5174">5174</span>
<span id="L5175" rel="#L5175">5175</span>
<span id="L5176" rel="#L5176">5176</span>
<span id="L5177" rel="#L5177">5177</span>
<span id="L5178" rel="#L5178">5178</span>
<span id="L5179" rel="#L5179">5179</span>
<span id="L5180" rel="#L5180">5180</span>
<span id="L5181" rel="#L5181">5181</span>
<span id="L5182" rel="#L5182">5182</span>
<span id="L5183" rel="#L5183">5183</span>
<span id="L5184" rel="#L5184">5184</span>
<span id="L5185" rel="#L5185">5185</span>
<span id="L5186" rel="#L5186">5186</span>
<span id="L5187" rel="#L5187">5187</span>
<span id="L5188" rel="#L5188">5188</span>
<span id="L5189" rel="#L5189">5189</span>
<span id="L5190" rel="#L5190">5190</span>
<span id="L5191" rel="#L5191">5191</span>
<span id="L5192" rel="#L5192">5192</span>
<span id="L5193" rel="#L5193">5193</span>
<span id="L5194" rel="#L5194">5194</span>
<span id="L5195" rel="#L5195">5195</span>
<span id="L5196" rel="#L5196">5196</span>
<span id="L5197" rel="#L5197">5197</span>
<span id="L5198" rel="#L5198">5198</span>
<span id="L5199" rel="#L5199">5199</span>
<span id="L5200" rel="#L5200">5200</span>
<span id="L5201" rel="#L5201">5201</span>
<span id="L5202" rel="#L5202">5202</span>
<span id="L5203" rel="#L5203">5203</span>
<span id="L5204" rel="#L5204">5204</span>
<span id="L5205" rel="#L5205">5205</span>
<span id="L5206" rel="#L5206">5206</span>
<span id="L5207" rel="#L5207">5207</span>
<span id="L5208" rel="#L5208">5208</span>
<span id="L5209" rel="#L5209">5209</span>
<span id="L5210" rel="#L5210">5210</span>
<span id="L5211" rel="#L5211">5211</span>
<span id="L5212" rel="#L5212">5212</span>
<span id="L5213" rel="#L5213">5213</span>
<span id="L5214" rel="#L5214">5214</span>
<span id="L5215" rel="#L5215">5215</span>
<span id="L5216" rel="#L5216">5216</span>
<span id="L5217" rel="#L5217">5217</span>
<span id="L5218" rel="#L5218">5218</span>
<span id="L5219" rel="#L5219">5219</span>
<span id="L5220" rel="#L5220">5220</span>
<span id="L5221" rel="#L5221">5221</span>
<span id="L5222" rel="#L5222">5222</span>
<span id="L5223" rel="#L5223">5223</span>
<span id="L5224" rel="#L5224">5224</span>
<span id="L5225" rel="#L5225">5225</span>
<span id="L5226" rel="#L5226">5226</span>
<span id="L5227" rel="#L5227">5227</span>
<span id="L5228" rel="#L5228">5228</span>
<span id="L5229" rel="#L5229">5229</span>
<span id="L5230" rel="#L5230">5230</span>
<span id="L5231" rel="#L5231">5231</span>
<span id="L5232" rel="#L5232">5232</span>
<span id="L5233" rel="#L5233">5233</span>
<span id="L5234" rel="#L5234">5234</span>
<span id="L5235" rel="#L5235">5235</span>
<span id="L5236" rel="#L5236">5236</span>
<span id="L5237" rel="#L5237">5237</span>
<span id="L5238" rel="#L5238">5238</span>
<span id="L5239" rel="#L5239">5239</span>
<span id="L5240" rel="#L5240">5240</span>
<span id="L5241" rel="#L5241">5241</span>
<span id="L5242" rel="#L5242">5242</span>
<span id="L5243" rel="#L5243">5243</span>
<span id="L5244" rel="#L5244">5244</span>
<span id="L5245" rel="#L5245">5245</span>
<span id="L5246" rel="#L5246">5246</span>
<span id="L5247" rel="#L5247">5247</span>
<span id="L5248" rel="#L5248">5248</span>
<span id="L5249" rel="#L5249">5249</span>
<span id="L5250" rel="#L5250">5250</span>
<span id="L5251" rel="#L5251">5251</span>
<span id="L5252" rel="#L5252">5252</span>
<span id="L5253" rel="#L5253">5253</span>
<span id="L5254" rel="#L5254">5254</span>
<span id="L5255" rel="#L5255">5255</span>
<span id="L5256" rel="#L5256">5256</span>
<span id="L5257" rel="#L5257">5257</span>
<span id="L5258" rel="#L5258">5258</span>
<span id="L5259" rel="#L5259">5259</span>
<span id="L5260" rel="#L5260">5260</span>
<span id="L5261" rel="#L5261">5261</span>
<span id="L5262" rel="#L5262">5262</span>
<span id="L5263" rel="#L5263">5263</span>
<span id="L5264" rel="#L5264">5264</span>
<span id="L5265" rel="#L5265">5265</span>
<span id="L5266" rel="#L5266">5266</span>
<span id="L5267" rel="#L5267">5267</span>
<span id="L5268" rel="#L5268">5268</span>
<span id="L5269" rel="#L5269">5269</span>
<span id="L5270" rel="#L5270">5270</span>
<span id="L5271" rel="#L5271">5271</span>
<span id="L5272" rel="#L5272">5272</span>
<span id="L5273" rel="#L5273">5273</span>
<span id="L5274" rel="#L5274">5274</span>
<span id="L5275" rel="#L5275">5275</span>
<span id="L5276" rel="#L5276">5276</span>
<span id="L5277" rel="#L5277">5277</span>
<span id="L5278" rel="#L5278">5278</span>
<span id="L5279" rel="#L5279">5279</span>
<span id="L5280" rel="#L5280">5280</span>
<span id="L5281" rel="#L5281">5281</span>
<span id="L5282" rel="#L5282">5282</span>
<span id="L5283" rel="#L5283">5283</span>
<span id="L5284" rel="#L5284">5284</span>
<span id="L5285" rel="#L5285">5285</span>
<span id="L5286" rel="#L5286">5286</span>
<span id="L5287" rel="#L5287">5287</span>
<span id="L5288" rel="#L5288">5288</span>
<span id="L5289" rel="#L5289">5289</span>
<span id="L5290" rel="#L5290">5290</span>
<span id="L5291" rel="#L5291">5291</span>
<span id="L5292" rel="#L5292">5292</span>
<span id="L5293" rel="#L5293">5293</span>
<span id="L5294" rel="#L5294">5294</span>
<span id="L5295" rel="#L5295">5295</span>
<span id="L5296" rel="#L5296">5296</span>
<span id="L5297" rel="#L5297">5297</span>
<span id="L5298" rel="#L5298">5298</span>
<span id="L5299" rel="#L5299">5299</span>
<span id="L5300" rel="#L5300">5300</span>
<span id="L5301" rel="#L5301">5301</span>
<span id="L5302" rel="#L5302">5302</span>
<span id="L5303" rel="#L5303">5303</span>
<span id="L5304" rel="#L5304">5304</span>
<span id="L5305" rel="#L5305">5305</span>
<span id="L5306" rel="#L5306">5306</span>
<span id="L5307" rel="#L5307">5307</span>
<span id="L5308" rel="#L5308">5308</span>
<span id="L5309" rel="#L5309">5309</span>
<span id="L5310" rel="#L5310">5310</span>
<span id="L5311" rel="#L5311">5311</span>
<span id="L5312" rel="#L5312">5312</span>
<span id="L5313" rel="#L5313">5313</span>
<span id="L5314" rel="#L5314">5314</span>
<span id="L5315" rel="#L5315">5315</span>
<span id="L5316" rel="#L5316">5316</span>
<span id="L5317" rel="#L5317">5317</span>
<span id="L5318" rel="#L5318">5318</span>
<span id="L5319" rel="#L5319">5319</span>
<span id="L5320" rel="#L5320">5320</span>
<span id="L5321" rel="#L5321">5321</span>
<span id="L5322" rel="#L5322">5322</span>
<span id="L5323" rel="#L5323">5323</span>
<span id="L5324" rel="#L5324">5324</span>
<span id="L5325" rel="#L5325">5325</span>
<span id="L5326" rel="#L5326">5326</span>
<span id="L5327" rel="#L5327">5327</span>
<span id="L5328" rel="#L5328">5328</span>
<span id="L5329" rel="#L5329">5329</span>
<span id="L5330" rel="#L5330">5330</span>
<span id="L5331" rel="#L5331">5331</span>
<span id="L5332" rel="#L5332">5332</span>
<span id="L5333" rel="#L5333">5333</span>
<span id="L5334" rel="#L5334">5334</span>
<span id="L5335" rel="#L5335">5335</span>
<span id="L5336" rel="#L5336">5336</span>
<span id="L5337" rel="#L5337">5337</span>
<span id="L5338" rel="#L5338">5338</span>
<span id="L5339" rel="#L5339">5339</span>
<span id="L5340" rel="#L5340">5340</span>
<span id="L5341" rel="#L5341">5341</span>
<span id="L5342" rel="#L5342">5342</span>
<span id="L5343" rel="#L5343">5343</span>
<span id="L5344" rel="#L5344">5344</span>
<span id="L5345" rel="#L5345">5345</span>
<span id="L5346" rel="#L5346">5346</span>
<span id="L5347" rel="#L5347">5347</span>
<span id="L5348" rel="#L5348">5348</span>
<span id="L5349" rel="#L5349">5349</span>
<span id="L5350" rel="#L5350">5350</span>
<span id="L5351" rel="#L5351">5351</span>
<span id="L5352" rel="#L5352">5352</span>
<span id="L5353" rel="#L5353">5353</span>
<span id="L5354" rel="#L5354">5354</span>
<span id="L5355" rel="#L5355">5355</span>
<span id="L5356" rel="#L5356">5356</span>
<span id="L5357" rel="#L5357">5357</span>
<span id="L5358" rel="#L5358">5358</span>
<span id="L5359" rel="#L5359">5359</span>
<span id="L5360" rel="#L5360">5360</span>
<span id="L5361" rel="#L5361">5361</span>
<span id="L5362" rel="#L5362">5362</span>
<span id="L5363" rel="#L5363">5363</span>
<span id="L5364" rel="#L5364">5364</span>
<span id="L5365" rel="#L5365">5365</span>
<span id="L5366" rel="#L5366">5366</span>
<span id="L5367" rel="#L5367">5367</span>
<span id="L5368" rel="#L5368">5368</span>
<span id="L5369" rel="#L5369">5369</span>
<span id="L5370" rel="#L5370">5370</span>
<span id="L5371" rel="#L5371">5371</span>
<span id="L5372" rel="#L5372">5372</span>
<span id="L5373" rel="#L5373">5373</span>
<span id="L5374" rel="#L5374">5374</span>
<span id="L5375" rel="#L5375">5375</span>
<span id="L5376" rel="#L5376">5376</span>
<span id="L5377" rel="#L5377">5377</span>
<span id="L5378" rel="#L5378">5378</span>
<span id="L5379" rel="#L5379">5379</span>
<span id="L5380" rel="#L5380">5380</span>
<span id="L5381" rel="#L5381">5381</span>
<span id="L5382" rel="#L5382">5382</span>
<span id="L5383" rel="#L5383">5383</span>
<span id="L5384" rel="#L5384">5384</span>
<span id="L5385" rel="#L5385">5385</span>
<span id="L5386" rel="#L5386">5386</span>
<span id="L5387" rel="#L5387">5387</span>
<span id="L5388" rel="#L5388">5388</span>
<span id="L5389" rel="#L5389">5389</span>
<span id="L5390" rel="#L5390">5390</span>
<span id="L5391" rel="#L5391">5391</span>
<span id="L5392" rel="#L5392">5392</span>
<span id="L5393" rel="#L5393">5393</span>
<span id="L5394" rel="#L5394">5394</span>
<span id="L5395" rel="#L5395">5395</span>
<span id="L5396" rel="#L5396">5396</span>
<span id="L5397" rel="#L5397">5397</span>
<span id="L5398" rel="#L5398">5398</span>
<span id="L5399" rel="#L5399">5399</span>
<span id="L5400" rel="#L5400">5400</span>
<span id="L5401" rel="#L5401">5401</span>
<span id="L5402" rel="#L5402">5402</span>
<span id="L5403" rel="#L5403">5403</span>
<span id="L5404" rel="#L5404">5404</span>
<span id="L5405" rel="#L5405">5405</span>
<span id="L5406" rel="#L5406">5406</span>
<span id="L5407" rel="#L5407">5407</span>
<span id="L5408" rel="#L5408">5408</span>
<span id="L5409" rel="#L5409">5409</span>
<span id="L5410" rel="#L5410">5410</span>
<span id="L5411" rel="#L5411">5411</span>
<span id="L5412" rel="#L5412">5412</span>
<span id="L5413" rel="#L5413">5413</span>
<span id="L5414" rel="#L5414">5414</span>
<span id="L5415" rel="#L5415">5415</span>
<span id="L5416" rel="#L5416">5416</span>
<span id="L5417" rel="#L5417">5417</span>
<span id="L5418" rel="#L5418">5418</span>
<span id="L5419" rel="#L5419">5419</span>
<span id="L5420" rel="#L5420">5420</span>
<span id="L5421" rel="#L5421">5421</span>
<span id="L5422" rel="#L5422">5422</span>
<span id="L5423" rel="#L5423">5423</span>
<span id="L5424" rel="#L5424">5424</span>
<span id="L5425" rel="#L5425">5425</span>
<span id="L5426" rel="#L5426">5426</span>
<span id="L5427" rel="#L5427">5427</span>
<span id="L5428" rel="#L5428">5428</span>
<span id="L5429" rel="#L5429">5429</span>
<span id="L5430" rel="#L5430">5430</span>
<span id="L5431" rel="#L5431">5431</span>
<span id="L5432" rel="#L5432">5432</span>
<span id="L5433" rel="#L5433">5433</span>
<span id="L5434" rel="#L5434">5434</span>
<span id="L5435" rel="#L5435">5435</span>
<span id="L5436" rel="#L5436">5436</span>
<span id="L5437" rel="#L5437">5437</span>
<span id="L5438" rel="#L5438">5438</span>
<span id="L5439" rel="#L5439">5439</span>
<span id="L5440" rel="#L5440">5440</span>
<span id="L5441" rel="#L5441">5441</span>
<span id="L5442" rel="#L5442">5442</span>
<span id="L5443" rel="#L5443">5443</span>
<span id="L5444" rel="#L5444">5444</span>
<span id="L5445" rel="#L5445">5445</span>
<span id="L5446" rel="#L5446">5446</span>
<span id="L5447" rel="#L5447">5447</span>
<span id="L5448" rel="#L5448">5448</span>
<span id="L5449" rel="#L5449">5449</span>
<span id="L5450" rel="#L5450">5450</span>
<span id="L5451" rel="#L5451">5451</span>
<span id="L5452" rel="#L5452">5452</span>
<span id="L5453" rel="#L5453">5453</span>
<span id="L5454" rel="#L5454">5454</span>
<span id="L5455" rel="#L5455">5455</span>
<span id="L5456" rel="#L5456">5456</span>
<span id="L5457" rel="#L5457">5457</span>
<span id="L5458" rel="#L5458">5458</span>
<span id="L5459" rel="#L5459">5459</span>
<span id="L5460" rel="#L5460">5460</span>
<span id="L5461" rel="#L5461">5461</span>
<span id="L5462" rel="#L5462">5462</span>
<span id="L5463" rel="#L5463">5463</span>
<span id="L5464" rel="#L5464">5464</span>
<span id="L5465" rel="#L5465">5465</span>
<span id="L5466" rel="#L5466">5466</span>
<span id="L5467" rel="#L5467">5467</span>
<span id="L5468" rel="#L5468">5468</span>
<span id="L5469" rel="#L5469">5469</span>
<span id="L5470" rel="#L5470">5470</span>
<span id="L5471" rel="#L5471">5471</span>
<span id="L5472" rel="#L5472">5472</span>
<span id="L5473" rel="#L5473">5473</span>
<span id="L5474" rel="#L5474">5474</span>
<span id="L5475" rel="#L5475">5475</span>
<span id="L5476" rel="#L5476">5476</span>
<span id="L5477" rel="#L5477">5477</span>
<span id="L5478" rel="#L5478">5478</span>
<span id="L5479" rel="#L5479">5479</span>
<span id="L5480" rel="#L5480">5480</span>
<span id="L5481" rel="#L5481">5481</span>
<span id="L5482" rel="#L5482">5482</span>
<span id="L5483" rel="#L5483">5483</span>
<span id="L5484" rel="#L5484">5484</span>
<span id="L5485" rel="#L5485">5485</span>
<span id="L5486" rel="#L5486">5486</span>
<span id="L5487" rel="#L5487">5487</span>
<span id="L5488" rel="#L5488">5488</span>
<span id="L5489" rel="#L5489">5489</span>
<span id="L5490" rel="#L5490">5490</span>
<span id="L5491" rel="#L5491">5491</span>
<span id="L5492" rel="#L5492">5492</span>
<span id="L5493" rel="#L5493">5493</span>
<span id="L5494" rel="#L5494">5494</span>
<span id="L5495" rel="#L5495">5495</span>
<span id="L5496" rel="#L5496">5496</span>
<span id="L5497" rel="#L5497">5497</span>
<span id="L5498" rel="#L5498">5498</span>
<span id="L5499" rel="#L5499">5499</span>
<span id="L5500" rel="#L5500">5500</span>
<span id="L5501" rel="#L5501">5501</span>
<span id="L5502" rel="#L5502">5502</span>
<span id="L5503" rel="#L5503">5503</span>
<span id="L5504" rel="#L5504">5504</span>
<span id="L5505" rel="#L5505">5505</span>
<span id="L5506" rel="#L5506">5506</span>
<span id="L5507" rel="#L5507">5507</span>
<span id="L5508" rel="#L5508">5508</span>
<span id="L5509" rel="#L5509">5509</span>
<span id="L5510" rel="#L5510">5510</span>
<span id="L5511" rel="#L5511">5511</span>
<span id="L5512" rel="#L5512">5512</span>
<span id="L5513" rel="#L5513">5513</span>
<span id="L5514" rel="#L5514">5514</span>
<span id="L5515" rel="#L5515">5515</span>
<span id="L5516" rel="#L5516">5516</span>
<span id="L5517" rel="#L5517">5517</span>
<span id="L5518" rel="#L5518">5518</span>
<span id="L5519" rel="#L5519">5519</span>
<span id="L5520" rel="#L5520">5520</span>
<span id="L5521" rel="#L5521">5521</span>
<span id="L5522" rel="#L5522">5522</span>
<span id="L5523" rel="#L5523">5523</span>
<span id="L5524" rel="#L5524">5524</span>
<span id="L5525" rel="#L5525">5525</span>
<span id="L5526" rel="#L5526">5526</span>
<span id="L5527" rel="#L5527">5527</span>
<span id="L5528" rel="#L5528">5528</span>
<span id="L5529" rel="#L5529">5529</span>
<span id="L5530" rel="#L5530">5530</span>
<span id="L5531" rel="#L5531">5531</span>
<span id="L5532" rel="#L5532">5532</span>
<span id="L5533" rel="#L5533">5533</span>
<span id="L5534" rel="#L5534">5534</span>
<span id="L5535" rel="#L5535">5535</span>
<span id="L5536" rel="#L5536">5536</span>
<span id="L5537" rel="#L5537">5537</span>
<span id="L5538" rel="#L5538">5538</span>
<span id="L5539" rel="#L5539">5539</span>
<span id="L5540" rel="#L5540">5540</span>
<span id="L5541" rel="#L5541">5541</span>
<span id="L5542" rel="#L5542">5542</span>
<span id="L5543" rel="#L5543">5543</span>
<span id="L5544" rel="#L5544">5544</span>
<span id="L5545" rel="#L5545">5545</span>
<span id="L5546" rel="#L5546">5546</span>
<span id="L5547" rel="#L5547">5547</span>
<span id="L5548" rel="#L5548">5548</span>
<span id="L5549" rel="#L5549">5549</span>
<span id="L5550" rel="#L5550">5550</span>
<span id="L5551" rel="#L5551">5551</span>
<span id="L5552" rel="#L5552">5552</span>
<span id="L5553" rel="#L5553">5553</span>
<span id="L5554" rel="#L5554">5554</span>
<span id="L5555" rel="#L5555">5555</span>
<span id="L5556" rel="#L5556">5556</span>
<span id="L5557" rel="#L5557">5557</span>
<span id="L5558" rel="#L5558">5558</span>
<span id="L5559" rel="#L5559">5559</span>
<span id="L5560" rel="#L5560">5560</span>
<span id="L5561" rel="#L5561">5561</span>
<span id="L5562" rel="#L5562">5562</span>
<span id="L5563" rel="#L5563">5563</span>
<span id="L5564" rel="#L5564">5564</span>
<span id="L5565" rel="#L5565">5565</span>
<span id="L5566" rel="#L5566">5566</span>
<span id="L5567" rel="#L5567">5567</span>
<span id="L5568" rel="#L5568">5568</span>
<span id="L5569" rel="#L5569">5569</span>
<span id="L5570" rel="#L5570">5570</span>
<span id="L5571" rel="#L5571">5571</span>
<span id="L5572" rel="#L5572">5572</span>
<span id="L5573" rel="#L5573">5573</span>
<span id="L5574" rel="#L5574">5574</span>
<span id="L5575" rel="#L5575">5575</span>
<span id="L5576" rel="#L5576">5576</span>
<span id="L5577" rel="#L5577">5577</span>
<span id="L5578" rel="#L5578">5578</span>
<span id="L5579" rel="#L5579">5579</span>
<span id="L5580" rel="#L5580">5580</span>
<span id="L5581" rel="#L5581">5581</span>
<span id="L5582" rel="#L5582">5582</span>
<span id="L5583" rel="#L5583">5583</span>
<span id="L5584" rel="#L5584">5584</span>
<span id="L5585" rel="#L5585">5585</span>
<span id="L5586" rel="#L5586">5586</span>
<span id="L5587" rel="#L5587">5587</span>
<span id="L5588" rel="#L5588">5588</span>
<span id="L5589" rel="#L5589">5589</span>
<span id="L5590" rel="#L5590">5590</span>
<span id="L5591" rel="#L5591">5591</span>
<span id="L5592" rel="#L5592">5592</span>
<span id="L5593" rel="#L5593">5593</span>
<span id="L5594" rel="#L5594">5594</span>
<span id="L5595" rel="#L5595">5595</span>
<span id="L5596" rel="#L5596">5596</span>
<span id="L5597" rel="#L5597">5597</span>
<span id="L5598" rel="#L5598">5598</span>
<span id="L5599" rel="#L5599">5599</span>
<span id="L5600" rel="#L5600">5600</span>
<span id="L5601" rel="#L5601">5601</span>
<span id="L5602" rel="#L5602">5602</span>
<span id="L5603" rel="#L5603">5603</span>
<span id="L5604" rel="#L5604">5604</span>
<span id="L5605" rel="#L5605">5605</span>
<span id="L5606" rel="#L5606">5606</span>
<span id="L5607" rel="#L5607">5607</span>
<span id="L5608" rel="#L5608">5608</span>
<span id="L5609" rel="#L5609">5609</span>
<span id="L5610" rel="#L5610">5610</span>
<span id="L5611" rel="#L5611">5611</span>
<span id="L5612" rel="#L5612">5612</span>
<span id="L5613" rel="#L5613">5613</span>
<span id="L5614" rel="#L5614">5614</span>
<span id="L5615" rel="#L5615">5615</span>
<span id="L5616" rel="#L5616">5616</span>
<span id="L5617" rel="#L5617">5617</span>
<span id="L5618" rel="#L5618">5618</span>
<span id="L5619" rel="#L5619">5619</span>
<span id="L5620" rel="#L5620">5620</span>
<span id="L5621" rel="#L5621">5621</span>
<span id="L5622" rel="#L5622">5622</span>
<span id="L5623" rel="#L5623">5623</span>
<span id="L5624" rel="#L5624">5624</span>
<span id="L5625" rel="#L5625">5625</span>
<span id="L5626" rel="#L5626">5626</span>
<span id="L5627" rel="#L5627">5627</span>
<span id="L5628" rel="#L5628">5628</span>
<span id="L5629" rel="#L5629">5629</span>
<span id="L5630" rel="#L5630">5630</span>
<span id="L5631" rel="#L5631">5631</span>
<span id="L5632" rel="#L5632">5632</span>
<span id="L5633" rel="#L5633">5633</span>
<span id="L5634" rel="#L5634">5634</span>
<span id="L5635" rel="#L5635">5635</span>
<span id="L5636" rel="#L5636">5636</span>
<span id="L5637" rel="#L5637">5637</span>
<span id="L5638" rel="#L5638">5638</span>
<span id="L5639" rel="#L5639">5639</span>
<span id="L5640" rel="#L5640">5640</span>
<span id="L5641" rel="#L5641">5641</span>
<span id="L5642" rel="#L5642">5642</span>
<span id="L5643" rel="#L5643">5643</span>
<span id="L5644" rel="#L5644">5644</span>
<span id="L5645" rel="#L5645">5645</span>
<span id="L5646" rel="#L5646">5646</span>
<span id="L5647" rel="#L5647">5647</span>
<span id="L5648" rel="#L5648">5648</span>
<span id="L5649" rel="#L5649">5649</span>
<span id="L5650" rel="#L5650">5650</span>
<span id="L5651" rel="#L5651">5651</span>
<span id="L5652" rel="#L5652">5652</span>
<span id="L5653" rel="#L5653">5653</span>
<span id="L5654" rel="#L5654">5654</span>
<span id="L5655" rel="#L5655">5655</span>
<span id="L5656" rel="#L5656">5656</span>
<span id="L5657" rel="#L5657">5657</span>
<span id="L5658" rel="#L5658">5658</span>
<span id="L5659" rel="#L5659">5659</span>
<span id="L5660" rel="#L5660">5660</span>
<span id="L5661" rel="#L5661">5661</span>
<span id="L5662" rel="#L5662">5662</span>
<span id="L5663" rel="#L5663">5663</span>
<span id="L5664" rel="#L5664">5664</span>
<span id="L5665" rel="#L5665">5665</span>
<span id="L5666" rel="#L5666">5666</span>
<span id="L5667" rel="#L5667">5667</span>
<span id="L5668" rel="#L5668">5668</span>
<span id="L5669" rel="#L5669">5669</span>
<span id="L5670" rel="#L5670">5670</span>
<span id="L5671" rel="#L5671">5671</span>
<span id="L5672" rel="#L5672">5672</span>
<span id="L5673" rel="#L5673">5673</span>
<span id="L5674" rel="#L5674">5674</span>
<span id="L5675" rel="#L5675">5675</span>
<span id="L5676" rel="#L5676">5676</span>
<span id="L5677" rel="#L5677">5677</span>
<span id="L5678" rel="#L5678">5678</span>
<span id="L5679" rel="#L5679">5679</span>
<span id="L5680" rel="#L5680">5680</span>
<span id="L5681" rel="#L5681">5681</span>
<span id="L5682" rel="#L5682">5682</span>
<span id="L5683" rel="#L5683">5683</span>
<span id="L5684" rel="#L5684">5684</span>
<span id="L5685" rel="#L5685">5685</span>
<span id="L5686" rel="#L5686">5686</span>
<span id="L5687" rel="#L5687">5687</span>
<span id="L5688" rel="#L5688">5688</span>
<span id="L5689" rel="#L5689">5689</span>
<span id="L5690" rel="#L5690">5690</span>
<span id="L5691" rel="#L5691">5691</span>
<span id="L5692" rel="#L5692">5692</span>
<span id="L5693" rel="#L5693">5693</span>
<span id="L5694" rel="#L5694">5694</span>
<span id="L5695" rel="#L5695">5695</span>
<span id="L5696" rel="#L5696">5696</span>
<span id="L5697" rel="#L5697">5697</span>
<span id="L5698" rel="#L5698">5698</span>
<span id="L5699" rel="#L5699">5699</span>
<span id="L5700" rel="#L5700">5700</span>
<span id="L5701" rel="#L5701">5701</span>
<span id="L5702" rel="#L5702">5702</span>
<span id="L5703" rel="#L5703">5703</span>
<span id="L5704" rel="#L5704">5704</span>
<span id="L5705" rel="#L5705">5705</span>
<span id="L5706" rel="#L5706">5706</span>
<span id="L5707" rel="#L5707">5707</span>
<span id="L5708" rel="#L5708">5708</span>
<span id="L5709" rel="#L5709">5709</span>
<span id="L5710" rel="#L5710">5710</span>
<span id="L5711" rel="#L5711">5711</span>
<span id="L5712" rel="#L5712">5712</span>
<span id="L5713" rel="#L5713">5713</span>
<span id="L5714" rel="#L5714">5714</span>
<span id="L5715" rel="#L5715">5715</span>
<span id="L5716" rel="#L5716">5716</span>
<span id="L5717" rel="#L5717">5717</span>
<span id="L5718" rel="#L5718">5718</span>
<span id="L5719" rel="#L5719">5719</span>
<span id="L5720" rel="#L5720">5720</span>
<span id="L5721" rel="#L5721">5721</span>
<span id="L5722" rel="#L5722">5722</span>
<span id="L5723" rel="#L5723">5723</span>
<span id="L5724" rel="#L5724">5724</span>
<span id="L5725" rel="#L5725">5725</span>
<span id="L5726" rel="#L5726">5726</span>
<span id="L5727" rel="#L5727">5727</span>
<span id="L5728" rel="#L5728">5728</span>
<span id="L5729" rel="#L5729">5729</span>
<span id="L5730" rel="#L5730">5730</span>
<span id="L5731" rel="#L5731">5731</span>
<span id="L5732" rel="#L5732">5732</span>
<span id="L5733" rel="#L5733">5733</span>
<span id="L5734" rel="#L5734">5734</span>
<span id="L5735" rel="#L5735">5735</span>
<span id="L5736" rel="#L5736">5736</span>
<span id="L5737" rel="#L5737">5737</span>
<span id="L5738" rel="#L5738">5738</span>
<span id="L5739" rel="#L5739">5739</span>
<span id="L5740" rel="#L5740">5740</span>
<span id="L5741" rel="#L5741">5741</span>
<span id="L5742" rel="#L5742">5742</span>
<span id="L5743" rel="#L5743">5743</span>
<span id="L5744" rel="#L5744">5744</span>
<span id="L5745" rel="#L5745">5745</span>
<span id="L5746" rel="#L5746">5746</span>
<span id="L5747" rel="#L5747">5747</span>
<span id="L5748" rel="#L5748">5748</span>
<span id="L5749" rel="#L5749">5749</span>
<span id="L5750" rel="#L5750">5750</span>
<span id="L5751" rel="#L5751">5751</span>
<span id="L5752" rel="#L5752">5752</span>
<span id="L5753" rel="#L5753">5753</span>
<span id="L5754" rel="#L5754">5754</span>
<span id="L5755" rel="#L5755">5755</span>
<span id="L5756" rel="#L5756">5756</span>
<span id="L5757" rel="#L5757">5757</span>
<span id="L5758" rel="#L5758">5758</span>
<span id="L5759" rel="#L5759">5759</span>
<span id="L5760" rel="#L5760">5760</span>
<span id="L5761" rel="#L5761">5761</span>
<span id="L5762" rel="#L5762">5762</span>
<span id="L5763" rel="#L5763">5763</span>
<span id="L5764" rel="#L5764">5764</span>
<span id="L5765" rel="#L5765">5765</span>
<span id="L5766" rel="#L5766">5766</span>
<span id="L5767" rel="#L5767">5767</span>
<span id="L5768" rel="#L5768">5768</span>
<span id="L5769" rel="#L5769">5769</span>
<span id="L5770" rel="#L5770">5770</span>
<span id="L5771" rel="#L5771">5771</span>
<span id="L5772" rel="#L5772">5772</span>
<span id="L5773" rel="#L5773">5773</span>
<span id="L5774" rel="#L5774">5774</span>
<span id="L5775" rel="#L5775">5775</span>
<span id="L5776" rel="#L5776">5776</span>
<span id="L5777" rel="#L5777">5777</span>
<span id="L5778" rel="#L5778">5778</span>
<span id="L5779" rel="#L5779">5779</span>
<span id="L5780" rel="#L5780">5780</span>
<span id="L5781" rel="#L5781">5781</span>
<span id="L5782" rel="#L5782">5782</span>
<span id="L5783" rel="#L5783">5783</span>
<span id="L5784" rel="#L5784">5784</span>
<span id="L5785" rel="#L5785">5785</span>
<span id="L5786" rel="#L5786">5786</span>
<span id="L5787" rel="#L5787">5787</span>
<span id="L5788" rel="#L5788">5788</span>
<span id="L5789" rel="#L5789">5789</span>
<span id="L5790" rel="#L5790">5790</span>
<span id="L5791" rel="#L5791">5791</span>
<span id="L5792" rel="#L5792">5792</span>
<span id="L5793" rel="#L5793">5793</span>
<span id="L5794" rel="#L5794">5794</span>
<span id="L5795" rel="#L5795">5795</span>
<span id="L5796" rel="#L5796">5796</span>
<span id="L5797" rel="#L5797">5797</span>
<span id="L5798" rel="#L5798">5798</span>
<span id="L5799" rel="#L5799">5799</span>
<span id="L5800" rel="#L5800">5800</span>
<span id="L5801" rel="#L5801">5801</span>
<span id="L5802" rel="#L5802">5802</span>
<span id="L5803" rel="#L5803">5803</span>
<span id="L5804" rel="#L5804">5804</span>
<span id="L5805" rel="#L5805">5805</span>
<span id="L5806" rel="#L5806">5806</span>
<span id="L5807" rel="#L5807">5807</span>
<span id="L5808" rel="#L5808">5808</span>
<span id="L5809" rel="#L5809">5809</span>
<span id="L5810" rel="#L5810">5810</span>
<span id="L5811" rel="#L5811">5811</span>
<span id="L5812" rel="#L5812">5812</span>
<span id="L5813" rel="#L5813">5813</span>
<span id="L5814" rel="#L5814">5814</span>
<span id="L5815" rel="#L5815">5815</span>
<span id="L5816" rel="#L5816">5816</span>
<span id="L5817" rel="#L5817">5817</span>
<span id="L5818" rel="#L5818">5818</span>
<span id="L5819" rel="#L5819">5819</span>
<span id="L5820" rel="#L5820">5820</span>
<span id="L5821" rel="#L5821">5821</span>
<span id="L5822" rel="#L5822">5822</span>
<span id="L5823" rel="#L5823">5823</span>
<span id="L5824" rel="#L5824">5824</span>
<span id="L5825" rel="#L5825">5825</span>
<span id="L5826" rel="#L5826">5826</span>
<span id="L5827" rel="#L5827">5827</span>
<span id="L5828" rel="#L5828">5828</span>
<span id="L5829" rel="#L5829">5829</span>
<span id="L5830" rel="#L5830">5830</span>
<span id="L5831" rel="#L5831">5831</span>
<span id="L5832" rel="#L5832">5832</span>
<span id="L5833" rel="#L5833">5833</span>
<span id="L5834" rel="#L5834">5834</span>
<span id="L5835" rel="#L5835">5835</span>
<span id="L5836" rel="#L5836">5836</span>
<span id="L5837" rel="#L5837">5837</span>
<span id="L5838" rel="#L5838">5838</span>
<span id="L5839" rel="#L5839">5839</span>
<span id="L5840" rel="#L5840">5840</span>
<span id="L5841" rel="#L5841">5841</span>
<span id="L5842" rel="#L5842">5842</span>
<span id="L5843" rel="#L5843">5843</span>
<span id="L5844" rel="#L5844">5844</span>
<span id="L5845" rel="#L5845">5845</span>
<span id="L5846" rel="#L5846">5846</span>
<span id="L5847" rel="#L5847">5847</span>
<span id="L5848" rel="#L5848">5848</span>
<span id="L5849" rel="#L5849">5849</span>
<span id="L5850" rel="#L5850">5850</span>
<span id="L5851" rel="#L5851">5851</span>
<span id="L5852" rel="#L5852">5852</span>
<span id="L5853" rel="#L5853">5853</span>
<span id="L5854" rel="#L5854">5854</span>
<span id="L5855" rel="#L5855">5855</span>
<span id="L5856" rel="#L5856">5856</span>
<span id="L5857" rel="#L5857">5857</span>
<span id="L5858" rel="#L5858">5858</span>
<span id="L5859" rel="#L5859">5859</span>
<span id="L5860" rel="#L5860">5860</span>
<span id="L5861" rel="#L5861">5861</span>
<span id="L5862" rel="#L5862">5862</span>
<span id="L5863" rel="#L5863">5863</span>
<span id="L5864" rel="#L5864">5864</span>
<span id="L5865" rel="#L5865">5865</span>
<span id="L5866" rel="#L5866">5866</span>
<span id="L5867" rel="#L5867">5867</span>
<span id="L5868" rel="#L5868">5868</span>
<span id="L5869" rel="#L5869">5869</span>
<span id="L5870" rel="#L5870">5870</span>
<span id="L5871" rel="#L5871">5871</span>
<span id="L5872" rel="#L5872">5872</span>
<span id="L5873" rel="#L5873">5873</span>
<span id="L5874" rel="#L5874">5874</span>
<span id="L5875" rel="#L5875">5875</span>
<span id="L5876" rel="#L5876">5876</span>
<span id="L5877" rel="#L5877">5877</span>
<span id="L5878" rel="#L5878">5878</span>
<span id="L5879" rel="#L5879">5879</span>
<span id="L5880" rel="#L5880">5880</span>
<span id="L5881" rel="#L5881">5881</span>
<span id="L5882" rel="#L5882">5882</span>
<span id="L5883" rel="#L5883">5883</span>
<span id="L5884" rel="#L5884">5884</span>
<span id="L5885" rel="#L5885">5885</span>
<span id="L5886" rel="#L5886">5886</span>
<span id="L5887" rel="#L5887">5887</span>
<span id="L5888" rel="#L5888">5888</span>
<span id="L5889" rel="#L5889">5889</span>
<span id="L5890" rel="#L5890">5890</span>
<span id="L5891" rel="#L5891">5891</span>
<span id="L5892" rel="#L5892">5892</span>
<span id="L5893" rel="#L5893">5893</span>
<span id="L5894" rel="#L5894">5894</span>
<span id="L5895" rel="#L5895">5895</span>
<span id="L5896" rel="#L5896">5896</span>
<span id="L5897" rel="#L5897">5897</span>
<span id="L5898" rel="#L5898">5898</span>
<span id="L5899" rel="#L5899">5899</span>
<span id="L5900" rel="#L5900">5900</span>
<span id="L5901" rel="#L5901">5901</span>
<span id="L5902" rel="#L5902">5902</span>
<span id="L5903" rel="#L5903">5903</span>
<span id="L5904" rel="#L5904">5904</span>
<span id="L5905" rel="#L5905">5905</span>
<span id="L5906" rel="#L5906">5906</span>
<span id="L5907" rel="#L5907">5907</span>
<span id="L5908" rel="#L5908">5908</span>
<span id="L5909" rel="#L5909">5909</span>
<span id="L5910" rel="#L5910">5910</span>
<span id="L5911" rel="#L5911">5911</span>
<span id="L5912" rel="#L5912">5912</span>
<span id="L5913" rel="#L5913">5913</span>
<span id="L5914" rel="#L5914">5914</span>
<span id="L5915" rel="#L5915">5915</span>
<span id="L5916" rel="#L5916">5916</span>
<span id="L5917" rel="#L5917">5917</span>
<span id="L5918" rel="#L5918">5918</span>
<span id="L5919" rel="#L5919">5919</span>
<span id="L5920" rel="#L5920">5920</span>
<span id="L5921" rel="#L5921">5921</span>
<span id="L5922" rel="#L5922">5922</span>
<span id="L5923" rel="#L5923">5923</span>
<span id="L5924" rel="#L5924">5924</span>
<span id="L5925" rel="#L5925">5925</span>
<span id="L5926" rel="#L5926">5926</span>
<span id="L5927" rel="#L5927">5927</span>
<span id="L5928" rel="#L5928">5928</span>
<span id="L5929" rel="#L5929">5929</span>
<span id="L5930" rel="#L5930">5930</span>
<span id="L5931" rel="#L5931">5931</span>
<span id="L5932" rel="#L5932">5932</span>
<span id="L5933" rel="#L5933">5933</span>
<span id="L5934" rel="#L5934">5934</span>
<span id="L5935" rel="#L5935">5935</span>
<span id="L5936" rel="#L5936">5936</span>
<span id="L5937" rel="#L5937">5937</span>
<span id="L5938" rel="#L5938">5938</span>
<span id="L5939" rel="#L5939">5939</span>
<span id="L5940" rel="#L5940">5940</span>
<span id="L5941" rel="#L5941">5941</span>
<span id="L5942" rel="#L5942">5942</span>
<span id="L5943" rel="#L5943">5943</span>
<span id="L5944" rel="#L5944">5944</span>
<span id="L5945" rel="#L5945">5945</span>
<span id="L5946" rel="#L5946">5946</span>
<span id="L5947" rel="#L5947">5947</span>
<span id="L5948" rel="#L5948">5948</span>
<span id="L5949" rel="#L5949">5949</span>
<span id="L5950" rel="#L5950">5950</span>
<span id="L5951" rel="#L5951">5951</span>
<span id="L5952" rel="#L5952">5952</span>
<span id="L5953" rel="#L5953">5953</span>
<span id="L5954" rel="#L5954">5954</span>
<span id="L5955" rel="#L5955">5955</span>
<span id="L5956" rel="#L5956">5956</span>
<span id="L5957" rel="#L5957">5957</span>
<span id="L5958" rel="#L5958">5958</span>
<span id="L5959" rel="#L5959">5959</span>
<span id="L5960" rel="#L5960">5960</span>
<span id="L5961" rel="#L5961">5961</span>
<span id="L5962" rel="#L5962">5962</span>
<span id="L5963" rel="#L5963">5963</span>
<span id="L5964" rel="#L5964">5964</span>
<span id="L5965" rel="#L5965">5965</span>
<span id="L5966" rel="#L5966">5966</span>
<span id="L5967" rel="#L5967">5967</span>
<span id="L5968" rel="#L5968">5968</span>
<span id="L5969" rel="#L5969">5969</span>
<span id="L5970" rel="#L5970">5970</span>
<span id="L5971" rel="#L5971">5971</span>
<span id="L5972" rel="#L5972">5972</span>
<span id="L5973" rel="#L5973">5973</span>
<span id="L5974" rel="#L5974">5974</span>
<span id="L5975" rel="#L5975">5975</span>
<span id="L5976" rel="#L5976">5976</span>
<span id="L5977" rel="#L5977">5977</span>
<span id="L5978" rel="#L5978">5978</span>
<span id="L5979" rel="#L5979">5979</span>
<span id="L5980" rel="#L5980">5980</span>
<span id="L5981" rel="#L5981">5981</span>
<span id="L5982" rel="#L5982">5982</span>
<span id="L5983" rel="#L5983">5983</span>
<span id="L5984" rel="#L5984">5984</span>
<span id="L5985" rel="#L5985">5985</span>
<span id="L5986" rel="#L5986">5986</span>
<span id="L5987" rel="#L5987">5987</span>
<span id="L5988" rel="#L5988">5988</span>
<span id="L5989" rel="#L5989">5989</span>
<span id="L5990" rel="#L5990">5990</span>
<span id="L5991" rel="#L5991">5991</span>
<span id="L5992" rel="#L5992">5992</span>
<span id="L5993" rel="#L5993">5993</span>
<span id="L5994" rel="#L5994">5994</span>
<span id="L5995" rel="#L5995">5995</span>
<span id="L5996" rel="#L5996">5996</span>
<span id="L5997" rel="#L5997">5997</span>
<span id="L5998" rel="#L5998">5998</span>
<span id="L5999" rel="#L5999">5999</span>
<span id="L6000" rel="#L6000">6000</span>
<span id="L6001" rel="#L6001">6001</span>
<span id="L6002" rel="#L6002">6002</span>
<span id="L6003" rel="#L6003">6003</span>
<span id="L6004" rel="#L6004">6004</span>
<span id="L6005" rel="#L6005">6005</span>
<span id="L6006" rel="#L6006">6006</span>
<span id="L6007" rel="#L6007">6007</span>
<span id="L6008" rel="#L6008">6008</span>
<span id="L6009" rel="#L6009">6009</span>
<span id="L6010" rel="#L6010">6010</span>
<span id="L6011" rel="#L6011">6011</span>
<span id="L6012" rel="#L6012">6012</span>
<span id="L6013" rel="#L6013">6013</span>
<span id="L6014" rel="#L6014">6014</span>
<span id="L6015" rel="#L6015">6015</span>
<span id="L6016" rel="#L6016">6016</span>
<span id="L6017" rel="#L6017">6017</span>
<span id="L6018" rel="#L6018">6018</span>
<span id="L6019" rel="#L6019">6019</span>
<span id="L6020" rel="#L6020">6020</span>
<span id="L6021" rel="#L6021">6021</span>
<span id="L6022" rel="#L6022">6022</span>
<span id="L6023" rel="#L6023">6023</span>
<span id="L6024" rel="#L6024">6024</span>
<span id="L6025" rel="#L6025">6025</span>
<span id="L6026" rel="#L6026">6026</span>
<span id="L6027" rel="#L6027">6027</span>
<span id="L6028" rel="#L6028">6028</span>
<span id="L6029" rel="#L6029">6029</span>
<span id="L6030" rel="#L6030">6030</span>
<span id="L6031" rel="#L6031">6031</span>
<span id="L6032" rel="#L6032">6032</span>
<span id="L6033" rel="#L6033">6033</span>
<span id="L6034" rel="#L6034">6034</span>
<span id="L6035" rel="#L6035">6035</span>
<span id="L6036" rel="#L6036">6036</span>
<span id="L6037" rel="#L6037">6037</span>
<span id="L6038" rel="#L6038">6038</span>
<span id="L6039" rel="#L6039">6039</span>
<span id="L6040" rel="#L6040">6040</span>
<span id="L6041" rel="#L6041">6041</span>
<span id="L6042" rel="#L6042">6042</span>
<span id="L6043" rel="#L6043">6043</span>
<span id="L6044" rel="#L6044">6044</span>
<span id="L6045" rel="#L6045">6045</span>
<span id="L6046" rel="#L6046">6046</span>
<span id="L6047" rel="#L6047">6047</span>
<span id="L6048" rel="#L6048">6048</span>
<span id="L6049" rel="#L6049">6049</span>
<span id="L6050" rel="#L6050">6050</span>
<span id="L6051" rel="#L6051">6051</span>
<span id="L6052" rel="#L6052">6052</span>
<span id="L6053" rel="#L6053">6053</span>
<span id="L6054" rel="#L6054">6054</span>
<span id="L6055" rel="#L6055">6055</span>
<span id="L6056" rel="#L6056">6056</span>
<span id="L6057" rel="#L6057">6057</span>
<span id="L6058" rel="#L6058">6058</span>
<span id="L6059" rel="#L6059">6059</span>
<span id="L6060" rel="#L6060">6060</span>
<span id="L6061" rel="#L6061">6061</span>
<span id="L6062" rel="#L6062">6062</span>
<span id="L6063" rel="#L6063">6063</span>
<span id="L6064" rel="#L6064">6064</span>
<span id="L6065" rel="#L6065">6065</span>
<span id="L6066" rel="#L6066">6066</span>
<span id="L6067" rel="#L6067">6067</span>
<span id="L6068" rel="#L6068">6068</span>
<span id="L6069" rel="#L6069">6069</span>
<span id="L6070" rel="#L6070">6070</span>
<span id="L6071" rel="#L6071">6071</span>
<span id="L6072" rel="#L6072">6072</span>
<span id="L6073" rel="#L6073">6073</span>
<span id="L6074" rel="#L6074">6074</span>
<span id="L6075" rel="#L6075">6075</span>
<span id="L6076" rel="#L6076">6076</span>
<span id="L6077" rel="#L6077">6077</span>
<span id="L6078" rel="#L6078">6078</span>
<span id="L6079" rel="#L6079">6079</span>
<span id="L6080" rel="#L6080">6080</span>
<span id="L6081" rel="#L6081">6081</span>
<span id="L6082" rel="#L6082">6082</span>
<span id="L6083" rel="#L6083">6083</span>
<span id="L6084" rel="#L6084">6084</span>
<span id="L6085" rel="#L6085">6085</span>
<span id="L6086" rel="#L6086">6086</span>
<span id="L6087" rel="#L6087">6087</span>
<span id="L6088" rel="#L6088">6088</span>
<span id="L6089" rel="#L6089">6089</span>
<span id="L6090" rel="#L6090">6090</span>
<span id="L6091" rel="#L6091">6091</span>
<span id="L6092" rel="#L6092">6092</span>
<span id="L6093" rel="#L6093">6093</span>
<span id="L6094" rel="#L6094">6094</span>
<span id="L6095" rel="#L6095">6095</span>
<span id="L6096" rel="#L6096">6096</span>
<span id="L6097" rel="#L6097">6097</span>
<span id="L6098" rel="#L6098">6098</span>
<span id="L6099" rel="#L6099">6099</span>
<span id="L6100" rel="#L6100">6100</span>
<span id="L6101" rel="#L6101">6101</span>
<span id="L6102" rel="#L6102">6102</span>
<span id="L6103" rel="#L6103">6103</span>
<span id="L6104" rel="#L6104">6104</span>
<span id="L6105" rel="#L6105">6105</span>
<span id="L6106" rel="#L6106">6106</span>
<span id="L6107" rel="#L6107">6107</span>
<span id="L6108" rel="#L6108">6108</span>
<span id="L6109" rel="#L6109">6109</span>
<span id="L6110" rel="#L6110">6110</span>
<span id="L6111" rel="#L6111">6111</span>
<span id="L6112" rel="#L6112">6112</span>
<span id="L6113" rel="#L6113">6113</span>
<span id="L6114" rel="#L6114">6114</span>
<span id="L6115" rel="#L6115">6115</span>
<span id="L6116" rel="#L6116">6116</span>
<span id="L6117" rel="#L6117">6117</span>
<span id="L6118" rel="#L6118">6118</span>
<span id="L6119" rel="#L6119">6119</span>
<span id="L6120" rel="#L6120">6120</span>
<span id="L6121" rel="#L6121">6121</span>
<span id="L6122" rel="#L6122">6122</span>
<span id="L6123" rel="#L6123">6123</span>
<span id="L6124" rel="#L6124">6124</span>
<span id="L6125" rel="#L6125">6125</span>
<span id="L6126" rel="#L6126">6126</span>
<span id="L6127" rel="#L6127">6127</span>
<span id="L6128" rel="#L6128">6128</span>
<span id="L6129" rel="#L6129">6129</span>
<span id="L6130" rel="#L6130">6130</span>
<span id="L6131" rel="#L6131">6131</span>
<span id="L6132" rel="#L6132">6132</span>
<span id="L6133" rel="#L6133">6133</span>
<span id="L6134" rel="#L6134">6134</span>
<span id="L6135" rel="#L6135">6135</span>
<span id="L6136" rel="#L6136">6136</span>
<span id="L6137" rel="#L6137">6137</span>
<span id="L6138" rel="#L6138">6138</span>
<span id="L6139" rel="#L6139">6139</span>
<span id="L6140" rel="#L6140">6140</span>
<span id="L6141" rel="#L6141">6141</span>
<span id="L6142" rel="#L6142">6142</span>
<span id="L6143" rel="#L6143">6143</span>
<span id="L6144" rel="#L6144">6144</span>
<span id="L6145" rel="#L6145">6145</span>
<span id="L6146" rel="#L6146">6146</span>
<span id="L6147" rel="#L6147">6147</span>
<span id="L6148" rel="#L6148">6148</span>
<span id="L6149" rel="#L6149">6149</span>
<span id="L6150" rel="#L6150">6150</span>
<span id="L6151" rel="#L6151">6151</span>
<span id="L6152" rel="#L6152">6152</span>
<span id="L6153" rel="#L6153">6153</span>
<span id="L6154" rel="#L6154">6154</span>
<span id="L6155" rel="#L6155">6155</span>
<span id="L6156" rel="#L6156">6156</span>
<span id="L6157" rel="#L6157">6157</span>
<span id="L6158" rel="#L6158">6158</span>
<span id="L6159" rel="#L6159">6159</span>
<span id="L6160" rel="#L6160">6160</span>
<span id="L6161" rel="#L6161">6161</span>
<span id="L6162" rel="#L6162">6162</span>
<span id="L6163" rel="#L6163">6163</span>
<span id="L6164" rel="#L6164">6164</span>
<span id="L6165" rel="#L6165">6165</span>
<span id="L6166" rel="#L6166">6166</span>
<span id="L6167" rel="#L6167">6167</span>
<span id="L6168" rel="#L6168">6168</span>
<span id="L6169" rel="#L6169">6169</span>
<span id="L6170" rel="#L6170">6170</span>
<span id="L6171" rel="#L6171">6171</span>
<span id="L6172" rel="#L6172">6172</span>
<span id="L6173" rel="#L6173">6173</span>
<span id="L6174" rel="#L6174">6174</span>
<span id="L6175" rel="#L6175">6175</span>
<span id="L6176" rel="#L6176">6176</span>
<span id="L6177" rel="#L6177">6177</span>
<span id="L6178" rel="#L6178">6178</span>
<span id="L6179" rel="#L6179">6179</span>
<span id="L6180" rel="#L6180">6180</span>
<span id="L6181" rel="#L6181">6181</span>
<span id="L6182" rel="#L6182">6182</span>
<span id="L6183" rel="#L6183">6183</span>
<span id="L6184" rel="#L6184">6184</span>
<span id="L6185" rel="#L6185">6185</span>
<span id="L6186" rel="#L6186">6186</span>
<span id="L6187" rel="#L6187">6187</span>
<span id="L6188" rel="#L6188">6188</span>
<span id="L6189" rel="#L6189">6189</span>
<span id="L6190" rel="#L6190">6190</span>
<span id="L6191" rel="#L6191">6191</span>
<span id="L6192" rel="#L6192">6192</span>
<span id="L6193" rel="#L6193">6193</span>
<span id="L6194" rel="#L6194">6194</span>
<span id="L6195" rel="#L6195">6195</span>
<span id="L6196" rel="#L6196">6196</span>
<span id="L6197" rel="#L6197">6197</span>
<span id="L6198" rel="#L6198">6198</span>
<span id="L6199" rel="#L6199">6199</span>
<span id="L6200" rel="#L6200">6200</span>
<span id="L6201" rel="#L6201">6201</span>
<span id="L6202" rel="#L6202">6202</span>
<span id="L6203" rel="#L6203">6203</span>
<span id="L6204" rel="#L6204">6204</span>
<span id="L6205" rel="#L6205">6205</span>
<span id="L6206" rel="#L6206">6206</span>
<span id="L6207" rel="#L6207">6207</span>
<span id="L6208" rel="#L6208">6208</span>
<span id="L6209" rel="#L6209">6209</span>
<span id="L6210" rel="#L6210">6210</span>
<span id="L6211" rel="#L6211">6211</span>
<span id="L6212" rel="#L6212">6212</span>
<span id="L6213" rel="#L6213">6213</span>
<span id="L6214" rel="#L6214">6214</span>
<span id="L6215" rel="#L6215">6215</span>
<span id="L6216" rel="#L6216">6216</span>
<span id="L6217" rel="#L6217">6217</span>
<span id="L6218" rel="#L6218">6218</span>
<span id="L6219" rel="#L6219">6219</span>
<span id="L6220" rel="#L6220">6220</span>
<span id="L6221" rel="#L6221">6221</span>
<span id="L6222" rel="#L6222">6222</span>
<span id="L6223" rel="#L6223">6223</span>
<span id="L6224" rel="#L6224">6224</span>
<span id="L6225" rel="#L6225">6225</span>
<span id="L6226" rel="#L6226">6226</span>
<span id="L6227" rel="#L6227">6227</span>
<span id="L6228" rel="#L6228">6228</span>
<span id="L6229" rel="#L6229">6229</span>
<span id="L6230" rel="#L6230">6230</span>
<span id="L6231" rel="#L6231">6231</span>
<span id="L6232" rel="#L6232">6232</span>
<span id="L6233" rel="#L6233">6233</span>
<span id="L6234" rel="#L6234">6234</span>
<span id="L6235" rel="#L6235">6235</span>
<span id="L6236" rel="#L6236">6236</span>
<span id="L6237" rel="#L6237">6237</span>
<span id="L6238" rel="#L6238">6238</span>
<span id="L6239" rel="#L6239">6239</span>
<span id="L6240" rel="#L6240">6240</span>
<span id="L6241" rel="#L6241">6241</span>
<span id="L6242" rel="#L6242">6242</span>
<span id="L6243" rel="#L6243">6243</span>
<span id="L6244" rel="#L6244">6244</span>
<span id="L6245" rel="#L6245">6245</span>
<span id="L6246" rel="#L6246">6246</span>
<span id="L6247" rel="#L6247">6247</span>
<span id="L6248" rel="#L6248">6248</span>
<span id="L6249" rel="#L6249">6249</span>
<span id="L6250" rel="#L6250">6250</span>
<span id="L6251" rel="#L6251">6251</span>
<span id="L6252" rel="#L6252">6252</span>
<span id="L6253" rel="#L6253">6253</span>
<span id="L6254" rel="#L6254">6254</span>
<span id="L6255" rel="#L6255">6255</span>
<span id="L6256" rel="#L6256">6256</span>
<span id="L6257" rel="#L6257">6257</span>
<span id="L6258" rel="#L6258">6258</span>
<span id="L6259" rel="#L6259">6259</span>
<span id="L6260" rel="#L6260">6260</span>
<span id="L6261" rel="#L6261">6261</span>
<span id="L6262" rel="#L6262">6262</span>
<span id="L6263" rel="#L6263">6263</span>
<span id="L6264" rel="#L6264">6264</span>
<span id="L6265" rel="#L6265">6265</span>
<span id="L6266" rel="#L6266">6266</span>
<span id="L6267" rel="#L6267">6267</span>
<span id="L6268" rel="#L6268">6268</span>
<span id="L6269" rel="#L6269">6269</span>
<span id="L6270" rel="#L6270">6270</span>
<span id="L6271" rel="#L6271">6271</span>
<span id="L6272" rel="#L6272">6272</span>
<span id="L6273" rel="#L6273">6273</span>
<span id="L6274" rel="#L6274">6274</span>
<span id="L6275" rel="#L6275">6275</span>
<span id="L6276" rel="#L6276">6276</span>
<span id="L6277" rel="#L6277">6277</span>
<span id="L6278" rel="#L6278">6278</span>
<span id="L6279" rel="#L6279">6279</span>
<span id="L6280" rel="#L6280">6280</span>
<span id="L6281" rel="#L6281">6281</span>
<span id="L6282" rel="#L6282">6282</span>
<span id="L6283" rel="#L6283">6283</span>
<span id="L6284" rel="#L6284">6284</span>
<span id="L6285" rel="#L6285">6285</span>
<span id="L6286" rel="#L6286">6286</span>
<span id="L6287" rel="#L6287">6287</span>
<span id="L6288" rel="#L6288">6288</span>
<span id="L6289" rel="#L6289">6289</span>
<span id="L6290" rel="#L6290">6290</span>
<span id="L6291" rel="#L6291">6291</span>
<span id="L6292" rel="#L6292">6292</span>
<span id="L6293" rel="#L6293">6293</span>
<span id="L6294" rel="#L6294">6294</span>
<span id="L6295" rel="#L6295">6295</span>
<span id="L6296" rel="#L6296">6296</span>
<span id="L6297" rel="#L6297">6297</span>
<span id="L6298" rel="#L6298">6298</span>
<span id="L6299" rel="#L6299">6299</span>
<span id="L6300" rel="#L6300">6300</span>
<span id="L6301" rel="#L6301">6301</span>
<span id="L6302" rel="#L6302">6302</span>
<span id="L6303" rel="#L6303">6303</span>
<span id="L6304" rel="#L6304">6304</span>
<span id="L6305" rel="#L6305">6305</span>
<span id="L6306" rel="#L6306">6306</span>
<span id="L6307" rel="#L6307">6307</span>
<span id="L6308" rel="#L6308">6308</span>
<span id="L6309" rel="#L6309">6309</span>
<span id="L6310" rel="#L6310">6310</span>
<span id="L6311" rel="#L6311">6311</span>
<span id="L6312" rel="#L6312">6312</span>
<span id="L6313" rel="#L6313">6313</span>
<span id="L6314" rel="#L6314">6314</span>
<span id="L6315" rel="#L6315">6315</span>
<span id="L6316" rel="#L6316">6316</span>
<span id="L6317" rel="#L6317">6317</span>
<span id="L6318" rel="#L6318">6318</span>
<span id="L6319" rel="#L6319">6319</span>
<span id="L6320" rel="#L6320">6320</span>
<span id="L6321" rel="#L6321">6321</span>
<span id="L6322" rel="#L6322">6322</span>
<span id="L6323" rel="#L6323">6323</span>
<span id="L6324" rel="#L6324">6324</span>
<span id="L6325" rel="#L6325">6325</span>
<span id="L6326" rel="#L6326">6326</span>
<span id="L6327" rel="#L6327">6327</span>
<span id="L6328" rel="#L6328">6328</span>
<span id="L6329" rel="#L6329">6329</span>
<span id="L6330" rel="#L6330">6330</span>
<span id="L6331" rel="#L6331">6331</span>
<span id="L6332" rel="#L6332">6332</span>
<span id="L6333" rel="#L6333">6333</span>
<span id="L6334" rel="#L6334">6334</span>
<span id="L6335" rel="#L6335">6335</span>
<span id="L6336" rel="#L6336">6336</span>
<span id="L6337" rel="#L6337">6337</span>
<span id="L6338" rel="#L6338">6338</span>
<span id="L6339" rel="#L6339">6339</span>
<span id="L6340" rel="#L6340">6340</span>
<span id="L6341" rel="#L6341">6341</span>
<span id="L6342" rel="#L6342">6342</span>
<span id="L6343" rel="#L6343">6343</span>
<span id="L6344" rel="#L6344">6344</span>
<span id="L6345" rel="#L6345">6345</span>
<span id="L6346" rel="#L6346">6346</span>
<span id="L6347" rel="#L6347">6347</span>
<span id="L6348" rel="#L6348">6348</span>
<span id="L6349" rel="#L6349">6349</span>
<span id="L6350" rel="#L6350">6350</span>
<span id="L6351" rel="#L6351">6351</span>
<span id="L6352" rel="#L6352">6352</span>
<span id="L6353" rel="#L6353">6353</span>
<span id="L6354" rel="#L6354">6354</span>
<span id="L6355" rel="#L6355">6355</span>
<span id="L6356" rel="#L6356">6356</span>
<span id="L6357" rel="#L6357">6357</span>
<span id="L6358" rel="#L6358">6358</span>
<span id="L6359" rel="#L6359">6359</span>
<span id="L6360" rel="#L6360">6360</span>
<span id="L6361" rel="#L6361">6361</span>
<span id="L6362" rel="#L6362">6362</span>
<span id="L6363" rel="#L6363">6363</span>
<span id="L6364" rel="#L6364">6364</span>
<span id="L6365" rel="#L6365">6365</span>
<span id="L6366" rel="#L6366">6366</span>
<span id="L6367" rel="#L6367">6367</span>
<span id="L6368" rel="#L6368">6368</span>
<span id="L6369" rel="#L6369">6369</span>
<span id="L6370" rel="#L6370">6370</span>
<span id="L6371" rel="#L6371">6371</span>
<span id="L6372" rel="#L6372">6372</span>
<span id="L6373" rel="#L6373">6373</span>
<span id="L6374" rel="#L6374">6374</span>
<span id="L6375" rel="#L6375">6375</span>
<span id="L6376" rel="#L6376">6376</span>
<span id="L6377" rel="#L6377">6377</span>
<span id="L6378" rel="#L6378">6378</span>
<span id="L6379" rel="#L6379">6379</span>
<span id="L6380" rel="#L6380">6380</span>
<span id="L6381" rel="#L6381">6381</span>
<span id="L6382" rel="#L6382">6382</span>
<span id="L6383" rel="#L6383">6383</span>
<span id="L6384" rel="#L6384">6384</span>
<span id="L6385" rel="#L6385">6385</span>
<span id="L6386" rel="#L6386">6386</span>
<span id="L6387" rel="#L6387">6387</span>
<span id="L6388" rel="#L6388">6388</span>
<span id="L6389" rel="#L6389">6389</span>
<span id="L6390" rel="#L6390">6390</span>
<span id="L6391" rel="#L6391">6391</span>
<span id="L6392" rel="#L6392">6392</span>
<span id="L6393" rel="#L6393">6393</span>
<span id="L6394" rel="#L6394">6394</span>
<span id="L6395" rel="#L6395">6395</span>
<span id="L6396" rel="#L6396">6396</span>
<span id="L6397" rel="#L6397">6397</span>
<span id="L6398" rel="#L6398">6398</span>
<span id="L6399" rel="#L6399">6399</span>
<span id="L6400" rel="#L6400">6400</span>
<span id="L6401" rel="#L6401">6401</span>
<span id="L6402" rel="#L6402">6402</span>
<span id="L6403" rel="#L6403">6403</span>
<span id="L6404" rel="#L6404">6404</span>
<span id="L6405" rel="#L6405">6405</span>
<span id="L6406" rel="#L6406">6406</span>
<span id="L6407" rel="#L6407">6407</span>
<span id="L6408" rel="#L6408">6408</span>
<span id="L6409" rel="#L6409">6409</span>
<span id="L6410" rel="#L6410">6410</span>
<span id="L6411" rel="#L6411">6411</span>
<span id="L6412" rel="#L6412">6412</span>
<span id="L6413" rel="#L6413">6413</span>
<span id="L6414" rel="#L6414">6414</span>
<span id="L6415" rel="#L6415">6415</span>
<span id="L6416" rel="#L6416">6416</span>
<span id="L6417" rel="#L6417">6417</span>
<span id="L6418" rel="#L6418">6418</span>
<span id="L6419" rel="#L6419">6419</span>
<span id="L6420" rel="#L6420">6420</span>
<span id="L6421" rel="#L6421">6421</span>
<span id="L6422" rel="#L6422">6422</span>
<span id="L6423" rel="#L6423">6423</span>
<span id="L6424" rel="#L6424">6424</span>
<span id="L6425" rel="#L6425">6425</span>
<span id="L6426" rel="#L6426">6426</span>
<span id="L6427" rel="#L6427">6427</span>
<span id="L6428" rel="#L6428">6428</span>
<span id="L6429" rel="#L6429">6429</span>
<span id="L6430" rel="#L6430">6430</span>
<span id="L6431" rel="#L6431">6431</span>
<span id="L6432" rel="#L6432">6432</span>
<span id="L6433" rel="#L6433">6433</span>
<span id="L6434" rel="#L6434">6434</span>
<span id="L6435" rel="#L6435">6435</span>
<span id="L6436" rel="#L6436">6436</span>
<span id="L6437" rel="#L6437">6437</span>
<span id="L6438" rel="#L6438">6438</span>
<span id="L6439" rel="#L6439">6439</span>
<span id="L6440" rel="#L6440">6440</span>
<span id="L6441" rel="#L6441">6441</span>
<span id="L6442" rel="#L6442">6442</span>
<span id="L6443" rel="#L6443">6443</span>
<span id="L6444" rel="#L6444">6444</span>
<span id="L6445" rel="#L6445">6445</span>
<span id="L6446" rel="#L6446">6446</span>
<span id="L6447" rel="#L6447">6447</span>
<span id="L6448" rel="#L6448">6448</span>
<span id="L6449" rel="#L6449">6449</span>
<span id="L6450" rel="#L6450">6450</span>
<span id="L6451" rel="#L6451">6451</span>
<span id="L6452" rel="#L6452">6452</span>
<span id="L6453" rel="#L6453">6453</span>
<span id="L6454" rel="#L6454">6454</span>
<span id="L6455" rel="#L6455">6455</span>
<span id="L6456" rel="#L6456">6456</span>
<span id="L6457" rel="#L6457">6457</span>
<span id="L6458" rel="#L6458">6458</span>
<span id="L6459" rel="#L6459">6459</span>
<span id="L6460" rel="#L6460">6460</span>
<span id="L6461" rel="#L6461">6461</span>
<span id="L6462" rel="#L6462">6462</span>
<span id="L6463" rel="#L6463">6463</span>
<span id="L6464" rel="#L6464">6464</span>
<span id="L6465" rel="#L6465">6465</span>
<span id="L6466" rel="#L6466">6466</span>
<span id="L6467" rel="#L6467">6467</span>
<span id="L6468" rel="#L6468">6468</span>
<span id="L6469" rel="#L6469">6469</span>
<span id="L6470" rel="#L6470">6470</span>
<span id="L6471" rel="#L6471">6471</span>
<span id="L6472" rel="#L6472">6472</span>
<span id="L6473" rel="#L6473">6473</span>
<span id="L6474" rel="#L6474">6474</span>
<span id="L6475" rel="#L6475">6475</span>
<span id="L6476" rel="#L6476">6476</span>
<span id="L6477" rel="#L6477">6477</span>
<span id="L6478" rel="#L6478">6478</span>
<span id="L6479" rel="#L6479">6479</span>
<span id="L6480" rel="#L6480">6480</span>
<span id="L6481" rel="#L6481">6481</span>
<span id="L6482" rel="#L6482">6482</span>
<span id="L6483" rel="#L6483">6483</span>
<span id="L6484" rel="#L6484">6484</span>
<span id="L6485" rel="#L6485">6485</span>
<span id="L6486" rel="#L6486">6486</span>
<span id="L6487" rel="#L6487">6487</span>
<span id="L6488" rel="#L6488">6488</span>
<span id="L6489" rel="#L6489">6489</span>
<span id="L6490" rel="#L6490">6490</span>
<span id="L6491" rel="#L6491">6491</span>
<span id="L6492" rel="#L6492">6492</span>
<span id="L6493" rel="#L6493">6493</span>
<span id="L6494" rel="#L6494">6494</span>
<span id="L6495" rel="#L6495">6495</span>
<span id="L6496" rel="#L6496">6496</span>
<span id="L6497" rel="#L6497">6497</span>
<span id="L6498" rel="#L6498">6498</span>
<span id="L6499" rel="#L6499">6499</span>
<span id="L6500" rel="#L6500">6500</span>
<span id="L6501" rel="#L6501">6501</span>
<span id="L6502" rel="#L6502">6502</span>
<span id="L6503" rel="#L6503">6503</span>
<span id="L6504" rel="#L6504">6504</span>
<span id="L6505" rel="#L6505">6505</span>
<span id="L6506" rel="#L6506">6506</span>
<span id="L6507" rel="#L6507">6507</span>
<span id="L6508" rel="#L6508">6508</span>
<span id="L6509" rel="#L6509">6509</span>
<span id="L6510" rel="#L6510">6510</span>
<span id="L6511" rel="#L6511">6511</span>
<span id="L6512" rel="#L6512">6512</span>
<span id="L6513" rel="#L6513">6513</span>
<span id="L6514" rel="#L6514">6514</span>
<span id="L6515" rel="#L6515">6515</span>
<span id="L6516" rel="#L6516">6516</span>
<span id="L6517" rel="#L6517">6517</span>
<span id="L6518" rel="#L6518">6518</span>
<span id="L6519" rel="#L6519">6519</span>
<span id="L6520" rel="#L6520">6520</span>
<span id="L6521" rel="#L6521">6521</span>
<span id="L6522" rel="#L6522">6522</span>
<span id="L6523" rel="#L6523">6523</span>
<span id="L6524" rel="#L6524">6524</span>
<span id="L6525" rel="#L6525">6525</span>
<span id="L6526" rel="#L6526">6526</span>
<span id="L6527" rel="#L6527">6527</span>
<span id="L6528" rel="#L6528">6528</span>
<span id="L6529" rel="#L6529">6529</span>
<span id="L6530" rel="#L6530">6530</span>
<span id="L6531" rel="#L6531">6531</span>
<span id="L6532" rel="#L6532">6532</span>
<span id="L6533" rel="#L6533">6533</span>
<span id="L6534" rel="#L6534">6534</span>
<span id="L6535" rel="#L6535">6535</span>
<span id="L6536" rel="#L6536">6536</span>
<span id="L6537" rel="#L6537">6537</span>
<span id="L6538" rel="#L6538">6538</span>
<span id="L6539" rel="#L6539">6539</span>
<span id="L6540" rel="#L6540">6540</span>
<span id="L6541" rel="#L6541">6541</span>
<span id="L6542" rel="#L6542">6542</span>
<span id="L6543" rel="#L6543">6543</span>
<span id="L6544" rel="#L6544">6544</span>
<span id="L6545" rel="#L6545">6545</span>
<span id="L6546" rel="#L6546">6546</span>
<span id="L6547" rel="#L6547">6547</span>
<span id="L6548" rel="#L6548">6548</span>
<span id="L6549" rel="#L6549">6549</span>
<span id="L6550" rel="#L6550">6550</span>
<span id="L6551" rel="#L6551">6551</span>
<span id="L6552" rel="#L6552">6552</span>
<span id="L6553" rel="#L6553">6553</span>
<span id="L6554" rel="#L6554">6554</span>
<span id="L6555" rel="#L6555">6555</span>
<span id="L6556" rel="#L6556">6556</span>
<span id="L6557" rel="#L6557">6557</span>
<span id="L6558" rel="#L6558">6558</span>
<span id="L6559" rel="#L6559">6559</span>
<span id="L6560" rel="#L6560">6560</span>
<span id="L6561" rel="#L6561">6561</span>
<span id="L6562" rel="#L6562">6562</span>
<span id="L6563" rel="#L6563">6563</span>
<span id="L6564" rel="#L6564">6564</span>
<span id="L6565" rel="#L6565">6565</span>
<span id="L6566" rel="#L6566">6566</span>
<span id="L6567" rel="#L6567">6567</span>
<span id="L6568" rel="#L6568">6568</span>
<span id="L6569" rel="#L6569">6569</span>
<span id="L6570" rel="#L6570">6570</span>
<span id="L6571" rel="#L6571">6571</span>
<span id="L6572" rel="#L6572">6572</span>
<span id="L6573" rel="#L6573">6573</span>
<span id="L6574" rel="#L6574">6574</span>
<span id="L6575" rel="#L6575">6575</span>
<span id="L6576" rel="#L6576">6576</span>
<span id="L6577" rel="#L6577">6577</span>
<span id="L6578" rel="#L6578">6578</span>
<span id="L6579" rel="#L6579">6579</span>
<span id="L6580" rel="#L6580">6580</span>
<span id="L6581" rel="#L6581">6581</span>
<span id="L6582" rel="#L6582">6582</span>
<span id="L6583" rel="#L6583">6583</span>
<span id="L6584" rel="#L6584">6584</span>
<span id="L6585" rel="#L6585">6585</span>
<span id="L6586" rel="#L6586">6586</span>
<span id="L6587" rel="#L6587">6587</span>
<span id="L6588" rel="#L6588">6588</span>
<span id="L6589" rel="#L6589">6589</span>
<span id="L6590" rel="#L6590">6590</span>
<span id="L6591" rel="#L6591">6591</span>
<span id="L6592" rel="#L6592">6592</span>
<span id="L6593" rel="#L6593">6593</span>
<span id="L6594" rel="#L6594">6594</span>
<span id="L6595" rel="#L6595">6595</span>
<span id="L6596" rel="#L6596">6596</span>
<span id="L6597" rel="#L6597">6597</span>
<span id="L6598" rel="#L6598">6598</span>
<span id="L6599" rel="#L6599">6599</span>
<span id="L6600" rel="#L6600">6600</span>
<span id="L6601" rel="#L6601">6601</span>
<span id="L6602" rel="#L6602">6602</span>
<span id="L6603" rel="#L6603">6603</span>
<span id="L6604" rel="#L6604">6604</span>
<span id="L6605" rel="#L6605">6605</span>
<span id="L6606" rel="#L6606">6606</span>
<span id="L6607" rel="#L6607">6607</span>
<span id="L6608" rel="#L6608">6608</span>
<span id="L6609" rel="#L6609">6609</span>
<span id="L6610" rel="#L6610">6610</span>
<span id="L6611" rel="#L6611">6611</span>
<span id="L6612" rel="#L6612">6612</span>
<span id="L6613" rel="#L6613">6613</span>
<span id="L6614" rel="#L6614">6614</span>
<span id="L6615" rel="#L6615">6615</span>
<span id="L6616" rel="#L6616">6616</span>
<span id="L6617" rel="#L6617">6617</span>
<span id="L6618" rel="#L6618">6618</span>
<span id="L6619" rel="#L6619">6619</span>
<span id="L6620" rel="#L6620">6620</span>
<span id="L6621" rel="#L6621">6621</span>
<span id="L6622" rel="#L6622">6622</span>
<span id="L6623" rel="#L6623">6623</span>
<span id="L6624" rel="#L6624">6624</span>
<span id="L6625" rel="#L6625">6625</span>
<span id="L6626" rel="#L6626">6626</span>
<span id="L6627" rel="#L6627">6627</span>
<span id="L6628" rel="#L6628">6628</span>
<span id="L6629" rel="#L6629">6629</span>
<span id="L6630" rel="#L6630">6630</span>
<span id="L6631" rel="#L6631">6631</span>
<span id="L6632" rel="#L6632">6632</span>
<span id="L6633" rel="#L6633">6633</span>
<span id="L6634" rel="#L6634">6634</span>
<span id="L6635" rel="#L6635">6635</span>
<span id="L6636" rel="#L6636">6636</span>
<span id="L6637" rel="#L6637">6637</span>
<span id="L6638" rel="#L6638">6638</span>
<span id="L6639" rel="#L6639">6639</span>
<span id="L6640" rel="#L6640">6640</span>
<span id="L6641" rel="#L6641">6641</span>
<span id="L6642" rel="#L6642">6642</span>
<span id="L6643" rel="#L6643">6643</span>
<span id="L6644" rel="#L6644">6644</span>
<span id="L6645" rel="#L6645">6645</span>
<span id="L6646" rel="#L6646">6646</span>
<span id="L6647" rel="#L6647">6647</span>
<span id="L6648" rel="#L6648">6648</span>
<span id="L6649" rel="#L6649">6649</span>
<span id="L6650" rel="#L6650">6650</span>
<span id="L6651" rel="#L6651">6651</span>
<span id="L6652" rel="#L6652">6652</span>
<span id="L6653" rel="#L6653">6653</span>
<span id="L6654" rel="#L6654">6654</span>
<span id="L6655" rel="#L6655">6655</span>
<span id="L6656" rel="#L6656">6656</span>
<span id="L6657" rel="#L6657">6657</span>
<span id="L6658" rel="#L6658">6658</span>
<span id="L6659" rel="#L6659">6659</span>
<span id="L6660" rel="#L6660">6660</span>
<span id="L6661" rel="#L6661">6661</span>
<span id="L6662" rel="#L6662">6662</span>
<span id="L6663" rel="#L6663">6663</span>
<span id="L6664" rel="#L6664">6664</span>
<span id="L6665" rel="#L6665">6665</span>
<span id="L6666" rel="#L6666">6666</span>
<span id="L6667" rel="#L6667">6667</span>
<span id="L6668" rel="#L6668">6668</span>
<span id="L6669" rel="#L6669">6669</span>
<span id="L6670" rel="#L6670">6670</span>
<span id="L6671" rel="#L6671">6671</span>
<span id="L6672" rel="#L6672">6672</span>
<span id="L6673" rel="#L6673">6673</span>
<span id="L6674" rel="#L6674">6674</span>
<span id="L6675" rel="#L6675">6675</span>
<span id="L6676" rel="#L6676">6676</span>
<span id="L6677" rel="#L6677">6677</span>
<span id="L6678" rel="#L6678">6678</span>
<span id="L6679" rel="#L6679">6679</span>
<span id="L6680" rel="#L6680">6680</span>
<span id="L6681" rel="#L6681">6681</span>
<span id="L6682" rel="#L6682">6682</span>
<span id="L6683" rel="#L6683">6683</span>
<span id="L6684" rel="#L6684">6684</span>
<span id="L6685" rel="#L6685">6685</span>
<span id="L6686" rel="#L6686">6686</span>
<span id="L6687" rel="#L6687">6687</span>
<span id="L6688" rel="#L6688">6688</span>
<span id="L6689" rel="#L6689">6689</span>
<span id="L6690" rel="#L6690">6690</span>
<span id="L6691" rel="#L6691">6691</span>
<span id="L6692" rel="#L6692">6692</span>
<span id="L6693" rel="#L6693">6693</span>
<span id="L6694" rel="#L6694">6694</span>
<span id="L6695" rel="#L6695">6695</span>
<span id="L6696" rel="#L6696">6696</span>
<span id="L6697" rel="#L6697">6697</span>
<span id="L6698" rel="#L6698">6698</span>
<span id="L6699" rel="#L6699">6699</span>
<span id="L6700" rel="#L6700">6700</span>
<span id="L6701" rel="#L6701">6701</span>
<span id="L6702" rel="#L6702">6702</span>
<span id="L6703" rel="#L6703">6703</span>
<span id="L6704" rel="#L6704">6704</span>
<span id="L6705" rel="#L6705">6705</span>
<span id="L6706" rel="#L6706">6706</span>
<span id="L6707" rel="#L6707">6707</span>
<span id="L6708" rel="#L6708">6708</span>
<span id="L6709" rel="#L6709">6709</span>
<span id="L6710" rel="#L6710">6710</span>
<span id="L6711" rel="#L6711">6711</span>
<span id="L6712" rel="#L6712">6712</span>
<span id="L6713" rel="#L6713">6713</span>
<span id="L6714" rel="#L6714">6714</span>
<span id="L6715" rel="#L6715">6715</span>
<span id="L6716" rel="#L6716">6716</span>
<span id="L6717" rel="#L6717">6717</span>
<span id="L6718" rel="#L6718">6718</span>
<span id="L6719" rel="#L6719">6719</span>
<span id="L6720" rel="#L6720">6720</span>
<span id="L6721" rel="#L6721">6721</span>
<span id="L6722" rel="#L6722">6722</span>
<span id="L6723" rel="#L6723">6723</span>
<span id="L6724" rel="#L6724">6724</span>
<span id="L6725" rel="#L6725">6725</span>
<span id="L6726" rel="#L6726">6726</span>
<span id="L6727" rel="#L6727">6727</span>
<span id="L6728" rel="#L6728">6728</span>
<span id="L6729" rel="#L6729">6729</span>
<span id="L6730" rel="#L6730">6730</span>
<span id="L6731" rel="#L6731">6731</span>
<span id="L6732" rel="#L6732">6732</span>
<span id="L6733" rel="#L6733">6733</span>
<span id="L6734" rel="#L6734">6734</span>
<span id="L6735" rel="#L6735">6735</span>
<span id="L6736" rel="#L6736">6736</span>
<span id="L6737" rel="#L6737">6737</span>
<span id="L6738" rel="#L6738">6738</span>
<span id="L6739" rel="#L6739">6739</span>
<span id="L6740" rel="#L6740">6740</span>
<span id="L6741" rel="#L6741">6741</span>
<span id="L6742" rel="#L6742">6742</span>
<span id="L6743" rel="#L6743">6743</span>
<span id="L6744" rel="#L6744">6744</span>
<span id="L6745" rel="#L6745">6745</span>
<span id="L6746" rel="#L6746">6746</span>
<span id="L6747" rel="#L6747">6747</span>
<span id="L6748" rel="#L6748">6748</span>
<span id="L6749" rel="#L6749">6749</span>
<span id="L6750" rel="#L6750">6750</span>
<span id="L6751" rel="#L6751">6751</span>
<span id="L6752" rel="#L6752">6752</span>
<span id="L6753" rel="#L6753">6753</span>
<span id="L6754" rel="#L6754">6754</span>
<span id="L6755" rel="#L6755">6755</span>
<span id="L6756" rel="#L6756">6756</span>
<span id="L6757" rel="#L6757">6757</span>
<span id="L6758" rel="#L6758">6758</span>
<span id="L6759" rel="#L6759">6759</span>
<span id="L6760" rel="#L6760">6760</span>
<span id="L6761" rel="#L6761">6761</span>
<span id="L6762" rel="#L6762">6762</span>
<span id="L6763" rel="#L6763">6763</span>
<span id="L6764" rel="#L6764">6764</span>
<span id="L6765" rel="#L6765">6765</span>
<span id="L6766" rel="#L6766">6766</span>
<span id="L6767" rel="#L6767">6767</span>
<span id="L6768" rel="#L6768">6768</span>
<span id="L6769" rel="#L6769">6769</span>
<span id="L6770" rel="#L6770">6770</span>
<span id="L6771" rel="#L6771">6771</span>
<span id="L6772" rel="#L6772">6772</span>
<span id="L6773" rel="#L6773">6773</span>
<span id="L6774" rel="#L6774">6774</span>
<span id="L6775" rel="#L6775">6775</span>
<span id="L6776" rel="#L6776">6776</span>
<span id="L6777" rel="#L6777">6777</span>
<span id="L6778" rel="#L6778">6778</span>
<span id="L6779" rel="#L6779">6779</span>
<span id="L6780" rel="#L6780">6780</span>
<span id="L6781" rel="#L6781">6781</span>
<span id="L6782" rel="#L6782">6782</span>
<span id="L6783" rel="#L6783">6783</span>
<span id="L6784" rel="#L6784">6784</span>
<span id="L6785" rel="#L6785">6785</span>
<span id="L6786" rel="#L6786">6786</span>
<span id="L6787" rel="#L6787">6787</span>
<span id="L6788" rel="#L6788">6788</span>
<span id="L6789" rel="#L6789">6789</span>
<span id="L6790" rel="#L6790">6790</span>
<span id="L6791" rel="#L6791">6791</span>
<span id="L6792" rel="#L6792">6792</span>
<span id="L6793" rel="#L6793">6793</span>
<span id="L6794" rel="#L6794">6794</span>
<span id="L6795" rel="#L6795">6795</span>
<span id="L6796" rel="#L6796">6796</span>
<span id="L6797" rel="#L6797">6797</span>
<span id="L6798" rel="#L6798">6798</span>
<span id="L6799" rel="#L6799">6799</span>
<span id="L6800" rel="#L6800">6800</span>
<span id="L6801" rel="#L6801">6801</span>
<span id="L6802" rel="#L6802">6802</span>
<span id="L6803" rel="#L6803">6803</span>
<span id="L6804" rel="#L6804">6804</span>
<span id="L6805" rel="#L6805">6805</span>
<span id="L6806" rel="#L6806">6806</span>
<span id="L6807" rel="#L6807">6807</span>
<span id="L6808" rel="#L6808">6808</span>
<span id="L6809" rel="#L6809">6809</span>
<span id="L6810" rel="#L6810">6810</span>
<span id="L6811" rel="#L6811">6811</span>
<span id="L6812" rel="#L6812">6812</span>
<span id="L6813" rel="#L6813">6813</span>
<span id="L6814" rel="#L6814">6814</span>
<span id="L6815" rel="#L6815">6815</span>
<span id="L6816" rel="#L6816">6816</span>
<span id="L6817" rel="#L6817">6817</span>
<span id="L6818" rel="#L6818">6818</span>
<span id="L6819" rel="#L6819">6819</span>
<span id="L6820" rel="#L6820">6820</span>
<span id="L6821" rel="#L6821">6821</span>
<span id="L6822" rel="#L6822">6822</span>
<span id="L6823" rel="#L6823">6823</span>
<span id="L6824" rel="#L6824">6824</span>
<span id="L6825" rel="#L6825">6825</span>
<span id="L6826" rel="#L6826">6826</span>
<span id="L6827" rel="#L6827">6827</span>
<span id="L6828" rel="#L6828">6828</span>
<span id="L6829" rel="#L6829">6829</span>
<span id="L6830" rel="#L6830">6830</span>
<span id="L6831" rel="#L6831">6831</span>
<span id="L6832" rel="#L6832">6832</span>
<span id="L6833" rel="#L6833">6833</span>
<span id="L6834" rel="#L6834">6834</span>
<span id="L6835" rel="#L6835">6835</span>
<span id="L6836" rel="#L6836">6836</span>
<span id="L6837" rel="#L6837">6837</span>
<span id="L6838" rel="#L6838">6838</span>
<span id="L6839" rel="#L6839">6839</span>
<span id="L6840" rel="#L6840">6840</span>
<span id="L6841" rel="#L6841">6841</span>
<span id="L6842" rel="#L6842">6842</span>
<span id="L6843" rel="#L6843">6843</span>
<span id="L6844" rel="#L6844">6844</span>
<span id="L6845" rel="#L6845">6845</span>
<span id="L6846" rel="#L6846">6846</span>
<span id="L6847" rel="#L6847">6847</span>
<span id="L6848" rel="#L6848">6848</span>
<span id="L6849" rel="#L6849">6849</span>
<span id="L6850" rel="#L6850">6850</span>
<span id="L6851" rel="#L6851">6851</span>
<span id="L6852" rel="#L6852">6852</span>
<span id="L6853" rel="#L6853">6853</span>
<span id="L6854" rel="#L6854">6854</span>
<span id="L6855" rel="#L6855">6855</span>
<span id="L6856" rel="#L6856">6856</span>
<span id="L6857" rel="#L6857">6857</span>
<span id="L6858" rel="#L6858">6858</span>
<span id="L6859" rel="#L6859">6859</span>
<span id="L6860" rel="#L6860">6860</span>
<span id="L6861" rel="#L6861">6861</span>
<span id="L6862" rel="#L6862">6862</span>
<span id="L6863" rel="#L6863">6863</span>
<span id="L6864" rel="#L6864">6864</span>
<span id="L6865" rel="#L6865">6865</span>
<span id="L6866" rel="#L6866">6866</span>
<span id="L6867" rel="#L6867">6867</span>
<span id="L6868" rel="#L6868">6868</span>
<span id="L6869" rel="#L6869">6869</span>
<span id="L6870" rel="#L6870">6870</span>
<span id="L6871" rel="#L6871">6871</span>
<span id="L6872" rel="#L6872">6872</span>
<span id="L6873" rel="#L6873">6873</span>
<span id="L6874" rel="#L6874">6874</span>
<span id="L6875" rel="#L6875">6875</span>
<span id="L6876" rel="#L6876">6876</span>
<span id="L6877" rel="#L6877">6877</span>
<span id="L6878" rel="#L6878">6878</span>
<span id="L6879" rel="#L6879">6879</span>
<span id="L6880" rel="#L6880">6880</span>
<span id="L6881" rel="#L6881">6881</span>
<span id="L6882" rel="#L6882">6882</span>
<span id="L6883" rel="#L6883">6883</span>
<span id="L6884" rel="#L6884">6884</span>
<span id="L6885" rel="#L6885">6885</span>
<span id="L6886" rel="#L6886">6886</span>
<span id="L6887" rel="#L6887">6887</span>
<span id="L6888" rel="#L6888">6888</span>
<span id="L6889" rel="#L6889">6889</span>
<span id="L6890" rel="#L6890">6890</span>
<span id="L6891" rel="#L6891">6891</span>
<span id="L6892" rel="#L6892">6892</span>
<span id="L6893" rel="#L6893">6893</span>
<span id="L6894" rel="#L6894">6894</span>
<span id="L6895" rel="#L6895">6895</span>
<span id="L6896" rel="#L6896">6896</span>
<span id="L6897" rel="#L6897">6897</span>
<span id="L6898" rel="#L6898">6898</span>
<span id="L6899" rel="#L6899">6899</span>
<span id="L6900" rel="#L6900">6900</span>
<span id="L6901" rel="#L6901">6901</span>
<span id="L6902" rel="#L6902">6902</span>
<span id="L6903" rel="#L6903">6903</span>
<span id="L6904" rel="#L6904">6904</span>
<span id="L6905" rel="#L6905">6905</span>
<span id="L6906" rel="#L6906">6906</span>
<span id="L6907" rel="#L6907">6907</span>
<span id="L6908" rel="#L6908">6908</span>
<span id="L6909" rel="#L6909">6909</span>
<span id="L6910" rel="#L6910">6910</span>
<span id="L6911" rel="#L6911">6911</span>
<span id="L6912" rel="#L6912">6912</span>
<span id="L6913" rel="#L6913">6913</span>
<span id="L6914" rel="#L6914">6914</span>
<span id="L6915" rel="#L6915">6915</span>
<span id="L6916" rel="#L6916">6916</span>
<span id="L6917" rel="#L6917">6917</span>
<span id="L6918" rel="#L6918">6918</span>
<span id="L6919" rel="#L6919">6919</span>
<span id="L6920" rel="#L6920">6920</span>
<span id="L6921" rel="#L6921">6921</span>
<span id="L6922" rel="#L6922">6922</span>
<span id="L6923" rel="#L6923">6923</span>
<span id="L6924" rel="#L6924">6924</span>
<span id="L6925" rel="#L6925">6925</span>
<span id="L6926" rel="#L6926">6926</span>
<span id="L6927" rel="#L6927">6927</span>
<span id="L6928" rel="#L6928">6928</span>
<span id="L6929" rel="#L6929">6929</span>
<span id="L6930" rel="#L6930">6930</span>
<span id="L6931" rel="#L6931">6931</span>
<span id="L6932" rel="#L6932">6932</span>
<span id="L6933" rel="#L6933">6933</span>
<span id="L6934" rel="#L6934">6934</span>
<span id="L6935" rel="#L6935">6935</span>
<span id="L6936" rel="#L6936">6936</span>
<span id="L6937" rel="#L6937">6937</span>
<span id="L6938" rel="#L6938">6938</span>
<span id="L6939" rel="#L6939">6939</span>
<span id="L6940" rel="#L6940">6940</span>
<span id="L6941" rel="#L6941">6941</span>
<span id="L6942" rel="#L6942">6942</span>
<span id="L6943" rel="#L6943">6943</span>
<span id="L6944" rel="#L6944">6944</span>
<span id="L6945" rel="#L6945">6945</span>
<span id="L6946" rel="#L6946">6946</span>
<span id="L6947" rel="#L6947">6947</span>
<span id="L6948" rel="#L6948">6948</span>
<span id="L6949" rel="#L6949">6949</span>
<span id="L6950" rel="#L6950">6950</span>
<span id="L6951" rel="#L6951">6951</span>
<span id="L6952" rel="#L6952">6952</span>
<span id="L6953" rel="#L6953">6953</span>
<span id="L6954" rel="#L6954">6954</span>
<span id="L6955" rel="#L6955">6955</span>
<span id="L6956" rel="#L6956">6956</span>
<span id="L6957" rel="#L6957">6957</span>
<span id="L6958" rel="#L6958">6958</span>
<span id="L6959" rel="#L6959">6959</span>
<span id="L6960" rel="#L6960">6960</span>
<span id="L6961" rel="#L6961">6961</span>
<span id="L6962" rel="#L6962">6962</span>
<span id="L6963" rel="#L6963">6963</span>
<span id="L6964" rel="#L6964">6964</span>
<span id="L6965" rel="#L6965">6965</span>
<span id="L6966" rel="#L6966">6966</span>
<span id="L6967" rel="#L6967">6967</span>
<span id="L6968" rel="#L6968">6968</span>
<span id="L6969" rel="#L6969">6969</span>
<span id="L6970" rel="#L6970">6970</span>
<span id="L6971" rel="#L6971">6971</span>
<span id="L6972" rel="#L6972">6972</span>
<span id="L6973" rel="#L6973">6973</span>
<span id="L6974" rel="#L6974">6974</span>
<span id="L6975" rel="#L6975">6975</span>
<span id="L6976" rel="#L6976">6976</span>
<span id="L6977" rel="#L6977">6977</span>
<span id="L6978" rel="#L6978">6978</span>
<span id="L6979" rel="#L6979">6979</span>
<span id="L6980" rel="#L6980">6980</span>
<span id="L6981" rel="#L6981">6981</span>
<span id="L6982" rel="#L6982">6982</span>
<span id="L6983" rel="#L6983">6983</span>
<span id="L6984" rel="#L6984">6984</span>
<span id="L6985" rel="#L6985">6985</span>
<span id="L6986" rel="#L6986">6986</span>
<span id="L6987" rel="#L6987">6987</span>
<span id="L6988" rel="#L6988">6988</span>
<span id="L6989" rel="#L6989">6989</span>
<span id="L6990" rel="#L6990">6990</span>
<span id="L6991" rel="#L6991">6991</span>
<span id="L6992" rel="#L6992">6992</span>
<span id="L6993" rel="#L6993">6993</span>
<span id="L6994" rel="#L6994">6994</span>
<span id="L6995" rel="#L6995">6995</span>
<span id="L6996" rel="#L6996">6996</span>
<span id="L6997" rel="#L6997">6997</span>
<span id="L6998" rel="#L6998">6998</span>
<span id="L6999" rel="#L6999">6999</span>
<span id="L7000" rel="#L7000">7000</span>
<span id="L7001" rel="#L7001">7001</span>
<span id="L7002" rel="#L7002">7002</span>
<span id="L7003" rel="#L7003">7003</span>
<span id="L7004" rel="#L7004">7004</span>
<span id="L7005" rel="#L7005">7005</span>
<span id="L7006" rel="#L7006">7006</span>
<span id="L7007" rel="#L7007">7007</span>
<span id="L7008" rel="#L7008">7008</span>
<span id="L7009" rel="#L7009">7009</span>
<span id="L7010" rel="#L7010">7010</span>
<span id="L7011" rel="#L7011">7011</span>
<span id="L7012" rel="#L7012">7012</span>
<span id="L7013" rel="#L7013">7013</span>
<span id="L7014" rel="#L7014">7014</span>
<span id="L7015" rel="#L7015">7015</span>
<span id="L7016" rel="#L7016">7016</span>
<span id="L7017" rel="#L7017">7017</span>
<span id="L7018" rel="#L7018">7018</span>
<span id="L7019" rel="#L7019">7019</span>
<span id="L7020" rel="#L7020">7020</span>
<span id="L7021" rel="#L7021">7021</span>
<span id="L7022" rel="#L7022">7022</span>
<span id="L7023" rel="#L7023">7023</span>
<span id="L7024" rel="#L7024">7024</span>
<span id="L7025" rel="#L7025">7025</span>
<span id="L7026" rel="#L7026">7026</span>
<span id="L7027" rel="#L7027">7027</span>
<span id="L7028" rel="#L7028">7028</span>
<span id="L7029" rel="#L7029">7029</span>
<span id="L7030" rel="#L7030">7030</span>
<span id="L7031" rel="#L7031">7031</span>
<span id="L7032" rel="#L7032">7032</span>
<span id="L7033" rel="#L7033">7033</span>
<span id="L7034" rel="#L7034">7034</span>
<span id="L7035" rel="#L7035">7035</span>
<span id="L7036" rel="#L7036">7036</span>
<span id="L7037" rel="#L7037">7037</span>
<span id="L7038" rel="#L7038">7038</span>
<span id="L7039" rel="#L7039">7039</span>
<span id="L7040" rel="#L7040">7040</span>
<span id="L7041" rel="#L7041">7041</span>
<span id="L7042" rel="#L7042">7042</span>
<span id="L7043" rel="#L7043">7043</span>
<span id="L7044" rel="#L7044">7044</span>
<span id="L7045" rel="#L7045">7045</span>
<span id="L7046" rel="#L7046">7046</span>
<span id="L7047" rel="#L7047">7047</span>
<span id="L7048" rel="#L7048">7048</span>
<span id="L7049" rel="#L7049">7049</span>
<span id="L7050" rel="#L7050">7050</span>
<span id="L7051" rel="#L7051">7051</span>
<span id="L7052" rel="#L7052">7052</span>
<span id="L7053" rel="#L7053">7053</span>
<span id="L7054" rel="#L7054">7054</span>
<span id="L7055" rel="#L7055">7055</span>
<span id="L7056" rel="#L7056">7056</span>
<span id="L7057" rel="#L7057">7057</span>
<span id="L7058" rel="#L7058">7058</span>
<span id="L7059" rel="#L7059">7059</span>
<span id="L7060" rel="#L7060">7060</span>
<span id="L7061" rel="#L7061">7061</span>
<span id="L7062" rel="#L7062">7062</span>
<span id="L7063" rel="#L7063">7063</span>
<span id="L7064" rel="#L7064">7064</span>
<span id="L7065" rel="#L7065">7065</span>
<span id="L7066" rel="#L7066">7066</span>
<span id="L7067" rel="#L7067">7067</span>
<span id="L7068" rel="#L7068">7068</span>
<span id="L7069" rel="#L7069">7069</span>
<span id="L7070" rel="#L7070">7070</span>
<span id="L7071" rel="#L7071">7071</span>
<span id="L7072" rel="#L7072">7072</span>
<span id="L7073" rel="#L7073">7073</span>
<span id="L7074" rel="#L7074">7074</span>
<span id="L7075" rel="#L7075">7075</span>
<span id="L7076" rel="#L7076">7076</span>
<span id="L7077" rel="#L7077">7077</span>
<span id="L7078" rel="#L7078">7078</span>
<span id="L7079" rel="#L7079">7079</span>
<span id="L7080" rel="#L7080">7080</span>
<span id="L7081" rel="#L7081">7081</span>
<span id="L7082" rel="#L7082">7082</span>
<span id="L7083" rel="#L7083">7083</span>
<span id="L7084" rel="#L7084">7084</span>
<span id="L7085" rel="#L7085">7085</span>
<span id="L7086" rel="#L7086">7086</span>
<span id="L7087" rel="#L7087">7087</span>
<span id="L7088" rel="#L7088">7088</span>
<span id="L7089" rel="#L7089">7089</span>
<span id="L7090" rel="#L7090">7090</span>
<span id="L7091" rel="#L7091">7091</span>
<span id="L7092" rel="#L7092">7092</span>
<span id="L7093" rel="#L7093">7093</span>
<span id="L7094" rel="#L7094">7094</span>
<span id="L7095" rel="#L7095">7095</span>
<span id="L7096" rel="#L7096">7096</span>
<span id="L7097" rel="#L7097">7097</span>
<span id="L7098" rel="#L7098">7098</span>
<span id="L7099" rel="#L7099">7099</span>
<span id="L7100" rel="#L7100">7100</span>
<span id="L7101" rel="#L7101">7101</span>
<span id="L7102" rel="#L7102">7102</span>
<span id="L7103" rel="#L7103">7103</span>
<span id="L7104" rel="#L7104">7104</span>
<span id="L7105" rel="#L7105">7105</span>
<span id="L7106" rel="#L7106">7106</span>
<span id="L7107" rel="#L7107">7107</span>
<span id="L7108" rel="#L7108">7108</span>
<span id="L7109" rel="#L7109">7109</span>
<span id="L7110" rel="#L7110">7110</span>
<span id="L7111" rel="#L7111">7111</span>
<span id="L7112" rel="#L7112">7112</span>
<span id="L7113" rel="#L7113">7113</span>
<span id="L7114" rel="#L7114">7114</span>
<span id="L7115" rel="#L7115">7115</span>
<span id="L7116" rel="#L7116">7116</span>
<span id="L7117" rel="#L7117">7117</span>
<span id="L7118" rel="#L7118">7118</span>
<span id="L7119" rel="#L7119">7119</span>
<span id="L7120" rel="#L7120">7120</span>
<span id="L7121" rel="#L7121">7121</span>
<span id="L7122" rel="#L7122">7122</span>
<span id="L7123" rel="#L7123">7123</span>
<span id="L7124" rel="#L7124">7124</span>
<span id="L7125" rel="#L7125">7125</span>
<span id="L7126" rel="#L7126">7126</span>
<span id="L7127" rel="#L7127">7127</span>
<span id="L7128" rel="#L7128">7128</span>
<span id="L7129" rel="#L7129">7129</span>
<span id="L7130" rel="#L7130">7130</span>
<span id="L7131" rel="#L7131">7131</span>
<span id="L7132" rel="#L7132">7132</span>
<span id="L7133" rel="#L7133">7133</span>
<span id="L7134" rel="#L7134">7134</span>
<span id="L7135" rel="#L7135">7135</span>
<span id="L7136" rel="#L7136">7136</span>
<span id="L7137" rel="#L7137">7137</span>
<span id="L7138" rel="#L7138">7138</span>
<span id="L7139" rel="#L7139">7139</span>
<span id="L7140" rel="#L7140">7140</span>
<span id="L7141" rel="#L7141">7141</span>
<span id="L7142" rel="#L7142">7142</span>
<span id="L7143" rel="#L7143">7143</span>
<span id="L7144" rel="#L7144">7144</span>
<span id="L7145" rel="#L7145">7145</span>
<span id="L7146" rel="#L7146">7146</span>
<span id="L7147" rel="#L7147">7147</span>
<span id="L7148" rel="#L7148">7148</span>
<span id="L7149" rel="#L7149">7149</span>
<span id="L7150" rel="#L7150">7150</span>
<span id="L7151" rel="#L7151">7151</span>
<span id="L7152" rel="#L7152">7152</span>
<span id="L7153" rel="#L7153">7153</span>
<span id="L7154" rel="#L7154">7154</span>
<span id="L7155" rel="#L7155">7155</span>
<span id="L7156" rel="#L7156">7156</span>
<span id="L7157" rel="#L7157">7157</span>
<span id="L7158" rel="#L7158">7158</span>
<span id="L7159" rel="#L7159">7159</span>
<span id="L7160" rel="#L7160">7160</span>
<span id="L7161" rel="#L7161">7161</span>
<span id="L7162" rel="#L7162">7162</span>
<span id="L7163" rel="#L7163">7163</span>
<span id="L7164" rel="#L7164">7164</span>
<span id="L7165" rel="#L7165">7165</span>
<span id="L7166" rel="#L7166">7166</span>
<span id="L7167" rel="#L7167">7167</span>
<span id="L7168" rel="#L7168">7168</span>
<span id="L7169" rel="#L7169">7169</span>
<span id="L7170" rel="#L7170">7170</span>
<span id="L7171" rel="#L7171">7171</span>
<span id="L7172" rel="#L7172">7172</span>
<span id="L7173" rel="#L7173">7173</span>
<span id="L7174" rel="#L7174">7174</span>
<span id="L7175" rel="#L7175">7175</span>
<span id="L7176" rel="#L7176">7176</span>
<span id="L7177" rel="#L7177">7177</span>
<span id="L7178" rel="#L7178">7178</span>
<span id="L7179" rel="#L7179">7179</span>
<span id="L7180" rel="#L7180">7180</span>
<span id="L7181" rel="#L7181">7181</span>
<span id="L7182" rel="#L7182">7182</span>
<span id="L7183" rel="#L7183">7183</span>
<span id="L7184" rel="#L7184">7184</span>
<span id="L7185" rel="#L7185">7185</span>
<span id="L7186" rel="#L7186">7186</span>
<span id="L7187" rel="#L7187">7187</span>
<span id="L7188" rel="#L7188">7188</span>
<span id="L7189" rel="#L7189">7189</span>
<span id="L7190" rel="#L7190">7190</span>
<span id="L7191" rel="#L7191">7191</span>
<span id="L7192" rel="#L7192">7192</span>
<span id="L7193" rel="#L7193">7193</span>
<span id="L7194" rel="#L7194">7194</span>
<span id="L7195" rel="#L7195">7195</span>
<span id="L7196" rel="#L7196">7196</span>
<span id="L7197" rel="#L7197">7197</span>
<span id="L7198" rel="#L7198">7198</span>
<span id="L7199" rel="#L7199">7199</span>
<span id="L7200" rel="#L7200">7200</span>
<span id="L7201" rel="#L7201">7201</span>
<span id="L7202" rel="#L7202">7202</span>
<span id="L7203" rel="#L7203">7203</span>
<span id="L7204" rel="#L7204">7204</span>
<span id="L7205" rel="#L7205">7205</span>
<span id="L7206" rel="#L7206">7206</span>
<span id="L7207" rel="#L7207">7207</span>
<span id="L7208" rel="#L7208">7208</span>
<span id="L7209" rel="#L7209">7209</span>
<span id="L7210" rel="#L7210">7210</span>
<span id="L7211" rel="#L7211">7211</span>
<span id="L7212" rel="#L7212">7212</span>
<span id="L7213" rel="#L7213">7213</span>
<span id="L7214" rel="#L7214">7214</span>
<span id="L7215" rel="#L7215">7215</span>
<span id="L7216" rel="#L7216">7216</span>
<span id="L7217" rel="#L7217">7217</span>
<span id="L7218" rel="#L7218">7218</span>
<span id="L7219" rel="#L7219">7219</span>
<span id="L7220" rel="#L7220">7220</span>
<span id="L7221" rel="#L7221">7221</span>
<span id="L7222" rel="#L7222">7222</span>
<span id="L7223" rel="#L7223">7223</span>
<span id="L7224" rel="#L7224">7224</span>
<span id="L7225" rel="#L7225">7225</span>
<span id="L7226" rel="#L7226">7226</span>
<span id="L7227" rel="#L7227">7227</span>
<span id="L7228" rel="#L7228">7228</span>
<span id="L7229" rel="#L7229">7229</span>
<span id="L7230" rel="#L7230">7230</span>
<span id="L7231" rel="#L7231">7231</span>
<span id="L7232" rel="#L7232">7232</span>
<span id="L7233" rel="#L7233">7233</span>
<span id="L7234" rel="#L7234">7234</span>
<span id="L7235" rel="#L7235">7235</span>
<span id="L7236" rel="#L7236">7236</span>
<span id="L7237" rel="#L7237">7237</span>
<span id="L7238" rel="#L7238">7238</span>
<span id="L7239" rel="#L7239">7239</span>
<span id="L7240" rel="#L7240">7240</span>
<span id="L7241" rel="#L7241">7241</span>
<span id="L7242" rel="#L7242">7242</span>
<span id="L7243" rel="#L7243">7243</span>
<span id="L7244" rel="#L7244">7244</span>
<span id="L7245" rel="#L7245">7245</span>
<span id="L7246" rel="#L7246">7246</span>
<span id="L7247" rel="#L7247">7247</span>
<span id="L7248" rel="#L7248">7248</span>
<span id="L7249" rel="#L7249">7249</span>
<span id="L7250" rel="#L7250">7250</span>
<span id="L7251" rel="#L7251">7251</span>
<span id="L7252" rel="#L7252">7252</span>
<span id="L7253" rel="#L7253">7253</span>
<span id="L7254" rel="#L7254">7254</span>
<span id="L7255" rel="#L7255">7255</span>
<span id="L7256" rel="#L7256">7256</span>
<span id="L7257" rel="#L7257">7257</span>
<span id="L7258" rel="#L7258">7258</span>
<span id="L7259" rel="#L7259">7259</span>
<span id="L7260" rel="#L7260">7260</span>
<span id="L7261" rel="#L7261">7261</span>
<span id="L7262" rel="#L7262">7262</span>
<span id="L7263" rel="#L7263">7263</span>
<span id="L7264" rel="#L7264">7264</span>
<span id="L7265" rel="#L7265">7265</span>
<span id="L7266" rel="#L7266">7266</span>
<span id="L7267" rel="#L7267">7267</span>
<span id="L7268" rel="#L7268">7268</span>
<span id="L7269" rel="#L7269">7269</span>
<span id="L7270" rel="#L7270">7270</span>
<span id="L7271" rel="#L7271">7271</span>
<span id="L7272" rel="#L7272">7272</span>
<span id="L7273" rel="#L7273">7273</span>
<span id="L7274" rel="#L7274">7274</span>
<span id="L7275" rel="#L7275">7275</span>
<span id="L7276" rel="#L7276">7276</span>
<span id="L7277" rel="#L7277">7277</span>
<span id="L7278" rel="#L7278">7278</span>
<span id="L7279" rel="#L7279">7279</span>
<span id="L7280" rel="#L7280">7280</span>
<span id="L7281" rel="#L7281">7281</span>
<span id="L7282" rel="#L7282">7282</span>
<span id="L7283" rel="#L7283">7283</span>
<span id="L7284" rel="#L7284">7284</span>
<span id="L7285" rel="#L7285">7285</span>
<span id="L7286" rel="#L7286">7286</span>
<span id="L7287" rel="#L7287">7287</span>
<span id="L7288" rel="#L7288">7288</span>
<span id="L7289" rel="#L7289">7289</span>
<span id="L7290" rel="#L7290">7290</span>
<span id="L7291" rel="#L7291">7291</span>
<span id="L7292" rel="#L7292">7292</span>
<span id="L7293" rel="#L7293">7293</span>
<span id="L7294" rel="#L7294">7294</span>
<span id="L7295" rel="#L7295">7295</span>
<span id="L7296" rel="#L7296">7296</span>
<span id="L7297" rel="#L7297">7297</span>
<span id="L7298" rel="#L7298">7298</span>
<span id="L7299" rel="#L7299">7299</span>
<span id="L7300" rel="#L7300">7300</span>
<span id="L7301" rel="#L7301">7301</span>
<span id="L7302" rel="#L7302">7302</span>
<span id="L7303" rel="#L7303">7303</span>
<span id="L7304" rel="#L7304">7304</span>
<span id="L7305" rel="#L7305">7305</span>
<span id="L7306" rel="#L7306">7306</span>
<span id="L7307" rel="#L7307">7307</span>
<span id="L7308" rel="#L7308">7308</span>
<span id="L7309" rel="#L7309">7309</span>
<span id="L7310" rel="#L7310">7310</span>
<span id="L7311" rel="#L7311">7311</span>
<span id="L7312" rel="#L7312">7312</span>
<span id="L7313" rel="#L7313">7313</span>
<span id="L7314" rel="#L7314">7314</span>
<span id="L7315" rel="#L7315">7315</span>
<span id="L7316" rel="#L7316">7316</span>
<span id="L7317" rel="#L7317">7317</span>
<span id="L7318" rel="#L7318">7318</span>
<span id="L7319" rel="#L7319">7319</span>
<span id="L7320" rel="#L7320">7320</span>
<span id="L7321" rel="#L7321">7321</span>
<span id="L7322" rel="#L7322">7322</span>
<span id="L7323" rel="#L7323">7323</span>
<span id="L7324" rel="#L7324">7324</span>
<span id="L7325" rel="#L7325">7325</span>
<span id="L7326" rel="#L7326">7326</span>
<span id="L7327" rel="#L7327">7327</span>
<span id="L7328" rel="#L7328">7328</span>
<span id="L7329" rel="#L7329">7329</span>
<span id="L7330" rel="#L7330">7330</span>
<span id="L7331" rel="#L7331">7331</span>
<span id="L7332" rel="#L7332">7332</span>
<span id="L7333" rel="#L7333">7333</span>
<span id="L7334" rel="#L7334">7334</span>
<span id="L7335" rel="#L7335">7335</span>
<span id="L7336" rel="#L7336">7336</span>
<span id="L7337" rel="#L7337">7337</span>
<span id="L7338" rel="#L7338">7338</span>
<span id="L7339" rel="#L7339">7339</span>
<span id="L7340" rel="#L7340">7340</span>
<span id="L7341" rel="#L7341">7341</span>
<span id="L7342" rel="#L7342">7342</span>
<span id="L7343" rel="#L7343">7343</span>
<span id="L7344" rel="#L7344">7344</span>
<span id="L7345" rel="#L7345">7345</span>
<span id="L7346" rel="#L7346">7346</span>
<span id="L7347" rel="#L7347">7347</span>
<span id="L7348" rel="#L7348">7348</span>
<span id="L7349" rel="#L7349">7349</span>
<span id="L7350" rel="#L7350">7350</span>
<span id="L7351" rel="#L7351">7351</span>
<span id="L7352" rel="#L7352">7352</span>
<span id="L7353" rel="#L7353">7353</span>
<span id="L7354" rel="#L7354">7354</span>
<span id="L7355" rel="#L7355">7355</span>
<span id="L7356" rel="#L7356">7356</span>
<span id="L7357" rel="#L7357">7357</span>
<span id="L7358" rel="#L7358">7358</span>
<span id="L7359" rel="#L7359">7359</span>
<span id="L7360" rel="#L7360">7360</span>
<span id="L7361" rel="#L7361">7361</span>
<span id="L7362" rel="#L7362">7362</span>
<span id="L7363" rel="#L7363">7363</span>
<span id="L7364" rel="#L7364">7364</span>
<span id="L7365" rel="#L7365">7365</span>
<span id="L7366" rel="#L7366">7366</span>
<span id="L7367" rel="#L7367">7367</span>
<span id="L7368" rel="#L7368">7368</span>
<span id="L7369" rel="#L7369">7369</span>
<span id="L7370" rel="#L7370">7370</span>
<span id="L7371" rel="#L7371">7371</span>
<span id="L7372" rel="#L7372">7372</span>
<span id="L7373" rel="#L7373">7373</span>
<span id="L7374" rel="#L7374">7374</span>
<span id="L7375" rel="#L7375">7375</span>
<span id="L7376" rel="#L7376">7376</span>
<span id="L7377" rel="#L7377">7377</span>
<span id="L7378" rel="#L7378">7378</span>
<span id="L7379" rel="#L7379">7379</span>
<span id="L7380" rel="#L7380">7380</span>
<span id="L7381" rel="#L7381">7381</span>
<span id="L7382" rel="#L7382">7382</span>
<span id="L7383" rel="#L7383">7383</span>
<span id="L7384" rel="#L7384">7384</span>
<span id="L7385" rel="#L7385">7385</span>
<span id="L7386" rel="#L7386">7386</span>
<span id="L7387" rel="#L7387">7387</span>
<span id="L7388" rel="#L7388">7388</span>
<span id="L7389" rel="#L7389">7389</span>
<span id="L7390" rel="#L7390">7390</span>
<span id="L7391" rel="#L7391">7391</span>
<span id="L7392" rel="#L7392">7392</span>
<span id="L7393" rel="#L7393">7393</span>
<span id="L7394" rel="#L7394">7394</span>
<span id="L7395" rel="#L7395">7395</span>
<span id="L7396" rel="#L7396">7396</span>
<span id="L7397" rel="#L7397">7397</span>
<span id="L7398" rel="#L7398">7398</span>
<span id="L7399" rel="#L7399">7399</span>
<span id="L7400" rel="#L7400">7400</span>
<span id="L7401" rel="#L7401">7401</span>
<span id="L7402" rel="#L7402">7402</span>
<span id="L7403" rel="#L7403">7403</span>
<span id="L7404" rel="#L7404">7404</span>
<span id="L7405" rel="#L7405">7405</span>
<span id="L7406" rel="#L7406">7406</span>
<span id="L7407" rel="#L7407">7407</span>
<span id="L7408" rel="#L7408">7408</span>
<span id="L7409" rel="#L7409">7409</span>
<span id="L7410" rel="#L7410">7410</span>
<span id="L7411" rel="#L7411">7411</span>
<span id="L7412" rel="#L7412">7412</span>
<span id="L7413" rel="#L7413">7413</span>
<span id="L7414" rel="#L7414">7414</span>
<span id="L7415" rel="#L7415">7415</span>
<span id="L7416" rel="#L7416">7416</span>
<span id="L7417" rel="#L7417">7417</span>
<span id="L7418" rel="#L7418">7418</span>
<span id="L7419" rel="#L7419">7419</span>
<span id="L7420" rel="#L7420">7420</span>
<span id="L7421" rel="#L7421">7421</span>
<span id="L7422" rel="#L7422">7422</span>
<span id="L7423" rel="#L7423">7423</span>
<span id="L7424" rel="#L7424">7424</span>
<span id="L7425" rel="#L7425">7425</span>
<span id="L7426" rel="#L7426">7426</span>
<span id="L7427" rel="#L7427">7427</span>
<span id="L7428" rel="#L7428">7428</span>
<span id="L7429" rel="#L7429">7429</span>
<span id="L7430" rel="#L7430">7430</span>
<span id="L7431" rel="#L7431">7431</span>
<span id="L7432" rel="#L7432">7432</span>
<span id="L7433" rel="#L7433">7433</span>
<span id="L7434" rel="#L7434">7434</span>
<span id="L7435" rel="#L7435">7435</span>
<span id="L7436" rel="#L7436">7436</span>
<span id="L7437" rel="#L7437">7437</span>
<span id="L7438" rel="#L7438">7438</span>
<span id="L7439" rel="#L7439">7439</span>
<span id="L7440" rel="#L7440">7440</span>
<span id="L7441" rel="#L7441">7441</span>
<span id="L7442" rel="#L7442">7442</span>
<span id="L7443" rel="#L7443">7443</span>
<span id="L7444" rel="#L7444">7444</span>
<span id="L7445" rel="#L7445">7445</span>
<span id="L7446" rel="#L7446">7446</span>
<span id="L7447" rel="#L7447">7447</span>
<span id="L7448" rel="#L7448">7448</span>
<span id="L7449" rel="#L7449">7449</span>
<span id="L7450" rel="#L7450">7450</span>
<span id="L7451" rel="#L7451">7451</span>
<span id="L7452" rel="#L7452">7452</span>
<span id="L7453" rel="#L7453">7453</span>
<span id="L7454" rel="#L7454">7454</span>
<span id="L7455" rel="#L7455">7455</span>
<span id="L7456" rel="#L7456">7456</span>
<span id="L7457" rel="#L7457">7457</span>
<span id="L7458" rel="#L7458">7458</span>
<span id="L7459" rel="#L7459">7459</span>
<span id="L7460" rel="#L7460">7460</span>
<span id="L7461" rel="#L7461">7461</span>
<span id="L7462" rel="#L7462">7462</span>
<span id="L7463" rel="#L7463">7463</span>
<span id="L7464" rel="#L7464">7464</span>
<span id="L7465" rel="#L7465">7465</span>
<span id="L7466" rel="#L7466">7466</span>
<span id="L7467" rel="#L7467">7467</span>
<span id="L7468" rel="#L7468">7468</span>
<span id="L7469" rel="#L7469">7469</span>
<span id="L7470" rel="#L7470">7470</span>
<span id="L7471" rel="#L7471">7471</span>
<span id="L7472" rel="#L7472">7472</span>
<span id="L7473" rel="#L7473">7473</span>
<span id="L7474" rel="#L7474">7474</span>
<span id="L7475" rel="#L7475">7475</span>
<span id="L7476" rel="#L7476">7476</span>
<span id="L7477" rel="#L7477">7477</span>
<span id="L7478" rel="#L7478">7478</span>
<span id="L7479" rel="#L7479">7479</span>
<span id="L7480" rel="#L7480">7480</span>
<span id="L7481" rel="#L7481">7481</span>
<span id="L7482" rel="#L7482">7482</span>
<span id="L7483" rel="#L7483">7483</span>
<span id="L7484" rel="#L7484">7484</span>
<span id="L7485" rel="#L7485">7485</span>
<span id="L7486" rel="#L7486">7486</span>
<span id="L7487" rel="#L7487">7487</span>
<span id="L7488" rel="#L7488">7488</span>
<span id="L7489" rel="#L7489">7489</span>
<span id="L7490" rel="#L7490">7490</span>
<span id="L7491" rel="#L7491">7491</span>
<span id="L7492" rel="#L7492">7492</span>
<span id="L7493" rel="#L7493">7493</span>
<span id="L7494" rel="#L7494">7494</span>
<span id="L7495" rel="#L7495">7495</span>
<span id="L7496" rel="#L7496">7496</span>
<span id="L7497" rel="#L7497">7497</span>
<span id="L7498" rel="#L7498">7498</span>
<span id="L7499" rel="#L7499">7499</span>
<span id="L7500" rel="#L7500">7500</span>
<span id="L7501" rel="#L7501">7501</span>
<span id="L7502" rel="#L7502">7502</span>
<span id="L7503" rel="#L7503">7503</span>
<span id="L7504" rel="#L7504">7504</span>
<span id="L7505" rel="#L7505">7505</span>
<span id="L7506" rel="#L7506">7506</span>
<span id="L7507" rel="#L7507">7507</span>
<span id="L7508" rel="#L7508">7508</span>
<span id="L7509" rel="#L7509">7509</span>
<span id="L7510" rel="#L7510">7510</span>
<span id="L7511" rel="#L7511">7511</span>
<span id="L7512" rel="#L7512">7512</span>
<span id="L7513" rel="#L7513">7513</span>
<span id="L7514" rel="#L7514">7514</span>
<span id="L7515" rel="#L7515">7515</span>
<span id="L7516" rel="#L7516">7516</span>
<span id="L7517" rel="#L7517">7517</span>
<span id="L7518" rel="#L7518">7518</span>
<span id="L7519" rel="#L7519">7519</span>
<span id="L7520" rel="#L7520">7520</span>
<span id="L7521" rel="#L7521">7521</span>
<span id="L7522" rel="#L7522">7522</span>
<span id="L7523" rel="#L7523">7523</span>
<span id="L7524" rel="#L7524">7524</span>
<span id="L7525" rel="#L7525">7525</span>
<span id="L7526" rel="#L7526">7526</span>
<span id="L7527" rel="#L7527">7527</span>
<span id="L7528" rel="#L7528">7528</span>
<span id="L7529" rel="#L7529">7529</span>
<span id="L7530" rel="#L7530">7530</span>
<span id="L7531" rel="#L7531">7531</span>
<span id="L7532" rel="#L7532">7532</span>
<span id="L7533" rel="#L7533">7533</span>
<span id="L7534" rel="#L7534">7534</span>
<span id="L7535" rel="#L7535">7535</span>
<span id="L7536" rel="#L7536">7536</span>
<span id="L7537" rel="#L7537">7537</span>
<span id="L7538" rel="#L7538">7538</span>
<span id="L7539" rel="#L7539">7539</span>
<span id="L7540" rel="#L7540">7540</span>
<span id="L7541" rel="#L7541">7541</span>
<span id="L7542" rel="#L7542">7542</span>
<span id="L7543" rel="#L7543">7543</span>
<span id="L7544" rel="#L7544">7544</span>
<span id="L7545" rel="#L7545">7545</span>
<span id="L7546" rel="#L7546">7546</span>
<span id="L7547" rel="#L7547">7547</span>
<span id="L7548" rel="#L7548">7548</span>
<span id="L7549" rel="#L7549">7549</span>
<span id="L7550" rel="#L7550">7550</span>
<span id="L7551" rel="#L7551">7551</span>
<span id="L7552" rel="#L7552">7552</span>
<span id="L7553" rel="#L7553">7553</span>
<span id="L7554" rel="#L7554">7554</span>
<span id="L7555" rel="#L7555">7555</span>
<span id="L7556" rel="#L7556">7556</span>
<span id="L7557" rel="#L7557">7557</span>
<span id="L7558" rel="#L7558">7558</span>
<span id="L7559" rel="#L7559">7559</span>
<span id="L7560" rel="#L7560">7560</span>
<span id="L7561" rel="#L7561">7561</span>
<span id="L7562" rel="#L7562">7562</span>
<span id="L7563" rel="#L7563">7563</span>
<span id="L7564" rel="#L7564">7564</span>
<span id="L7565" rel="#L7565">7565</span>
<span id="L7566" rel="#L7566">7566</span>
<span id="L7567" rel="#L7567">7567</span>
<span id="L7568" rel="#L7568">7568</span>
<span id="L7569" rel="#L7569">7569</span>
<span id="L7570" rel="#L7570">7570</span>
<span id="L7571" rel="#L7571">7571</span>
<span id="L7572" rel="#L7572">7572</span>
<span id="L7573" rel="#L7573">7573</span>
<span id="L7574" rel="#L7574">7574</span>
<span id="L7575" rel="#L7575">7575</span>
<span id="L7576" rel="#L7576">7576</span>
<span id="L7577" rel="#L7577">7577</span>
<span id="L7578" rel="#L7578">7578</span>
<span id="L7579" rel="#L7579">7579</span>
<span id="L7580" rel="#L7580">7580</span>
<span id="L7581" rel="#L7581">7581</span>
<span id="L7582" rel="#L7582">7582</span>
<span id="L7583" rel="#L7583">7583</span>
<span id="L7584" rel="#L7584">7584</span>
<span id="L7585" rel="#L7585">7585</span>
<span id="L7586" rel="#L7586">7586</span>
<span id="L7587" rel="#L7587">7587</span>
<span id="L7588" rel="#L7588">7588</span>
<span id="L7589" rel="#L7589">7589</span>
<span id="L7590" rel="#L7590">7590</span>
<span id="L7591" rel="#L7591">7591</span>
<span id="L7592" rel="#L7592">7592</span>
<span id="L7593" rel="#L7593">7593</span>
<span id="L7594" rel="#L7594">7594</span>
<span id="L7595" rel="#L7595">7595</span>
<span id="L7596" rel="#L7596">7596</span>
<span id="L7597" rel="#L7597">7597</span>
<span id="L7598" rel="#L7598">7598</span>
<span id="L7599" rel="#L7599">7599</span>
<span id="L7600" rel="#L7600">7600</span>
<span id="L7601" rel="#L7601">7601</span>
<span id="L7602" rel="#L7602">7602</span>
<span id="L7603" rel="#L7603">7603</span>
<span id="L7604" rel="#L7604">7604</span>
<span id="L7605" rel="#L7605">7605</span>
<span id="L7606" rel="#L7606">7606</span>
<span id="L7607" rel="#L7607">7607</span>
<span id="L7608" rel="#L7608">7608</span>
<span id="L7609" rel="#L7609">7609</span>
<span id="L7610" rel="#L7610">7610</span>
<span id="L7611" rel="#L7611">7611</span>
<span id="L7612" rel="#L7612">7612</span>
<span id="L7613" rel="#L7613">7613</span>
<span id="L7614" rel="#L7614">7614</span>
<span id="L7615" rel="#L7615">7615</span>
<span id="L7616" rel="#L7616">7616</span>
<span id="L7617" rel="#L7617">7617</span>
<span id="L7618" rel="#L7618">7618</span>
<span id="L7619" rel="#L7619">7619</span>
<span id="L7620" rel="#L7620">7620</span>
<span id="L7621" rel="#L7621">7621</span>
<span id="L7622" rel="#L7622">7622</span>
<span id="L7623" rel="#L7623">7623</span>
<span id="L7624" rel="#L7624">7624</span>
<span id="L7625" rel="#L7625">7625</span>
<span id="L7626" rel="#L7626">7626</span>
<span id="L7627" rel="#L7627">7627</span>
<span id="L7628" rel="#L7628">7628</span>
<span id="L7629" rel="#L7629">7629</span>
<span id="L7630" rel="#L7630">7630</span>
<span id="L7631" rel="#L7631">7631</span>
<span id="L7632" rel="#L7632">7632</span>
<span id="L7633" rel="#L7633">7633</span>
<span id="L7634" rel="#L7634">7634</span>
<span id="L7635" rel="#L7635">7635</span>
<span id="L7636" rel="#L7636">7636</span>
<span id="L7637" rel="#L7637">7637</span>
<span id="L7638" rel="#L7638">7638</span>
<span id="L7639" rel="#L7639">7639</span>
<span id="L7640" rel="#L7640">7640</span>
<span id="L7641" rel="#L7641">7641</span>
<span id="L7642" rel="#L7642">7642</span>
<span id="L7643" rel="#L7643">7643</span>
<span id="L7644" rel="#L7644">7644</span>
<span id="L7645" rel="#L7645">7645</span>
<span id="L7646" rel="#L7646">7646</span>
<span id="L7647" rel="#L7647">7647</span>
<span id="L7648" rel="#L7648">7648</span>
<span id="L7649" rel="#L7649">7649</span>
<span id="L7650" rel="#L7650">7650</span>
<span id="L7651" rel="#L7651">7651</span>
<span id="L7652" rel="#L7652">7652</span>
<span id="L7653" rel="#L7653">7653</span>
<span id="L7654" rel="#L7654">7654</span>
<span id="L7655" rel="#L7655">7655</span>
<span id="L7656" rel="#L7656">7656</span>
<span id="L7657" rel="#L7657">7657</span>
<span id="L7658" rel="#L7658">7658</span>
<span id="L7659" rel="#L7659">7659</span>
<span id="L7660" rel="#L7660">7660</span>
<span id="L7661" rel="#L7661">7661</span>
<span id="L7662" rel="#L7662">7662</span>
<span id="L7663" rel="#L7663">7663</span>
<span id="L7664" rel="#L7664">7664</span>
<span id="L7665" rel="#L7665">7665</span>
<span id="L7666" rel="#L7666">7666</span>
<span id="L7667" rel="#L7667">7667</span>
<span id="L7668" rel="#L7668">7668</span>
<span id="L7669" rel="#L7669">7669</span>
<span id="L7670" rel="#L7670">7670</span>
<span id="L7671" rel="#L7671">7671</span>
<span id="L7672" rel="#L7672">7672</span>
<span id="L7673" rel="#L7673">7673</span>
<span id="L7674" rel="#L7674">7674</span>
<span id="L7675" rel="#L7675">7675</span>
<span id="L7676" rel="#L7676">7676</span>
<span id="L7677" rel="#L7677">7677</span>
<span id="L7678" rel="#L7678">7678</span>
<span id="L7679" rel="#L7679">7679</span>
<span id="L7680" rel="#L7680">7680</span>
<span id="L7681" rel="#L7681">7681</span>
<span id="L7682" rel="#L7682">7682</span>
<span id="L7683" rel="#L7683">7683</span>
<span id="L7684" rel="#L7684">7684</span>
<span id="L7685" rel="#L7685">7685</span>
<span id="L7686" rel="#L7686">7686</span>
<span id="L7687" rel="#L7687">7687</span>
<span id="L7688" rel="#L7688">7688</span>
<span id="L7689" rel="#L7689">7689</span>
<span id="L7690" rel="#L7690">7690</span>
<span id="L7691" rel="#L7691">7691</span>
<span id="L7692" rel="#L7692">7692</span>
<span id="L7693" rel="#L7693">7693</span>
<span id="L7694" rel="#L7694">7694</span>
<span id="L7695" rel="#L7695">7695</span>
<span id="L7696" rel="#L7696">7696</span>
<span id="L7697" rel="#L7697">7697</span>
<span id="L7698" rel="#L7698">7698</span>
<span id="L7699" rel="#L7699">7699</span>
<span id="L7700" rel="#L7700">7700</span>
<span id="L7701" rel="#L7701">7701</span>
<span id="L7702" rel="#L7702">7702</span>
<span id="L7703" rel="#L7703">7703</span>
<span id="L7704" rel="#L7704">7704</span>
<span id="L7705" rel="#L7705">7705</span>
<span id="L7706" rel="#L7706">7706</span>
<span id="L7707" rel="#L7707">7707</span>
<span id="L7708" rel="#L7708">7708</span>
<span id="L7709" rel="#L7709">7709</span>
<span id="L7710" rel="#L7710">7710</span>
<span id="L7711" rel="#L7711">7711</span>
<span id="L7712" rel="#L7712">7712</span>
<span id="L7713" rel="#L7713">7713</span>
<span id="L7714" rel="#L7714">7714</span>
<span id="L7715" rel="#L7715">7715</span>
<span id="L7716" rel="#L7716">7716</span>
<span id="L7717" rel="#L7717">7717</span>
<span id="L7718" rel="#L7718">7718</span>
<span id="L7719" rel="#L7719">7719</span>
<span id="L7720" rel="#L7720">7720</span>
<span id="L7721" rel="#L7721">7721</span>
<span id="L7722" rel="#L7722">7722</span>
<span id="L7723" rel="#L7723">7723</span>
<span id="L7724" rel="#L7724">7724</span>
<span id="L7725" rel="#L7725">7725</span>
<span id="L7726" rel="#L7726">7726</span>
<span id="L7727" rel="#L7727">7727</span>
<span id="L7728" rel="#L7728">7728</span>
<span id="L7729" rel="#L7729">7729</span>
<span id="L7730" rel="#L7730">7730</span>
<span id="L7731" rel="#L7731">7731</span>
<span id="L7732" rel="#L7732">7732</span>
<span id="L7733" rel="#L7733">7733</span>
<span id="L7734" rel="#L7734">7734</span>
<span id="L7735" rel="#L7735">7735</span>
<span id="L7736" rel="#L7736">7736</span>
<span id="L7737" rel="#L7737">7737</span>
<span id="L7738" rel="#L7738">7738</span>
<span id="L7739" rel="#L7739">7739</span>
<span id="L7740" rel="#L7740">7740</span>
<span id="L7741" rel="#L7741">7741</span>
<span id="L7742" rel="#L7742">7742</span>
<span id="L7743" rel="#L7743">7743</span>
<span id="L7744" rel="#L7744">7744</span>
<span id="L7745" rel="#L7745">7745</span>
<span id="L7746" rel="#L7746">7746</span>
<span id="L7747" rel="#L7747">7747</span>
<span id="L7748" rel="#L7748">7748</span>
<span id="L7749" rel="#L7749">7749</span>
<span id="L7750" rel="#L7750">7750</span>
<span id="L7751" rel="#L7751">7751</span>
<span id="L7752" rel="#L7752">7752</span>
<span id="L7753" rel="#L7753">7753</span>
<span id="L7754" rel="#L7754">7754</span>
<span id="L7755" rel="#L7755">7755</span>
<span id="L7756" rel="#L7756">7756</span>
<span id="L7757" rel="#L7757">7757</span>
<span id="L7758" rel="#L7758">7758</span>
<span id="L7759" rel="#L7759">7759</span>
<span id="L7760" rel="#L7760">7760</span>
<span id="L7761" rel="#L7761">7761</span>
<span id="L7762" rel="#L7762">7762</span>
<span id="L7763" rel="#L7763">7763</span>
<span id="L7764" rel="#L7764">7764</span>
<span id="L7765" rel="#L7765">7765</span>
<span id="L7766" rel="#L7766">7766</span>
<span id="L7767" rel="#L7767">7767</span>
<span id="L7768" rel="#L7768">7768</span>
<span id="L7769" rel="#L7769">7769</span>
<span id="L7770" rel="#L7770">7770</span>
<span id="L7771" rel="#L7771">7771</span>
<span id="L7772" rel="#L7772">7772</span>
<span id="L7773" rel="#L7773">7773</span>
<span id="L7774" rel="#L7774">7774</span>
<span id="L7775" rel="#L7775">7775</span>
<span id="L7776" rel="#L7776">7776</span>
<span id="L7777" rel="#L7777">7777</span>
<span id="L7778" rel="#L7778">7778</span>
<span id="L7779" rel="#L7779">7779</span>
<span id="L7780" rel="#L7780">7780</span>
<span id="L7781" rel="#L7781">7781</span>
<span id="L7782" rel="#L7782">7782</span>
<span id="L7783" rel="#L7783">7783</span>
<span id="L7784" rel="#L7784">7784</span>
<span id="L7785" rel="#L7785">7785</span>
<span id="L7786" rel="#L7786">7786</span>
<span id="L7787" rel="#L7787">7787</span>
<span id="L7788" rel="#L7788">7788</span>
<span id="L7789" rel="#L7789">7789</span>
<span id="L7790" rel="#L7790">7790</span>
<span id="L7791" rel="#L7791">7791</span>
<span id="L7792" rel="#L7792">7792</span>
<span id="L7793" rel="#L7793">7793</span>
<span id="L7794" rel="#L7794">7794</span>
<span id="L7795" rel="#L7795">7795</span>
<span id="L7796" rel="#L7796">7796</span>
<span id="L7797" rel="#L7797">7797</span>
<span id="L7798" rel="#L7798">7798</span>
<span id="L7799" rel="#L7799">7799</span>
<span id="L7800" rel="#L7800">7800</span>
<span id="L7801" rel="#L7801">7801</span>
<span id="L7802" rel="#L7802">7802</span>
<span id="L7803" rel="#L7803">7803</span>
<span id="L7804" rel="#L7804">7804</span>
<span id="L7805" rel="#L7805">7805</span>
<span id="L7806" rel="#L7806">7806</span>
<span id="L7807" rel="#L7807">7807</span>
<span id="L7808" rel="#L7808">7808</span>
<span id="L7809" rel="#L7809">7809</span>
<span id="L7810" rel="#L7810">7810</span>
<span id="L7811" rel="#L7811">7811</span>
<span id="L7812" rel="#L7812">7812</span>
<span id="L7813" rel="#L7813">7813</span>
<span id="L7814" rel="#L7814">7814</span>
<span id="L7815" rel="#L7815">7815</span>
<span id="L7816" rel="#L7816">7816</span>
<span id="L7817" rel="#L7817">7817</span>
<span id="L7818" rel="#L7818">7818</span>
<span id="L7819" rel="#L7819">7819</span>
<span id="L7820" rel="#L7820">7820</span>
<span id="L7821" rel="#L7821">7821</span>
<span id="L7822" rel="#L7822">7822</span>
<span id="L7823" rel="#L7823">7823</span>
<span id="L7824" rel="#L7824">7824</span>
<span id="L7825" rel="#L7825">7825</span>
<span id="L7826" rel="#L7826">7826</span>
<span id="L7827" rel="#L7827">7827</span>
<span id="L7828" rel="#L7828">7828</span>
<span id="L7829" rel="#L7829">7829</span>
<span id="L7830" rel="#L7830">7830</span>
<span id="L7831" rel="#L7831">7831</span>
<span id="L7832" rel="#L7832">7832</span>
<span id="L7833" rel="#L7833">7833</span>
<span id="L7834" rel="#L7834">7834</span>
<span id="L7835" rel="#L7835">7835</span>
<span id="L7836" rel="#L7836">7836</span>
<span id="L7837" rel="#L7837">7837</span>
<span id="L7838" rel="#L7838">7838</span>
<span id="L7839" rel="#L7839">7839</span>
<span id="L7840" rel="#L7840">7840</span>
<span id="L7841" rel="#L7841">7841</span>
<span id="L7842" rel="#L7842">7842</span>
<span id="L7843" rel="#L7843">7843</span>
<span id="L7844" rel="#L7844">7844</span>
<span id="L7845" rel="#L7845">7845</span>
<span id="L7846" rel="#L7846">7846</span>
<span id="L7847" rel="#L7847">7847</span>
<span id="L7848" rel="#L7848">7848</span>
<span id="L7849" rel="#L7849">7849</span>
<span id="L7850" rel="#L7850">7850</span>
<span id="L7851" rel="#L7851">7851</span>
<span id="L7852" rel="#L7852">7852</span>
<span id="L7853" rel="#L7853">7853</span>
<span id="L7854" rel="#L7854">7854</span>
<span id="L7855" rel="#L7855">7855</span>
<span id="L7856" rel="#L7856">7856</span>
<span id="L7857" rel="#L7857">7857</span>
<span id="L7858" rel="#L7858">7858</span>
<span id="L7859" rel="#L7859">7859</span>
<span id="L7860" rel="#L7860">7860</span>
<span id="L7861" rel="#L7861">7861</span>
<span id="L7862" rel="#L7862">7862</span>
<span id="L7863" rel="#L7863">7863</span>
<span id="L7864" rel="#L7864">7864</span>
<span id="L7865" rel="#L7865">7865</span>
<span id="L7866" rel="#L7866">7866</span>
<span id="L7867" rel="#L7867">7867</span>
<span id="L7868" rel="#L7868">7868</span>
<span id="L7869" rel="#L7869">7869</span>
<span id="L7870" rel="#L7870">7870</span>
<span id="L7871" rel="#L7871">7871</span>
<span id="L7872" rel="#L7872">7872</span>
<span id="L7873" rel="#L7873">7873</span>
<span id="L7874" rel="#L7874">7874</span>
<span id="L7875" rel="#L7875">7875</span>
<span id="L7876" rel="#L7876">7876</span>
<span id="L7877" rel="#L7877">7877</span>
<span id="L7878" rel="#L7878">7878</span>
<span id="L7879" rel="#L7879">7879</span>
<span id="L7880" rel="#L7880">7880</span>
<span id="L7881" rel="#L7881">7881</span>
<span id="L7882" rel="#L7882">7882</span>
<span id="L7883" rel="#L7883">7883</span>
<span id="L7884" rel="#L7884">7884</span>
<span id="L7885" rel="#L7885">7885</span>
<span id="L7886" rel="#L7886">7886</span>
<span id="L7887" rel="#L7887">7887</span>
<span id="L7888" rel="#L7888">7888</span>
<span id="L7889" rel="#L7889">7889</span>
<span id="L7890" rel="#L7890">7890</span>
<span id="L7891" rel="#L7891">7891</span>
<span id="L7892" rel="#L7892">7892</span>
<span id="L7893" rel="#L7893">7893</span>
<span id="L7894" rel="#L7894">7894</span>
<span id="L7895" rel="#L7895">7895</span>
<span id="L7896" rel="#L7896">7896</span>
<span id="L7897" rel="#L7897">7897</span>
<span id="L7898" rel="#L7898">7898</span>
<span id="L7899" rel="#L7899">7899</span>
<span id="L7900" rel="#L7900">7900</span>
<span id="L7901" rel="#L7901">7901</span>
<span id="L7902" rel="#L7902">7902</span>
<span id="L7903" rel="#L7903">7903</span>
<span id="L7904" rel="#L7904">7904</span>
<span id="L7905" rel="#L7905">7905</span>
<span id="L7906" rel="#L7906">7906</span>
<span id="L7907" rel="#L7907">7907</span>
<span id="L7908" rel="#L7908">7908</span>
<span id="L7909" rel="#L7909">7909</span>
<span id="L7910" rel="#L7910">7910</span>
<span id="L7911" rel="#L7911">7911</span>
<span id="L7912" rel="#L7912">7912</span>
<span id="L7913" rel="#L7913">7913</span>
<span id="L7914" rel="#L7914">7914</span>
<span id="L7915" rel="#L7915">7915</span>
<span id="L7916" rel="#L7916">7916</span>
<span id="L7917" rel="#L7917">7917</span>
<span id="L7918" rel="#L7918">7918</span>
<span id="L7919" rel="#L7919">7919</span>
<span id="L7920" rel="#L7920">7920</span>
<span id="L7921" rel="#L7921">7921</span>
<span id="L7922" rel="#L7922">7922</span>
<span id="L7923" rel="#L7923">7923</span>
<span id="L7924" rel="#L7924">7924</span>
<span id="L7925" rel="#L7925">7925</span>
<span id="L7926" rel="#L7926">7926</span>
<span id="L7927" rel="#L7927">7927</span>
<span id="L7928" rel="#L7928">7928</span>
<span id="L7929" rel="#L7929">7929</span>
<span id="L7930" rel="#L7930">7930</span>
<span id="L7931" rel="#L7931">7931</span>
<span id="L7932" rel="#L7932">7932</span>
<span id="L7933" rel="#L7933">7933</span>
<span id="L7934" rel="#L7934">7934</span>
<span id="L7935" rel="#L7935">7935</span>
<span id="L7936" rel="#L7936">7936</span>
<span id="L7937" rel="#L7937">7937</span>
<span id="L7938" rel="#L7938">7938</span>
<span id="L7939" rel="#L7939">7939</span>
<span id="L7940" rel="#L7940">7940</span>
<span id="L7941" rel="#L7941">7941</span>
<span id="L7942" rel="#L7942">7942</span>
<span id="L7943" rel="#L7943">7943</span>
<span id="L7944" rel="#L7944">7944</span>
<span id="L7945" rel="#L7945">7945</span>
<span id="L7946" rel="#L7946">7946</span>
<span id="L7947" rel="#L7947">7947</span>
<span id="L7948" rel="#L7948">7948</span>
<span id="L7949" rel="#L7949">7949</span>
<span id="L7950" rel="#L7950">7950</span>
<span id="L7951" rel="#L7951">7951</span>
<span id="L7952" rel="#L7952">7952</span>
<span id="L7953" rel="#L7953">7953</span>
<span id="L7954" rel="#L7954">7954</span>
<span id="L7955" rel="#L7955">7955</span>
<span id="L7956" rel="#L7956">7956</span>
<span id="L7957" rel="#L7957">7957</span>
<span id="L7958" rel="#L7958">7958</span>
<span id="L7959" rel="#L7959">7959</span>
<span id="L7960" rel="#L7960">7960</span>
<span id="L7961" rel="#L7961">7961</span>
<span id="L7962" rel="#L7962">7962</span>
<span id="L7963" rel="#L7963">7963</span>
<span id="L7964" rel="#L7964">7964</span>
<span id="L7965" rel="#L7965">7965</span>
<span id="L7966" rel="#L7966">7966</span>
<span id="L7967" rel="#L7967">7967</span>
<span id="L7968" rel="#L7968">7968</span>
<span id="L7969" rel="#L7969">7969</span>
<span id="L7970" rel="#L7970">7970</span>
<span id="L7971" rel="#L7971">7971</span>
<span id="L7972" rel="#L7972">7972</span>
<span id="L7973" rel="#L7973">7973</span>
<span id="L7974" rel="#L7974">7974</span>
<span id="L7975" rel="#L7975">7975</span>
<span id="L7976" rel="#L7976">7976</span>
<span id="L7977" rel="#L7977">7977</span>
<span id="L7978" rel="#L7978">7978</span>
<span id="L7979" rel="#L7979">7979</span>
<span id="L7980" rel="#L7980">7980</span>
<span id="L7981" rel="#L7981">7981</span>
<span id="L7982" rel="#L7982">7982</span>
<span id="L7983" rel="#L7983">7983</span>
<span id="L7984" rel="#L7984">7984</span>
<span id="L7985" rel="#L7985">7985</span>
<span id="L7986" rel="#L7986">7986</span>
<span id="L7987" rel="#L7987">7987</span>
<span id="L7988" rel="#L7988">7988</span>
<span id="L7989" rel="#L7989">7989</span>
<span id="L7990" rel="#L7990">7990</span>
<span id="L7991" rel="#L7991">7991</span>
<span id="L7992" rel="#L7992">7992</span>
<span id="L7993" rel="#L7993">7993</span>
<span id="L7994" rel="#L7994">7994</span>
<span id="L7995" rel="#L7995">7995</span>
<span id="L7996" rel="#L7996">7996</span>
<span id="L7997" rel="#L7997">7997</span>
<span id="L7998" rel="#L7998">7998</span>
<span id="L7999" rel="#L7999">7999</span>
<span id="L8000" rel="#L8000">8000</span>
<span id="L8001" rel="#L8001">8001</span>
<span id="L8002" rel="#L8002">8002</span>
<span id="L8003" rel="#L8003">8003</span>
<span id="L8004" rel="#L8004">8004</span>
<span id="L8005" rel="#L8005">8005</span>
<span id="L8006" rel="#L8006">8006</span>
<span id="L8007" rel="#L8007">8007</span>
<span id="L8008" rel="#L8008">8008</span>
<span id="L8009" rel="#L8009">8009</span>
<span id="L8010" rel="#L8010">8010</span>
<span id="L8011" rel="#L8011">8011</span>
<span id="L8012" rel="#L8012">8012</span>
<span id="L8013" rel="#L8013">8013</span>
<span id="L8014" rel="#L8014">8014</span>
<span id="L8015" rel="#L8015">8015</span>
<span id="L8016" rel="#L8016">8016</span>
<span id="L8017" rel="#L8017">8017</span>
<span id="L8018" rel="#L8018">8018</span>
<span id="L8019" rel="#L8019">8019</span>
<span id="L8020" rel="#L8020">8020</span>
<span id="L8021" rel="#L8021">8021</span>
<span id="L8022" rel="#L8022">8022</span>
<span id="L8023" rel="#L8023">8023</span>
<span id="L8024" rel="#L8024">8024</span>
<span id="L8025" rel="#L8025">8025</span>
<span id="L8026" rel="#L8026">8026</span>
<span id="L8027" rel="#L8027">8027</span>
<span id="L8028" rel="#L8028">8028</span>
<span id="L8029" rel="#L8029">8029</span>
<span id="L8030" rel="#L8030">8030</span>
<span id="L8031" rel="#L8031">8031</span>
<span id="L8032" rel="#L8032">8032</span>
<span id="L8033" rel="#L8033">8033</span>
<span id="L8034" rel="#L8034">8034</span>
<span id="L8035" rel="#L8035">8035</span>
<span id="L8036" rel="#L8036">8036</span>
<span id="L8037" rel="#L8037">8037</span>
<span id="L8038" rel="#L8038">8038</span>
<span id="L8039" rel="#L8039">8039</span>
<span id="L8040" rel="#L8040">8040</span>
<span id="L8041" rel="#L8041">8041</span>
<span id="L8042" rel="#L8042">8042</span>
<span id="L8043" rel="#L8043">8043</span>
<span id="L8044" rel="#L8044">8044</span>
<span id="L8045" rel="#L8045">8045</span>
<span id="L8046" rel="#L8046">8046</span>
<span id="L8047" rel="#L8047">8047</span>
<span id="L8048" rel="#L8048">8048</span>
<span id="L8049" rel="#L8049">8049</span>
<span id="L8050" rel="#L8050">8050</span>
<span id="L8051" rel="#L8051">8051</span>
<span id="L8052" rel="#L8052">8052</span>
<span id="L8053" rel="#L8053">8053</span>
<span id="L8054" rel="#L8054">8054</span>
<span id="L8055" rel="#L8055">8055</span>
<span id="L8056" rel="#L8056">8056</span>
<span id="L8057" rel="#L8057">8057</span>
<span id="L8058" rel="#L8058">8058</span>
<span id="L8059" rel="#L8059">8059</span>
<span id="L8060" rel="#L8060">8060</span>
<span id="L8061" rel="#L8061">8061</span>
<span id="L8062" rel="#L8062">8062</span>
<span id="L8063" rel="#L8063">8063</span>
<span id="L8064" rel="#L8064">8064</span>
<span id="L8065" rel="#L8065">8065</span>
<span id="L8066" rel="#L8066">8066</span>
<span id="L8067" rel="#L8067">8067</span>
<span id="L8068" rel="#L8068">8068</span>
<span id="L8069" rel="#L8069">8069</span>
<span id="L8070" rel="#L8070">8070</span>
<span id="L8071" rel="#L8071">8071</span>
<span id="L8072" rel="#L8072">8072</span>
<span id="L8073" rel="#L8073">8073</span>
<span id="L8074" rel="#L8074">8074</span>
<span id="L8075" rel="#L8075">8075</span>
<span id="L8076" rel="#L8076">8076</span>
<span id="L8077" rel="#L8077">8077</span>
<span id="L8078" rel="#L8078">8078</span>
<span id="L8079" rel="#L8079">8079</span>
<span id="L8080" rel="#L8080">8080</span>
<span id="L8081" rel="#L8081">8081</span>
<span id="L8082" rel="#L8082">8082</span>
<span id="L8083" rel="#L8083">8083</span>
<span id="L8084" rel="#L8084">8084</span>
<span id="L8085" rel="#L8085">8085</span>
<span id="L8086" rel="#L8086">8086</span>
<span id="L8087" rel="#L8087">8087</span>
<span id="L8088" rel="#L8088">8088</span>
<span id="L8089" rel="#L8089">8089</span>
<span id="L8090" rel="#L8090">8090</span>
<span id="L8091" rel="#L8091">8091</span>
<span id="L8092" rel="#L8092">8092</span>
<span id="L8093" rel="#L8093">8093</span>
<span id="L8094" rel="#L8094">8094</span>
<span id="L8095" rel="#L8095">8095</span>
<span id="L8096" rel="#L8096">8096</span>
<span id="L8097" rel="#L8097">8097</span>
<span id="L8098" rel="#L8098">8098</span>
<span id="L8099" rel="#L8099">8099</span>
<span id="L8100" rel="#L8100">8100</span>
<span id="L8101" rel="#L8101">8101</span>
<span id="L8102" rel="#L8102">8102</span>
<span id="L8103" rel="#L8103">8103</span>
<span id="L8104" rel="#L8104">8104</span>
<span id="L8105" rel="#L8105">8105</span>
<span id="L8106" rel="#L8106">8106</span>
<span id="L8107" rel="#L8107">8107</span>
<span id="L8108" rel="#L8108">8108</span>
<span id="L8109" rel="#L8109">8109</span>
<span id="L8110" rel="#L8110">8110</span>
<span id="L8111" rel="#L8111">8111</span>
<span id="L8112" rel="#L8112">8112</span>
<span id="L8113" rel="#L8113">8113</span>
<span id="L8114" rel="#L8114">8114</span>
<span id="L8115" rel="#L8115">8115</span>
<span id="L8116" rel="#L8116">8116</span>
<span id="L8117" rel="#L8117">8117</span>
<span id="L8118" rel="#L8118">8118</span>
<span id="L8119" rel="#L8119">8119</span>
<span id="L8120" rel="#L8120">8120</span>
<span id="L8121" rel="#L8121">8121</span>
<span id="L8122" rel="#L8122">8122</span>
<span id="L8123" rel="#L8123">8123</span>
<span id="L8124" rel="#L8124">8124</span>
<span id="L8125" rel="#L8125">8125</span>
<span id="L8126" rel="#L8126">8126</span>
<span id="L8127" rel="#L8127">8127</span>
<span id="L8128" rel="#L8128">8128</span>
<span id="L8129" rel="#L8129">8129</span>
<span id="L8130" rel="#L8130">8130</span>
<span id="L8131" rel="#L8131">8131</span>
<span id="L8132" rel="#L8132">8132</span>
<span id="L8133" rel="#L8133">8133</span>
<span id="L8134" rel="#L8134">8134</span>
<span id="L8135" rel="#L8135">8135</span>
<span id="L8136" rel="#L8136">8136</span>
<span id="L8137" rel="#L8137">8137</span>
<span id="L8138" rel="#L8138">8138</span>
<span id="L8139" rel="#L8139">8139</span>
<span id="L8140" rel="#L8140">8140</span>
<span id="L8141" rel="#L8141">8141</span>
<span id="L8142" rel="#L8142">8142</span>
<span id="L8143" rel="#L8143">8143</span>
<span id="L8144" rel="#L8144">8144</span>
<span id="L8145" rel="#L8145">8145</span>
<span id="L8146" rel="#L8146">8146</span>
<span id="L8147" rel="#L8147">8147</span>
<span id="L8148" rel="#L8148">8148</span>
<span id="L8149" rel="#L8149">8149</span>
<span id="L8150" rel="#L8150">8150</span>
<span id="L8151" rel="#L8151">8151</span>
<span id="L8152" rel="#L8152">8152</span>
<span id="L8153" rel="#L8153">8153</span>
<span id="L8154" rel="#L8154">8154</span>
<span id="L8155" rel="#L8155">8155</span>
<span id="L8156" rel="#L8156">8156</span>
<span id="L8157" rel="#L8157">8157</span>
<span id="L8158" rel="#L8158">8158</span>
<span id="L8159" rel="#L8159">8159</span>
<span id="L8160" rel="#L8160">8160</span>
<span id="L8161" rel="#L8161">8161</span>
<span id="L8162" rel="#L8162">8162</span>
<span id="L8163" rel="#L8163">8163</span>
<span id="L8164" rel="#L8164">8164</span>
<span id="L8165" rel="#L8165">8165</span>
<span id="L8166" rel="#L8166">8166</span>
<span id="L8167" rel="#L8167">8167</span>
<span id="L8168" rel="#L8168">8168</span>
<span id="L8169" rel="#L8169">8169</span>
<span id="L8170" rel="#L8170">8170</span>
<span id="L8171" rel="#L8171">8171</span>
<span id="L8172" rel="#L8172">8172</span>
<span id="L8173" rel="#L8173">8173</span>
<span id="L8174" rel="#L8174">8174</span>
<span id="L8175" rel="#L8175">8175</span>
<span id="L8176" rel="#L8176">8176</span>
<span id="L8177" rel="#L8177">8177</span>
<span id="L8178" rel="#L8178">8178</span>
<span id="L8179" rel="#L8179">8179</span>
<span id="L8180" rel="#L8180">8180</span>
<span id="L8181" rel="#L8181">8181</span>
<span id="L8182" rel="#L8182">8182</span>
<span id="L8183" rel="#L8183">8183</span>
<span id="L8184" rel="#L8184">8184</span>
<span id="L8185" rel="#L8185">8185</span>
<span id="L8186" rel="#L8186">8186</span>
<span id="L8187" rel="#L8187">8187</span>
<span id="L8188" rel="#L8188">8188</span>
<span id="L8189" rel="#L8189">8189</span>
<span id="L8190" rel="#L8190">8190</span>
<span id="L8191" rel="#L8191">8191</span>
<span id="L8192" rel="#L8192">8192</span>
<span id="L8193" rel="#L8193">8193</span>
<span id="L8194" rel="#L8194">8194</span>
<span id="L8195" rel="#L8195">8195</span>
<span id="L8196" rel="#L8196">8196</span>
<span id="L8197" rel="#L8197">8197</span>
<span id="L8198" rel="#L8198">8198</span>
<span id="L8199" rel="#L8199">8199</span>
<span id="L8200" rel="#L8200">8200</span>
<span id="L8201" rel="#L8201">8201</span>
<span id="L8202" rel="#L8202">8202</span>
<span id="L8203" rel="#L8203">8203</span>
<span id="L8204" rel="#L8204">8204</span>
<span id="L8205" rel="#L8205">8205</span>
<span id="L8206" rel="#L8206">8206</span>
<span id="L8207" rel="#L8207">8207</span>
<span id="L8208" rel="#L8208">8208</span>
<span id="L8209" rel="#L8209">8209</span>
<span id="L8210" rel="#L8210">8210</span>
<span id="L8211" rel="#L8211">8211</span>
<span id="L8212" rel="#L8212">8212</span>
<span id="L8213" rel="#L8213">8213</span>
<span id="L8214" rel="#L8214">8214</span>
<span id="L8215" rel="#L8215">8215</span>
<span id="L8216" rel="#L8216">8216</span>
<span id="L8217" rel="#L8217">8217</span>
<span id="L8218" rel="#L8218">8218</span>
<span id="L8219" rel="#L8219">8219</span>
<span id="L8220" rel="#L8220">8220</span>
<span id="L8221" rel="#L8221">8221</span>
<span id="L8222" rel="#L8222">8222</span>
<span id="L8223" rel="#L8223">8223</span>
<span id="L8224" rel="#L8224">8224</span>
<span id="L8225" rel="#L8225">8225</span>
<span id="L8226" rel="#L8226">8226</span>
<span id="L8227" rel="#L8227">8227</span>
<span id="L8228" rel="#L8228">8228</span>
<span id="L8229" rel="#L8229">8229</span>
<span id="L8230" rel="#L8230">8230</span>
<span id="L8231" rel="#L8231">8231</span>
<span id="L8232" rel="#L8232">8232</span>
<span id="L8233" rel="#L8233">8233</span>
<span id="L8234" rel="#L8234">8234</span>
<span id="L8235" rel="#L8235">8235</span>
<span id="L8236" rel="#L8236">8236</span>
<span id="L8237" rel="#L8237">8237</span>
<span id="L8238" rel="#L8238">8238</span>
<span id="L8239" rel="#L8239">8239</span>
<span id="L8240" rel="#L8240">8240</span>
<span id="L8241" rel="#L8241">8241</span>
<span id="L8242" rel="#L8242">8242</span>
<span id="L8243" rel="#L8243">8243</span>
<span id="L8244" rel="#L8244">8244</span>
<span id="L8245" rel="#L8245">8245</span>
<span id="L8246" rel="#L8246">8246</span>
<span id="L8247" rel="#L8247">8247</span>
<span id="L8248" rel="#L8248">8248</span>
<span id="L8249" rel="#L8249">8249</span>
<span id="L8250" rel="#L8250">8250</span>
<span id="L8251" rel="#L8251">8251</span>
<span id="L8252" rel="#L8252">8252</span>
<span id="L8253" rel="#L8253">8253</span>
<span id="L8254" rel="#L8254">8254</span>
<span id="L8255" rel="#L8255">8255</span>
<span id="L8256" rel="#L8256">8256</span>
<span id="L8257" rel="#L8257">8257</span>
<span id="L8258" rel="#L8258">8258</span>
<span id="L8259" rel="#L8259">8259</span>
<span id="L8260" rel="#L8260">8260</span>
<span id="L8261" rel="#L8261">8261</span>
<span id="L8262" rel="#L8262">8262</span>
<span id="L8263" rel="#L8263">8263</span>
<span id="L8264" rel="#L8264">8264</span>
<span id="L8265" rel="#L8265">8265</span>
<span id="L8266" rel="#L8266">8266</span>
<span id="L8267" rel="#L8267">8267</span>
<span id="L8268" rel="#L8268">8268</span>
<span id="L8269" rel="#L8269">8269</span>
<span id="L8270" rel="#L8270">8270</span>
<span id="L8271" rel="#L8271">8271</span>
<span id="L8272" rel="#L8272">8272</span>
<span id="L8273" rel="#L8273">8273</span>
<span id="L8274" rel="#L8274">8274</span>
<span id="L8275" rel="#L8275">8275</span>
<span id="L8276" rel="#L8276">8276</span>
<span id="L8277" rel="#L8277">8277</span>
<span id="L8278" rel="#L8278">8278</span>
<span id="L8279" rel="#L8279">8279</span>
<span id="L8280" rel="#L8280">8280</span>
<span id="L8281" rel="#L8281">8281</span>
<span id="L8282" rel="#L8282">8282</span>
<span id="L8283" rel="#L8283">8283</span>
<span id="L8284" rel="#L8284">8284</span>
<span id="L8285" rel="#L8285">8285</span>
<span id="L8286" rel="#L8286">8286</span>
<span id="L8287" rel="#L8287">8287</span>
<span id="L8288" rel="#L8288">8288</span>
<span id="L8289" rel="#L8289">8289</span>
<span id="L8290" rel="#L8290">8290</span>
<span id="L8291" rel="#L8291">8291</span>
<span id="L8292" rel="#L8292">8292</span>
<span id="L8293" rel="#L8293">8293</span>
<span id="L8294" rel="#L8294">8294</span>
<span id="L8295" rel="#L8295">8295</span>
<span id="L8296" rel="#L8296">8296</span>
<span id="L8297" rel="#L8297">8297</span>
<span id="L8298" rel="#L8298">8298</span>
<span id="L8299" rel="#L8299">8299</span>
<span id="L8300" rel="#L8300">8300</span>
<span id="L8301" rel="#L8301">8301</span>
<span id="L8302" rel="#L8302">8302</span>
<span id="L8303" rel="#L8303">8303</span>
<span id="L8304" rel="#L8304">8304</span>
<span id="L8305" rel="#L8305">8305</span>
<span id="L8306" rel="#L8306">8306</span>
<span id="L8307" rel="#L8307">8307</span>
<span id="L8308" rel="#L8308">8308</span>
<span id="L8309" rel="#L8309">8309</span>
<span id="L8310" rel="#L8310">8310</span>
<span id="L8311" rel="#L8311">8311</span>
<span id="L8312" rel="#L8312">8312</span>
<span id="L8313" rel="#L8313">8313</span>
<span id="L8314" rel="#L8314">8314</span>
<span id="L8315" rel="#L8315">8315</span>
<span id="L8316" rel="#L8316">8316</span>
<span id="L8317" rel="#L8317">8317</span>
<span id="L8318" rel="#L8318">8318</span>
<span id="L8319" rel="#L8319">8319</span>
<span id="L8320" rel="#L8320">8320</span>
<span id="L8321" rel="#L8321">8321</span>
<span id="L8322" rel="#L8322">8322</span>
<span id="L8323" rel="#L8323">8323</span>
<span id="L8324" rel="#L8324">8324</span>
<span id="L8325" rel="#L8325">8325</span>
<span id="L8326" rel="#L8326">8326</span>
<span id="L8327" rel="#L8327">8327</span>
<span id="L8328" rel="#L8328">8328</span>
<span id="L8329" rel="#L8329">8329</span>
<span id="L8330" rel="#L8330">8330</span>
<span id="L8331" rel="#L8331">8331</span>
<span id="L8332" rel="#L8332">8332</span>
<span id="L8333" rel="#L8333">8333</span>
<span id="L8334" rel="#L8334">8334</span>
<span id="L8335" rel="#L8335">8335</span>
<span id="L8336" rel="#L8336">8336</span>
<span id="L8337" rel="#L8337">8337</span>
<span id="L8338" rel="#L8338">8338</span>
<span id="L8339" rel="#L8339">8339</span>
<span id="L8340" rel="#L8340">8340</span>
<span id="L8341" rel="#L8341">8341</span>
<span id="L8342" rel="#L8342">8342</span>
<span id="L8343" rel="#L8343">8343</span>
<span id="L8344" rel="#L8344">8344</span>
<span id="L8345" rel="#L8345">8345</span>
<span id="L8346" rel="#L8346">8346</span>
<span id="L8347" rel="#L8347">8347</span>
<span id="L8348" rel="#L8348">8348</span>
<span id="L8349" rel="#L8349">8349</span>
<span id="L8350" rel="#L8350">8350</span>
<span id="L8351" rel="#L8351">8351</span>
<span id="L8352" rel="#L8352">8352</span>
<span id="L8353" rel="#L8353">8353</span>
<span id="L8354" rel="#L8354">8354</span>
<span id="L8355" rel="#L8355">8355</span>
<span id="L8356" rel="#L8356">8356</span>
<span id="L8357" rel="#L8357">8357</span>
<span id="L8358" rel="#L8358">8358</span>
<span id="L8359" rel="#L8359">8359</span>
<span id="L8360" rel="#L8360">8360</span>
<span id="L8361" rel="#L8361">8361</span>
<span id="L8362" rel="#L8362">8362</span>
<span id="L8363" rel="#L8363">8363</span>
<span id="L8364" rel="#L8364">8364</span>
<span id="L8365" rel="#L8365">8365</span>
<span id="L8366" rel="#L8366">8366</span>
<span id="L8367" rel="#L8367">8367</span>
<span id="L8368" rel="#L8368">8368</span>
<span id="L8369" rel="#L8369">8369</span>
<span id="L8370" rel="#L8370">8370</span>
<span id="L8371" rel="#L8371">8371</span>
<span id="L8372" rel="#L8372">8372</span>
<span id="L8373" rel="#L8373">8373</span>
<span id="L8374" rel="#L8374">8374</span>
<span id="L8375" rel="#L8375">8375</span>
<span id="L8376" rel="#L8376">8376</span>
<span id="L8377" rel="#L8377">8377</span>
<span id="L8378" rel="#L8378">8378</span>
<span id="L8379" rel="#L8379">8379</span>
<span id="L8380" rel="#L8380">8380</span>
<span id="L8381" rel="#L8381">8381</span>
<span id="L8382" rel="#L8382">8382</span>
<span id="L8383" rel="#L8383">8383</span>
<span id="L8384" rel="#L8384">8384</span>
<span id="L8385" rel="#L8385">8385</span>
<span id="L8386" rel="#L8386">8386</span>
<span id="L8387" rel="#L8387">8387</span>
<span id="L8388" rel="#L8388">8388</span>
<span id="L8389" rel="#L8389">8389</span>
<span id="L8390" rel="#L8390">8390</span>
<span id="L8391" rel="#L8391">8391</span>
<span id="L8392" rel="#L8392">8392</span>
<span id="L8393" rel="#L8393">8393</span>
<span id="L8394" rel="#L8394">8394</span>
<span id="L8395" rel="#L8395">8395</span>
<span id="L8396" rel="#L8396">8396</span>
<span id="L8397" rel="#L8397">8397</span>
<span id="L8398" rel="#L8398">8398</span>
<span id="L8399" rel="#L8399">8399</span>
<span id="L8400" rel="#L8400">8400</span>
<span id="L8401" rel="#L8401">8401</span>
<span id="L8402" rel="#L8402">8402</span>
<span id="L8403" rel="#L8403">8403</span>
<span id="L8404" rel="#L8404">8404</span>
<span id="L8405" rel="#L8405">8405</span>
<span id="L8406" rel="#L8406">8406</span>
<span id="L8407" rel="#L8407">8407</span>
<span id="L8408" rel="#L8408">8408</span>
<span id="L8409" rel="#L8409">8409</span>
<span id="L8410" rel="#L8410">8410</span>
<span id="L8411" rel="#L8411">8411</span>
<span id="L8412" rel="#L8412">8412</span>
<span id="L8413" rel="#L8413">8413</span>
<span id="L8414" rel="#L8414">8414</span>
<span id="L8415" rel="#L8415">8415</span>
<span id="L8416" rel="#L8416">8416</span>
<span id="L8417" rel="#L8417">8417</span>
<span id="L8418" rel="#L8418">8418</span>
<span id="L8419" rel="#L8419">8419</span>
<span id="L8420" rel="#L8420">8420</span>
<span id="L8421" rel="#L8421">8421</span>
<span id="L8422" rel="#L8422">8422</span>
<span id="L8423" rel="#L8423">8423</span>
<span id="L8424" rel="#L8424">8424</span>
<span id="L8425" rel="#L8425">8425</span>
<span id="L8426" rel="#L8426">8426</span>
<span id="L8427" rel="#L8427">8427</span>
<span id="L8428" rel="#L8428">8428</span>
<span id="L8429" rel="#L8429">8429</span>
<span id="L8430" rel="#L8430">8430</span>
<span id="L8431" rel="#L8431">8431</span>
<span id="L8432" rel="#L8432">8432</span>
<span id="L8433" rel="#L8433">8433</span>
<span id="L8434" rel="#L8434">8434</span>
<span id="L8435" rel="#L8435">8435</span>
<span id="L8436" rel="#L8436">8436</span>
<span id="L8437" rel="#L8437">8437</span>
<span id="L8438" rel="#L8438">8438</span>
<span id="L8439" rel="#L8439">8439</span>
<span id="L8440" rel="#L8440">8440</span>
<span id="L8441" rel="#L8441">8441</span>
<span id="L8442" rel="#L8442">8442</span>
<span id="L8443" rel="#L8443">8443</span>
<span id="L8444" rel="#L8444">8444</span>
<span id="L8445" rel="#L8445">8445</span>
<span id="L8446" rel="#L8446">8446</span>
<span id="L8447" rel="#L8447">8447</span>
<span id="L8448" rel="#L8448">8448</span>
<span id="L8449" rel="#L8449">8449</span>
<span id="L8450" rel="#L8450">8450</span>
<span id="L8451" rel="#L8451">8451</span>
<span id="L8452" rel="#L8452">8452</span>
<span id="L8453" rel="#L8453">8453</span>
<span id="L8454" rel="#L8454">8454</span>
<span id="L8455" rel="#L8455">8455</span>
<span id="L8456" rel="#L8456">8456</span>
<span id="L8457" rel="#L8457">8457</span>
<span id="L8458" rel="#L8458">8458</span>
<span id="L8459" rel="#L8459">8459</span>
<span id="L8460" rel="#L8460">8460</span>
<span id="L8461" rel="#L8461">8461</span>
<span id="L8462" rel="#L8462">8462</span>
<span id="L8463" rel="#L8463">8463</span>
<span id="L8464" rel="#L8464">8464</span>
<span id="L8465" rel="#L8465">8465</span>
<span id="L8466" rel="#L8466">8466</span>
<span id="L8467" rel="#L8467">8467</span>
<span id="L8468" rel="#L8468">8468</span>
<span id="L8469" rel="#L8469">8469</span>
<span id="L8470" rel="#L8470">8470</span>
<span id="L8471" rel="#L8471">8471</span>
<span id="L8472" rel="#L8472">8472</span>
<span id="L8473" rel="#L8473">8473</span>
<span id="L8474" rel="#L8474">8474</span>
<span id="L8475" rel="#L8475">8475</span>
<span id="L8476" rel="#L8476">8476</span>
<span id="L8477" rel="#L8477">8477</span>
<span id="L8478" rel="#L8478">8478</span>
<span id="L8479" rel="#L8479">8479</span>
<span id="L8480" rel="#L8480">8480</span>
<span id="L8481" rel="#L8481">8481</span>
<span id="L8482" rel="#L8482">8482</span>
<span id="L8483" rel="#L8483">8483</span>
<span id="L8484" rel="#L8484">8484</span>
<span id="L8485" rel="#L8485">8485</span>
<span id="L8486" rel="#L8486">8486</span>
<span id="L8487" rel="#L8487">8487</span>
<span id="L8488" rel="#L8488">8488</span>
<span id="L8489" rel="#L8489">8489</span>
<span id="L8490" rel="#L8490">8490</span>
<span id="L8491" rel="#L8491">8491</span>
<span id="L8492" rel="#L8492">8492</span>
<span id="L8493" rel="#L8493">8493</span>
<span id="L8494" rel="#L8494">8494</span>
<span id="L8495" rel="#L8495">8495</span>
<span id="L8496" rel="#L8496">8496</span>
<span id="L8497" rel="#L8497">8497</span>
<span id="L8498" rel="#L8498">8498</span>
<span id="L8499" rel="#L8499">8499</span>
<span id="L8500" rel="#L8500">8500</span>
<span id="L8501" rel="#L8501">8501</span>
<span id="L8502" rel="#L8502">8502</span>
<span id="L8503" rel="#L8503">8503</span>
<span id="L8504" rel="#L8504">8504</span>
<span id="L8505" rel="#L8505">8505</span>
<span id="L8506" rel="#L8506">8506</span>
<span id="L8507" rel="#L8507">8507</span>
<span id="L8508" rel="#L8508">8508</span>
<span id="L8509" rel="#L8509">8509</span>
<span id="L8510" rel="#L8510">8510</span>
<span id="L8511" rel="#L8511">8511</span>
<span id="L8512" rel="#L8512">8512</span>
<span id="L8513" rel="#L8513">8513</span>
<span id="L8514" rel="#L8514">8514</span>
<span id="L8515" rel="#L8515">8515</span>
<span id="L8516" rel="#L8516">8516</span>
<span id="L8517" rel="#L8517">8517</span>
<span id="L8518" rel="#L8518">8518</span>
<span id="L8519" rel="#L8519">8519</span>
<span id="L8520" rel="#L8520">8520</span>
<span id="L8521" rel="#L8521">8521</span>
<span id="L8522" rel="#L8522">8522</span>
<span id="L8523" rel="#L8523">8523</span>
<span id="L8524" rel="#L8524">8524</span>
<span id="L8525" rel="#L8525">8525</span>
<span id="L8526" rel="#L8526">8526</span>
<span id="L8527" rel="#L8527">8527</span>
<span id="L8528" rel="#L8528">8528</span>
<span id="L8529" rel="#L8529">8529</span>
<span id="L8530" rel="#L8530">8530</span>
<span id="L8531" rel="#L8531">8531</span>
<span id="L8532" rel="#L8532">8532</span>
<span id="L8533" rel="#L8533">8533</span>
<span id="L8534" rel="#L8534">8534</span>
<span id="L8535" rel="#L8535">8535</span>
<span id="L8536" rel="#L8536">8536</span>
<span id="L8537" rel="#L8537">8537</span>
<span id="L8538" rel="#L8538">8538</span>
<span id="L8539" rel="#L8539">8539</span>
<span id="L8540" rel="#L8540">8540</span>
<span id="L8541" rel="#L8541">8541</span>
<span id="L8542" rel="#L8542">8542</span>
<span id="L8543" rel="#L8543">8543</span>
<span id="L8544" rel="#L8544">8544</span>
<span id="L8545" rel="#L8545">8545</span>
<span id="L8546" rel="#L8546">8546</span>
<span id="L8547" rel="#L8547">8547</span>
<span id="L8548" rel="#L8548">8548</span>
<span id="L8549" rel="#L8549">8549</span>
<span id="L8550" rel="#L8550">8550</span>
<span id="L8551" rel="#L8551">8551</span>
<span id="L8552" rel="#L8552">8552</span>
<span id="L8553" rel="#L8553">8553</span>
<span id="L8554" rel="#L8554">8554</span>
<span id="L8555" rel="#L8555">8555</span>
<span id="L8556" rel="#L8556">8556</span>
<span id="L8557" rel="#L8557">8557</span>
<span id="L8558" rel="#L8558">8558</span>
<span id="L8559" rel="#L8559">8559</span>
<span id="L8560" rel="#L8560">8560</span>
<span id="L8561" rel="#L8561">8561</span>
<span id="L8562" rel="#L8562">8562</span>
<span id="L8563" rel="#L8563">8563</span>
<span id="L8564" rel="#L8564">8564</span>
<span id="L8565" rel="#L8565">8565</span>
<span id="L8566" rel="#L8566">8566</span>
<span id="L8567" rel="#L8567">8567</span>
<span id="L8568" rel="#L8568">8568</span>
<span id="L8569" rel="#L8569">8569</span>
<span id="L8570" rel="#L8570">8570</span>
<span id="L8571" rel="#L8571">8571</span>
<span id="L8572" rel="#L8572">8572</span>
<span id="L8573" rel="#L8573">8573</span>
<span id="L8574" rel="#L8574">8574</span>
<span id="L8575" rel="#L8575">8575</span>
<span id="L8576" rel="#L8576">8576</span>
<span id="L8577" rel="#L8577">8577</span>
<span id="L8578" rel="#L8578">8578</span>
<span id="L8579" rel="#L8579">8579</span>
<span id="L8580" rel="#L8580">8580</span>
<span id="L8581" rel="#L8581">8581</span>
<span id="L8582" rel="#L8582">8582</span>
<span id="L8583" rel="#L8583">8583</span>
<span id="L8584" rel="#L8584">8584</span>
<span id="L8585" rel="#L8585">8585</span>
<span id="L8586" rel="#L8586">8586</span>
<span id="L8587" rel="#L8587">8587</span>
<span id="L8588" rel="#L8588">8588</span>
<span id="L8589" rel="#L8589">8589</span>
<span id="L8590" rel="#L8590">8590</span>
<span id="L8591" rel="#L8591">8591</span>
<span id="L8592" rel="#L8592">8592</span>
<span id="L8593" rel="#L8593">8593</span>
<span id="L8594" rel="#L8594">8594</span>
<span id="L8595" rel="#L8595">8595</span>
<span id="L8596" rel="#L8596">8596</span>
<span id="L8597" rel="#L8597">8597</span>
<span id="L8598" rel="#L8598">8598</span>
<span id="L8599" rel="#L8599">8599</span>
<span id="L8600" rel="#L8600">8600</span>
<span id="L8601" rel="#L8601">8601</span>
<span id="L8602" rel="#L8602">8602</span>
<span id="L8603" rel="#L8603">8603</span>
<span id="L8604" rel="#L8604">8604</span>
<span id="L8605" rel="#L8605">8605</span>
<span id="L8606" rel="#L8606">8606</span>
<span id="L8607" rel="#L8607">8607</span>
<span id="L8608" rel="#L8608">8608</span>
<span id="L8609" rel="#L8609">8609</span>
<span id="L8610" rel="#L8610">8610</span>
<span id="L8611" rel="#L8611">8611</span>
<span id="L8612" rel="#L8612">8612</span>
<span id="L8613" rel="#L8613">8613</span>
<span id="L8614" rel="#L8614">8614</span>
<span id="L8615" rel="#L8615">8615</span>
<span id="L8616" rel="#L8616">8616</span>
<span id="L8617" rel="#L8617">8617</span>
<span id="L8618" rel="#L8618">8618</span>
<span id="L8619" rel="#L8619">8619</span>
<span id="L8620" rel="#L8620">8620</span>
<span id="L8621" rel="#L8621">8621</span>
<span id="L8622" rel="#L8622">8622</span>
<span id="L8623" rel="#L8623">8623</span>
<span id="L8624" rel="#L8624">8624</span>
<span id="L8625" rel="#L8625">8625</span>
<span id="L8626" rel="#L8626">8626</span>
<span id="L8627" rel="#L8627">8627</span>
<span id="L8628" rel="#L8628">8628</span>
<span id="L8629" rel="#L8629">8629</span>
<span id="L8630" rel="#L8630">8630</span>
<span id="L8631" rel="#L8631">8631</span>
<span id="L8632" rel="#L8632">8632</span>
<span id="L8633" rel="#L8633">8633</span>
<span id="L8634" rel="#L8634">8634</span>
<span id="L8635" rel="#L8635">8635</span>
<span id="L8636" rel="#L8636">8636</span>
<span id="L8637" rel="#L8637">8637</span>
<span id="L8638" rel="#L8638">8638</span>
<span id="L8639" rel="#L8639">8639</span>
<span id="L8640" rel="#L8640">8640</span>
<span id="L8641" rel="#L8641">8641</span>
<span id="L8642" rel="#L8642">8642</span>
<span id="L8643" rel="#L8643">8643</span>
<span id="L8644" rel="#L8644">8644</span>
<span id="L8645" rel="#L8645">8645</span>
<span id="L8646" rel="#L8646">8646</span>
<span id="L8647" rel="#L8647">8647</span>
<span id="L8648" rel="#L8648">8648</span>
<span id="L8649" rel="#L8649">8649</span>
<span id="L8650" rel="#L8650">8650</span>
<span id="L8651" rel="#L8651">8651</span>
<span id="L8652" rel="#L8652">8652</span>
<span id="L8653" rel="#L8653">8653</span>
<span id="L8654" rel="#L8654">8654</span>
<span id="L8655" rel="#L8655">8655</span>
<span id="L8656" rel="#L8656">8656</span>
<span id="L8657" rel="#L8657">8657</span>
<span id="L8658" rel="#L8658">8658</span>
<span id="L8659" rel="#L8659">8659</span>
<span id="L8660" rel="#L8660">8660</span>
<span id="L8661" rel="#L8661">8661</span>
<span id="L8662" rel="#L8662">8662</span>
<span id="L8663" rel="#L8663">8663</span>
<span id="L8664" rel="#L8664">8664</span>
<span id="L8665" rel="#L8665">8665</span>
<span id="L8666" rel="#L8666">8666</span>
<span id="L8667" rel="#L8667">8667</span>
<span id="L8668" rel="#L8668">8668</span>
<span id="L8669" rel="#L8669">8669</span>
<span id="L8670" rel="#L8670">8670</span>
<span id="L8671" rel="#L8671">8671</span>
<span id="L8672" rel="#L8672">8672</span>
<span id="L8673" rel="#L8673">8673</span>
<span id="L8674" rel="#L8674">8674</span>
<span id="L8675" rel="#L8675">8675</span>
<span id="L8676" rel="#L8676">8676</span>
<span id="L8677" rel="#L8677">8677</span>
<span id="L8678" rel="#L8678">8678</span>
<span id="L8679" rel="#L8679">8679</span>
<span id="L8680" rel="#L8680">8680</span>
<span id="L8681" rel="#L8681">8681</span>
<span id="L8682" rel="#L8682">8682</span>
<span id="L8683" rel="#L8683">8683</span>
<span id="L8684" rel="#L8684">8684</span>
<span id="L8685" rel="#L8685">8685</span>
<span id="L8686" rel="#L8686">8686</span>
<span id="L8687" rel="#L8687">8687</span>
<span id="L8688" rel="#L8688">8688</span>
<span id="L8689" rel="#L8689">8689</span>
<span id="L8690" rel="#L8690">8690</span>
<span id="L8691" rel="#L8691">8691</span>
<span id="L8692" rel="#L8692">8692</span>
<span id="L8693" rel="#L8693">8693</span>
<span id="L8694" rel="#L8694">8694</span>
<span id="L8695" rel="#L8695">8695</span>
<span id="L8696" rel="#L8696">8696</span>
<span id="L8697" rel="#L8697">8697</span>
<span id="L8698" rel="#L8698">8698</span>
<span id="L8699" rel="#L8699">8699</span>
<span id="L8700" rel="#L8700">8700</span>
<span id="L8701" rel="#L8701">8701</span>
<span id="L8702" rel="#L8702">8702</span>
<span id="L8703" rel="#L8703">8703</span>
<span id="L8704" rel="#L8704">8704</span>
<span id="L8705" rel="#L8705">8705</span>
<span id="L8706" rel="#L8706">8706</span>
<span id="L8707" rel="#L8707">8707</span>
<span id="L8708" rel="#L8708">8708</span>
<span id="L8709" rel="#L8709">8709</span>
<span id="L8710" rel="#L8710">8710</span>
<span id="L8711" rel="#L8711">8711</span>
<span id="L8712" rel="#L8712">8712</span>
<span id="L8713" rel="#L8713">8713</span>
<span id="L8714" rel="#L8714">8714</span>
<span id="L8715" rel="#L8715">8715</span>
<span id="L8716" rel="#L8716">8716</span>
<span id="L8717" rel="#L8717">8717</span>
<span id="L8718" rel="#L8718">8718</span>
<span id="L8719" rel="#L8719">8719</span>
<span id="L8720" rel="#L8720">8720</span>
<span id="L8721" rel="#L8721">8721</span>
<span id="L8722" rel="#L8722">8722</span>
<span id="L8723" rel="#L8723">8723</span>
<span id="L8724" rel="#L8724">8724</span>
<span id="L8725" rel="#L8725">8725</span>
<span id="L8726" rel="#L8726">8726</span>
<span id="L8727" rel="#L8727">8727</span>
<span id="L8728" rel="#L8728">8728</span>
<span id="L8729" rel="#L8729">8729</span>
<span id="L8730" rel="#L8730">8730</span>
<span id="L8731" rel="#L8731">8731</span>
<span id="L8732" rel="#L8732">8732</span>
<span id="L8733" rel="#L8733">8733</span>
<span id="L8734" rel="#L8734">8734</span>
<span id="L8735" rel="#L8735">8735</span>
<span id="L8736" rel="#L8736">8736</span>
<span id="L8737" rel="#L8737">8737</span>
<span id="L8738" rel="#L8738">8738</span>
<span id="L8739" rel="#L8739">8739</span>
<span id="L8740" rel="#L8740">8740</span>
<span id="L8741" rel="#L8741">8741</span>
<span id="L8742" rel="#L8742">8742</span>
<span id="L8743" rel="#L8743">8743</span>
<span id="L8744" rel="#L8744">8744</span>
<span id="L8745" rel="#L8745">8745</span>
<span id="L8746" rel="#L8746">8746</span>
<span id="L8747" rel="#L8747">8747</span>
<span id="L8748" rel="#L8748">8748</span>
<span id="L8749" rel="#L8749">8749</span>
<span id="L8750" rel="#L8750">8750</span>
<span id="L8751" rel="#L8751">8751</span>
<span id="L8752" rel="#L8752">8752</span>
<span id="L8753" rel="#L8753">8753</span>
<span id="L8754" rel="#L8754">8754</span>
<span id="L8755" rel="#L8755">8755</span>
<span id="L8756" rel="#L8756">8756</span>
<span id="L8757" rel="#L8757">8757</span>
<span id="L8758" rel="#L8758">8758</span>
<span id="L8759" rel="#L8759">8759</span>
<span id="L8760" rel="#L8760">8760</span>
<span id="L8761" rel="#L8761">8761</span>
<span id="L8762" rel="#L8762">8762</span>
<span id="L8763" rel="#L8763">8763</span>
<span id="L8764" rel="#L8764">8764</span>
<span id="L8765" rel="#L8765">8765</span>
<span id="L8766" rel="#L8766">8766</span>
<span id="L8767" rel="#L8767">8767</span>
<span id="L8768" rel="#L8768">8768</span>
<span id="L8769" rel="#L8769">8769</span>
<span id="L8770" rel="#L8770">8770</span>
<span id="L8771" rel="#L8771">8771</span>
<span id="L8772" rel="#L8772">8772</span>
<span id="L8773" rel="#L8773">8773</span>
<span id="L8774" rel="#L8774">8774</span>
<span id="L8775" rel="#L8775">8775</span>
<span id="L8776" rel="#L8776">8776</span>
<span id="L8777" rel="#L8777">8777</span>
<span id="L8778" rel="#L8778">8778</span>
<span id="L8779" rel="#L8779">8779</span>
<span id="L8780" rel="#L8780">8780</span>
<span id="L8781" rel="#L8781">8781</span>
<span id="L8782" rel="#L8782">8782</span>
<span id="L8783" rel="#L8783">8783</span>
<span id="L8784" rel="#L8784">8784</span>
<span id="L8785" rel="#L8785">8785</span>
<span id="L8786" rel="#L8786">8786</span>
<span id="L8787" rel="#L8787">8787</span>
<span id="L8788" rel="#L8788">8788</span>
<span id="L8789" rel="#L8789">8789</span>
<span id="L8790" rel="#L8790">8790</span>
<span id="L8791" rel="#L8791">8791</span>
<span id="L8792" rel="#L8792">8792</span>
<span id="L8793" rel="#L8793">8793</span>
<span id="L8794" rel="#L8794">8794</span>
<span id="L8795" rel="#L8795">8795</span>
<span id="L8796" rel="#L8796">8796</span>
<span id="L8797" rel="#L8797">8797</span>
<span id="L8798" rel="#L8798">8798</span>
<span id="L8799" rel="#L8799">8799</span>
<span id="L8800" rel="#L8800">8800</span>
<span id="L8801" rel="#L8801">8801</span>
<span id="L8802" rel="#L8802">8802</span>
<span id="L8803" rel="#L8803">8803</span>
<span id="L8804" rel="#L8804">8804</span>
<span id="L8805" rel="#L8805">8805</span>
<span id="L8806" rel="#L8806">8806</span>
<span id="L8807" rel="#L8807">8807</span>
<span id="L8808" rel="#L8808">8808</span>
<span id="L8809" rel="#L8809">8809</span>
<span id="L8810" rel="#L8810">8810</span>
<span id="L8811" rel="#L8811">8811</span>
<span id="L8812" rel="#L8812">8812</span>
<span id="L8813" rel="#L8813">8813</span>
<span id="L8814" rel="#L8814">8814</span>
<span id="L8815" rel="#L8815">8815</span>
<span id="L8816" rel="#L8816">8816</span>
<span id="L8817" rel="#L8817">8817</span>
<span id="L8818" rel="#L8818">8818</span>
<span id="L8819" rel="#L8819">8819</span>
<span id="L8820" rel="#L8820">8820</span>
<span id="L8821" rel="#L8821">8821</span>
<span id="L8822" rel="#L8822">8822</span>
<span id="L8823" rel="#L8823">8823</span>
<span id="L8824" rel="#L8824">8824</span>
<span id="L8825" rel="#L8825">8825</span>
<span id="L8826" rel="#L8826">8826</span>
<span id="L8827" rel="#L8827">8827</span>
<span id="L8828" rel="#L8828">8828</span>
<span id="L8829" rel="#L8829">8829</span>
<span id="L8830" rel="#L8830">8830</span>
<span id="L8831" rel="#L8831">8831</span>
<span id="L8832" rel="#L8832">8832</span>
<span id="L8833" rel="#L8833">8833</span>
<span id="L8834" rel="#L8834">8834</span>
<span id="L8835" rel="#L8835">8835</span>
<span id="L8836" rel="#L8836">8836</span>
<span id="L8837" rel="#L8837">8837</span>
<span id="L8838" rel="#L8838">8838</span>
<span id="L8839" rel="#L8839">8839</span>
<span id="L8840" rel="#L8840">8840</span>
<span id="L8841" rel="#L8841">8841</span>
<span id="L8842" rel="#L8842">8842</span>
<span id="L8843" rel="#L8843">8843</span>
<span id="L8844" rel="#L8844">8844</span>
<span id="L8845" rel="#L8845">8845</span>
<span id="L8846" rel="#L8846">8846</span>
<span id="L8847" rel="#L8847">8847</span>
<span id="L8848" rel="#L8848">8848</span>
<span id="L8849" rel="#L8849">8849</span>
<span id="L8850" rel="#L8850">8850</span>
<span id="L8851" rel="#L8851">8851</span>
<span id="L8852" rel="#L8852">8852</span>
<span id="L8853" rel="#L8853">8853</span>
<span id="L8854" rel="#L8854">8854</span>
<span id="L8855" rel="#L8855">8855</span>
<span id="L8856" rel="#L8856">8856</span>
<span id="L8857" rel="#L8857">8857</span>
<span id="L8858" rel="#L8858">8858</span>
<span id="L8859" rel="#L8859">8859</span>
<span id="L8860" rel="#L8860">8860</span>
<span id="L8861" rel="#L8861">8861</span>
<span id="L8862" rel="#L8862">8862</span>
<span id="L8863" rel="#L8863">8863</span>
<span id="L8864" rel="#L8864">8864</span>
<span id="L8865" rel="#L8865">8865</span>
<span id="L8866" rel="#L8866">8866</span>
<span id="L8867" rel="#L8867">8867</span>
<span id="L8868" rel="#L8868">8868</span>
<span id="L8869" rel="#L8869">8869</span>
<span id="L8870" rel="#L8870">8870</span>
<span id="L8871" rel="#L8871">8871</span>
<span id="L8872" rel="#L8872">8872</span>
<span id="L8873" rel="#L8873">8873</span>
<span id="L8874" rel="#L8874">8874</span>
<span id="L8875" rel="#L8875">8875</span>
<span id="L8876" rel="#L8876">8876</span>
<span id="L8877" rel="#L8877">8877</span>
<span id="L8878" rel="#L8878">8878</span>
<span id="L8879" rel="#L8879">8879</span>
<span id="L8880" rel="#L8880">8880</span>
<span id="L8881" rel="#L8881">8881</span>
<span id="L8882" rel="#L8882">8882</span>
<span id="L8883" rel="#L8883">8883</span>
<span id="L8884" rel="#L8884">8884</span>
<span id="L8885" rel="#L8885">8885</span>
<span id="L8886" rel="#L8886">8886</span>
<span id="L8887" rel="#L8887">8887</span>
<span id="L8888" rel="#L8888">8888</span>
<span id="L8889" rel="#L8889">8889</span>
<span id="L8890" rel="#L8890">8890</span>
<span id="L8891" rel="#L8891">8891</span>
<span id="L8892" rel="#L8892">8892</span>
<span id="L8893" rel="#L8893">8893</span>
<span id="L8894" rel="#L8894">8894</span>
<span id="L8895" rel="#L8895">8895</span>
<span id="L8896" rel="#L8896">8896</span>
<span id="L8897" rel="#L8897">8897</span>
<span id="L8898" rel="#L8898">8898</span>
<span id="L8899" rel="#L8899">8899</span>
<span id="L8900" rel="#L8900">8900</span>
<span id="L8901" rel="#L8901">8901</span>
<span id="L8902" rel="#L8902">8902</span>
<span id="L8903" rel="#L8903">8903</span>
<span id="L8904" rel="#L8904">8904</span>
<span id="L8905" rel="#L8905">8905</span>
<span id="L8906" rel="#L8906">8906</span>
<span id="L8907" rel="#L8907">8907</span>
<span id="L8908" rel="#L8908">8908</span>
<span id="L8909" rel="#L8909">8909</span>
<span id="L8910" rel="#L8910">8910</span>
<span id="L8911" rel="#L8911">8911</span>
<span id="L8912" rel="#L8912">8912</span>
<span id="L8913" rel="#L8913">8913</span>
<span id="L8914" rel="#L8914">8914</span>
<span id="L8915" rel="#L8915">8915</span>
<span id="L8916" rel="#L8916">8916</span>
<span id="L8917" rel="#L8917">8917</span>
<span id="L8918" rel="#L8918">8918</span>
<span id="L8919" rel="#L8919">8919</span>
<span id="L8920" rel="#L8920">8920</span>
<span id="L8921" rel="#L8921">8921</span>
<span id="L8922" rel="#L8922">8922</span>
<span id="L8923" rel="#L8923">8923</span>
<span id="L8924" rel="#L8924">8924</span>
<span id="L8925" rel="#L8925">8925</span>
<span id="L8926" rel="#L8926">8926</span>
<span id="L8927" rel="#L8927">8927</span>
<span id="L8928" rel="#L8928">8928</span>
<span id="L8929" rel="#L8929">8929</span>
<span id="L8930" rel="#L8930">8930</span>
<span id="L8931" rel="#L8931">8931</span>
<span id="L8932" rel="#L8932">8932</span>
<span id="L8933" rel="#L8933">8933</span>
<span id="L8934" rel="#L8934">8934</span>
<span id="L8935" rel="#L8935">8935</span>
<span id="L8936" rel="#L8936">8936</span>
<span id="L8937" rel="#L8937">8937</span>
<span id="L8938" rel="#L8938">8938</span>
<span id="L8939" rel="#L8939">8939</span>
<span id="L8940" rel="#L8940">8940</span>
<span id="L8941" rel="#L8941">8941</span>
<span id="L8942" rel="#L8942">8942</span>
<span id="L8943" rel="#L8943">8943</span>
<span id="L8944" rel="#L8944">8944</span>
<span id="L8945" rel="#L8945">8945</span>
<span id="L8946" rel="#L8946">8946</span>
<span id="L8947" rel="#L8947">8947</span>
<span id="L8948" rel="#L8948">8948</span>
<span id="L8949" rel="#L8949">8949</span>
<span id="L8950" rel="#L8950">8950</span>
<span id="L8951" rel="#L8951">8951</span>
<span id="L8952" rel="#L8952">8952</span>
<span id="L8953" rel="#L8953">8953</span>
<span id="L8954" rel="#L8954">8954</span>
<span id="L8955" rel="#L8955">8955</span>
<span id="L8956" rel="#L8956">8956</span>
<span id="L8957" rel="#L8957">8957</span>
<span id="L8958" rel="#L8958">8958</span>
<span id="L8959" rel="#L8959">8959</span>
<span id="L8960" rel="#L8960">8960</span>
<span id="L8961" rel="#L8961">8961</span>
<span id="L8962" rel="#L8962">8962</span>
<span id="L8963" rel="#L8963">8963</span>
<span id="L8964" rel="#L8964">8964</span>
<span id="L8965" rel="#L8965">8965</span>
<span id="L8966" rel="#L8966">8966</span>
<span id="L8967" rel="#L8967">8967</span>
<span id="L8968" rel="#L8968">8968</span>
<span id="L8969" rel="#L8969">8969</span>
<span id="L8970" rel="#L8970">8970</span>
<span id="L8971" rel="#L8971">8971</span>
<span id="L8972" rel="#L8972">8972</span>
<span id="L8973" rel="#L8973">8973</span>
<span id="L8974" rel="#L8974">8974</span>
<span id="L8975" rel="#L8975">8975</span>
<span id="L8976" rel="#L8976">8976</span>
<span id="L8977" rel="#L8977">8977</span>
<span id="L8978" rel="#L8978">8978</span>
<span id="L8979" rel="#L8979">8979</span>
<span id="L8980" rel="#L8980">8980</span>
<span id="L8981" rel="#L8981">8981</span>
<span id="L8982" rel="#L8982">8982</span>
<span id="L8983" rel="#L8983">8983</span>
<span id="L8984" rel="#L8984">8984</span>
<span id="L8985" rel="#L8985">8985</span>
<span id="L8986" rel="#L8986">8986</span>
<span id="L8987" rel="#L8987">8987</span>
<span id="L8988" rel="#L8988">8988</span>
<span id="L8989" rel="#L8989">8989</span>
<span id="L8990" rel="#L8990">8990</span>
<span id="L8991" rel="#L8991">8991</span>
<span id="L8992" rel="#L8992">8992</span>
<span id="L8993" rel="#L8993">8993</span>
<span id="L8994" rel="#L8994">8994</span>
<span id="L8995" rel="#L8995">8995</span>
<span id="L8996" rel="#L8996">8996</span>
<span id="L8997" rel="#L8997">8997</span>
<span id="L8998" rel="#L8998">8998</span>
<span id="L8999" rel="#L8999">8999</span>
<span id="L9000" rel="#L9000">9000</span>
<span id="L9001" rel="#L9001">9001</span>
<span id="L9002" rel="#L9002">9002</span>
<span id="L9003" rel="#L9003">9003</span>
<span id="L9004" rel="#L9004">9004</span>
<span id="L9005" rel="#L9005">9005</span>
<span id="L9006" rel="#L9006">9006</span>
<span id="L9007" rel="#L9007">9007</span>
<span id="L9008" rel="#L9008">9008</span>
<span id="L9009" rel="#L9009">9009</span>
<span id="L9010" rel="#L9010">9010</span>
<span id="L9011" rel="#L9011">9011</span>
<span id="L9012" rel="#L9012">9012</span>
<span id="L9013" rel="#L9013">9013</span>
<span id="L9014" rel="#L9014">9014</span>
<span id="L9015" rel="#L9015">9015</span>
<span id="L9016" rel="#L9016">9016</span>
<span id="L9017" rel="#L9017">9017</span>
<span id="L9018" rel="#L9018">9018</span>
<span id="L9019" rel="#L9019">9019</span>
<span id="L9020" rel="#L9020">9020</span>
<span id="L9021" rel="#L9021">9021</span>
<span id="L9022" rel="#L9022">9022</span>
<span id="L9023" rel="#L9023">9023</span>
<span id="L9024" rel="#L9024">9024</span>
<span id="L9025" rel="#L9025">9025</span>
<span id="L9026" rel="#L9026">9026</span>
<span id="L9027" rel="#L9027">9027</span>
<span id="L9028" rel="#L9028">9028</span>
<span id="L9029" rel="#L9029">9029</span>
<span id="L9030" rel="#L9030">9030</span>
<span id="L9031" rel="#L9031">9031</span>
<span id="L9032" rel="#L9032">9032</span>
<span id="L9033" rel="#L9033">9033</span>
<span id="L9034" rel="#L9034">9034</span>
<span id="L9035" rel="#L9035">9035</span>
<span id="L9036" rel="#L9036">9036</span>
<span id="L9037" rel="#L9037">9037</span>
<span id="L9038" rel="#L9038">9038</span>
<span id="L9039" rel="#L9039">9039</span>
<span id="L9040" rel="#L9040">9040</span>
<span id="L9041" rel="#L9041">9041</span>
<span id="L9042" rel="#L9042">9042</span>
<span id="L9043" rel="#L9043">9043</span>
<span id="L9044" rel="#L9044">9044</span>
<span id="L9045" rel="#L9045">9045</span>
<span id="L9046" rel="#L9046">9046</span>
<span id="L9047" rel="#L9047">9047</span>
<span id="L9048" rel="#L9048">9048</span>
<span id="L9049" rel="#L9049">9049</span>
<span id="L9050" rel="#L9050">9050</span>
<span id="L9051" rel="#L9051">9051</span>
<span id="L9052" rel="#L9052">9052</span>
<span id="L9053" rel="#L9053">9053</span>
<span id="L9054" rel="#L9054">9054</span>
<span id="L9055" rel="#L9055">9055</span>
<span id="L9056" rel="#L9056">9056</span>
<span id="L9057" rel="#L9057">9057</span>
<span id="L9058" rel="#L9058">9058</span>
<span id="L9059" rel="#L9059">9059</span>
<span id="L9060" rel="#L9060">9060</span>
<span id="L9061" rel="#L9061">9061</span>
<span id="L9062" rel="#L9062">9062</span>
<span id="L9063" rel="#L9063">9063</span>
<span id="L9064" rel="#L9064">9064</span>
<span id="L9065" rel="#L9065">9065</span>
<span id="L9066" rel="#L9066">9066</span>
<span id="L9067" rel="#L9067">9067</span>
<span id="L9068" rel="#L9068">9068</span>
<span id="L9069" rel="#L9069">9069</span>
<span id="L9070" rel="#L9070">9070</span>
<span id="L9071" rel="#L9071">9071</span>
<span id="L9072" rel="#L9072">9072</span>
<span id="L9073" rel="#L9073">9073</span>
<span id="L9074" rel="#L9074">9074</span>
<span id="L9075" rel="#L9075">9075</span>
<span id="L9076" rel="#L9076">9076</span>
<span id="L9077" rel="#L9077">9077</span>
<span id="L9078" rel="#L9078">9078</span>
<span id="L9079" rel="#L9079">9079</span>
<span id="L9080" rel="#L9080">9080</span>
<span id="L9081" rel="#L9081">9081</span>
<span id="L9082" rel="#L9082">9082</span>
<span id="L9083" rel="#L9083">9083</span>
<span id="L9084" rel="#L9084">9084</span>
<span id="L9085" rel="#L9085">9085</span>
<span id="L9086" rel="#L9086">9086</span>
<span id="L9087" rel="#L9087">9087</span>
<span id="L9088" rel="#L9088">9088</span>
<span id="L9089" rel="#L9089">9089</span>
<span id="L9090" rel="#L9090">9090</span>
<span id="L9091" rel="#L9091">9091</span>
<span id="L9092" rel="#L9092">9092</span>
<span id="L9093" rel="#L9093">9093</span>
<span id="L9094" rel="#L9094">9094</span>
<span id="L9095" rel="#L9095">9095</span>
<span id="L9096" rel="#L9096">9096</span>
<span id="L9097" rel="#L9097">9097</span>
<span id="L9098" rel="#L9098">9098</span>
<span id="L9099" rel="#L9099">9099</span>
<span id="L9100" rel="#L9100">9100</span>
<span id="L9101" rel="#L9101">9101</span>
<span id="L9102" rel="#L9102">9102</span>
<span id="L9103" rel="#L9103">9103</span>
<span id="L9104" rel="#L9104">9104</span>
<span id="L9105" rel="#L9105">9105</span>
<span id="L9106" rel="#L9106">9106</span>
<span id="L9107" rel="#L9107">9107</span>
<span id="L9108" rel="#L9108">9108</span>
<span id="L9109" rel="#L9109">9109</span>
<span id="L9110" rel="#L9110">9110</span>
<span id="L9111" rel="#L9111">9111</span>
<span id="L9112" rel="#L9112">9112</span>
<span id="L9113" rel="#L9113">9113</span>
<span id="L9114" rel="#L9114">9114</span>
<span id="L9115" rel="#L9115">9115</span>
<span id="L9116" rel="#L9116">9116</span>
<span id="L9117" rel="#L9117">9117</span>
<span id="L9118" rel="#L9118">9118</span>
<span id="L9119" rel="#L9119">9119</span>
<span id="L9120" rel="#L9120">9120</span>
<span id="L9121" rel="#L9121">9121</span>
<span id="L9122" rel="#L9122">9122</span>
<span id="L9123" rel="#L9123">9123</span>
<span id="L9124" rel="#L9124">9124</span>
<span id="L9125" rel="#L9125">9125</span>
<span id="L9126" rel="#L9126">9126</span>
<span id="L9127" rel="#L9127">9127</span>
<span id="L9128" rel="#L9128">9128</span>
<span id="L9129" rel="#L9129">9129</span>
<span id="L9130" rel="#L9130">9130</span>
<span id="L9131" rel="#L9131">9131</span>
<span id="L9132" rel="#L9132">9132</span>
<span id="L9133" rel="#L9133">9133</span>
<span id="L9134" rel="#L9134">9134</span>
<span id="L9135" rel="#L9135">9135</span>
<span id="L9136" rel="#L9136">9136</span>
<span id="L9137" rel="#L9137">9137</span>
<span id="L9138" rel="#L9138">9138</span>
<span id="L9139" rel="#L9139">9139</span>
<span id="L9140" rel="#L9140">9140</span>
<span id="L9141" rel="#L9141">9141</span>
<span id="L9142" rel="#L9142">9142</span>
<span id="L9143" rel="#L9143">9143</span>
<span id="L9144" rel="#L9144">9144</span>
<span id="L9145" rel="#L9145">9145</span>
<span id="L9146" rel="#L9146">9146</span>
<span id="L9147" rel="#L9147">9147</span>
<span id="L9148" rel="#L9148">9148</span>
<span id="L9149" rel="#L9149">9149</span>
<span id="L9150" rel="#L9150">9150</span>
<span id="L9151" rel="#L9151">9151</span>
<span id="L9152" rel="#L9152">9152</span>
<span id="L9153" rel="#L9153">9153</span>
<span id="L9154" rel="#L9154">9154</span>
<span id="L9155" rel="#L9155">9155</span>
<span id="L9156" rel="#L9156">9156</span>
<span id="L9157" rel="#L9157">9157</span>
<span id="L9158" rel="#L9158">9158</span>
<span id="L9159" rel="#L9159">9159</span>
<span id="L9160" rel="#L9160">9160</span>
<span id="L9161" rel="#L9161">9161</span>
<span id="L9162" rel="#L9162">9162</span>
<span id="L9163" rel="#L9163">9163</span>
<span id="L9164" rel="#L9164">9164</span>
<span id="L9165" rel="#L9165">9165</span>
<span id="L9166" rel="#L9166">9166</span>
<span id="L9167" rel="#L9167">9167</span>
<span id="L9168" rel="#L9168">9168</span>
<span id="L9169" rel="#L9169">9169</span>
<span id="L9170" rel="#L9170">9170</span>
<span id="L9171" rel="#L9171">9171</span>
<span id="L9172" rel="#L9172">9172</span>
<span id="L9173" rel="#L9173">9173</span>
<span id="L9174" rel="#L9174">9174</span>
<span id="L9175" rel="#L9175">9175</span>
<span id="L9176" rel="#L9176">9176</span>
<span id="L9177" rel="#L9177">9177</span>
<span id="L9178" rel="#L9178">9178</span>
<span id="L9179" rel="#L9179">9179</span>
<span id="L9180" rel="#L9180">9180</span>
<span id="L9181" rel="#L9181">9181</span>
<span id="L9182" rel="#L9182">9182</span>
<span id="L9183" rel="#L9183">9183</span>
<span id="L9184" rel="#L9184">9184</span>
<span id="L9185" rel="#L9185">9185</span>
<span id="L9186" rel="#L9186">9186</span>
<span id="L9187" rel="#L9187">9187</span>
<span id="L9188" rel="#L9188">9188</span>
<span id="L9189" rel="#L9189">9189</span>
<span id="L9190" rel="#L9190">9190</span>
<span id="L9191" rel="#L9191">9191</span>
<span id="L9192" rel="#L9192">9192</span>
<span id="L9193" rel="#L9193">9193</span>
<span id="L9194" rel="#L9194">9194</span>
<span id="L9195" rel="#L9195">9195</span>
<span id="L9196" rel="#L9196">9196</span>
<span id="L9197" rel="#L9197">9197</span>
<span id="L9198" rel="#L9198">9198</span>
<span id="L9199" rel="#L9199">9199</span>
<span id="L9200" rel="#L9200">9200</span>
<span id="L9201" rel="#L9201">9201</span>
<span id="L9202" rel="#L9202">9202</span>
<span id="L9203" rel="#L9203">9203</span>
<span id="L9204" rel="#L9204">9204</span>
<span id="L9205" rel="#L9205">9205</span>
<span id="L9206" rel="#L9206">9206</span>
<span id="L9207" rel="#L9207">9207</span>
<span id="L9208" rel="#L9208">9208</span>
<span id="L9209" rel="#L9209">9209</span>
<span id="L9210" rel="#L9210">9210</span>
<span id="L9211" rel="#L9211">9211</span>
<span id="L9212" rel="#L9212">9212</span>
<span id="L9213" rel="#L9213">9213</span>
<span id="L9214" rel="#L9214">9214</span>
<span id="L9215" rel="#L9215">9215</span>
<span id="L9216" rel="#L9216">9216</span>
<span id="L9217" rel="#L9217">9217</span>
<span id="L9218" rel="#L9218">9218</span>
<span id="L9219" rel="#L9219">9219</span>
<span id="L9220" rel="#L9220">9220</span>
<span id="L9221" rel="#L9221">9221</span>
<span id="L9222" rel="#L9222">9222</span>
<span id="L9223" rel="#L9223">9223</span>
<span id="L9224" rel="#L9224">9224</span>
<span id="L9225" rel="#L9225">9225</span>
<span id="L9226" rel="#L9226">9226</span>
<span id="L9227" rel="#L9227">9227</span>
<span id="L9228" rel="#L9228">9228</span>
<span id="L9229" rel="#L9229">9229</span>
<span id="L9230" rel="#L9230">9230</span>
<span id="L9231" rel="#L9231">9231</span>
<span id="L9232" rel="#L9232">9232</span>
<span id="L9233" rel="#L9233">9233</span>
<span id="L9234" rel="#L9234">9234</span>
<span id="L9235" rel="#L9235">9235</span>
<span id="L9236" rel="#L9236">9236</span>
<span id="L9237" rel="#L9237">9237</span>
<span id="L9238" rel="#L9238">9238</span>
<span id="L9239" rel="#L9239">9239</span>
<span id="L9240" rel="#L9240">9240</span>
<span id="L9241" rel="#L9241">9241</span>
<span id="L9242" rel="#L9242">9242</span>
<span id="L9243" rel="#L9243">9243</span>
<span id="L9244" rel="#L9244">9244</span>
<span id="L9245" rel="#L9245">9245</span>
<span id="L9246" rel="#L9246">9246</span>
<span id="L9247" rel="#L9247">9247</span>
<span id="L9248" rel="#L9248">9248</span>
<span id="L9249" rel="#L9249">9249</span>
<span id="L9250" rel="#L9250">9250</span>
<span id="L9251" rel="#L9251">9251</span>
<span id="L9252" rel="#L9252">9252</span>
<span id="L9253" rel="#L9253">9253</span>
<span id="L9254" rel="#L9254">9254</span>
<span id="L9255" rel="#L9255">9255</span>
<span id="L9256" rel="#L9256">9256</span>
<span id="L9257" rel="#L9257">9257</span>
<span id="L9258" rel="#L9258">9258</span>
<span id="L9259" rel="#L9259">9259</span>
<span id="L9260" rel="#L9260">9260</span>
<span id="L9261" rel="#L9261">9261</span>
<span id="L9262" rel="#L9262">9262</span>
<span id="L9263" rel="#L9263">9263</span>
<span id="L9264" rel="#L9264">9264</span>
<span id="L9265" rel="#L9265">9265</span>
<span id="L9266" rel="#L9266">9266</span>
<span id="L9267" rel="#L9267">9267</span>
<span id="L9268" rel="#L9268">9268</span>
<span id="L9269" rel="#L9269">9269</span>
<span id="L9270" rel="#L9270">9270</span>
<span id="L9271" rel="#L9271">9271</span>
<span id="L9272" rel="#L9272">9272</span>
<span id="L9273" rel="#L9273">9273</span>
<span id="L9274" rel="#L9274">9274</span>
<span id="L9275" rel="#L9275">9275</span>
<span id="L9276" rel="#L9276">9276</span>
<span id="L9277" rel="#L9277">9277</span>
<span id="L9278" rel="#L9278">9278</span>
<span id="L9279" rel="#L9279">9279</span>
<span id="L9280" rel="#L9280">9280</span>
<span id="L9281" rel="#L9281">9281</span>
<span id="L9282" rel="#L9282">9282</span>
<span id="L9283" rel="#L9283">9283</span>
<span id="L9284" rel="#L9284">9284</span>
<span id="L9285" rel="#L9285">9285</span>
<span id="L9286" rel="#L9286">9286</span>
<span id="L9287" rel="#L9287">9287</span>
<span id="L9288" rel="#L9288">9288</span>
<span id="L9289" rel="#L9289">9289</span>
<span id="L9290" rel="#L9290">9290</span>
<span id="L9291" rel="#L9291">9291</span>
<span id="L9292" rel="#L9292">9292</span>
<span id="L9293" rel="#L9293">9293</span>
<span id="L9294" rel="#L9294">9294</span>
<span id="L9295" rel="#L9295">9295</span>
<span id="L9296" rel="#L9296">9296</span>
<span id="L9297" rel="#L9297">9297</span>
<span id="L9298" rel="#L9298">9298</span>
<span id="L9299" rel="#L9299">9299</span>
<span id="L9300" rel="#L9300">9300</span>
<span id="L9301" rel="#L9301">9301</span>
<span id="L9302" rel="#L9302">9302</span>
<span id="L9303" rel="#L9303">9303</span>
<span id="L9304" rel="#L9304">9304</span>
<span id="L9305" rel="#L9305">9305</span>
<span id="L9306" rel="#L9306">9306</span>
<span id="L9307" rel="#L9307">9307</span>
<span id="L9308" rel="#L9308">9308</span>
<span id="L9309" rel="#L9309">9309</span>
<span id="L9310" rel="#L9310">9310</span>
<span id="L9311" rel="#L9311">9311</span>
<span id="L9312" rel="#L9312">9312</span>
<span id="L9313" rel="#L9313">9313</span>
<span id="L9314" rel="#L9314">9314</span>
<span id="L9315" rel="#L9315">9315</span>
<span id="L9316" rel="#L9316">9316</span>
<span id="L9317" rel="#L9317">9317</span>
<span id="L9318" rel="#L9318">9318</span>
<span id="L9319" rel="#L9319">9319</span>
<span id="L9320" rel="#L9320">9320</span>
<span id="L9321" rel="#L9321">9321</span>
<span id="L9322" rel="#L9322">9322</span>
<span id="L9323" rel="#L9323">9323</span>
<span id="L9324" rel="#L9324">9324</span>
<span id="L9325" rel="#L9325">9325</span>
<span id="L9326" rel="#L9326">9326</span>
<span id="L9327" rel="#L9327">9327</span>
<span id="L9328" rel="#L9328">9328</span>
<span id="L9329" rel="#L9329">9329</span>
<span id="L9330" rel="#L9330">9330</span>
<span id="L9331" rel="#L9331">9331</span>
<span id="L9332" rel="#L9332">9332</span>
<span id="L9333" rel="#L9333">9333</span>
<span id="L9334" rel="#L9334">9334</span>
<span id="L9335" rel="#L9335">9335</span>
<span id="L9336" rel="#L9336">9336</span>
<span id="L9337" rel="#L9337">9337</span>
<span id="L9338" rel="#L9338">9338</span>
<span id="L9339" rel="#L9339">9339</span>
<span id="L9340" rel="#L9340">9340</span>
<span id="L9341" rel="#L9341">9341</span>
<span id="L9342" rel="#L9342">9342</span>
<span id="L9343" rel="#L9343">9343</span>
<span id="L9344" rel="#L9344">9344</span>
<span id="L9345" rel="#L9345">9345</span>
<span id="L9346" rel="#L9346">9346</span>
<span id="L9347" rel="#L9347">9347</span>
<span id="L9348" rel="#L9348">9348</span>
<span id="L9349" rel="#L9349">9349</span>
<span id="L9350" rel="#L9350">9350</span>
<span id="L9351" rel="#L9351">9351</span>
<span id="L9352" rel="#L9352">9352</span>
<span id="L9353" rel="#L9353">9353</span>
<span id="L9354" rel="#L9354">9354</span>
<span id="L9355" rel="#L9355">9355</span>
<span id="L9356" rel="#L9356">9356</span>
<span id="L9357" rel="#L9357">9357</span>
<span id="L9358" rel="#L9358">9358</span>
<span id="L9359" rel="#L9359">9359</span>
<span id="L9360" rel="#L9360">9360</span>
<span id="L9361" rel="#L9361">9361</span>
<span id="L9362" rel="#L9362">9362</span>
<span id="L9363" rel="#L9363">9363</span>
<span id="L9364" rel="#L9364">9364</span>
<span id="L9365" rel="#L9365">9365</span>
<span id="L9366" rel="#L9366">9366</span>
<span id="L9367" rel="#L9367">9367</span>
<span id="L9368" rel="#L9368">9368</span>
<span id="L9369" rel="#L9369">9369</span>
<span id="L9370" rel="#L9370">9370</span>
<span id="L9371" rel="#L9371">9371</span>
<span id="L9372" rel="#L9372">9372</span>
<span id="L9373" rel="#L9373">9373</span>
<span id="L9374" rel="#L9374">9374</span>
<span id="L9375" rel="#L9375">9375</span>
<span id="L9376" rel="#L9376">9376</span>
<span id="L9377" rel="#L9377">9377</span>
<span id="L9378" rel="#L9378">9378</span>
<span id="L9379" rel="#L9379">9379</span>
<span id="L9380" rel="#L9380">9380</span>
<span id="L9381" rel="#L9381">9381</span>
<span id="L9382" rel="#L9382">9382</span>
<span id="L9383" rel="#L9383">9383</span>
<span id="L9384" rel="#L9384">9384</span>
<span id="L9385" rel="#L9385">9385</span>
<span id="L9386" rel="#L9386">9386</span>
<span id="L9387" rel="#L9387">9387</span>
<span id="L9388" rel="#L9388">9388</span>
<span id="L9389" rel="#L9389">9389</span>
<span id="L9390" rel="#L9390">9390</span>
<span id="L9391" rel="#L9391">9391</span>
<span id="L9392" rel="#L9392">9392</span>
<span id="L9393" rel="#L9393">9393</span>
<span id="L9394" rel="#L9394">9394</span>
<span id="L9395" rel="#L9395">9395</span>
<span id="L9396" rel="#L9396">9396</span>
<span id="L9397" rel="#L9397">9397</span>
<span id="L9398" rel="#L9398">9398</span>
<span id="L9399" rel="#L9399">9399</span>
<span id="L9400" rel="#L9400">9400</span>
<span id="L9401" rel="#L9401">9401</span>
<span id="L9402" rel="#L9402">9402</span>
<span id="L9403" rel="#L9403">9403</span>
<span id="L9404" rel="#L9404">9404</span>
<span id="L9405" rel="#L9405">9405</span>
<span id="L9406" rel="#L9406">9406</span>
<span id="L9407" rel="#L9407">9407</span>
<span id="L9408" rel="#L9408">9408</span>
<span id="L9409" rel="#L9409">9409</span>
<span id="L9410" rel="#L9410">9410</span>
<span id="L9411" rel="#L9411">9411</span>
<span id="L9412" rel="#L9412">9412</span>
<span id="L9413" rel="#L9413">9413</span>
<span id="L9414" rel="#L9414">9414</span>
<span id="L9415" rel="#L9415">9415</span>
<span id="L9416" rel="#L9416">9416</span>
<span id="L9417" rel="#L9417">9417</span>
<span id="L9418" rel="#L9418">9418</span>
<span id="L9419" rel="#L9419">9419</span>
<span id="L9420" rel="#L9420">9420</span>
<span id="L9421" rel="#L9421">9421</span>
<span id="L9422" rel="#L9422">9422</span>
<span id="L9423" rel="#L9423">9423</span>
<span id="L9424" rel="#L9424">9424</span>
<span id="L9425" rel="#L9425">9425</span>
<span id="L9426" rel="#L9426">9426</span>
<span id="L9427" rel="#L9427">9427</span>
<span id="L9428" rel="#L9428">9428</span>
<span id="L9429" rel="#L9429">9429</span>
<span id="L9430" rel="#L9430">9430</span>
<span id="L9431" rel="#L9431">9431</span>
<span id="L9432" rel="#L9432">9432</span>
<span id="L9433" rel="#L9433">9433</span>
<span id="L9434" rel="#L9434">9434</span>
<span id="L9435" rel="#L9435">9435</span>
<span id="L9436" rel="#L9436">9436</span>
<span id="L9437" rel="#L9437">9437</span>
<span id="L9438" rel="#L9438">9438</span>
<span id="L9439" rel="#L9439">9439</span>
<span id="L9440" rel="#L9440">9440</span>
<span id="L9441" rel="#L9441">9441</span>
<span id="L9442" rel="#L9442">9442</span>
<span id="L9443" rel="#L9443">9443</span>
<span id="L9444" rel="#L9444">9444</span>
<span id="L9445" rel="#L9445">9445</span>
<span id="L9446" rel="#L9446">9446</span>
<span id="L9447" rel="#L9447">9447</span>
<span id="L9448" rel="#L9448">9448</span>
<span id="L9449" rel="#L9449">9449</span>
<span id="L9450" rel="#L9450">9450</span>
<span id="L9451" rel="#L9451">9451</span>
<span id="L9452" rel="#L9452">9452</span>
<span id="L9453" rel="#L9453">9453</span>
<span id="L9454" rel="#L9454">9454</span>
<span id="L9455" rel="#L9455">9455</span>
<span id="L9456" rel="#L9456">9456</span>
<span id="L9457" rel="#L9457">9457</span>
<span id="L9458" rel="#L9458">9458</span>
<span id="L9459" rel="#L9459">9459</span>
<span id="L9460" rel="#L9460">9460</span>
<span id="L9461" rel="#L9461">9461</span>
<span id="L9462" rel="#L9462">9462</span>
<span id="L9463" rel="#L9463">9463</span>
<span id="L9464" rel="#L9464">9464</span>
<span id="L9465" rel="#L9465">9465</span>
<span id="L9466" rel="#L9466">9466</span>
<span id="L9467" rel="#L9467">9467</span>
<span id="L9468" rel="#L9468">9468</span>
<span id="L9469" rel="#L9469">9469</span>
<span id="L9470" rel="#L9470">9470</span>
<span id="L9471" rel="#L9471">9471</span>
<span id="L9472" rel="#L9472">9472</span>
<span id="L9473" rel="#L9473">9473</span>
<span id="L9474" rel="#L9474">9474</span>
<span id="L9475" rel="#L9475">9475</span>
<span id="L9476" rel="#L9476">9476</span>
<span id="L9477" rel="#L9477">9477</span>
<span id="L9478" rel="#L9478">9478</span>
<span id="L9479" rel="#L9479">9479</span>
<span id="L9480" rel="#L9480">9480</span>
<span id="L9481" rel="#L9481">9481</span>
<span id="L9482" rel="#L9482">9482</span>
<span id="L9483" rel="#L9483">9483</span>
<span id="L9484" rel="#L9484">9484</span>
<span id="L9485" rel="#L9485">9485</span>
<span id="L9486" rel="#L9486">9486</span>
<span id="L9487" rel="#L9487">9487</span>
<span id="L9488" rel="#L9488">9488</span>
<span id="L9489" rel="#L9489">9489</span>
<span id="L9490" rel="#L9490">9490</span>
<span id="L9491" rel="#L9491">9491</span>
<span id="L9492" rel="#L9492">9492</span>
<span id="L9493" rel="#L9493">9493</span>
<span id="L9494" rel="#L9494">9494</span>
<span id="L9495" rel="#L9495">9495</span>
<span id="L9496" rel="#L9496">9496</span>
<span id="L9497" rel="#L9497">9497</span>
<span id="L9498" rel="#L9498">9498</span>
<span id="L9499" rel="#L9499">9499</span>
<span id="L9500" rel="#L9500">9500</span>
<span id="L9501" rel="#L9501">9501</span>
<span id="L9502" rel="#L9502">9502</span>
<span id="L9503" rel="#L9503">9503</span>
<span id="L9504" rel="#L9504">9504</span>
<span id="L9505" rel="#L9505">9505</span>
<span id="L9506" rel="#L9506">9506</span>
<span id="L9507" rel="#L9507">9507</span>
<span id="L9508" rel="#L9508">9508</span>
<span id="L9509" rel="#L9509">9509</span>
<span id="L9510" rel="#L9510">9510</span>
<span id="L9511" rel="#L9511">9511</span>
<span id="L9512" rel="#L9512">9512</span>
<span id="L9513" rel="#L9513">9513</span>
<span id="L9514" rel="#L9514">9514</span>
<span id="L9515" rel="#L9515">9515</span>
<span id="L9516" rel="#L9516">9516</span>
<span id="L9517" rel="#L9517">9517</span>
<span id="L9518" rel="#L9518">9518</span>
<span id="L9519" rel="#L9519">9519</span>
<span id="L9520" rel="#L9520">9520</span>
<span id="L9521" rel="#L9521">9521</span>
<span id="L9522" rel="#L9522">9522</span>
<span id="L9523" rel="#L9523">9523</span>
<span id="L9524" rel="#L9524">9524</span>
<span id="L9525" rel="#L9525">9525</span>
<span id="L9526" rel="#L9526">9526</span>
<span id="L9527" rel="#L9527">9527</span>
<span id="L9528" rel="#L9528">9528</span>
<span id="L9529" rel="#L9529">9529</span>
<span id="L9530" rel="#L9530">9530</span>
<span id="L9531" rel="#L9531">9531</span>
<span id="L9532" rel="#L9532">9532</span>
<span id="L9533" rel="#L9533">9533</span>
<span id="L9534" rel="#L9534">9534</span>
<span id="L9535" rel="#L9535">9535</span>
<span id="L9536" rel="#L9536">9536</span>
<span id="L9537" rel="#L9537">9537</span>
<span id="L9538" rel="#L9538">9538</span>
<span id="L9539" rel="#L9539">9539</span>
<span id="L9540" rel="#L9540">9540</span>
<span id="L9541" rel="#L9541">9541</span>
<span id="L9542" rel="#L9542">9542</span>
<span id="L9543" rel="#L9543">9543</span>
<span id="L9544" rel="#L9544">9544</span>
<span id="L9545" rel="#L9545">9545</span>
<span id="L9546" rel="#L9546">9546</span>
<span id="L9547" rel="#L9547">9547</span>
<span id="L9548" rel="#L9548">9548</span>
<span id="L9549" rel="#L9549">9549</span>
<span id="L9550" rel="#L9550">9550</span>
<span id="L9551" rel="#L9551">9551</span>
<span id="L9552" rel="#L9552">9552</span>
<span id="L9553" rel="#L9553">9553</span>
<span id="L9554" rel="#L9554">9554</span>
<span id="L9555" rel="#L9555">9555</span>
<span id="L9556" rel="#L9556">9556</span>
<span id="L9557" rel="#L9557">9557</span>
<span id="L9558" rel="#L9558">9558</span>
<span id="L9559" rel="#L9559">9559</span>
<span id="L9560" rel="#L9560">9560</span>
<span id="L9561" rel="#L9561">9561</span>
<span id="L9562" rel="#L9562">9562</span>
<span id="L9563" rel="#L9563">9563</span>
<span id="L9564" rel="#L9564">9564</span>
<span id="L9565" rel="#L9565">9565</span>
<span id="L9566" rel="#L9566">9566</span>
<span id="L9567" rel="#L9567">9567</span>
<span id="L9568" rel="#L9568">9568</span>
<span id="L9569" rel="#L9569">9569</span>
<span id="L9570" rel="#L9570">9570</span>
<span id="L9571" rel="#L9571">9571</span>
<span id="L9572" rel="#L9572">9572</span>
<span id="L9573" rel="#L9573">9573</span>
<span id="L9574" rel="#L9574">9574</span>
<span id="L9575" rel="#L9575">9575</span>
<span id="L9576" rel="#L9576">9576</span>
<span id="L9577" rel="#L9577">9577</span>
<span id="L9578" rel="#L9578">9578</span>
<span id="L9579" rel="#L9579">9579</span>
<span id="L9580" rel="#L9580">9580</span>
<span id="L9581" rel="#L9581">9581</span>
<span id="L9582" rel="#L9582">9582</span>
<span id="L9583" rel="#L9583">9583</span>
<span id="L9584" rel="#L9584">9584</span>
<span id="L9585" rel="#L9585">9585</span>
<span id="L9586" rel="#L9586">9586</span>
<span id="L9587" rel="#L9587">9587</span>
<span id="L9588" rel="#L9588">9588</span>
<span id="L9589" rel="#L9589">9589</span>
<span id="L9590" rel="#L9590">9590</span>
<span id="L9591" rel="#L9591">9591</span>
<span id="L9592" rel="#L9592">9592</span>
<span id="L9593" rel="#L9593">9593</span>
<span id="L9594" rel="#L9594">9594</span>
<span id="L9595" rel="#L9595">9595</span>
<span id="L9596" rel="#L9596">9596</span>
<span id="L9597" rel="#L9597">9597</span>
<span id="L9598" rel="#L9598">9598</span>
<span id="L9599" rel="#L9599">9599</span>
<span id="L9600" rel="#L9600">9600</span>
<span id="L9601" rel="#L9601">9601</span>
<span id="L9602" rel="#L9602">9602</span>
<span id="L9603" rel="#L9603">9603</span>
<span id="L9604" rel="#L9604">9604</span>
<span id="L9605" rel="#L9605">9605</span>
<span id="L9606" rel="#L9606">9606</span>
<span id="L9607" rel="#L9607">9607</span>
<span id="L9608" rel="#L9608">9608</span>
<span id="L9609" rel="#L9609">9609</span>
<span id="L9610" rel="#L9610">9610</span>
<span id="L9611" rel="#L9611">9611</span>
<span id="L9612" rel="#L9612">9612</span>
<span id="L9613" rel="#L9613">9613</span>
<span id="L9614" rel="#L9614">9614</span>
<span id="L9615" rel="#L9615">9615</span>
<span id="L9616" rel="#L9616">9616</span>
<span id="L9617" rel="#L9617">9617</span>
<span id="L9618" rel="#L9618">9618</span>
<span id="L9619" rel="#L9619">9619</span>
<span id="L9620" rel="#L9620">9620</span>
<span id="L9621" rel="#L9621">9621</span>
<span id="L9622" rel="#L9622">9622</span>
<span id="L9623" rel="#L9623">9623</span>
<span id="L9624" rel="#L9624">9624</span>
<span id="L9625" rel="#L9625">9625</span>
<span id="L9626" rel="#L9626">9626</span>
<span id="L9627" rel="#L9627">9627</span>
<span id="L9628" rel="#L9628">9628</span>
<span id="L9629" rel="#L9629">9629</span>
<span id="L9630" rel="#L9630">9630</span>
<span id="L9631" rel="#L9631">9631</span>
<span id="L9632" rel="#L9632">9632</span>
<span id="L9633" rel="#L9633">9633</span>
<span id="L9634" rel="#L9634">9634</span>
<span id="L9635" rel="#L9635">9635</span>
<span id="L9636" rel="#L9636">9636</span>
<span id="L9637" rel="#L9637">9637</span>
<span id="L9638" rel="#L9638">9638</span>
<span id="L9639" rel="#L9639">9639</span>
<span id="L9640" rel="#L9640">9640</span>
<span id="L9641" rel="#L9641">9641</span>
<span id="L9642" rel="#L9642">9642</span>
<span id="L9643" rel="#L9643">9643</span>
<span id="L9644" rel="#L9644">9644</span>
<span id="L9645" rel="#L9645">9645</span>
<span id="L9646" rel="#L9646">9646</span>
<span id="L9647" rel="#L9647">9647</span>
<span id="L9648" rel="#L9648">9648</span>
<span id="L9649" rel="#L9649">9649</span>
<span id="L9650" rel="#L9650">9650</span>
<span id="L9651" rel="#L9651">9651</span>
<span id="L9652" rel="#L9652">9652</span>
<span id="L9653" rel="#L9653">9653</span>
<span id="L9654" rel="#L9654">9654</span>
<span id="L9655" rel="#L9655">9655</span>
<span id="L9656" rel="#L9656">9656</span>
<span id="L9657" rel="#L9657">9657</span>
<span id="L9658" rel="#L9658">9658</span>
<span id="L9659" rel="#L9659">9659</span>
<span id="L9660" rel="#L9660">9660</span>
<span id="L9661" rel="#L9661">9661</span>
<span id="L9662" rel="#L9662">9662</span>
<span id="L9663" rel="#L9663">9663</span>
<span id="L9664" rel="#L9664">9664</span>
<span id="L9665" rel="#L9665">9665</span>
<span id="L9666" rel="#L9666">9666</span>
<span id="L9667" rel="#L9667">9667</span>
<span id="L9668" rel="#L9668">9668</span>
<span id="L9669" rel="#L9669">9669</span>
<span id="L9670" rel="#L9670">9670</span>
<span id="L9671" rel="#L9671">9671</span>
<span id="L9672" rel="#L9672">9672</span>
<span id="L9673" rel="#L9673">9673</span>
<span id="L9674" rel="#L9674">9674</span>
<span id="L9675" rel="#L9675">9675</span>
<span id="L9676" rel="#L9676">9676</span>
<span id="L9677" rel="#L9677">9677</span>
<span id="L9678" rel="#L9678">9678</span>
<span id="L9679" rel="#L9679">9679</span>
<span id="L9680" rel="#L9680">9680</span>
<span id="L9681" rel="#L9681">9681</span>
<span id="L9682" rel="#L9682">9682</span>
<span id="L9683" rel="#L9683">9683</span>
<span id="L9684" rel="#L9684">9684</span>
<span id="L9685" rel="#L9685">9685</span>
<span id="L9686" rel="#L9686">9686</span>
<span id="L9687" rel="#L9687">9687</span>
<span id="L9688" rel="#L9688">9688</span>
<span id="L9689" rel="#L9689">9689</span>
<span id="L9690" rel="#L9690">9690</span>
<span id="L9691" rel="#L9691">9691</span>
<span id="L9692" rel="#L9692">9692</span>
<span id="L9693" rel="#L9693">9693</span>
<span id="L9694" rel="#L9694">9694</span>
<span id="L9695" rel="#L9695">9695</span>
<span id="L9696" rel="#L9696">9696</span>
<span id="L9697" rel="#L9697">9697</span>
<span id="L9698" rel="#L9698">9698</span>
<span id="L9699" rel="#L9699">9699</span>
<span id="L9700" rel="#L9700">9700</span>
<span id="L9701" rel="#L9701">9701</span>
<span id="L9702" rel="#L9702">9702</span>
<span id="L9703" rel="#L9703">9703</span>
<span id="L9704" rel="#L9704">9704</span>
<span id="L9705" rel="#L9705">9705</span>
<span id="L9706" rel="#L9706">9706</span>
<span id="L9707" rel="#L9707">9707</span>
<span id="L9708" rel="#L9708">9708</span>
<span id="L9709" rel="#L9709">9709</span>
<span id="L9710" rel="#L9710">9710</span>
<span id="L9711" rel="#L9711">9711</span>
<span id="L9712" rel="#L9712">9712</span>
<span id="L9713" rel="#L9713">9713</span>
<span id="L9714" rel="#L9714">9714</span>
<span id="L9715" rel="#L9715">9715</span>
<span id="L9716" rel="#L9716">9716</span>
<span id="L9717" rel="#L9717">9717</span>
<span id="L9718" rel="#L9718">9718</span>
<span id="L9719" rel="#L9719">9719</span>
<span id="L9720" rel="#L9720">9720</span>
<span id="L9721" rel="#L9721">9721</span>
<span id="L9722" rel="#L9722">9722</span>
<span id="L9723" rel="#L9723">9723</span>
<span id="L9724" rel="#L9724">9724</span>
<span id="L9725" rel="#L9725">9725</span>
<span id="L9726" rel="#L9726">9726</span>
<span id="L9727" rel="#L9727">9727</span>
<span id="L9728" rel="#L9728">9728</span>
<span id="L9729" rel="#L9729">9729</span>
<span id="L9730" rel="#L9730">9730</span>
<span id="L9731" rel="#L9731">9731</span>
<span id="L9732" rel="#L9732">9732</span>
<span id="L9733" rel="#L9733">9733</span>
<span id="L9734" rel="#L9734">9734</span>
<span id="L9735" rel="#L9735">9735</span>
<span id="L9736" rel="#L9736">9736</span>
<span id="L9737" rel="#L9737">9737</span>
<span id="L9738" rel="#L9738">9738</span>
<span id="L9739" rel="#L9739">9739</span>
<span id="L9740" rel="#L9740">9740</span>
<span id="L9741" rel="#L9741">9741</span>
<span id="L9742" rel="#L9742">9742</span>
<span id="L9743" rel="#L9743">9743</span>
<span id="L9744" rel="#L9744">9744</span>
<span id="L9745" rel="#L9745">9745</span>
<span id="L9746" rel="#L9746">9746</span>
<span id="L9747" rel="#L9747">9747</span>
<span id="L9748" rel="#L9748">9748</span>
<span id="L9749" rel="#L9749">9749</span>
<span id="L9750" rel="#L9750">9750</span>
<span id="L9751" rel="#L9751">9751</span>
<span id="L9752" rel="#L9752">9752</span>
<span id="L9753" rel="#L9753">9753</span>
<span id="L9754" rel="#L9754">9754</span>
<span id="L9755" rel="#L9755">9755</span>
<span id="L9756" rel="#L9756">9756</span>
<span id="L9757" rel="#L9757">9757</span>
<span id="L9758" rel="#L9758">9758</span>
<span id="L9759" rel="#L9759">9759</span>
<span id="L9760" rel="#L9760">9760</span>
<span id="L9761" rel="#L9761">9761</span>
<span id="L9762" rel="#L9762">9762</span>
<span id="L9763" rel="#L9763">9763</span>
<span id="L9764" rel="#L9764">9764</span>
<span id="L9765" rel="#L9765">9765</span>
<span id="L9766" rel="#L9766">9766</span>
<span id="L9767" rel="#L9767">9767</span>
<span id="L9768" rel="#L9768">9768</span>
<span id="L9769" rel="#L9769">9769</span>
<span id="L9770" rel="#L9770">9770</span>
<span id="L9771" rel="#L9771">9771</span>
<span id="L9772" rel="#L9772">9772</span>
<span id="L9773" rel="#L9773">9773</span>
<span id="L9774" rel="#L9774">9774</span>
<span id="L9775" rel="#L9775">9775</span>
<span id="L9776" rel="#L9776">9776</span>
<span id="L9777" rel="#L9777">9777</span>
<span id="L9778" rel="#L9778">9778</span>
<span id="L9779" rel="#L9779">9779</span>
<span id="L9780" rel="#L9780">9780</span>
<span id="L9781" rel="#L9781">9781</span>
<span id="L9782" rel="#L9782">9782</span>
<span id="L9783" rel="#L9783">9783</span>
<span id="L9784" rel="#L9784">9784</span>
<span id="L9785" rel="#L9785">9785</span>
<span id="L9786" rel="#L9786">9786</span>
<span id="L9787" rel="#L9787">9787</span>
<span id="L9788" rel="#L9788">9788</span>
<span id="L9789" rel="#L9789">9789</span>
<span id="L9790" rel="#L9790">9790</span>
<span id="L9791" rel="#L9791">9791</span>
<span id="L9792" rel="#L9792">9792</span>
<span id="L9793" rel="#L9793">9793</span>
<span id="L9794" rel="#L9794">9794</span>
<span id="L9795" rel="#L9795">9795</span>
<span id="L9796" rel="#L9796">9796</span>
<span id="L9797" rel="#L9797">9797</span>
<span id="L9798" rel="#L9798">9798</span>
<span id="L9799" rel="#L9799">9799</span>
<span id="L9800" rel="#L9800">9800</span>
<span id="L9801" rel="#L9801">9801</span>
<span id="L9802" rel="#L9802">9802</span>
<span id="L9803" rel="#L9803">9803</span>
<span id="L9804" rel="#L9804">9804</span>
<span id="L9805" rel="#L9805">9805</span>
<span id="L9806" rel="#L9806">9806</span>
<span id="L9807" rel="#L9807">9807</span>
<span id="L9808" rel="#L9808">9808</span>
<span id="L9809" rel="#L9809">9809</span>
<span id="L9810" rel="#L9810">9810</span>
<span id="L9811" rel="#L9811">9811</span>
<span id="L9812" rel="#L9812">9812</span>
<span id="L9813" rel="#L9813">9813</span>
<span id="L9814" rel="#L9814">9814</span>
<span id="L9815" rel="#L9815">9815</span>
<span id="L9816" rel="#L9816">9816</span>
<span id="L9817" rel="#L9817">9817</span>
<span id="L9818" rel="#L9818">9818</span>
<span id="L9819" rel="#L9819">9819</span>
<span id="L9820" rel="#L9820">9820</span>
<span id="L9821" rel="#L9821">9821</span>
<span id="L9822" rel="#L9822">9822</span>
<span id="L9823" rel="#L9823">9823</span>
<span id="L9824" rel="#L9824">9824</span>
<span id="L9825" rel="#L9825">9825</span>
<span id="L9826" rel="#L9826">9826</span>
<span id="L9827" rel="#L9827">9827</span>
<span id="L9828" rel="#L9828">9828</span>
<span id="L9829" rel="#L9829">9829</span>
<span id="L9830" rel="#L9830">9830</span>
<span id="L9831" rel="#L9831">9831</span>
<span id="L9832" rel="#L9832">9832</span>
<span id="L9833" rel="#L9833">9833</span>
<span id="L9834" rel="#L9834">9834</span>
<span id="L9835" rel="#L9835">9835</span>
<span id="L9836" rel="#L9836">9836</span>
<span id="L9837" rel="#L9837">9837</span>
<span id="L9838" rel="#L9838">9838</span>
<span id="L9839" rel="#L9839">9839</span>
<span id="L9840" rel="#L9840">9840</span>
<span id="L9841" rel="#L9841">9841</span>
<span id="L9842" rel="#L9842">9842</span>
<span id="L9843" rel="#L9843">9843</span>
<span id="L9844" rel="#L9844">9844</span>
<span id="L9845" rel="#L9845">9845</span>
<span id="L9846" rel="#L9846">9846</span>
<span id="L9847" rel="#L9847">9847</span>
<span id="L9848" rel="#L9848">9848</span>
<span id="L9849" rel="#L9849">9849</span>
<span id="L9850" rel="#L9850">9850</span>
<span id="L9851" rel="#L9851">9851</span>
<span id="L9852" rel="#L9852">9852</span>
<span id="L9853" rel="#L9853">9853</span>
<span id="L9854" rel="#L9854">9854</span>
<span id="L9855" rel="#L9855">9855</span>
<span id="L9856" rel="#L9856">9856</span>
<span id="L9857" rel="#L9857">9857</span>
<span id="L9858" rel="#L9858">9858</span>
<span id="L9859" rel="#L9859">9859</span>
<span id="L9860" rel="#L9860">9860</span>
<span id="L9861" rel="#L9861">9861</span>
<span id="L9862" rel="#L9862">9862</span>
<span id="L9863" rel="#L9863">9863</span>
<span id="L9864" rel="#L9864">9864</span>
<span id="L9865" rel="#L9865">9865</span>
<span id="L9866" rel="#L9866">9866</span>
<span id="L9867" rel="#L9867">9867</span>
<span id="L9868" rel="#L9868">9868</span>
<span id="L9869" rel="#L9869">9869</span>
<span id="L9870" rel="#L9870">9870</span>
<span id="L9871" rel="#L9871">9871</span>
<span id="L9872" rel="#L9872">9872</span>
<span id="L9873" rel="#L9873">9873</span>
<span id="L9874" rel="#L9874">9874</span>
<span id="L9875" rel="#L9875">9875</span>
<span id="L9876" rel="#L9876">9876</span>
<span id="L9877" rel="#L9877">9877</span>
<span id="L9878" rel="#L9878">9878</span>
<span id="L9879" rel="#L9879">9879</span>
<span id="L9880" rel="#L9880">9880</span>
<span id="L9881" rel="#L9881">9881</span>
<span id="L9882" rel="#L9882">9882</span>
<span id="L9883" rel="#L9883">9883</span>
<span id="L9884" rel="#L9884">9884</span>
<span id="L9885" rel="#L9885">9885</span>
<span id="L9886" rel="#L9886">9886</span>
<span id="L9887" rel="#L9887">9887</span>
<span id="L9888" rel="#L9888">9888</span>
<span id="L9889" rel="#L9889">9889</span>
<span id="L9890" rel="#L9890">9890</span>
<span id="L9891" rel="#L9891">9891</span>
<span id="L9892" rel="#L9892">9892</span>
<span id="L9893" rel="#L9893">9893</span>
<span id="L9894" rel="#L9894">9894</span>
<span id="L9895" rel="#L9895">9895</span>
<span id="L9896" rel="#L9896">9896</span>
<span id="L9897" rel="#L9897">9897</span>
<span id="L9898" rel="#L9898">9898</span>
<span id="L9899" rel="#L9899">9899</span>
<span id="L9900" rel="#L9900">9900</span>
<span id="L9901" rel="#L9901">9901</span>
<span id="L9902" rel="#L9902">9902</span>
<span id="L9903" rel="#L9903">9903</span>
<span id="L9904" rel="#L9904">9904</span>
<span id="L9905" rel="#L9905">9905</span>
<span id="L9906" rel="#L9906">9906</span>
<span id="L9907" rel="#L9907">9907</span>
<span id="L9908" rel="#L9908">9908</span>
<span id="L9909" rel="#L9909">9909</span>
<span id="L9910" rel="#L9910">9910</span>
<span id="L9911" rel="#L9911">9911</span>
<span id="L9912" rel="#L9912">9912</span>
<span id="L9913" rel="#L9913">9913</span>
<span id="L9914" rel="#L9914">9914</span>
<span id="L9915" rel="#L9915">9915</span>
<span id="L9916" rel="#L9916">9916</span>
<span id="L9917" rel="#L9917">9917</span>
<span id="L9918" rel="#L9918">9918</span>
<span id="L9919" rel="#L9919">9919</span>
<span id="L9920" rel="#L9920">9920</span>
<span id="L9921" rel="#L9921">9921</span>
<span id="L9922" rel="#L9922">9922</span>
<span id="L9923" rel="#L9923">9923</span>
<span id="L9924" rel="#L9924">9924</span>
<span id="L9925" rel="#L9925">9925</span>
<span id="L9926" rel="#L9926">9926</span>
<span id="L9927" rel="#L9927">9927</span>
<span id="L9928" rel="#L9928">9928</span>
<span id="L9929" rel="#L9929">9929</span>
<span id="L9930" rel="#L9930">9930</span>
<span id="L9931" rel="#L9931">9931</span>
<span id="L9932" rel="#L9932">9932</span>
<span id="L9933" rel="#L9933">9933</span>
<span id="L9934" rel="#L9934">9934</span>
<span id="L9935" rel="#L9935">9935</span>
<span id="L9936" rel="#L9936">9936</span>
<span id="L9937" rel="#L9937">9937</span>
<span id="L9938" rel="#L9938">9938</span>
<span id="L9939" rel="#L9939">9939</span>
<span id="L9940" rel="#L9940">9940</span>
<span id="L9941" rel="#L9941">9941</span>
<span id="L9942" rel="#L9942">9942</span>
<span id="L9943" rel="#L9943">9943</span>
<span id="L9944" rel="#L9944">9944</span>
<span id="L9945" rel="#L9945">9945</span>
<span id="L9946" rel="#L9946">9946</span>
<span id="L9947" rel="#L9947">9947</span>
<span id="L9948" rel="#L9948">9948</span>
<span id="L9949" rel="#L9949">9949</span>
<span id="L9950" rel="#L9950">9950</span>
<span id="L9951" rel="#L9951">9951</span>
<span id="L9952" rel="#L9952">9952</span>
<span id="L9953" rel="#L9953">9953</span>
<span id="L9954" rel="#L9954">9954</span>
<span id="L9955" rel="#L9955">9955</span>
<span id="L9956" rel="#L9956">9956</span>
<span id="L9957" rel="#L9957">9957</span>
<span id="L9958" rel="#L9958">9958</span>
<span id="L9959" rel="#L9959">9959</span>
<span id="L9960" rel="#L9960">9960</span>
<span id="L9961" rel="#L9961">9961</span>
<span id="L9962" rel="#L9962">9962</span>
<span id="L9963" rel="#L9963">9963</span>
<span id="L9964" rel="#L9964">9964</span>
<span id="L9965" rel="#L9965">9965</span>
<span id="L9966" rel="#L9966">9966</span>
<span id="L9967" rel="#L9967">9967</span>
<span id="L9968" rel="#L9968">9968</span>
<span id="L9969" rel="#L9969">9969</span>
<span id="L9970" rel="#L9970">9970</span>
<span id="L9971" rel="#L9971">9971</span>
<span id="L9972" rel="#L9972">9972</span>
<span id="L9973" rel="#L9973">9973</span>
<span id="L9974" rel="#L9974">9974</span>
<span id="L9975" rel="#L9975">9975</span>
<span id="L9976" rel="#L9976">9976</span>
<span id="L9977" rel="#L9977">9977</span>
<span id="L9978" rel="#L9978">9978</span>
<span id="L9979" rel="#L9979">9979</span>
<span id="L9980" rel="#L9980">9980</span>
<span id="L9981" rel="#L9981">9981</span>
<span id="L9982" rel="#L9982">9982</span>
<span id="L9983" rel="#L9983">9983</span>
<span id="L9984" rel="#L9984">9984</span>
<span id="L9985" rel="#L9985">9985</span>
<span id="L9986" rel="#L9986">9986</span>
<span id="L9987" rel="#L9987">9987</span>
<span id="L9988" rel="#L9988">9988</span>
<span id="L9989" rel="#L9989">9989</span>
<span id="L9990" rel="#L9990">9990</span>
<span id="L9991" rel="#L9991">9991</span>
<span id="L9992" rel="#L9992">9992</span>
<span id="L9993" rel="#L9993">9993</span>
<span id="L9994" rel="#L9994">9994</span>
<span id="L9995" rel="#L9995">9995</span>
<span id="L9996" rel="#L9996">9996</span>
<span id="L9997" rel="#L9997">9997</span>
<span id="L9998" rel="#L9998">9998</span>
<span id="L9999" rel="#L9999">9999</span>
<span id="L10000" rel="#L10000">10000</span>
<span id="L10001" rel="#L10001">10001</span>
<span id="L10002" rel="#L10002">10002</span>
<span id="L10003" rel="#L10003">10003</span>
<span id="L10004" rel="#L10004">10004</span>
<span id="L10005" rel="#L10005">10005</span>
<span id="L10006" rel="#L10006">10006</span>
<span id="L10007" rel="#L10007">10007</span>
<span id="L10008" rel="#L10008">10008</span>
<span id="L10009" rel="#L10009">10009</span>
<span id="L10010" rel="#L10010">10010</span>
<span id="L10011" rel="#L10011">10011</span>
<span id="L10012" rel="#L10012">10012</span>
<span id="L10013" rel="#L10013">10013</span>
<span id="L10014" rel="#L10014">10014</span>
<span id="L10015" rel="#L10015">10015</span>
<span id="L10016" rel="#L10016">10016</span>
<span id="L10017" rel="#L10017">10017</span>
<span id="L10018" rel="#L10018">10018</span>
<span id="L10019" rel="#L10019">10019</span>
<span id="L10020" rel="#L10020">10020</span>
<span id="L10021" rel="#L10021">10021</span>
<span id="L10022" rel="#L10022">10022</span>
<span id="L10023" rel="#L10023">10023</span>
<span id="L10024" rel="#L10024">10024</span>
<span id="L10025" rel="#L10025">10025</span>
<span id="L10026" rel="#L10026">10026</span>
<span id="L10027" rel="#L10027">10027</span>
<span id="L10028" rel="#L10028">10028</span>
<span id="L10029" rel="#L10029">10029</span>
<span id="L10030" rel="#L10030">10030</span>
<span id="L10031" rel="#L10031">10031</span>
<span id="L10032" rel="#L10032">10032</span>
<span id="L10033" rel="#L10033">10033</span>
<span id="L10034" rel="#L10034">10034</span>
<span id="L10035" rel="#L10035">10035</span>
<span id="L10036" rel="#L10036">10036</span>
<span id="L10037" rel="#L10037">10037</span>
<span id="L10038" rel="#L10038">10038</span>
<span id="L10039" rel="#L10039">10039</span>
<span id="L10040" rel="#L10040">10040</span>
<span id="L10041" rel="#L10041">10041</span>
<span id="L10042" rel="#L10042">10042</span>
<span id="L10043" rel="#L10043">10043</span>
<span id="L10044" rel="#L10044">10044</span>
<span id="L10045" rel="#L10045">10045</span>
<span id="L10046" rel="#L10046">10046</span>
<span id="L10047" rel="#L10047">10047</span>
<span id="L10048" rel="#L10048">10048</span>
<span id="L10049" rel="#L10049">10049</span>
<span id="L10050" rel="#L10050">10050</span>
<span id="L10051" rel="#L10051">10051</span>
<span id="L10052" rel="#L10052">10052</span>
<span id="L10053" rel="#L10053">10053</span>
<span id="L10054" rel="#L10054">10054</span>
<span id="L10055" rel="#L10055">10055</span>
<span id="L10056" rel="#L10056">10056</span>
<span id="L10057" rel="#L10057">10057</span>
<span id="L10058" rel="#L10058">10058</span>
<span id="L10059" rel="#L10059">10059</span>
<span id="L10060" rel="#L10060">10060</span>
<span id="L10061" rel="#L10061">10061</span>
<span id="L10062" rel="#L10062">10062</span>
<span id="L10063" rel="#L10063">10063</span>
<span id="L10064" rel="#L10064">10064</span>
<span id="L10065" rel="#L10065">10065</span>
<span id="L10066" rel="#L10066">10066</span>
<span id="L10067" rel="#L10067">10067</span>
<span id="L10068" rel="#L10068">10068</span>
<span id="L10069" rel="#L10069">10069</span>
<span id="L10070" rel="#L10070">10070</span>
<span id="L10071" rel="#L10071">10071</span>
<span id="L10072" rel="#L10072">10072</span>
<span id="L10073" rel="#L10073">10073</span>
<span id="L10074" rel="#L10074">10074</span>
<span id="L10075" rel="#L10075">10075</span>
<span id="L10076" rel="#L10076">10076</span>
<span id="L10077" rel="#L10077">10077</span>
<span id="L10078" rel="#L10078">10078</span>
<span id="L10079" rel="#L10079">10079</span>
<span id="L10080" rel="#L10080">10080</span>
<span id="L10081" rel="#L10081">10081</span>
<span id="L10082" rel="#L10082">10082</span>
<span id="L10083" rel="#L10083">10083</span>
<span id="L10084" rel="#L10084">10084</span>
<span id="L10085" rel="#L10085">10085</span>
<span id="L10086" rel="#L10086">10086</span>
<span id="L10087" rel="#L10087">10087</span>
<span id="L10088" rel="#L10088">10088</span>
<span id="L10089" rel="#L10089">10089</span>
<span id="L10090" rel="#L10090">10090</span>
<span id="L10091" rel="#L10091">10091</span>
<span id="L10092" rel="#L10092">10092</span>
<span id="L10093" rel="#L10093">10093</span>
<span id="L10094" rel="#L10094">10094</span>
<span id="L10095" rel="#L10095">10095</span>
<span id="L10096" rel="#L10096">10096</span>
<span id="L10097" rel="#L10097">10097</span>
<span id="L10098" rel="#L10098">10098</span>
<span id="L10099" rel="#L10099">10099</span>
<span id="L10100" rel="#L10100">10100</span>
<span id="L10101" rel="#L10101">10101</span>
<span id="L10102" rel="#L10102">10102</span>
<span id="L10103" rel="#L10103">10103</span>
<span id="L10104" rel="#L10104">10104</span>
<span id="L10105" rel="#L10105">10105</span>
<span id="L10106" rel="#L10106">10106</span>
<span id="L10107" rel="#L10107">10107</span>
<span id="L10108" rel="#L10108">10108</span>
<span id="L10109" rel="#L10109">10109</span>
<span id="L10110" rel="#L10110">10110</span>
<span id="L10111" rel="#L10111">10111</span>
<span id="L10112" rel="#L10112">10112</span>
<span id="L10113" rel="#L10113">10113</span>
<span id="L10114" rel="#L10114">10114</span>
<span id="L10115" rel="#L10115">10115</span>
<span id="L10116" rel="#L10116">10116</span>
<span id="L10117" rel="#L10117">10117</span>
<span id="L10118" rel="#L10118">10118</span>
<span id="L10119" rel="#L10119">10119</span>
<span id="L10120" rel="#L10120">10120</span>
<span id="L10121" rel="#L10121">10121</span>
<span id="L10122" rel="#L10122">10122</span>
<span id="L10123" rel="#L10123">10123</span>
<span id="L10124" rel="#L10124">10124</span>
<span id="L10125" rel="#L10125">10125</span>
<span id="L10126" rel="#L10126">10126</span>
<span id="L10127" rel="#L10127">10127</span>
<span id="L10128" rel="#L10128">10128</span>
<span id="L10129" rel="#L10129">10129</span>
<span id="L10130" rel="#L10130">10130</span>
<span id="L10131" rel="#L10131">10131</span>
<span id="L10132" rel="#L10132">10132</span>
<span id="L10133" rel="#L10133">10133</span>
<span id="L10134" rel="#L10134">10134</span>
<span id="L10135" rel="#L10135">10135</span>
<span id="L10136" rel="#L10136">10136</span>
<span id="L10137" rel="#L10137">10137</span>
<span id="L10138" rel="#L10138">10138</span>
<span id="L10139" rel="#L10139">10139</span>
<span id="L10140" rel="#L10140">10140</span>
<span id="L10141" rel="#L10141">10141</span>
<span id="L10142" rel="#L10142">10142</span>
<span id="L10143" rel="#L10143">10143</span>
<span id="L10144" rel="#L10144">10144</span>
<span id="L10145" rel="#L10145">10145</span>
<span id="L10146" rel="#L10146">10146</span>
<span id="L10147" rel="#L10147">10147</span>
<span id="L10148" rel="#L10148">10148</span>
<span id="L10149" rel="#L10149">10149</span>
<span id="L10150" rel="#L10150">10150</span>
<span id="L10151" rel="#L10151">10151</span>
<span id="L10152" rel="#L10152">10152</span>
<span id="L10153" rel="#L10153">10153</span>
<span id="L10154" rel="#L10154">10154</span>
<span id="L10155" rel="#L10155">10155</span>
<span id="L10156" rel="#L10156">10156</span>
<span id="L10157" rel="#L10157">10157</span>
<span id="L10158" rel="#L10158">10158</span>
<span id="L10159" rel="#L10159">10159</span>
<span id="L10160" rel="#L10160">10160</span>
<span id="L10161" rel="#L10161">10161</span>
<span id="L10162" rel="#L10162">10162</span>
<span id="L10163" rel="#L10163">10163</span>
<span id="L10164" rel="#L10164">10164</span>
<span id="L10165" rel="#L10165">10165</span>
<span id="L10166" rel="#L10166">10166</span>
<span id="L10167" rel="#L10167">10167</span>
<span id="L10168" rel="#L10168">10168</span>
<span id="L10169" rel="#L10169">10169</span>
<span id="L10170" rel="#L10170">10170</span>
<span id="L10171" rel="#L10171">10171</span>
<span id="L10172" rel="#L10172">10172</span>
<span id="L10173" rel="#L10173">10173</span>
<span id="L10174" rel="#L10174">10174</span>
<span id="L10175" rel="#L10175">10175</span>
<span id="L10176" rel="#L10176">10176</span>
<span id="L10177" rel="#L10177">10177</span>
<span id="L10178" rel="#L10178">10178</span>
<span id="L10179" rel="#L10179">10179</span>
<span id="L10180" rel="#L10180">10180</span>
<span id="L10181" rel="#L10181">10181</span>
<span id="L10182" rel="#L10182">10182</span>
<span id="L10183" rel="#L10183">10183</span>
<span id="L10184" rel="#L10184">10184</span>
<span id="L10185" rel="#L10185">10185</span>
<span id="L10186" rel="#L10186">10186</span>
<span id="L10187" rel="#L10187">10187</span>
<span id="L10188" rel="#L10188">10188</span>
<span id="L10189" rel="#L10189">10189</span>
<span id="L10190" rel="#L10190">10190</span>
<span id="L10191" rel="#L10191">10191</span>
<span id="L10192" rel="#L10192">10192</span>
<span id="L10193" rel="#L10193">10193</span>
<span id="L10194" rel="#L10194">10194</span>
<span id="L10195" rel="#L10195">10195</span>
<span id="L10196" rel="#L10196">10196</span>
<span id="L10197" rel="#L10197">10197</span>
<span id="L10198" rel="#L10198">10198</span>
<span id="L10199" rel="#L10199">10199</span>
<span id="L10200" rel="#L10200">10200</span>
<span id="L10201" rel="#L10201">10201</span>
<span id="L10202" rel="#L10202">10202</span>
<span id="L10203" rel="#L10203">10203</span>
<span id="L10204" rel="#L10204">10204</span>
<span id="L10205" rel="#L10205">10205</span>
<span id="L10206" rel="#L10206">10206</span>
<span id="L10207" rel="#L10207">10207</span>
<span id="L10208" rel="#L10208">10208</span>
<span id="L10209" rel="#L10209">10209</span>
<span id="L10210" rel="#L10210">10210</span>
<span id="L10211" rel="#L10211">10211</span>
<span id="L10212" rel="#L10212">10212</span>
<span id="L10213" rel="#L10213">10213</span>
<span id="L10214" rel="#L10214">10214</span>
<span id="L10215" rel="#L10215">10215</span>
<span id="L10216" rel="#L10216">10216</span>
<span id="L10217" rel="#L10217">10217</span>
<span id="L10218" rel="#L10218">10218</span>
<span id="L10219" rel="#L10219">10219</span>
<span id="L10220" rel="#L10220">10220</span>
<span id="L10221" rel="#L10221">10221</span>
<span id="L10222" rel="#L10222">10222</span>
<span id="L10223" rel="#L10223">10223</span>
<span id="L10224" rel="#L10224">10224</span>
<span id="L10225" rel="#L10225">10225</span>
<span id="L10226" rel="#L10226">10226</span>
<span id="L10227" rel="#L10227">10227</span>
<span id="L10228" rel="#L10228">10228</span>
<span id="L10229" rel="#L10229">10229</span>
<span id="L10230" rel="#L10230">10230</span>
<span id="L10231" rel="#L10231">10231</span>
<span id="L10232" rel="#L10232">10232</span>
<span id="L10233" rel="#L10233">10233</span>
<span id="L10234" rel="#L10234">10234</span>
<span id="L10235" rel="#L10235">10235</span>
<span id="L10236" rel="#L10236">10236</span>
<span id="L10237" rel="#L10237">10237</span>
<span id="L10238" rel="#L10238">10238</span>
<span id="L10239" rel="#L10239">10239</span>
<span id="L10240" rel="#L10240">10240</span>
<span id="L10241" rel="#L10241">10241</span>
<span id="L10242" rel="#L10242">10242</span>
<span id="L10243" rel="#L10243">10243</span>
<span id="L10244" rel="#L10244">10244</span>
<span id="L10245" rel="#L10245">10245</span>
<span id="L10246" rel="#L10246">10246</span>
<span id="L10247" rel="#L10247">10247</span>
<span id="L10248" rel="#L10248">10248</span>
<span id="L10249" rel="#L10249">10249</span>
<span id="L10250" rel="#L10250">10250</span>
<span id="L10251" rel="#L10251">10251</span>
<span id="L10252" rel="#L10252">10252</span>
<span id="L10253" rel="#L10253">10253</span>
<span id="L10254" rel="#L10254">10254</span>
<span id="L10255" rel="#L10255">10255</span>
<span id="L10256" rel="#L10256">10256</span>
<span id="L10257" rel="#L10257">10257</span>
<span id="L10258" rel="#L10258">10258</span>
<span id="L10259" rel="#L10259">10259</span>
<span id="L10260" rel="#L10260">10260</span>
<span id="L10261" rel="#L10261">10261</span>
<span id="L10262" rel="#L10262">10262</span>
<span id="L10263" rel="#L10263">10263</span>
<span id="L10264" rel="#L10264">10264</span>
<span id="L10265" rel="#L10265">10265</span>
<span id="L10266" rel="#L10266">10266</span>
<span id="L10267" rel="#L10267">10267</span>
<span id="L10268" rel="#L10268">10268</span>
<span id="L10269" rel="#L10269">10269</span>
<span id="L10270" rel="#L10270">10270</span>
<span id="L10271" rel="#L10271">10271</span>
<span id="L10272" rel="#L10272">10272</span>
<span id="L10273" rel="#L10273">10273</span>
<span id="L10274" rel="#L10274">10274</span>
<span id="L10275" rel="#L10275">10275</span>
<span id="L10276" rel="#L10276">10276</span>
<span id="L10277" rel="#L10277">10277</span>
<span id="L10278" rel="#L10278">10278</span>
<span id="L10279" rel="#L10279">10279</span>
<span id="L10280" rel="#L10280">10280</span>
<span id="L10281" rel="#L10281">10281</span>
<span id="L10282" rel="#L10282">10282</span>
<span id="L10283" rel="#L10283">10283</span>
<span id="L10284" rel="#L10284">10284</span>
<span id="L10285" rel="#L10285">10285</span>
<span id="L10286" rel="#L10286">10286</span>
<span id="L10287" rel="#L10287">10287</span>
<span id="L10288" rel="#L10288">10288</span>
<span id="L10289" rel="#L10289">10289</span>
<span id="L10290" rel="#L10290">10290</span>
<span id="L10291" rel="#L10291">10291</span>
<span id="L10292" rel="#L10292">10292</span>
<span id="L10293" rel="#L10293">10293</span>
<span id="L10294" rel="#L10294">10294</span>
<span id="L10295" rel="#L10295">10295</span>
<span id="L10296" rel="#L10296">10296</span>
<span id="L10297" rel="#L10297">10297</span>
<span id="L10298" rel="#L10298">10298</span>
<span id="L10299" rel="#L10299">10299</span>
<span id="L10300" rel="#L10300">10300</span>
<span id="L10301" rel="#L10301">10301</span>
<span id="L10302" rel="#L10302">10302</span>
<span id="L10303" rel="#L10303">10303</span>
<span id="L10304" rel="#L10304">10304</span>
<span id="L10305" rel="#L10305">10305</span>
<span id="L10306" rel="#L10306">10306</span>
<span id="L10307" rel="#L10307">10307</span>
<span id="L10308" rel="#L10308">10308</span>
<span id="L10309" rel="#L10309">10309</span>
<span id="L10310" rel="#L10310">10310</span>
<span id="L10311" rel="#L10311">10311</span>
<span id="L10312" rel="#L10312">10312</span>
<span id="L10313" rel="#L10313">10313</span>
<span id="L10314" rel="#L10314">10314</span>
<span id="L10315" rel="#L10315">10315</span>
<span id="L10316" rel="#L10316">10316</span>
<span id="L10317" rel="#L10317">10317</span>
<span id="L10318" rel="#L10318">10318</span>
<span id="L10319" rel="#L10319">10319</span>
<span id="L10320" rel="#L10320">10320</span>
<span id="L10321" rel="#L10321">10321</span>
<span id="L10322" rel="#L10322">10322</span>
<span id="L10323" rel="#L10323">10323</span>
<span id="L10324" rel="#L10324">10324</span>
<span id="L10325" rel="#L10325">10325</span>
<span id="L10326" rel="#L10326">10326</span>
<span id="L10327" rel="#L10327">10327</span>
<span id="L10328" rel="#L10328">10328</span>
<span id="L10329" rel="#L10329">10329</span>
<span id="L10330" rel="#L10330">10330</span>
<span id="L10331" rel="#L10331">10331</span>
<span id="L10332" rel="#L10332">10332</span>
<span id="L10333" rel="#L10333">10333</span>
<span id="L10334" rel="#L10334">10334</span>
<span id="L10335" rel="#L10335">10335</span>
<span id="L10336" rel="#L10336">10336</span>
<span id="L10337" rel="#L10337">10337</span>
<span id="L10338" rel="#L10338">10338</span>
<span id="L10339" rel="#L10339">10339</span>
<span id="L10340" rel="#L10340">10340</span>
<span id="L10341" rel="#L10341">10341</span>
<span id="L10342" rel="#L10342">10342</span>
<span id="L10343" rel="#L10343">10343</span>
<span id="L10344" rel="#L10344">10344</span>
<span id="L10345" rel="#L10345">10345</span>
<span id="L10346" rel="#L10346">10346</span>
<span id="L10347" rel="#L10347">10347</span>
<span id="L10348" rel="#L10348">10348</span>
<span id="L10349" rel="#L10349">10349</span>
<span id="L10350" rel="#L10350">10350</span>
<span id="L10351" rel="#L10351">10351</span>
<span id="L10352" rel="#L10352">10352</span>
<span id="L10353" rel="#L10353">10353</span>
<span id="L10354" rel="#L10354">10354</span>
<span id="L10355" rel="#L10355">10355</span>
<span id="L10356" rel="#L10356">10356</span>
<span id="L10357" rel="#L10357">10357</span>
<span id="L10358" rel="#L10358">10358</span>
<span id="L10359" rel="#L10359">10359</span>
<span id="L10360" rel="#L10360">10360</span>
<span id="L10361" rel="#L10361">10361</span>
<span id="L10362" rel="#L10362">10362</span>
<span id="L10363" rel="#L10363">10363</span>
<span id="L10364" rel="#L10364">10364</span>
<span id="L10365" rel="#L10365">10365</span>
<span id="L10366" rel="#L10366">10366</span>
<span id="L10367" rel="#L10367">10367</span>
<span id="L10368" rel="#L10368">10368</span>
<span id="L10369" rel="#L10369">10369</span>
<span id="L10370" rel="#L10370">10370</span>
<span id="L10371" rel="#L10371">10371</span>
<span id="L10372" rel="#L10372">10372</span>
<span id="L10373" rel="#L10373">10373</span>
<span id="L10374" rel="#L10374">10374</span>
<span id="L10375" rel="#L10375">10375</span>
<span id="L10376" rel="#L10376">10376</span>
<span id="L10377" rel="#L10377">10377</span>
<span id="L10378" rel="#L10378">10378</span>
<span id="L10379" rel="#L10379">10379</span>
<span id="L10380" rel="#L10380">10380</span>
<span id="L10381" rel="#L10381">10381</span>
<span id="L10382" rel="#L10382">10382</span>
<span id="L10383" rel="#L10383">10383</span>
<span id="L10384" rel="#L10384">10384</span>
<span id="L10385" rel="#L10385">10385</span>
<span id="L10386" rel="#L10386">10386</span>
<span id="L10387" rel="#L10387">10387</span>
<span id="L10388" rel="#L10388">10388</span>
<span id="L10389" rel="#L10389">10389</span>
<span id="L10390" rel="#L10390">10390</span>
<span id="L10391" rel="#L10391">10391</span>
<span id="L10392" rel="#L10392">10392</span>
<span id="L10393" rel="#L10393">10393</span>
<span id="L10394" rel="#L10394">10394</span>
<span id="L10395" rel="#L10395">10395</span>
<span id="L10396" rel="#L10396">10396</span>
<span id="L10397" rel="#L10397">10397</span>
<span id="L10398" rel="#L10398">10398</span>
<span id="L10399" rel="#L10399">10399</span>
<span id="L10400" rel="#L10400">10400</span>
<span id="L10401" rel="#L10401">10401</span>
<span id="L10402" rel="#L10402">10402</span>
<span id="L10403" rel="#L10403">10403</span>
<span id="L10404" rel="#L10404">10404</span>
<span id="L10405" rel="#L10405">10405</span>
<span id="L10406" rel="#L10406">10406</span>
<span id="L10407" rel="#L10407">10407</span>
<span id="L10408" rel="#L10408">10408</span>
<span id="L10409" rel="#L10409">10409</span>
<span id="L10410" rel="#L10410">10410</span>
<span id="L10411" rel="#L10411">10411</span>
<span id="L10412" rel="#L10412">10412</span>
<span id="L10413" rel="#L10413">10413</span>
<span id="L10414" rel="#L10414">10414</span>
<span id="L10415" rel="#L10415">10415</span>
<span id="L10416" rel="#L10416">10416</span>
<span id="L10417" rel="#L10417">10417</span>
<span id="L10418" rel="#L10418">10418</span>
<span id="L10419" rel="#L10419">10419</span>
<span id="L10420" rel="#L10420">10420</span>
<span id="L10421" rel="#L10421">10421</span>
<span id="L10422" rel="#L10422">10422</span>
<span id="L10423" rel="#L10423">10423</span>
<span id="L10424" rel="#L10424">10424</span>
<span id="L10425" rel="#L10425">10425</span>
<span id="L10426" rel="#L10426">10426</span>
<span id="L10427" rel="#L10427">10427</span>
<span id="L10428" rel="#L10428">10428</span>
<span id="L10429" rel="#L10429">10429</span>
<span id="L10430" rel="#L10430">10430</span>
<span id="L10431" rel="#L10431">10431</span>
<span id="L10432" rel="#L10432">10432</span>
<span id="L10433" rel="#L10433">10433</span>
<span id="L10434" rel="#L10434">10434</span>
<span id="L10435" rel="#L10435">10435</span>
<span id="L10436" rel="#L10436">10436</span>
<span id="L10437" rel="#L10437">10437</span>
<span id="L10438" rel="#L10438">10438</span>
<span id="L10439" rel="#L10439">10439</span>
<span id="L10440" rel="#L10440">10440</span>
<span id="L10441" rel="#L10441">10441</span>
<span id="L10442" rel="#L10442">10442</span>
<span id="L10443" rel="#L10443">10443</span>
<span id="L10444" rel="#L10444">10444</span>
<span id="L10445" rel="#L10445">10445</span>
<span id="L10446" rel="#L10446">10446</span>
<span id="L10447" rel="#L10447">10447</span>
<span id="L10448" rel="#L10448">10448</span>
<span id="L10449" rel="#L10449">10449</span>
<span id="L10450" rel="#L10450">10450</span>
<span id="L10451" rel="#L10451">10451</span>
<span id="L10452" rel="#L10452">10452</span>
<span id="L10453" rel="#L10453">10453</span>
<span id="L10454" rel="#L10454">10454</span>
<span id="L10455" rel="#L10455">10455</span>
<span id="L10456" rel="#L10456">10456</span>
<span id="L10457" rel="#L10457">10457</span>
<span id="L10458" rel="#L10458">10458</span>
<span id="L10459" rel="#L10459">10459</span>
<span id="L10460" rel="#L10460">10460</span>
<span id="L10461" rel="#L10461">10461</span>
<span id="L10462" rel="#L10462">10462</span>
<span id="L10463" rel="#L10463">10463</span>
<span id="L10464" rel="#L10464">10464</span>
<span id="L10465" rel="#L10465">10465</span>
<span id="L10466" rel="#L10466">10466</span>
<span id="L10467" rel="#L10467">10467</span>
<span id="L10468" rel="#L10468">10468</span>
<span id="L10469" rel="#L10469">10469</span>
<span id="L10470" rel="#L10470">10470</span>
<span id="L10471" rel="#L10471">10471</span>
<span id="L10472" rel="#L10472">10472</span>
<span id="L10473" rel="#L10473">10473</span>
<span id="L10474" rel="#L10474">10474</span>
<span id="L10475" rel="#L10475">10475</span>
<span id="L10476" rel="#L10476">10476</span>
<span id="L10477" rel="#L10477">10477</span>
<span id="L10478" rel="#L10478">10478</span>
<span id="L10479" rel="#L10479">10479</span>
<span id="L10480" rel="#L10480">10480</span>
<span id="L10481" rel="#L10481">10481</span>
<span id="L10482" rel="#L10482">10482</span>
<span id="L10483" rel="#L10483">10483</span>
<span id="L10484" rel="#L10484">10484</span>
<span id="L10485" rel="#L10485">10485</span>
<span id="L10486" rel="#L10486">10486</span>
<span id="L10487" rel="#L10487">10487</span>
<span id="L10488" rel="#L10488">10488</span>
<span id="L10489" rel="#L10489">10489</span>
<span id="L10490" rel="#L10490">10490</span>
<span id="L10491" rel="#L10491">10491</span>
<span id="L10492" rel="#L10492">10492</span>
<span id="L10493" rel="#L10493">10493</span>
<span id="L10494" rel="#L10494">10494</span>
<span id="L10495" rel="#L10495">10495</span>
<span id="L10496" rel="#L10496">10496</span>
<span id="L10497" rel="#L10497">10497</span>
<span id="L10498" rel="#L10498">10498</span>
<span id="L10499" rel="#L10499">10499</span>
<span id="L10500" rel="#L10500">10500</span>
<span id="L10501" rel="#L10501">10501</span>
<span id="L10502" rel="#L10502">10502</span>
<span id="L10503" rel="#L10503">10503</span>
<span id="L10504" rel="#L10504">10504</span>
<span id="L10505" rel="#L10505">10505</span>
<span id="L10506" rel="#L10506">10506</span>
<span id="L10507" rel="#L10507">10507</span>
<span id="L10508" rel="#L10508">10508</span>
<span id="L10509" rel="#L10509">10509</span>
<span id="L10510" rel="#L10510">10510</span>
<span id="L10511" rel="#L10511">10511</span>
<span id="L10512" rel="#L10512">10512</span>
<span id="L10513" rel="#L10513">10513</span>
<span id="L10514" rel="#L10514">10514</span>
<span id="L10515" rel="#L10515">10515</span>
<span id="L10516" rel="#L10516">10516</span>
<span id="L10517" rel="#L10517">10517</span>
<span id="L10518" rel="#L10518">10518</span>
<span id="L10519" rel="#L10519">10519</span>
<span id="L10520" rel="#L10520">10520</span>
<span id="L10521" rel="#L10521">10521</span>
<span id="L10522" rel="#L10522">10522</span>
<span id="L10523" rel="#L10523">10523</span>
<span id="L10524" rel="#L10524">10524</span>
<span id="L10525" rel="#L10525">10525</span>
<span id="L10526" rel="#L10526">10526</span>
<span id="L10527" rel="#L10527">10527</span>
<span id="L10528" rel="#L10528">10528</span>
<span id="L10529" rel="#L10529">10529</span>
<span id="L10530" rel="#L10530">10530</span>
<span id="L10531" rel="#L10531">10531</span>
<span id="L10532" rel="#L10532">10532</span>
<span id="L10533" rel="#L10533">10533</span>
<span id="L10534" rel="#L10534">10534</span>
<span id="L10535" rel="#L10535">10535</span>
<span id="L10536" rel="#L10536">10536</span>
<span id="L10537" rel="#L10537">10537</span>
<span id="L10538" rel="#L10538">10538</span>
<span id="L10539" rel="#L10539">10539</span>
<span id="L10540" rel="#L10540">10540</span>
<span id="L10541" rel="#L10541">10541</span>
<span id="L10542" rel="#L10542">10542</span>
<span id="L10543" rel="#L10543">10543</span>
<span id="L10544" rel="#L10544">10544</span>
<span id="L10545" rel="#L10545">10545</span>
<span id="L10546" rel="#L10546">10546</span>
<span id="L10547" rel="#L10547">10547</span>
<span id="L10548" rel="#L10548">10548</span>
<span id="L10549" rel="#L10549">10549</span>
<span id="L10550" rel="#L10550">10550</span>
<span id="L10551" rel="#L10551">10551</span>
<span id="L10552" rel="#L10552">10552</span>
<span id="L10553" rel="#L10553">10553</span>
<span id="L10554" rel="#L10554">10554</span>
<span id="L10555" rel="#L10555">10555</span>
<span id="L10556" rel="#L10556">10556</span>
<span id="L10557" rel="#L10557">10557</span>
<span id="L10558" rel="#L10558">10558</span>
<span id="L10559" rel="#L10559">10559</span>
<span id="L10560" rel="#L10560">10560</span>
<span id="L10561" rel="#L10561">10561</span>
<span id="L10562" rel="#L10562">10562</span>
<span id="L10563" rel="#L10563">10563</span>
<span id="L10564" rel="#L10564">10564</span>
<span id="L10565" rel="#L10565">10565</span>
<span id="L10566" rel="#L10566">10566</span>
<span id="L10567" rel="#L10567">10567</span>
<span id="L10568" rel="#L10568">10568</span>
<span id="L10569" rel="#L10569">10569</span>
<span id="L10570" rel="#L10570">10570</span>
<span id="L10571" rel="#L10571">10571</span>
<span id="L10572" rel="#L10572">10572</span>
<span id="L10573" rel="#L10573">10573</span>
<span id="L10574" rel="#L10574">10574</span>
<span id="L10575" rel="#L10575">10575</span>
<span id="L10576" rel="#L10576">10576</span>
<span id="L10577" rel="#L10577">10577</span>
<span id="L10578" rel="#L10578">10578</span>
<span id="L10579" rel="#L10579">10579</span>
<span id="L10580" rel="#L10580">10580</span>
<span id="L10581" rel="#L10581">10581</span>
<span id="L10582" rel="#L10582">10582</span>
<span id="L10583" rel="#L10583">10583</span>
<span id="L10584" rel="#L10584">10584</span>
<span id="L10585" rel="#L10585">10585</span>
<span id="L10586" rel="#L10586">10586</span>
<span id="L10587" rel="#L10587">10587</span>
<span id="L10588" rel="#L10588">10588</span>
<span id="L10589" rel="#L10589">10589</span>
<span id="L10590" rel="#L10590">10590</span>
<span id="L10591" rel="#L10591">10591</span>
<span id="L10592" rel="#L10592">10592</span>
<span id="L10593" rel="#L10593">10593</span>
<span id="L10594" rel="#L10594">10594</span>
<span id="L10595" rel="#L10595">10595</span>
<span id="L10596" rel="#L10596">10596</span>
<span id="L10597" rel="#L10597">10597</span>
<span id="L10598" rel="#L10598">10598</span>
<span id="L10599" rel="#L10599">10599</span>
<span id="L10600" rel="#L10600">10600</span>
<span id="L10601" rel="#L10601">10601</span>
<span id="L10602" rel="#L10602">10602</span>
<span id="L10603" rel="#L10603">10603</span>
<span id="L10604" rel="#L10604">10604</span>
<span id="L10605" rel="#L10605">10605</span>
<span id="L10606" rel="#L10606">10606</span>
<span id="L10607" rel="#L10607">10607</span>
<span id="L10608" rel="#L10608">10608</span>
<span id="L10609" rel="#L10609">10609</span>
<span id="L10610" rel="#L10610">10610</span>
<span id="L10611" rel="#L10611">10611</span>
<span id="L10612" rel="#L10612">10612</span>
<span id="L10613" rel="#L10613">10613</span>
<span id="L10614" rel="#L10614">10614</span>
<span id="L10615" rel="#L10615">10615</span>
<span id="L10616" rel="#L10616">10616</span>
<span id="L10617" rel="#L10617">10617</span>
<span id="L10618" rel="#L10618">10618</span>
<span id="L10619" rel="#L10619">10619</span>
<span id="L10620" rel="#L10620">10620</span>
<span id="L10621" rel="#L10621">10621</span>
<span id="L10622" rel="#L10622">10622</span>
<span id="L10623" rel="#L10623">10623</span>
<span id="L10624" rel="#L10624">10624</span>
<span id="L10625" rel="#L10625">10625</span>
<span id="L10626" rel="#L10626">10626</span>
<span id="L10627" rel="#L10627">10627</span>
<span id="L10628" rel="#L10628">10628</span>
<span id="L10629" rel="#L10629">10629</span>
<span id="L10630" rel="#L10630">10630</span>
<span id="L10631" rel="#L10631">10631</span>
<span id="L10632" rel="#L10632">10632</span>
<span id="L10633" rel="#L10633">10633</span>
<span id="L10634" rel="#L10634">10634</span>
<span id="L10635" rel="#L10635">10635</span>
<span id="L10636" rel="#L10636">10636</span>
<span id="L10637" rel="#L10637">10637</span>
<span id="L10638" rel="#L10638">10638</span>
<span id="L10639" rel="#L10639">10639</span>
<span id="L10640" rel="#L10640">10640</span>
<span id="L10641" rel="#L10641">10641</span>
<span id="L10642" rel="#L10642">10642</span>
<span id="L10643" rel="#L10643">10643</span>
<span id="L10644" rel="#L10644">10644</span>
<span id="L10645" rel="#L10645">10645</span>
<span id="L10646" rel="#L10646">10646</span>
<span id="L10647" rel="#L10647">10647</span>
<span id="L10648" rel="#L10648">10648</span>
<span id="L10649" rel="#L10649">10649</span>
<span id="L10650" rel="#L10650">10650</span>
<span id="L10651" rel="#L10651">10651</span>
<span id="L10652" rel="#L10652">10652</span>
<span id="L10653" rel="#L10653">10653</span>
<span id="L10654" rel="#L10654">10654</span>
<span id="L10655" rel="#L10655">10655</span>
<span id="L10656" rel="#L10656">10656</span>
<span id="L10657" rel="#L10657">10657</span>
<span id="L10658" rel="#L10658">10658</span>
<span id="L10659" rel="#L10659">10659</span>
<span id="L10660" rel="#L10660">10660</span>
<span id="L10661" rel="#L10661">10661</span>
<span id="L10662" rel="#L10662">10662</span>
<span id="L10663" rel="#L10663">10663</span>
<span id="L10664" rel="#L10664">10664</span>
<span id="L10665" rel="#L10665">10665</span>
<span id="L10666" rel="#L10666">10666</span>
<span id="L10667" rel="#L10667">10667</span>
<span id="L10668" rel="#L10668">10668</span>
<span id="L10669" rel="#L10669">10669</span>
<span id="L10670" rel="#L10670">10670</span>
<span id="L10671" rel="#L10671">10671</span>
<span id="L10672" rel="#L10672">10672</span>
<span id="L10673" rel="#L10673">10673</span>
<span id="L10674" rel="#L10674">10674</span>
<span id="L10675" rel="#L10675">10675</span>
<span id="L10676" rel="#L10676">10676</span>
<span id="L10677" rel="#L10677">10677</span>
<span id="L10678" rel="#L10678">10678</span>
<span id="L10679" rel="#L10679">10679</span>
<span id="L10680" rel="#L10680">10680</span>
<span id="L10681" rel="#L10681">10681</span>
<span id="L10682" rel="#L10682">10682</span>
<span id="L10683" rel="#L10683">10683</span>
<span id="L10684" rel="#L10684">10684</span>
<span id="L10685" rel="#L10685">10685</span>
<span id="L10686" rel="#L10686">10686</span>
<span id="L10687" rel="#L10687">10687</span>
<span id="L10688" rel="#L10688">10688</span>
<span id="L10689" rel="#L10689">10689</span>
<span id="L10690" rel="#L10690">10690</span>
<span id="L10691" rel="#L10691">10691</span>
<span id="L10692" rel="#L10692">10692</span>
<span id="L10693" rel="#L10693">10693</span>
<span id="L10694" rel="#L10694">10694</span>
<span id="L10695" rel="#L10695">10695</span>
<span id="L10696" rel="#L10696">10696</span>
<span id="L10697" rel="#L10697">10697</span>
<span id="L10698" rel="#L10698">10698</span>
<span id="L10699" rel="#L10699">10699</span>
<span id="L10700" rel="#L10700">10700</span>
<span id="L10701" rel="#L10701">10701</span>
<span id="L10702" rel="#L10702">10702</span>
<span id="L10703" rel="#L10703">10703</span>
<span id="L10704" rel="#L10704">10704</span>
<span id="L10705" rel="#L10705">10705</span>
<span id="L10706" rel="#L10706">10706</span>
<span id="L10707" rel="#L10707">10707</span>
<span id="L10708" rel="#L10708">10708</span>
<span id="L10709" rel="#L10709">10709</span>
<span id="L10710" rel="#L10710">10710</span>
<span id="L10711" rel="#L10711">10711</span>
<span id="L10712" rel="#L10712">10712</span>
<span id="L10713" rel="#L10713">10713</span>
<span id="L10714" rel="#L10714">10714</span>
<span id="L10715" rel="#L10715">10715</span>
<span id="L10716" rel="#L10716">10716</span>
<span id="L10717" rel="#L10717">10717</span>
<span id="L10718" rel="#L10718">10718</span>
<span id="L10719" rel="#L10719">10719</span>
<span id="L10720" rel="#L10720">10720</span>
<span id="L10721" rel="#L10721">10721</span>
<span id="L10722" rel="#L10722">10722</span>
<span id="L10723" rel="#L10723">10723</span>
<span id="L10724" rel="#L10724">10724</span>
<span id="L10725" rel="#L10725">10725</span>
<span id="L10726" rel="#L10726">10726</span>
<span id="L10727" rel="#L10727">10727</span>
<span id="L10728" rel="#L10728">10728</span>
<span id="L10729" rel="#L10729">10729</span>
<span id="L10730" rel="#L10730">10730</span>
<span id="L10731" rel="#L10731">10731</span>
<span id="L10732" rel="#L10732">10732</span>
<span id="L10733" rel="#L10733">10733</span>
<span id="L10734" rel="#L10734">10734</span>
<span id="L10735" rel="#L10735">10735</span>
<span id="L10736" rel="#L10736">10736</span>
<span id="L10737" rel="#L10737">10737</span>
<span id="L10738" rel="#L10738">10738</span>
<span id="L10739" rel="#L10739">10739</span>
<span id="L10740" rel="#L10740">10740</span>
<span id="L10741" rel="#L10741">10741</span>
<span id="L10742" rel="#L10742">10742</span>
<span id="L10743" rel="#L10743">10743</span>
<span id="L10744" rel="#L10744">10744</span>
<span id="L10745" rel="#L10745">10745</span>
<span id="L10746" rel="#L10746">10746</span>
<span id="L10747" rel="#L10747">10747</span>
<span id="L10748" rel="#L10748">10748</span>
<span id="L10749" rel="#L10749">10749</span>
<span id="L10750" rel="#L10750">10750</span>
<span id="L10751" rel="#L10751">10751</span>
<span id="L10752" rel="#L10752">10752</span>
<span id="L10753" rel="#L10753">10753</span>
<span id="L10754" rel="#L10754">10754</span>
<span id="L10755" rel="#L10755">10755</span>
<span id="L10756" rel="#L10756">10756</span>
<span id="L10757" rel="#L10757">10757</span>
<span id="L10758" rel="#L10758">10758</span>
<span id="L10759" rel="#L10759">10759</span>
<span id="L10760" rel="#L10760">10760</span>
<span id="L10761" rel="#L10761">10761</span>
<span id="L10762" rel="#L10762">10762</span>
<span id="L10763" rel="#L10763">10763</span>
<span id="L10764" rel="#L10764">10764</span>
<span id="L10765" rel="#L10765">10765</span>
<span id="L10766" rel="#L10766">10766</span>
<span id="L10767" rel="#L10767">10767</span>
<span id="L10768" rel="#L10768">10768</span>
<span id="L10769" rel="#L10769">10769</span>
<span id="L10770" rel="#L10770">10770</span>
<span id="L10771" rel="#L10771">10771</span>
<span id="L10772" rel="#L10772">10772</span>
<span id="L10773" rel="#L10773">10773</span>
<span id="L10774" rel="#L10774">10774</span>
<span id="L10775" rel="#L10775">10775</span>
<span id="L10776" rel="#L10776">10776</span>
<span id="L10777" rel="#L10777">10777</span>
<span id="L10778" rel="#L10778">10778</span>
<span id="L10779" rel="#L10779">10779</span>
<span id="L10780" rel="#L10780">10780</span>
<span id="L10781" rel="#L10781">10781</span>
<span id="L10782" rel="#L10782">10782</span>
<span id="L10783" rel="#L10783">10783</span>
<span id="L10784" rel="#L10784">10784</span>
<span id="L10785" rel="#L10785">10785</span>
<span id="L10786" rel="#L10786">10786</span>
<span id="L10787" rel="#L10787">10787</span>
<span id="L10788" rel="#L10788">10788</span>
<span id="L10789" rel="#L10789">10789</span>
<span id="L10790" rel="#L10790">10790</span>
<span id="L10791" rel="#L10791">10791</span>
<span id="L10792" rel="#L10792">10792</span>
<span id="L10793" rel="#L10793">10793</span>
<span id="L10794" rel="#L10794">10794</span>
<span id="L10795" rel="#L10795">10795</span>
<span id="L10796" rel="#L10796">10796</span>
<span id="L10797" rel="#L10797">10797</span>
<span id="L10798" rel="#L10798">10798</span>
<span id="L10799" rel="#L10799">10799</span>
<span id="L10800" rel="#L10800">10800</span>
<span id="L10801" rel="#L10801">10801</span>
<span id="L10802" rel="#L10802">10802</span>
<span id="L10803" rel="#L10803">10803</span>
<span id="L10804" rel="#L10804">10804</span>
<span id="L10805" rel="#L10805">10805</span>
<span id="L10806" rel="#L10806">10806</span>
<span id="L10807" rel="#L10807">10807</span>
<span id="L10808" rel="#L10808">10808</span>
<span id="L10809" rel="#L10809">10809</span>
<span id="L10810" rel="#L10810">10810</span>
<span id="L10811" rel="#L10811">10811</span>
<span id="L10812" rel="#L10812">10812</span>
<span id="L10813" rel="#L10813">10813</span>
<span id="L10814" rel="#L10814">10814</span>
<span id="L10815" rel="#L10815">10815</span>
<span id="L10816" rel="#L10816">10816</span>
<span id="L10817" rel="#L10817">10817</span>
<span id="L10818" rel="#L10818">10818</span>
<span id="L10819" rel="#L10819">10819</span>
<span id="L10820" rel="#L10820">10820</span>
<span id="L10821" rel="#L10821">10821</span>
<span id="L10822" rel="#L10822">10822</span>
<span id="L10823" rel="#L10823">10823</span>
<span id="L10824" rel="#L10824">10824</span>
<span id="L10825" rel="#L10825">10825</span>
<span id="L10826" rel="#L10826">10826</span>
<span id="L10827" rel="#L10827">10827</span>
<span id="L10828" rel="#L10828">10828</span>
<span id="L10829" rel="#L10829">10829</span>
<span id="L10830" rel="#L10830">10830</span>
<span id="L10831" rel="#L10831">10831</span>
<span id="L10832" rel="#L10832">10832</span>
<span id="L10833" rel="#L10833">10833</span>
<span id="L10834" rel="#L10834">10834</span>
<span id="L10835" rel="#L10835">10835</span>
<span id="L10836" rel="#L10836">10836</span>
<span id="L10837" rel="#L10837">10837</span>
<span id="L10838" rel="#L10838">10838</span>
<span id="L10839" rel="#L10839">10839</span>
<span id="L10840" rel="#L10840">10840</span>
<span id="L10841" rel="#L10841">10841</span>
<span id="L10842" rel="#L10842">10842</span>
<span id="L10843" rel="#L10843">10843</span>
<span id="L10844" rel="#L10844">10844</span>
<span id="L10845" rel="#L10845">10845</span>
<span id="L10846" rel="#L10846">10846</span>
<span id="L10847" rel="#L10847">10847</span>
<span id="L10848" rel="#L10848">10848</span>
<span id="L10849" rel="#L10849">10849</span>
<span id="L10850" rel="#L10850">10850</span>
<span id="L10851" rel="#L10851">10851</span>
<span id="L10852" rel="#L10852">10852</span>
<span id="L10853" rel="#L10853">10853</span>
<span id="L10854" rel="#L10854">10854</span>
<span id="L10855" rel="#L10855">10855</span>
<span id="L10856" rel="#L10856">10856</span>
<span id="L10857" rel="#L10857">10857</span>
<span id="L10858" rel="#L10858">10858</span>
<span id="L10859" rel="#L10859">10859</span>
<span id="L10860" rel="#L10860">10860</span>
<span id="L10861" rel="#L10861">10861</span>
<span id="L10862" rel="#L10862">10862</span>
<span id="L10863" rel="#L10863">10863</span>
<span id="L10864" rel="#L10864">10864</span>
<span id="L10865" rel="#L10865">10865</span>
<span id="L10866" rel="#L10866">10866</span>
<span id="L10867" rel="#L10867">10867</span>
<span id="L10868" rel="#L10868">10868</span>
<span id="L10869" rel="#L10869">10869</span>
<span id="L10870" rel="#L10870">10870</span>
<span id="L10871" rel="#L10871">10871</span>
<span id="L10872" rel="#L10872">10872</span>
<span id="L10873" rel="#L10873">10873</span>
<span id="L10874" rel="#L10874">10874</span>
<span id="L10875" rel="#L10875">10875</span>
<span id="L10876" rel="#L10876">10876</span>
<span id="L10877" rel="#L10877">10877</span>
<span id="L10878" rel="#L10878">10878</span>
<span id="L10879" rel="#L10879">10879</span>
<span id="L10880" rel="#L10880">10880</span>
<span id="L10881" rel="#L10881">10881</span>
<span id="L10882" rel="#L10882">10882</span>
<span id="L10883" rel="#L10883">10883</span>
<span id="L10884" rel="#L10884">10884</span>
<span id="L10885" rel="#L10885">10885</span>
<span id="L10886" rel="#L10886">10886</span>
<span id="L10887" rel="#L10887">10887</span>
<span id="L10888" rel="#L10888">10888</span>
<span id="L10889" rel="#L10889">10889</span>
<span id="L10890" rel="#L10890">10890</span>
<span id="L10891" rel="#L10891">10891</span>
<span id="L10892" rel="#L10892">10892</span>
<span id="L10893" rel="#L10893">10893</span>
<span id="L10894" rel="#L10894">10894</span>
<span id="L10895" rel="#L10895">10895</span>
<span id="L10896" rel="#L10896">10896</span>
<span id="L10897" rel="#L10897">10897</span>
<span id="L10898" rel="#L10898">10898</span>
<span id="L10899" rel="#L10899">10899</span>
<span id="L10900" rel="#L10900">10900</span>
<span id="L10901" rel="#L10901">10901</span>
<span id="L10902" rel="#L10902">10902</span>
<span id="L10903" rel="#L10903">10903</span>
<span id="L10904" rel="#L10904">10904</span>
<span id="L10905" rel="#L10905">10905</span>
<span id="L10906" rel="#L10906">10906</span>
<span id="L10907" rel="#L10907">10907</span>
<span id="L10908" rel="#L10908">10908</span>
<span id="L10909" rel="#L10909">10909</span>
<span id="L10910" rel="#L10910">10910</span>
<span id="L10911" rel="#L10911">10911</span>
<span id="L10912" rel="#L10912">10912</span>
<span id="L10913" rel="#L10913">10913</span>
<span id="L10914" rel="#L10914">10914</span>
<span id="L10915" rel="#L10915">10915</span>
<span id="L10916" rel="#L10916">10916</span>
<span id="L10917" rel="#L10917">10917</span>
<span id="L10918" rel="#L10918">10918</span>
<span id="L10919" rel="#L10919">10919</span>
<span id="L10920" rel="#L10920">10920</span>
<span id="L10921" rel="#L10921">10921</span>
<span id="L10922" rel="#L10922">10922</span>
<span id="L10923" rel="#L10923">10923</span>
<span id="L10924" rel="#L10924">10924</span>
<span id="L10925" rel="#L10925">10925</span>
<span id="L10926" rel="#L10926">10926</span>
<span id="L10927" rel="#L10927">10927</span>
<span id="L10928" rel="#L10928">10928</span>
<span id="L10929" rel="#L10929">10929</span>
<span id="L10930" rel="#L10930">10930</span>
<span id="L10931" rel="#L10931">10931</span>
<span id="L10932" rel="#L10932">10932</span>
<span id="L10933" rel="#L10933">10933</span>
<span id="L10934" rel="#L10934">10934</span>
<span id="L10935" rel="#L10935">10935</span>
<span id="L10936" rel="#L10936">10936</span>
<span id="L10937" rel="#L10937">10937</span>
<span id="L10938" rel="#L10938">10938</span>
<span id="L10939" rel="#L10939">10939</span>
<span id="L10940" rel="#L10940">10940</span>
<span id="L10941" rel="#L10941">10941</span>
<span id="L10942" rel="#L10942">10942</span>
<span id="L10943" rel="#L10943">10943</span>
<span id="L10944" rel="#L10944">10944</span>
<span id="L10945" rel="#L10945">10945</span>
<span id="L10946" rel="#L10946">10946</span>
<span id="L10947" rel="#L10947">10947</span>
<span id="L10948" rel="#L10948">10948</span>
<span id="L10949" rel="#L10949">10949</span>
<span id="L10950" rel="#L10950">10950</span>
<span id="L10951" rel="#L10951">10951</span>
<span id="L10952" rel="#L10952">10952</span>
<span id="L10953" rel="#L10953">10953</span>
<span id="L10954" rel="#L10954">10954</span>
<span id="L10955" rel="#L10955">10955</span>
<span id="L10956" rel="#L10956">10956</span>
<span id="L10957" rel="#L10957">10957</span>
<span id="L10958" rel="#L10958">10958</span>
<span id="L10959" rel="#L10959">10959</span>
<span id="L10960" rel="#L10960">10960</span>
<span id="L10961" rel="#L10961">10961</span>
<span id="L10962" rel="#L10962">10962</span>
<span id="L10963" rel="#L10963">10963</span>
<span id="L10964" rel="#L10964">10964</span>
<span id="L10965" rel="#L10965">10965</span>
<span id="L10966" rel="#L10966">10966</span>
<span id="L10967" rel="#L10967">10967</span>
<span id="L10968" rel="#L10968">10968</span>
<span id="L10969" rel="#L10969">10969</span>
<span id="L10970" rel="#L10970">10970</span>
<span id="L10971" rel="#L10971">10971</span>
<span id="L10972" rel="#L10972">10972</span>
<span id="L10973" rel="#L10973">10973</span>
<span id="L10974" rel="#L10974">10974</span>
<span id="L10975" rel="#L10975">10975</span>
<span id="L10976" rel="#L10976">10976</span>
<span id="L10977" rel="#L10977">10977</span>
<span id="L10978" rel="#L10978">10978</span>
<span id="L10979" rel="#L10979">10979</span>
<span id="L10980" rel="#L10980">10980</span>
<span id="L10981" rel="#L10981">10981</span>
<span id="L10982" rel="#L10982">10982</span>
<span id="L10983" rel="#L10983">10983</span>
<span id="L10984" rel="#L10984">10984</span>
<span id="L10985" rel="#L10985">10985</span>
<span id="L10986" rel="#L10986">10986</span>
<span id="L10987" rel="#L10987">10987</span>
<span id="L10988" rel="#L10988">10988</span>
<span id="L10989" rel="#L10989">10989</span>
<span id="L10990" rel="#L10990">10990</span>
<span id="L10991" rel="#L10991">10991</span>
<span id="L10992" rel="#L10992">10992</span>
<span id="L10993" rel="#L10993">10993</span>
<span id="L10994" rel="#L10994">10994</span>
<span id="L10995" rel="#L10995">10995</span>
<span id="L10996" rel="#L10996">10996</span>
<span id="L10997" rel="#L10997">10997</span>
<span id="L10998" rel="#L10998">10998</span>
<span id="L10999" rel="#L10999">10999</span>
<span id="L11000" rel="#L11000">11000</span>
<span id="L11001" rel="#L11001">11001</span>
<span id="L11002" rel="#L11002">11002</span>
<span id="L11003" rel="#L11003">11003</span>
<span id="L11004" rel="#L11004">11004</span>
<span id="L11005" rel="#L11005">11005</span>
<span id="L11006" rel="#L11006">11006</span>
<span id="L11007" rel="#L11007">11007</span>
<span id="L11008" rel="#L11008">11008</span>
<span id="L11009" rel="#L11009">11009</span>
<span id="L11010" rel="#L11010">11010</span>
<span id="L11011" rel="#L11011">11011</span>
<span id="L11012" rel="#L11012">11012</span>
<span id="L11013" rel="#L11013">11013</span>
<span id="L11014" rel="#L11014">11014</span>
<span id="L11015" rel="#L11015">11015</span>
<span id="L11016" rel="#L11016">11016</span>
<span id="L11017" rel="#L11017">11017</span>
<span id="L11018" rel="#L11018">11018</span>
<span id="L11019" rel="#L11019">11019</span>
<span id="L11020" rel="#L11020">11020</span>
<span id="L11021" rel="#L11021">11021</span>
<span id="L11022" rel="#L11022">11022</span>
<span id="L11023" rel="#L11023">11023</span>
<span id="L11024" rel="#L11024">11024</span>
<span id="L11025" rel="#L11025">11025</span>
<span id="L11026" rel="#L11026">11026</span>
<span id="L11027" rel="#L11027">11027</span>
<span id="L11028" rel="#L11028">11028</span>
<span id="L11029" rel="#L11029">11029</span>
<span id="L11030" rel="#L11030">11030</span>
<span id="L11031" rel="#L11031">11031</span>
<span id="L11032" rel="#L11032">11032</span>
<span id="L11033" rel="#L11033">11033</span>
<span id="L11034" rel="#L11034">11034</span>
<span id="L11035" rel="#L11035">11035</span>
<span id="L11036" rel="#L11036">11036</span>
<span id="L11037" rel="#L11037">11037</span>
<span id="L11038" rel="#L11038">11038</span>
<span id="L11039" rel="#L11039">11039</span>
<span id="L11040" rel="#L11040">11040</span>
<span id="L11041" rel="#L11041">11041</span>
<span id="L11042" rel="#L11042">11042</span>
<span id="L11043" rel="#L11043">11043</span>
<span id="L11044" rel="#L11044">11044</span>
<span id="L11045" rel="#L11045">11045</span>
<span id="L11046" rel="#L11046">11046</span>
<span id="L11047" rel="#L11047">11047</span>
<span id="L11048" rel="#L11048">11048</span>
<span id="L11049" rel="#L11049">11049</span>
<span id="L11050" rel="#L11050">11050</span>
<span id="L11051" rel="#L11051">11051</span>
<span id="L11052" rel="#L11052">11052</span>
<span id="L11053" rel="#L11053">11053</span>
<span id="L11054" rel="#L11054">11054</span>
<span id="L11055" rel="#L11055">11055</span>
<span id="L11056" rel="#L11056">11056</span>
<span id="L11057" rel="#L11057">11057</span>
<span id="L11058" rel="#L11058">11058</span>
<span id="L11059" rel="#L11059">11059</span>
<span id="L11060" rel="#L11060">11060</span>
<span id="L11061" rel="#L11061">11061</span>
<span id="L11062" rel="#L11062">11062</span>
<span id="L11063" rel="#L11063">11063</span>
<span id="L11064" rel="#L11064">11064</span>
<span id="L11065" rel="#L11065">11065</span>
<span id="L11066" rel="#L11066">11066</span>
<span id="L11067" rel="#L11067">11067</span>
<span id="L11068" rel="#L11068">11068</span>
<span id="L11069" rel="#L11069">11069</span>
<span id="L11070" rel="#L11070">11070</span>
<span id="L11071" rel="#L11071">11071</span>
<span id="L11072" rel="#L11072">11072</span>
<span id="L11073" rel="#L11073">11073</span>
<span id="L11074" rel="#L11074">11074</span>
<span id="L11075" rel="#L11075">11075</span>
<span id="L11076" rel="#L11076">11076</span>
<span id="L11077" rel="#L11077">11077</span>
<span id="L11078" rel="#L11078">11078</span>
<span id="L11079" rel="#L11079">11079</span>
<span id="L11080" rel="#L11080">11080</span>
<span id="L11081" rel="#L11081">11081</span>
<span id="L11082" rel="#L11082">11082</span>
<span id="L11083" rel="#L11083">11083</span>
<span id="L11084" rel="#L11084">11084</span>
<span id="L11085" rel="#L11085">11085</span>
<span id="L11086" rel="#L11086">11086</span>
<span id="L11087" rel="#L11087">11087</span>
<span id="L11088" rel="#L11088">11088</span>
<span id="L11089" rel="#L11089">11089</span>
<span id="L11090" rel="#L11090">11090</span>
<span id="L11091" rel="#L11091">11091</span>
<span id="L11092" rel="#L11092">11092</span>
<span id="L11093" rel="#L11093">11093</span>
<span id="L11094" rel="#L11094">11094</span>
<span id="L11095" rel="#L11095">11095</span>
<span id="L11096" rel="#L11096">11096</span>
<span id="L11097" rel="#L11097">11097</span>
<span id="L11098" rel="#L11098">11098</span>
<span id="L11099" rel="#L11099">11099</span>
<span id="L11100" rel="#L11100">11100</span>
<span id="L11101" rel="#L11101">11101</span>
<span id="L11102" rel="#L11102">11102</span>
<span id="L11103" rel="#L11103">11103</span>
<span id="L11104" rel="#L11104">11104</span>
<span id="L11105" rel="#L11105">11105</span>
<span id="L11106" rel="#L11106">11106</span>
<span id="L11107" rel="#L11107">11107</span>
<span id="L11108" rel="#L11108">11108</span>
<span id="L11109" rel="#L11109">11109</span>
<span id="L11110" rel="#L11110">11110</span>
<span id="L11111" rel="#L11111">11111</span>
<span id="L11112" rel="#L11112">11112</span>
<span id="L11113" rel="#L11113">11113</span>
<span id="L11114" rel="#L11114">11114</span>
<span id="L11115" rel="#L11115">11115</span>
<span id="L11116" rel="#L11116">11116</span>
<span id="L11117" rel="#L11117">11117</span>
<span id="L11118" rel="#L11118">11118</span>
<span id="L11119" rel="#L11119">11119</span>
<span id="L11120" rel="#L11120">11120</span>
<span id="L11121" rel="#L11121">11121</span>
<span id="L11122" rel="#L11122">11122</span>
<span id="L11123" rel="#L11123">11123</span>
<span id="L11124" rel="#L11124">11124</span>
<span id="L11125" rel="#L11125">11125</span>
<span id="L11126" rel="#L11126">11126</span>
<span id="L11127" rel="#L11127">11127</span>
<span id="L11128" rel="#L11128">11128</span>
<span id="L11129" rel="#L11129">11129</span>
<span id="L11130" rel="#L11130">11130</span>
<span id="L11131" rel="#L11131">11131</span>
<span id="L11132" rel="#L11132">11132</span>
<span id="L11133" rel="#L11133">11133</span>
<span id="L11134" rel="#L11134">11134</span>
<span id="L11135" rel="#L11135">11135</span>
<span id="L11136" rel="#L11136">11136</span>
<span id="L11137" rel="#L11137">11137</span>
<span id="L11138" rel="#L11138">11138</span>
<span id="L11139" rel="#L11139">11139</span>
<span id="L11140" rel="#L11140">11140</span>
<span id="L11141" rel="#L11141">11141</span>
<span id="L11142" rel="#L11142">11142</span>
<span id="L11143" rel="#L11143">11143</span>
<span id="L11144" rel="#L11144">11144</span>
<span id="L11145" rel="#L11145">11145</span>
<span id="L11146" rel="#L11146">11146</span>
<span id="L11147" rel="#L11147">11147</span>
<span id="L11148" rel="#L11148">11148</span>
<span id="L11149" rel="#L11149">11149</span>
<span id="L11150" rel="#L11150">11150</span>
<span id="L11151" rel="#L11151">11151</span>
<span id="L11152" rel="#L11152">11152</span>
<span id="L11153" rel="#L11153">11153</span>
<span id="L11154" rel="#L11154">11154</span>
<span id="L11155" rel="#L11155">11155</span>
<span id="L11156" rel="#L11156">11156</span>
<span id="L11157" rel="#L11157">11157</span>
<span id="L11158" rel="#L11158">11158</span>
<span id="L11159" rel="#L11159">11159</span>
<span id="L11160" rel="#L11160">11160</span>
<span id="L11161" rel="#L11161">11161</span>
<span id="L11162" rel="#L11162">11162</span>
<span id="L11163" rel="#L11163">11163</span>
<span id="L11164" rel="#L11164">11164</span>
<span id="L11165" rel="#L11165">11165</span>
<span id="L11166" rel="#L11166">11166</span>
<span id="L11167" rel="#L11167">11167</span>
<span id="L11168" rel="#L11168">11168</span>
<span id="L11169" rel="#L11169">11169</span>
<span id="L11170" rel="#L11170">11170</span>
<span id="L11171" rel="#L11171">11171</span>
<span id="L11172" rel="#L11172">11172</span>
<span id="L11173" rel="#L11173">11173</span>
<span id="L11174" rel="#L11174">11174</span>
<span id="L11175" rel="#L11175">11175</span>
<span id="L11176" rel="#L11176">11176</span>
<span id="L11177" rel="#L11177">11177</span>
<span id="L11178" rel="#L11178">11178</span>
<span id="L11179" rel="#L11179">11179</span>
<span id="L11180" rel="#L11180">11180</span>
<span id="L11181" rel="#L11181">11181</span>
<span id="L11182" rel="#L11182">11182</span>
<span id="L11183" rel="#L11183">11183</span>
<span id="L11184" rel="#L11184">11184</span>
<span id="L11185" rel="#L11185">11185</span>
<span id="L11186" rel="#L11186">11186</span>
<span id="L11187" rel="#L11187">11187</span>
<span id="L11188" rel="#L11188">11188</span>
<span id="L11189" rel="#L11189">11189</span>
<span id="L11190" rel="#L11190">11190</span>
<span id="L11191" rel="#L11191">11191</span>
<span id="L11192" rel="#L11192">11192</span>
<span id="L11193" rel="#L11193">11193</span>
<span id="L11194" rel="#L11194">11194</span>
<span id="L11195" rel="#L11195">11195</span>
<span id="L11196" rel="#L11196">11196</span>
<span id="L11197" rel="#L11197">11197</span>
<span id="L11198" rel="#L11198">11198</span>
<span id="L11199" rel="#L11199">11199</span>
<span id="L11200" rel="#L11200">11200</span>
<span id="L11201" rel="#L11201">11201</span>
<span id="L11202" rel="#L11202">11202</span>
<span id="L11203" rel="#L11203">11203</span>
<span id="L11204" rel="#L11204">11204</span>
<span id="L11205" rel="#L11205">11205</span>
<span id="L11206" rel="#L11206">11206</span>
<span id="L11207" rel="#L11207">11207</span>
<span id="L11208" rel="#L11208">11208</span>
<span id="L11209" rel="#L11209">11209</span>
<span id="L11210" rel="#L11210">11210</span>
<span id="L11211" rel="#L11211">11211</span>
<span id="L11212" rel="#L11212">11212</span>
<span id="L11213" rel="#L11213">11213</span>
<span id="L11214" rel="#L11214">11214</span>
<span id="L11215" rel="#L11215">11215</span>
<span id="L11216" rel="#L11216">11216</span>
<span id="L11217" rel="#L11217">11217</span>
<span id="L11218" rel="#L11218">11218</span>
<span id="L11219" rel="#L11219">11219</span>
<span id="L11220" rel="#L11220">11220</span>
<span id="L11221" rel="#L11221">11221</span>
<span id="L11222" rel="#L11222">11222</span>
<span id="L11223" rel="#L11223">11223</span>
<span id="L11224" rel="#L11224">11224</span>
<span id="L11225" rel="#L11225">11225</span>
<span id="L11226" rel="#L11226">11226</span>
<span id="L11227" rel="#L11227">11227</span>
<span id="L11228" rel="#L11228">11228</span>
<span id="L11229" rel="#L11229">11229</span>
<span id="L11230" rel="#L11230">11230</span>
<span id="L11231" rel="#L11231">11231</span>
<span id="L11232" rel="#L11232">11232</span>
<span id="L11233" rel="#L11233">11233</span>
<span id="L11234" rel="#L11234">11234</span>
<span id="L11235" rel="#L11235">11235</span>
<span id="L11236" rel="#L11236">11236</span>
<span id="L11237" rel="#L11237">11237</span>
<span id="L11238" rel="#L11238">11238</span>
<span id="L11239" rel="#L11239">11239</span>
<span id="L11240" rel="#L11240">11240</span>
<span id="L11241" rel="#L11241">11241</span>
<span id="L11242" rel="#L11242">11242</span>
<span id="L11243" rel="#L11243">11243</span>
<span id="L11244" rel="#L11244">11244</span>
<span id="L11245" rel="#L11245">11245</span>
<span id="L11246" rel="#L11246">11246</span>
<span id="L11247" rel="#L11247">11247</span>
<span id="L11248" rel="#L11248">11248</span>
<span id="L11249" rel="#L11249">11249</span>
<span id="L11250" rel="#L11250">11250</span>
<span id="L11251" rel="#L11251">11251</span>
<span id="L11252" rel="#L11252">11252</span>
<span id="L11253" rel="#L11253">11253</span>
<span id="L11254" rel="#L11254">11254</span>
<span id="L11255" rel="#L11255">11255</span>
<span id="L11256" rel="#L11256">11256</span>
<span id="L11257" rel="#L11257">11257</span>
<span id="L11258" rel="#L11258">11258</span>
<span id="L11259" rel="#L11259">11259</span>
<span id="L11260" rel="#L11260">11260</span>
<span id="L11261" rel="#L11261">11261</span>
<span id="L11262" rel="#L11262">11262</span>
<span id="L11263" rel="#L11263">11263</span>
<span id="L11264" rel="#L11264">11264</span>
<span id="L11265" rel="#L11265">11265</span>
<span id="L11266" rel="#L11266">11266</span>
<span id="L11267" rel="#L11267">11267</span>
<span id="L11268" rel="#L11268">11268</span>
<span id="L11269" rel="#L11269">11269</span>
<span id="L11270" rel="#L11270">11270</span>
<span id="L11271" rel="#L11271">11271</span>
<span id="L11272" rel="#L11272">11272</span>
<span id="L11273" rel="#L11273">11273</span>
<span id="L11274" rel="#L11274">11274</span>
<span id="L11275" rel="#L11275">11275</span>
<span id="L11276" rel="#L11276">11276</span>
<span id="L11277" rel="#L11277">11277</span>
<span id="L11278" rel="#L11278">11278</span>
<span id="L11279" rel="#L11279">11279</span>
<span id="L11280" rel="#L11280">11280</span>
<span id="L11281" rel="#L11281">11281</span>
<span id="L11282" rel="#L11282">11282</span>
<span id="L11283" rel="#L11283">11283</span>
<span id="L11284" rel="#L11284">11284</span>
<span id="L11285" rel="#L11285">11285</span>
<span id="L11286" rel="#L11286">11286</span>
<span id="L11287" rel="#L11287">11287</span>
<span id="L11288" rel="#L11288">11288</span>
<span id="L11289" rel="#L11289">11289</span>
<span id="L11290" rel="#L11290">11290</span>
<span id="L11291" rel="#L11291">11291</span>
<span id="L11292" rel="#L11292">11292</span>
<span id="L11293" rel="#L11293">11293</span>
<span id="L11294" rel="#L11294">11294</span>
<span id="L11295" rel="#L11295">11295</span>
<span id="L11296" rel="#L11296">11296</span>
<span id="L11297" rel="#L11297">11297</span>
<span id="L11298" rel="#L11298">11298</span>
<span id="L11299" rel="#L11299">11299</span>
<span id="L11300" rel="#L11300">11300</span>
<span id="L11301" rel="#L11301">11301</span>
<span id="L11302" rel="#L11302">11302</span>
<span id="L11303" rel="#L11303">11303</span>
<span id="L11304" rel="#L11304">11304</span>
<span id="L11305" rel="#L11305">11305</span>
<span id="L11306" rel="#L11306">11306</span>
<span id="L11307" rel="#L11307">11307</span>
<span id="L11308" rel="#L11308">11308</span>
<span id="L11309" rel="#L11309">11309</span>
<span id="L11310" rel="#L11310">11310</span>
<span id="L11311" rel="#L11311">11311</span>
<span id="L11312" rel="#L11312">11312</span>
<span id="L11313" rel="#L11313">11313</span>
<span id="L11314" rel="#L11314">11314</span>
<span id="L11315" rel="#L11315">11315</span>
<span id="L11316" rel="#L11316">11316</span>
<span id="L11317" rel="#L11317">11317</span>
<span id="L11318" rel="#L11318">11318</span>
<span id="L11319" rel="#L11319">11319</span>
<span id="L11320" rel="#L11320">11320</span>
<span id="L11321" rel="#L11321">11321</span>
<span id="L11322" rel="#L11322">11322</span>
<span id="L11323" rel="#L11323">11323</span>
<span id="L11324" rel="#L11324">11324</span>
<span id="L11325" rel="#L11325">11325</span>
<span id="L11326" rel="#L11326">11326</span>
<span id="L11327" rel="#L11327">11327</span>
<span id="L11328" rel="#L11328">11328</span>
<span id="L11329" rel="#L11329">11329</span>
<span id="L11330" rel="#L11330">11330</span>
<span id="L11331" rel="#L11331">11331</span>
<span id="L11332" rel="#L11332">11332</span>
<span id="L11333" rel="#L11333">11333</span>
<span id="L11334" rel="#L11334">11334</span>
<span id="L11335" rel="#L11335">11335</span>
<span id="L11336" rel="#L11336">11336</span>
<span id="L11337" rel="#L11337">11337</span>
<span id="L11338" rel="#L11338">11338</span>
<span id="L11339" rel="#L11339">11339</span>
<span id="L11340" rel="#L11340">11340</span>
<span id="L11341" rel="#L11341">11341</span>
<span id="L11342" rel="#L11342">11342</span>
<span id="L11343" rel="#L11343">11343</span>
<span id="L11344" rel="#L11344">11344</span>
<span id="L11345" rel="#L11345">11345</span>
<span id="L11346" rel="#L11346">11346</span>
<span id="L11347" rel="#L11347">11347</span>
<span id="L11348" rel="#L11348">11348</span>
<span id="L11349" rel="#L11349">11349</span>
<span id="L11350" rel="#L11350">11350</span>
<span id="L11351" rel="#L11351">11351</span>
<span id="L11352" rel="#L11352">11352</span>
<span id="L11353" rel="#L11353">11353</span>
<span id="L11354" rel="#L11354">11354</span>
<span id="L11355" rel="#L11355">11355</span>
<span id="L11356" rel="#L11356">11356</span>
<span id="L11357" rel="#L11357">11357</span>
<span id="L11358" rel="#L11358">11358</span>
<span id="L11359" rel="#L11359">11359</span>
<span id="L11360" rel="#L11360">11360</span>
<span id="L11361" rel="#L11361">11361</span>
<span id="L11362" rel="#L11362">11362</span>
<span id="L11363" rel="#L11363">11363</span>
<span id="L11364" rel="#L11364">11364</span>
<span id="L11365" rel="#L11365">11365</span>
<span id="L11366" rel="#L11366">11366</span>
<span id="L11367" rel="#L11367">11367</span>
<span id="L11368" rel="#L11368">11368</span>
<span id="L11369" rel="#L11369">11369</span>
<span id="L11370" rel="#L11370">11370</span>
<span id="L11371" rel="#L11371">11371</span>
<span id="L11372" rel="#L11372">11372</span>
<span id="L11373" rel="#L11373">11373</span>
<span id="L11374" rel="#L11374">11374</span>
<span id="L11375" rel="#L11375">11375</span>
<span id="L11376" rel="#L11376">11376</span>
<span id="L11377" rel="#L11377">11377</span>
<span id="L11378" rel="#L11378">11378</span>
<span id="L11379" rel="#L11379">11379</span>
<span id="L11380" rel="#L11380">11380</span>
<span id="L11381" rel="#L11381">11381</span>
<span id="L11382" rel="#L11382">11382</span>
<span id="L11383" rel="#L11383">11383</span>
<span id="L11384" rel="#L11384">11384</span>
<span id="L11385" rel="#L11385">11385</span>
<span id="L11386" rel="#L11386">11386</span>
<span id="L11387" rel="#L11387">11387</span>
<span id="L11388" rel="#L11388">11388</span>
<span id="L11389" rel="#L11389">11389</span>
<span id="L11390" rel="#L11390">11390</span>
<span id="L11391" rel="#L11391">11391</span>
<span id="L11392" rel="#L11392">11392</span>
<span id="L11393" rel="#L11393">11393</span>
<span id="L11394" rel="#L11394">11394</span>
<span id="L11395" rel="#L11395">11395</span>
<span id="L11396" rel="#L11396">11396</span>
<span id="L11397" rel="#L11397">11397</span>
<span id="L11398" rel="#L11398">11398</span>
<span id="L11399" rel="#L11399">11399</span>
<span id="L11400" rel="#L11400">11400</span>
<span id="L11401" rel="#L11401">11401</span>
<span id="L11402" rel="#L11402">11402</span>
<span id="L11403" rel="#L11403">11403</span>
<span id="L11404" rel="#L11404">11404</span>
<span id="L11405" rel="#L11405">11405</span>
<span id="L11406" rel="#L11406">11406</span>
<span id="L11407" rel="#L11407">11407</span>
<span id="L11408" rel="#L11408">11408</span>
<span id="L11409" rel="#L11409">11409</span>
<span id="L11410" rel="#L11410">11410</span>
<span id="L11411" rel="#L11411">11411</span>
<span id="L11412" rel="#L11412">11412</span>
<span id="L11413" rel="#L11413">11413</span>
<span id="L11414" rel="#L11414">11414</span>
<span id="L11415" rel="#L11415">11415</span>
<span id="L11416" rel="#L11416">11416</span>
<span id="L11417" rel="#L11417">11417</span>
<span id="L11418" rel="#L11418">11418</span>
<span id="L11419" rel="#L11419">11419</span>
<span id="L11420" rel="#L11420">11420</span>
<span id="L11421" rel="#L11421">11421</span>
<span id="L11422" rel="#L11422">11422</span>
<span id="L11423" rel="#L11423">11423</span>
<span id="L11424" rel="#L11424">11424</span>
<span id="L11425" rel="#L11425">11425</span>
<span id="L11426" rel="#L11426">11426</span>
<span id="L11427" rel="#L11427">11427</span>
<span id="L11428" rel="#L11428">11428</span>
<span id="L11429" rel="#L11429">11429</span>
<span id="L11430" rel="#L11430">11430</span>
<span id="L11431" rel="#L11431">11431</span>
<span id="L11432" rel="#L11432">11432</span>
<span id="L11433" rel="#L11433">11433</span>
<span id="L11434" rel="#L11434">11434</span>
<span id="L11435" rel="#L11435">11435</span>
<span id="L11436" rel="#L11436">11436</span>
<span id="L11437" rel="#L11437">11437</span>
<span id="L11438" rel="#L11438">11438</span>
<span id="L11439" rel="#L11439">11439</span>
<span id="L11440" rel="#L11440">11440</span>
<span id="L11441" rel="#L11441">11441</span>
<span id="L11442" rel="#L11442">11442</span>
<span id="L11443" rel="#L11443">11443</span>
<span id="L11444" rel="#L11444">11444</span>
<span id="L11445" rel="#L11445">11445</span>
<span id="L11446" rel="#L11446">11446</span>
<span id="L11447" rel="#L11447">11447</span>
<span id="L11448" rel="#L11448">11448</span>
<span id="L11449" rel="#L11449">11449</span>
<span id="L11450" rel="#L11450">11450</span>
<span id="L11451" rel="#L11451">11451</span>
<span id="L11452" rel="#L11452">11452</span>
<span id="L11453" rel="#L11453">11453</span>
<span id="L11454" rel="#L11454">11454</span>
<span id="L11455" rel="#L11455">11455</span>
<span id="L11456" rel="#L11456">11456</span>
<span id="L11457" rel="#L11457">11457</span>
<span id="L11458" rel="#L11458">11458</span>
<span id="L11459" rel="#L11459">11459</span>
<span id="L11460" rel="#L11460">11460</span>
<span id="L11461" rel="#L11461">11461</span>
<span id="L11462" rel="#L11462">11462</span>
<span id="L11463" rel="#L11463">11463</span>
<span id="L11464" rel="#L11464">11464</span>
<span id="L11465" rel="#L11465">11465</span>
<span id="L11466" rel="#L11466">11466</span>
<span id="L11467" rel="#L11467">11467</span>
<span id="L11468" rel="#L11468">11468</span>
<span id="L11469" rel="#L11469">11469</span>
<span id="L11470" rel="#L11470">11470</span>
<span id="L11471" rel="#L11471">11471</span>
<span id="L11472" rel="#L11472">11472</span>
<span id="L11473" rel="#L11473">11473</span>
<span id="L11474" rel="#L11474">11474</span>
<span id="L11475" rel="#L11475">11475</span>
<span id="L11476" rel="#L11476">11476</span>
<span id="L11477" rel="#L11477">11477</span>
<span id="L11478" rel="#L11478">11478</span>
<span id="L11479" rel="#L11479">11479</span>
<span id="L11480" rel="#L11480">11480</span>
<span id="L11481" rel="#L11481">11481</span>
<span id="L11482" rel="#L11482">11482</span>
<span id="L11483" rel="#L11483">11483</span>
<span id="L11484" rel="#L11484">11484</span>
<span id="L11485" rel="#L11485">11485</span>
<span id="L11486" rel="#L11486">11486</span>
<span id="L11487" rel="#L11487">11487</span>
<span id="L11488" rel="#L11488">11488</span>
<span id="L11489" rel="#L11489">11489</span>
<span id="L11490" rel="#L11490">11490</span>
<span id="L11491" rel="#L11491">11491</span>
<span id="L11492" rel="#L11492">11492</span>
<span id="L11493" rel="#L11493">11493</span>
<span id="L11494" rel="#L11494">11494</span>
<span id="L11495" rel="#L11495">11495</span>
<span id="L11496" rel="#L11496">11496</span>
<span id="L11497" rel="#L11497">11497</span>
<span id="L11498" rel="#L11498">11498</span>
<span id="L11499" rel="#L11499">11499</span>
<span id="L11500" rel="#L11500">11500</span>
<span id="L11501" rel="#L11501">11501</span>
<span id="L11502" rel="#L11502">11502</span>
<span id="L11503" rel="#L11503">11503</span>
<span id="L11504" rel="#L11504">11504</span>
<span id="L11505" rel="#L11505">11505</span>
<span id="L11506" rel="#L11506">11506</span>
<span id="L11507" rel="#L11507">11507</span>
<span id="L11508" rel="#L11508">11508</span>
<span id="L11509" rel="#L11509">11509</span>
<span id="L11510" rel="#L11510">11510</span>
<span id="L11511" rel="#L11511">11511</span>
<span id="L11512" rel="#L11512">11512</span>
<span id="L11513" rel="#L11513">11513</span>
<span id="L11514" rel="#L11514">11514</span>
<span id="L11515" rel="#L11515">11515</span>
<span id="L11516" rel="#L11516">11516</span>
<span id="L11517" rel="#L11517">11517</span>
<span id="L11518" rel="#L11518">11518</span>
<span id="L11519" rel="#L11519">11519</span>
<span id="L11520" rel="#L11520">11520</span>
<span id="L11521" rel="#L11521">11521</span>
<span id="L11522" rel="#L11522">11522</span>
<span id="L11523" rel="#L11523">11523</span>
<span id="L11524" rel="#L11524">11524</span>
<span id="L11525" rel="#L11525">11525</span>
<span id="L11526" rel="#L11526">11526</span>
<span id="L11527" rel="#L11527">11527</span>
<span id="L11528" rel="#L11528">11528</span>
<span id="L11529" rel="#L11529">11529</span>
<span id="L11530" rel="#L11530">11530</span>
<span id="L11531" rel="#L11531">11531</span>
<span id="L11532" rel="#L11532">11532</span>
<span id="L11533" rel="#L11533">11533</span>
<span id="L11534" rel="#L11534">11534</span>
<span id="L11535" rel="#L11535">11535</span>
<span id="L11536" rel="#L11536">11536</span>
<span id="L11537" rel="#L11537">11537</span>
<span id="L11538" rel="#L11538">11538</span>
<span id="L11539" rel="#L11539">11539</span>
<span id="L11540" rel="#L11540">11540</span>
<span id="L11541" rel="#L11541">11541</span>
<span id="L11542" rel="#L11542">11542</span>
<span id="L11543" rel="#L11543">11543</span>
<span id="L11544" rel="#L11544">11544</span>
<span id="L11545" rel="#L11545">11545</span>
<span id="L11546" rel="#L11546">11546</span>
<span id="L11547" rel="#L11547">11547</span>
<span id="L11548" rel="#L11548">11548</span>
<span id="L11549" rel="#L11549">11549</span>
<span id="L11550" rel="#L11550">11550</span>
<span id="L11551" rel="#L11551">11551</span>
<span id="L11552" rel="#L11552">11552</span>
<span id="L11553" rel="#L11553">11553</span>
<span id="L11554" rel="#L11554">11554</span>
<span id="L11555" rel="#L11555">11555</span>
<span id="L11556" rel="#L11556">11556</span>
<span id="L11557" rel="#L11557">11557</span>
<span id="L11558" rel="#L11558">11558</span>
<span id="L11559" rel="#L11559">11559</span>
<span id="L11560" rel="#L11560">11560</span>
<span id="L11561" rel="#L11561">11561</span>
<span id="L11562" rel="#L11562">11562</span>
<span id="L11563" rel="#L11563">11563</span>
<span id="L11564" rel="#L11564">11564</span>
<span id="L11565" rel="#L11565">11565</span>
<span id="L11566" rel="#L11566">11566</span>
<span id="L11567" rel="#L11567">11567</span>
<span id="L11568" rel="#L11568">11568</span>
<span id="L11569" rel="#L11569">11569</span>
<span id="L11570" rel="#L11570">11570</span>
<span id="L11571" rel="#L11571">11571</span>
<span id="L11572" rel="#L11572">11572</span>
<span id="L11573" rel="#L11573">11573</span>
<span id="L11574" rel="#L11574">11574</span>
<span id="L11575" rel="#L11575">11575</span>
<span id="L11576" rel="#L11576">11576</span>
<span id="L11577" rel="#L11577">11577</span>
<span id="L11578" rel="#L11578">11578</span>
<span id="L11579" rel="#L11579">11579</span>
<span id="L11580" rel="#L11580">11580</span>
<span id="L11581" rel="#L11581">11581</span>
<span id="L11582" rel="#L11582">11582</span>
<span id="L11583" rel="#L11583">11583</span>
<span id="L11584" rel="#L11584">11584</span>
<span id="L11585" rel="#L11585">11585</span>
<span id="L11586" rel="#L11586">11586</span>
<span id="L11587" rel="#L11587">11587</span>
<span id="L11588" rel="#L11588">11588</span>
<span id="L11589" rel="#L11589">11589</span>
<span id="L11590" rel="#L11590">11590</span>
<span id="L11591" rel="#L11591">11591</span>
<span id="L11592" rel="#L11592">11592</span>
<span id="L11593" rel="#L11593">11593</span>
<span id="L11594" rel="#L11594">11594</span>
<span id="L11595" rel="#L11595">11595</span>
<span id="L11596" rel="#L11596">11596</span>
<span id="L11597" rel="#L11597">11597</span>
<span id="L11598" rel="#L11598">11598</span>
<span id="L11599" rel="#L11599">11599</span>
<span id="L11600" rel="#L11600">11600</span>
<span id="L11601" rel="#L11601">11601</span>
<span id="L11602" rel="#L11602">11602</span>
<span id="L11603" rel="#L11603">11603</span>
<span id="L11604" rel="#L11604">11604</span>
<span id="L11605" rel="#L11605">11605</span>
<span id="L11606" rel="#L11606">11606</span>
<span id="L11607" rel="#L11607">11607</span>
<span id="L11608" rel="#L11608">11608</span>
<span id="L11609" rel="#L11609">11609</span>
<span id="L11610" rel="#L11610">11610</span>
<span id="L11611" rel="#L11611">11611</span>
<span id="L11612" rel="#L11612">11612</span>
<span id="L11613" rel="#L11613">11613</span>
<span id="L11614" rel="#L11614">11614</span>
<span id="L11615" rel="#L11615">11615</span>
<span id="L11616" rel="#L11616">11616</span>
<span id="L11617" rel="#L11617">11617</span>
<span id="L11618" rel="#L11618">11618</span>
<span id="L11619" rel="#L11619">11619</span>
<span id="L11620" rel="#L11620">11620</span>
<span id="L11621" rel="#L11621">11621</span>
<span id="L11622" rel="#L11622">11622</span>
<span id="L11623" rel="#L11623">11623</span>
<span id="L11624" rel="#L11624">11624</span>
<span id="L11625" rel="#L11625">11625</span>
<span id="L11626" rel="#L11626">11626</span>
<span id="L11627" rel="#L11627">11627</span>
<span id="L11628" rel="#L11628">11628</span>
<span id="L11629" rel="#L11629">11629</span>
<span id="L11630" rel="#L11630">11630</span>
<span id="L11631" rel="#L11631">11631</span>
<span id="L11632" rel="#L11632">11632</span>
<span id="L11633" rel="#L11633">11633</span>
<span id="L11634" rel="#L11634">11634</span>
<span id="L11635" rel="#L11635">11635</span>
<span id="L11636" rel="#L11636">11636</span>
<span id="L11637" rel="#L11637">11637</span>
<span id="L11638" rel="#L11638">11638</span>
<span id="L11639" rel="#L11639">11639</span>
<span id="L11640" rel="#L11640">11640</span>
<span id="L11641" rel="#L11641">11641</span>
<span id="L11642" rel="#L11642">11642</span>
<span id="L11643" rel="#L11643">11643</span>
<span id="L11644" rel="#L11644">11644</span>
<span id="L11645" rel="#L11645">11645</span>
<span id="L11646" rel="#L11646">11646</span>
<span id="L11647" rel="#L11647">11647</span>
<span id="L11648" rel="#L11648">11648</span>
<span id="L11649" rel="#L11649">11649</span>
<span id="L11650" rel="#L11650">11650</span>
<span id="L11651" rel="#L11651">11651</span>
<span id="L11652" rel="#L11652">11652</span>
<span id="L11653" rel="#L11653">11653</span>
<span id="L11654" rel="#L11654">11654</span>
<span id="L11655" rel="#L11655">11655</span>
<span id="L11656" rel="#L11656">11656</span>
<span id="L11657" rel="#L11657">11657</span>
<span id="L11658" rel="#L11658">11658</span>
<span id="L11659" rel="#L11659">11659</span>
<span id="L11660" rel="#L11660">11660</span>
<span id="L11661" rel="#L11661">11661</span>
<span id="L11662" rel="#L11662">11662</span>
<span id="L11663" rel="#L11663">11663</span>
<span id="L11664" rel="#L11664">11664</span>
<span id="L11665" rel="#L11665">11665</span>
<span id="L11666" rel="#L11666">11666</span>
<span id="L11667" rel="#L11667">11667</span>
<span id="L11668" rel="#L11668">11668</span>
<span id="L11669" rel="#L11669">11669</span>
<span id="L11670" rel="#L11670">11670</span>
<span id="L11671" rel="#L11671">11671</span>
<span id="L11672" rel="#L11672">11672</span>
<span id="L11673" rel="#L11673">11673</span>
<span id="L11674" rel="#L11674">11674</span>
<span id="L11675" rel="#L11675">11675</span>
<span id="L11676" rel="#L11676">11676</span>
<span id="L11677" rel="#L11677">11677</span>
<span id="L11678" rel="#L11678">11678</span>
<span id="L11679" rel="#L11679">11679</span>
<span id="L11680" rel="#L11680">11680</span>
<span id="L11681" rel="#L11681">11681</span>
<span id="L11682" rel="#L11682">11682</span>
<span id="L11683" rel="#L11683">11683</span>
<span id="L11684" rel="#L11684">11684</span>
<span id="L11685" rel="#L11685">11685</span>
<span id="L11686" rel="#L11686">11686</span>
<span id="L11687" rel="#L11687">11687</span>
<span id="L11688" rel="#L11688">11688</span>
<span id="L11689" rel="#L11689">11689</span>
<span id="L11690" rel="#L11690">11690</span>
<span id="L11691" rel="#L11691">11691</span>
<span id="L11692" rel="#L11692">11692</span>
<span id="L11693" rel="#L11693">11693</span>
<span id="L11694" rel="#L11694">11694</span>
<span id="L11695" rel="#L11695">11695</span>
<span id="L11696" rel="#L11696">11696</span>
<span id="L11697" rel="#L11697">11697</span>
<span id="L11698" rel="#L11698">11698</span>
<span id="L11699" rel="#L11699">11699</span>
<span id="L11700" rel="#L11700">11700</span>
<span id="L11701" rel="#L11701">11701</span>
<span id="L11702" rel="#L11702">11702</span>
<span id="L11703" rel="#L11703">11703</span>
<span id="L11704" rel="#L11704">11704</span>
<span id="L11705" rel="#L11705">11705</span>
<span id="L11706" rel="#L11706">11706</span>
<span id="L11707" rel="#L11707">11707</span>
<span id="L11708" rel="#L11708">11708</span>
<span id="L11709" rel="#L11709">11709</span>
<span id="L11710" rel="#L11710">11710</span>
<span id="L11711" rel="#L11711">11711</span>
<span id="L11712" rel="#L11712">11712</span>
<span id="L11713" rel="#L11713">11713</span>
<span id="L11714" rel="#L11714">11714</span>
<span id="L11715" rel="#L11715">11715</span>
<span id="L11716" rel="#L11716">11716</span>
<span id="L11717" rel="#L11717">11717</span>
<span id="L11718" rel="#L11718">11718</span>
<span id="L11719" rel="#L11719">11719</span>
<span id="L11720" rel="#L11720">11720</span>
<span id="L11721" rel="#L11721">11721</span>
<span id="L11722" rel="#L11722">11722</span>
<span id="L11723" rel="#L11723">11723</span>
<span id="L11724" rel="#L11724">11724</span>
<span id="L11725" rel="#L11725">11725</span>
<span id="L11726" rel="#L11726">11726</span>
<span id="L11727" rel="#L11727">11727</span>
<span id="L11728" rel="#L11728">11728</span>
<span id="L11729" rel="#L11729">11729</span>
<span id="L11730" rel="#L11730">11730</span>
<span id="L11731" rel="#L11731">11731</span>
<span id="L11732" rel="#L11732">11732</span>
<span id="L11733" rel="#L11733">11733</span>
<span id="L11734" rel="#L11734">11734</span>
<span id="L11735" rel="#L11735">11735</span>
<span id="L11736" rel="#L11736">11736</span>
<span id="L11737" rel="#L11737">11737</span>
<span id="L11738" rel="#L11738">11738</span>
<span id="L11739" rel="#L11739">11739</span>
<span id="L11740" rel="#L11740">11740</span>
<span id="L11741" rel="#L11741">11741</span>
<span id="L11742" rel="#L11742">11742</span>
<span id="L11743" rel="#L11743">11743</span>
<span id="L11744" rel="#L11744">11744</span>
<span id="L11745" rel="#L11745">11745</span>
<span id="L11746" rel="#L11746">11746</span>
<span id="L11747" rel="#L11747">11747</span>
<span id="L11748" rel="#L11748">11748</span>
<span id="L11749" rel="#L11749">11749</span>
<span id="L11750" rel="#L11750">11750</span>
<span id="L11751" rel="#L11751">11751</span>
<span id="L11752" rel="#L11752">11752</span>
<span id="L11753" rel="#L11753">11753</span>
<span id="L11754" rel="#L11754">11754</span>
<span id="L11755" rel="#L11755">11755</span>
<span id="L11756" rel="#L11756">11756</span>
<span id="L11757" rel="#L11757">11757</span>
<span id="L11758" rel="#L11758">11758</span>
<span id="L11759" rel="#L11759">11759</span>
<span id="L11760" rel="#L11760">11760</span>
<span id="L11761" rel="#L11761">11761</span>
<span id="L11762" rel="#L11762">11762</span>
<span id="L11763" rel="#L11763">11763</span>
<span id="L11764" rel="#L11764">11764</span>
<span id="L11765" rel="#L11765">11765</span>
<span id="L11766" rel="#L11766">11766</span>
<span id="L11767" rel="#L11767">11767</span>
<span id="L11768" rel="#L11768">11768</span>
<span id="L11769" rel="#L11769">11769</span>
<span id="L11770" rel="#L11770">11770</span>
<span id="L11771" rel="#L11771">11771</span>
<span id="L11772" rel="#L11772">11772</span>
<span id="L11773" rel="#L11773">11773</span>
<span id="L11774" rel="#L11774">11774</span>
<span id="L11775" rel="#L11775">11775</span>
<span id="L11776" rel="#L11776">11776</span>
<span id="L11777" rel="#L11777">11777</span>
<span id="L11778" rel="#L11778">11778</span>
<span id="L11779" rel="#L11779">11779</span>
<span id="L11780" rel="#L11780">11780</span>
<span id="L11781" rel="#L11781">11781</span>
<span id="L11782" rel="#L11782">11782</span>
<span id="L11783" rel="#L11783">11783</span>
<span id="L11784" rel="#L11784">11784</span>
<span id="L11785" rel="#L11785">11785</span>
<span id="L11786" rel="#L11786">11786</span>
<span id="L11787" rel="#L11787">11787</span>
<span id="L11788" rel="#L11788">11788</span>
<span id="L11789" rel="#L11789">11789</span>
<span id="L11790" rel="#L11790">11790</span>
<span id="L11791" rel="#L11791">11791</span>
<span id="L11792" rel="#L11792">11792</span>
<span id="L11793" rel="#L11793">11793</span>
<span id="L11794" rel="#L11794">11794</span>
<span id="L11795" rel="#L11795">11795</span>
<span id="L11796" rel="#L11796">11796</span>
<span id="L11797" rel="#L11797">11797</span>
<span id="L11798" rel="#L11798">11798</span>
<span id="L11799" rel="#L11799">11799</span>
<span id="L11800" rel="#L11800">11800</span>
<span id="L11801" rel="#L11801">11801</span>
<span id="L11802" rel="#L11802">11802</span>
<span id="L11803" rel="#L11803">11803</span>
<span id="L11804" rel="#L11804">11804</span>
<span id="L11805" rel="#L11805">11805</span>
<span id="L11806" rel="#L11806">11806</span>
<span id="L11807" rel="#L11807">11807</span>
<span id="L11808" rel="#L11808">11808</span>
<span id="L11809" rel="#L11809">11809</span>
<span id="L11810" rel="#L11810">11810</span>
<span id="L11811" rel="#L11811">11811</span>
<span id="L11812" rel="#L11812">11812</span>
<span id="L11813" rel="#L11813">11813</span>
<span id="L11814" rel="#L11814">11814</span>
<span id="L11815" rel="#L11815">11815</span>
<span id="L11816" rel="#L11816">11816</span>
<span id="L11817" rel="#L11817">11817</span>
<span id="L11818" rel="#L11818">11818</span>
<span id="L11819" rel="#L11819">11819</span>
<span id="L11820" rel="#L11820">11820</span>
<span id="L11821" rel="#L11821">11821</span>
<span id="L11822" rel="#L11822">11822</span>
<span id="L11823" rel="#L11823">11823</span>
<span id="L11824" rel="#L11824">11824</span>
<span id="L11825" rel="#L11825">11825</span>
<span id="L11826" rel="#L11826">11826</span>
<span id="L11827" rel="#L11827">11827</span>
<span id="L11828" rel="#L11828">11828</span>
<span id="L11829" rel="#L11829">11829</span>
<span id="L11830" rel="#L11830">11830</span>
<span id="L11831" rel="#L11831">11831</span>
<span id="L11832" rel="#L11832">11832</span>
<span id="L11833" rel="#L11833">11833</span>
<span id="L11834" rel="#L11834">11834</span>
<span id="L11835" rel="#L11835">11835</span>
<span id="L11836" rel="#L11836">11836</span>
<span id="L11837" rel="#L11837">11837</span>
<span id="L11838" rel="#L11838">11838</span>
<span id="L11839" rel="#L11839">11839</span>
<span id="L11840" rel="#L11840">11840</span>
<span id="L11841" rel="#L11841">11841</span>
<span id="L11842" rel="#L11842">11842</span>
<span id="L11843" rel="#L11843">11843</span>
<span id="L11844" rel="#L11844">11844</span>
<span id="L11845" rel="#L11845">11845</span>
<span id="L11846" rel="#L11846">11846</span>
<span id="L11847" rel="#L11847">11847</span>
<span id="L11848" rel="#L11848">11848</span>
<span id="L11849" rel="#L11849">11849</span>
<span id="L11850" rel="#L11850">11850</span>
<span id="L11851" rel="#L11851">11851</span>
<span id="L11852" rel="#L11852">11852</span>
<span id="L11853" rel="#L11853">11853</span>
<span id="L11854" rel="#L11854">11854</span>
<span id="L11855" rel="#L11855">11855</span>
<span id="L11856" rel="#L11856">11856</span>
<span id="L11857" rel="#L11857">11857</span>
<span id="L11858" rel="#L11858">11858</span>
<span id="L11859" rel="#L11859">11859</span>
<span id="L11860" rel="#L11860">11860</span>
<span id="L11861" rel="#L11861">11861</span>
<span id="L11862" rel="#L11862">11862</span>
<span id="L11863" rel="#L11863">11863</span>
<span id="L11864" rel="#L11864">11864</span>
<span id="L11865" rel="#L11865">11865</span>
<span id="L11866" rel="#L11866">11866</span>
<span id="L11867" rel="#L11867">11867</span>
<span id="L11868" rel="#L11868">11868</span>
<span id="L11869" rel="#L11869">11869</span>
<span id="L11870" rel="#L11870">11870</span>
<span id="L11871" rel="#L11871">11871</span>
<span id="L11872" rel="#L11872">11872</span>
<span id="L11873" rel="#L11873">11873</span>
<span id="L11874" rel="#L11874">11874</span>
<span id="L11875" rel="#L11875">11875</span>
<span id="L11876" rel="#L11876">11876</span>
<span id="L11877" rel="#L11877">11877</span>
<span id="L11878" rel="#L11878">11878</span>
<span id="L11879" rel="#L11879">11879</span>
<span id="L11880" rel="#L11880">11880</span>
<span id="L11881" rel="#L11881">11881</span>
<span id="L11882" rel="#L11882">11882</span>
<span id="L11883" rel="#L11883">11883</span>
<span id="L11884" rel="#L11884">11884</span>
<span id="L11885" rel="#L11885">11885</span>
<span id="L11886" rel="#L11886">11886</span>
<span id="L11887" rel="#L11887">11887</span>
<span id="L11888" rel="#L11888">11888</span>
<span id="L11889" rel="#L11889">11889</span>
<span id="L11890" rel="#L11890">11890</span>
<span id="L11891" rel="#L11891">11891</span>
<span id="L11892" rel="#L11892">11892</span>
<span id="L11893" rel="#L11893">11893</span>
<span id="L11894" rel="#L11894">11894</span>
<span id="L11895" rel="#L11895">11895</span>
<span id="L11896" rel="#L11896">11896</span>
<span id="L11897" rel="#L11897">11897</span>
<span id="L11898" rel="#L11898">11898</span>
<span id="L11899" rel="#L11899">11899</span>
<span id="L11900" rel="#L11900">11900</span>
<span id="L11901" rel="#L11901">11901</span>
<span id="L11902" rel="#L11902">11902</span>
<span id="L11903" rel="#L11903">11903</span>
<span id="L11904" rel="#L11904">11904</span>
<span id="L11905" rel="#L11905">11905</span>
<span id="L11906" rel="#L11906">11906</span>
<span id="L11907" rel="#L11907">11907</span>
<span id="L11908" rel="#L11908">11908</span>
<span id="L11909" rel="#L11909">11909</span>
<span id="L11910" rel="#L11910">11910</span>
<span id="L11911" rel="#L11911">11911</span>
<span id="L11912" rel="#L11912">11912</span>
<span id="L11913" rel="#L11913">11913</span>
<span id="L11914" rel="#L11914">11914</span>
<span id="L11915" rel="#L11915">11915</span>
<span id="L11916" rel="#L11916">11916</span>
<span id="L11917" rel="#L11917">11917</span>
<span id="L11918" rel="#L11918">11918</span>
<span id="L11919" rel="#L11919">11919</span>
<span id="L11920" rel="#L11920">11920</span>
<span id="L11921" rel="#L11921">11921</span>
<span id="L11922" rel="#L11922">11922</span>
<span id="L11923" rel="#L11923">11923</span>
<span id="L11924" rel="#L11924">11924</span>
<span id="L11925" rel="#L11925">11925</span>
<span id="L11926" rel="#L11926">11926</span>
<span id="L11927" rel="#L11927">11927</span>
<span id="L11928" rel="#L11928">11928</span>
<span id="L11929" rel="#L11929">11929</span>
<span id="L11930" rel="#L11930">11930</span>
<span id="L11931" rel="#L11931">11931</span>
<span id="L11932" rel="#L11932">11932</span>
<span id="L11933" rel="#L11933">11933</span>
<span id="L11934" rel="#L11934">11934</span>
<span id="L11935" rel="#L11935">11935</span>
<span id="L11936" rel="#L11936">11936</span>
<span id="L11937" rel="#L11937">11937</span>
<span id="L11938" rel="#L11938">11938</span>
<span id="L11939" rel="#L11939">11939</span>
<span id="L11940" rel="#L11940">11940</span>
<span id="L11941" rel="#L11941">11941</span>
<span id="L11942" rel="#L11942">11942</span>
<span id="L11943" rel="#L11943">11943</span>
<span id="L11944" rel="#L11944">11944</span>
<span id="L11945" rel="#L11945">11945</span>
<span id="L11946" rel="#L11946">11946</span>
<span id="L11947" rel="#L11947">11947</span>
<span id="L11948" rel="#L11948">11948</span>
<span id="L11949" rel="#L11949">11949</span>
<span id="L11950" rel="#L11950">11950</span>
<span id="L11951" rel="#L11951">11951</span>
<span id="L11952" rel="#L11952">11952</span>
<span id="L11953" rel="#L11953">11953</span>
<span id="L11954" rel="#L11954">11954</span>
<span id="L11955" rel="#L11955">11955</span>
<span id="L11956" rel="#L11956">11956</span>
<span id="L11957" rel="#L11957">11957</span>
<span id="L11958" rel="#L11958">11958</span>
<span id="L11959" rel="#L11959">11959</span>
<span id="L11960" rel="#L11960">11960</span>
<span id="L11961" rel="#L11961">11961</span>
<span id="L11962" rel="#L11962">11962</span>
<span id="L11963" rel="#L11963">11963</span>
<span id="L11964" rel="#L11964">11964</span>
<span id="L11965" rel="#L11965">11965</span>
<span id="L11966" rel="#L11966">11966</span>
<span id="L11967" rel="#L11967">11967</span>
<span id="L11968" rel="#L11968">11968</span>
<span id="L11969" rel="#L11969">11969</span>
<span id="L11970" rel="#L11970">11970</span>
<span id="L11971" rel="#L11971">11971</span>
<span id="L11972" rel="#L11972">11972</span>
<span id="L11973" rel="#L11973">11973</span>
<span id="L11974" rel="#L11974">11974</span>
<span id="L11975" rel="#L11975">11975</span>
<span id="L11976" rel="#L11976">11976</span>
<span id="L11977" rel="#L11977">11977</span>
<span id="L11978" rel="#L11978">11978</span>
<span id="L11979" rel="#L11979">11979</span>
<span id="L11980" rel="#L11980">11980</span>
<span id="L11981" rel="#L11981">11981</span>
<span id="L11982" rel="#L11982">11982</span>
<span id="L11983" rel="#L11983">11983</span>
<span id="L11984" rel="#L11984">11984</span>
<span id="L11985" rel="#L11985">11985</span>
<span id="L11986" rel="#L11986">11986</span>
<span id="L11987" rel="#L11987">11987</span>
<span id="L11988" rel="#L11988">11988</span>
<span id="L11989" rel="#L11989">11989</span>
<span id="L11990" rel="#L11990">11990</span>
<span id="L11991" rel="#L11991">11991</span>
<span id="L11992" rel="#L11992">11992</span>
<span id="L11993" rel="#L11993">11993</span>
<span id="L11994" rel="#L11994">11994</span>
<span id="L11995" rel="#L11995">11995</span>
<span id="L11996" rel="#L11996">11996</span>
<span id="L11997" rel="#L11997">11997</span>
<span id="L11998" rel="#L11998">11998</span>
<span id="L11999" rel="#L11999">11999</span>
<span id="L12000" rel="#L12000">12000</span>
<span id="L12001" rel="#L12001">12001</span>
<span id="L12002" rel="#L12002">12002</span>
<span id="L12003" rel="#L12003">12003</span>
<span id="L12004" rel="#L12004">12004</span>
<span id="L12005" rel="#L12005">12005</span>
<span id="L12006" rel="#L12006">12006</span>
<span id="L12007" rel="#L12007">12007</span>
<span id="L12008" rel="#L12008">12008</span>
<span id="L12009" rel="#L12009">12009</span>
<span id="L12010" rel="#L12010">12010</span>
<span id="L12011" rel="#L12011">12011</span>
<span id="L12012" rel="#L12012">12012</span>
<span id="L12013" rel="#L12013">12013</span>
<span id="L12014" rel="#L12014">12014</span>
<span id="L12015" rel="#L12015">12015</span>
<span id="L12016" rel="#L12016">12016</span>
<span id="L12017" rel="#L12017">12017</span>
<span id="L12018" rel="#L12018">12018</span>
<span id="L12019" rel="#L12019">12019</span>
<span id="L12020" rel="#L12020">12020</span>
<span id="L12021" rel="#L12021">12021</span>
<span id="L12022" rel="#L12022">12022</span>
<span id="L12023" rel="#L12023">12023</span>
<span id="L12024" rel="#L12024">12024</span>
<span id="L12025" rel="#L12025">12025</span>
<span id="L12026" rel="#L12026">12026</span>
<span id="L12027" rel="#L12027">12027</span>
<span id="L12028" rel="#L12028">12028</span>
<span id="L12029" rel="#L12029">12029</span>
<span id="L12030" rel="#L12030">12030</span>
<span id="L12031" rel="#L12031">12031</span>
<span id="L12032" rel="#L12032">12032</span>
<span id="L12033" rel="#L12033">12033</span>
<span id="L12034" rel="#L12034">12034</span>
<span id="L12035" rel="#L12035">12035</span>
<span id="L12036" rel="#L12036">12036</span>
<span id="L12037" rel="#L12037">12037</span>
<span id="L12038" rel="#L12038">12038</span>
<span id="L12039" rel="#L12039">12039</span>
<span id="L12040" rel="#L12040">12040</span>
<span id="L12041" rel="#L12041">12041</span>
<span id="L12042" rel="#L12042">12042</span>
<span id="L12043" rel="#L12043">12043</span>
<span id="L12044" rel="#L12044">12044</span>
<span id="L12045" rel="#L12045">12045</span>
<span id="L12046" rel="#L12046">12046</span>
<span id="L12047" rel="#L12047">12047</span>
<span id="L12048" rel="#L12048">12048</span>
<span id="L12049" rel="#L12049">12049</span>
<span id="L12050" rel="#L12050">12050</span>
<span id="L12051" rel="#L12051">12051</span>
<span id="L12052" rel="#L12052">12052</span>
<span id="L12053" rel="#L12053">12053</span>
<span id="L12054" rel="#L12054">12054</span>
<span id="L12055" rel="#L12055">12055</span>
<span id="L12056" rel="#L12056">12056</span>
<span id="L12057" rel="#L12057">12057</span>
<span id="L12058" rel="#L12058">12058</span>
<span id="L12059" rel="#L12059">12059</span>
<span id="L12060" rel="#L12060">12060</span>
<span id="L12061" rel="#L12061">12061</span>
<span id="L12062" rel="#L12062">12062</span>
<span id="L12063" rel="#L12063">12063</span>
<span id="L12064" rel="#L12064">12064</span>
<span id="L12065" rel="#L12065">12065</span>
<span id="L12066" rel="#L12066">12066</span>
<span id="L12067" rel="#L12067">12067</span>
<span id="L12068" rel="#L12068">12068</span>
<span id="L12069" rel="#L12069">12069</span>
<span id="L12070" rel="#L12070">12070</span>
<span id="L12071" rel="#L12071">12071</span>
<span id="L12072" rel="#L12072">12072</span>
<span id="L12073" rel="#L12073">12073</span>
<span id="L12074" rel="#L12074">12074</span>
<span id="L12075" rel="#L12075">12075</span>
<span id="L12076" rel="#L12076">12076</span>
<span id="L12077" rel="#L12077">12077</span>
<span id="L12078" rel="#L12078">12078</span>
<span id="L12079" rel="#L12079">12079</span>
<span id="L12080" rel="#L12080">12080</span>
<span id="L12081" rel="#L12081">12081</span>
<span id="L12082" rel="#L12082">12082</span>
<span id="L12083" rel="#L12083">12083</span>
<span id="L12084" rel="#L12084">12084</span>
<span id="L12085" rel="#L12085">12085</span>
<span id="L12086" rel="#L12086">12086</span>
<span id="L12087" rel="#L12087">12087</span>
<span id="L12088" rel="#L12088">12088</span>
<span id="L12089" rel="#L12089">12089</span>
<span id="L12090" rel="#L12090">12090</span>
<span id="L12091" rel="#L12091">12091</span>
<span id="L12092" rel="#L12092">12092</span>
<span id="L12093" rel="#L12093">12093</span>
<span id="L12094" rel="#L12094">12094</span>
<span id="L12095" rel="#L12095">12095</span>
<span id="L12096" rel="#L12096">12096</span>
<span id="L12097" rel="#L12097">12097</span>
<span id="L12098" rel="#L12098">12098</span>
<span id="L12099" rel="#L12099">12099</span>
<span id="L12100" rel="#L12100">12100</span>
<span id="L12101" rel="#L12101">12101</span>
<span id="L12102" rel="#L12102">12102</span>
<span id="L12103" rel="#L12103">12103</span>
<span id="L12104" rel="#L12104">12104</span>
<span id="L12105" rel="#L12105">12105</span>
<span id="L12106" rel="#L12106">12106</span>
<span id="L12107" rel="#L12107">12107</span>
<span id="L12108" rel="#L12108">12108</span>
<span id="L12109" rel="#L12109">12109</span>
<span id="L12110" rel="#L12110">12110</span>
<span id="L12111" rel="#L12111">12111</span>
<span id="L12112" rel="#L12112">12112</span>
<span id="L12113" rel="#L12113">12113</span>
<span id="L12114" rel="#L12114">12114</span>
<span id="L12115" rel="#L12115">12115</span>
<span id="L12116" rel="#L12116">12116</span>
<span id="L12117" rel="#L12117">12117</span>
<span id="L12118" rel="#L12118">12118</span>
<span id="L12119" rel="#L12119">12119</span>
<span id="L12120" rel="#L12120">12120</span>
<span id="L12121" rel="#L12121">12121</span>
<span id="L12122" rel="#L12122">12122</span>
<span id="L12123" rel="#L12123">12123</span>
<span id="L12124" rel="#L12124">12124</span>
<span id="L12125" rel="#L12125">12125</span>
<span id="L12126" rel="#L12126">12126</span>
<span id="L12127" rel="#L12127">12127</span>
<span id="L12128" rel="#L12128">12128</span>
<span id="L12129" rel="#L12129">12129</span>
<span id="L12130" rel="#L12130">12130</span>
<span id="L12131" rel="#L12131">12131</span>
<span id="L12132" rel="#L12132">12132</span>
<span id="L12133" rel="#L12133">12133</span>
<span id="L12134" rel="#L12134">12134</span>
<span id="L12135" rel="#L12135">12135</span>
<span id="L12136" rel="#L12136">12136</span>
<span id="L12137" rel="#L12137">12137</span>
<span id="L12138" rel="#L12138">12138</span>
<span id="L12139" rel="#L12139">12139</span>
<span id="L12140" rel="#L12140">12140</span>
<span id="L12141" rel="#L12141">12141</span>
<span id="L12142" rel="#L12142">12142</span>
<span id="L12143" rel="#L12143">12143</span>
<span id="L12144" rel="#L12144">12144</span>
<span id="L12145" rel="#L12145">12145</span>
<span id="L12146" rel="#L12146">12146</span>
<span id="L12147" rel="#L12147">12147</span>
<span id="L12148" rel="#L12148">12148</span>
<span id="L12149" rel="#L12149">12149</span>
<span id="L12150" rel="#L12150">12150</span>
<span id="L12151" rel="#L12151">12151</span>
<span id="L12152" rel="#L12152">12152</span>
<span id="L12153" rel="#L12153">12153</span>
<span id="L12154" rel="#L12154">12154</span>
<span id="L12155" rel="#L12155">12155</span>
<span id="L12156" rel="#L12156">12156</span>
<span id="L12157" rel="#L12157">12157</span>
<span id="L12158" rel="#L12158">12158</span>
<span id="L12159" rel="#L12159">12159</span>
<span id="L12160" rel="#L12160">12160</span>
<span id="L12161" rel="#L12161">12161</span>
<span id="L12162" rel="#L12162">12162</span>
<span id="L12163" rel="#L12163">12163</span>
<span id="L12164" rel="#L12164">12164</span>
<span id="L12165" rel="#L12165">12165</span>
<span id="L12166" rel="#L12166">12166</span>
<span id="L12167" rel="#L12167">12167</span>
<span id="L12168" rel="#L12168">12168</span>
<span id="L12169" rel="#L12169">12169</span>
<span id="L12170" rel="#L12170">12170</span>
<span id="L12171" rel="#L12171">12171</span>
<span id="L12172" rel="#L12172">12172</span>
<span id="L12173" rel="#L12173">12173</span>
<span id="L12174" rel="#L12174">12174</span>
<span id="L12175" rel="#L12175">12175</span>
<span id="L12176" rel="#L12176">12176</span>
<span id="L12177" rel="#L12177">12177</span>
<span id="L12178" rel="#L12178">12178</span>
<span id="L12179" rel="#L12179">12179</span>
<span id="L12180" rel="#L12180">12180</span>
<span id="L12181" rel="#L12181">12181</span>
<span id="L12182" rel="#L12182">12182</span>
<span id="L12183" rel="#L12183">12183</span>
<span id="L12184" rel="#L12184">12184</span>
<span id="L12185" rel="#L12185">12185</span>
<span id="L12186" rel="#L12186">12186</span>
<span id="L12187" rel="#L12187">12187</span>
<span id="L12188" rel="#L12188">12188</span>
<span id="L12189" rel="#L12189">12189</span>
<span id="L12190" rel="#L12190">12190</span>
<span id="L12191" rel="#L12191">12191</span>
<span id="L12192" rel="#L12192">12192</span>
<span id="L12193" rel="#L12193">12193</span>
<span id="L12194" rel="#L12194">12194</span>
<span id="L12195" rel="#L12195">12195</span>
<span id="L12196" rel="#L12196">12196</span>
<span id="L12197" rel="#L12197">12197</span>
<span id="L12198" rel="#L12198">12198</span>
<span id="L12199" rel="#L12199">12199</span>
<span id="L12200" rel="#L12200">12200</span>
<span id="L12201" rel="#L12201">12201</span>
<span id="L12202" rel="#L12202">12202</span>
<span id="L12203" rel="#L12203">12203</span>
<span id="L12204" rel="#L12204">12204</span>
<span id="L12205" rel="#L12205">12205</span>
<span id="L12206" rel="#L12206">12206</span>
<span id="L12207" rel="#L12207">12207</span>
<span id="L12208" rel="#L12208">12208</span>
<span id="L12209" rel="#L12209">12209</span>
<span id="L12210" rel="#L12210">12210</span>
<span id="L12211" rel="#L12211">12211</span>
<span id="L12212" rel="#L12212">12212</span>
<span id="L12213" rel="#L12213">12213</span>
<span id="L12214" rel="#L12214">12214</span>
<span id="L12215" rel="#L12215">12215</span>
<span id="L12216" rel="#L12216">12216</span>
<span id="L12217" rel="#L12217">12217</span>
<span id="L12218" rel="#L12218">12218</span>
<span id="L12219" rel="#L12219">12219</span>
<span id="L12220" rel="#L12220">12220</span>
<span id="L12221" rel="#L12221">12221</span>
<span id="L12222" rel="#L12222">12222</span>
<span id="L12223" rel="#L12223">12223</span>
<span id="L12224" rel="#L12224">12224</span>
<span id="L12225" rel="#L12225">12225</span>
<span id="L12226" rel="#L12226">12226</span>
<span id="L12227" rel="#L12227">12227</span>
<span id="L12228" rel="#L12228">12228</span>
<span id="L12229" rel="#L12229">12229</span>
<span id="L12230" rel="#L12230">12230</span>
<span id="L12231" rel="#L12231">12231</span>
<span id="L12232" rel="#L12232">12232</span>
<span id="L12233" rel="#L12233">12233</span>
<span id="L12234" rel="#L12234">12234</span>
<span id="L12235" rel="#L12235">12235</span>
<span id="L12236" rel="#L12236">12236</span>
<span id="L12237" rel="#L12237">12237</span>
<span id="L12238" rel="#L12238">12238</span>
<span id="L12239" rel="#L12239">12239</span>
<span id="L12240" rel="#L12240">12240</span>
<span id="L12241" rel="#L12241">12241</span>
<span id="L12242" rel="#L12242">12242</span>
<span id="L12243" rel="#L12243">12243</span>
<span id="L12244" rel="#L12244">12244</span>
<span id="L12245" rel="#L12245">12245</span>
<span id="L12246" rel="#L12246">12246</span>
<span id="L12247" rel="#L12247">12247</span>
<span id="L12248" rel="#L12248">12248</span>
<span id="L12249" rel="#L12249">12249</span>
<span id="L12250" rel="#L12250">12250</span>
<span id="L12251" rel="#L12251">12251</span>
<span id="L12252" rel="#L12252">12252</span>
<span id="L12253" rel="#L12253">12253</span>
<span id="L12254" rel="#L12254">12254</span>
<span id="L12255" rel="#L12255">12255</span>
<span id="L12256" rel="#L12256">12256</span>
<span id="L12257" rel="#L12257">12257</span>
<span id="L12258" rel="#L12258">12258</span>
<span id="L12259" rel="#L12259">12259</span>
<span id="L12260" rel="#L12260">12260</span>
<span id="L12261" rel="#L12261">12261</span>
<span id="L12262" rel="#L12262">12262</span>
<span id="L12263" rel="#L12263">12263</span>
<span id="L12264" rel="#L12264">12264</span>
<span id="L12265" rel="#L12265">12265</span>
<span id="L12266" rel="#L12266">12266</span>
<span id="L12267" rel="#L12267">12267</span>
<span id="L12268" rel="#L12268">12268</span>
<span id="L12269" rel="#L12269">12269</span>
<span id="L12270" rel="#L12270">12270</span>
<span id="L12271" rel="#L12271">12271</span>
<span id="L12272" rel="#L12272">12272</span>
<span id="L12273" rel="#L12273">12273</span>
<span id="L12274" rel="#L12274">12274</span>
<span id="L12275" rel="#L12275">12275</span>
<span id="L12276" rel="#L12276">12276</span>
<span id="L12277" rel="#L12277">12277</span>
<span id="L12278" rel="#L12278">12278</span>
<span id="L12279" rel="#L12279">12279</span>
<span id="L12280" rel="#L12280">12280</span>
<span id="L12281" rel="#L12281">12281</span>
<span id="L12282" rel="#L12282">12282</span>
<span id="L12283" rel="#L12283">12283</span>
<span id="L12284" rel="#L12284">12284</span>
<span id="L12285" rel="#L12285">12285</span>
<span id="L12286" rel="#L12286">12286</span>
<span id="L12287" rel="#L12287">12287</span>
<span id="L12288" rel="#L12288">12288</span>
<span id="L12289" rel="#L12289">12289</span>
<span id="L12290" rel="#L12290">12290</span>
<span id="L12291" rel="#L12291">12291</span>
<span id="L12292" rel="#L12292">12292</span>
<span id="L12293" rel="#L12293">12293</span>
<span id="L12294" rel="#L12294">12294</span>
<span id="L12295" rel="#L12295">12295</span>
<span id="L12296" rel="#L12296">12296</span>
<span id="L12297" rel="#L12297">12297</span>
<span id="L12298" rel="#L12298">12298</span>
<span id="L12299" rel="#L12299">12299</span>
<span id="L12300" rel="#L12300">12300</span>
<span id="L12301" rel="#L12301">12301</span>
<span id="L12302" rel="#L12302">12302</span>
<span id="L12303" rel="#L12303">12303</span>
<span id="L12304" rel="#L12304">12304</span>
<span id="L12305" rel="#L12305">12305</span>
<span id="L12306" rel="#L12306">12306</span>
<span id="L12307" rel="#L12307">12307</span>
<span id="L12308" rel="#L12308">12308</span>
<span id="L12309" rel="#L12309">12309</span>
<span id="L12310" rel="#L12310">12310</span>
<span id="L12311" rel="#L12311">12311</span>
<span id="L12312" rel="#L12312">12312</span>
<span id="L12313" rel="#L12313">12313</span>
<span id="L12314" rel="#L12314">12314</span>
<span id="L12315" rel="#L12315">12315</span>
<span id="L12316" rel="#L12316">12316</span>
<span id="L12317" rel="#L12317">12317</span>
<span id="L12318" rel="#L12318">12318</span>
<span id="L12319" rel="#L12319">12319</span>
<span id="L12320" rel="#L12320">12320</span>
<span id="L12321" rel="#L12321">12321</span>
<span id="L12322" rel="#L12322">12322</span>
<span id="L12323" rel="#L12323">12323</span>
<span id="L12324" rel="#L12324">12324</span>
<span id="L12325" rel="#L12325">12325</span>
<span id="L12326" rel="#L12326">12326</span>
<span id="L12327" rel="#L12327">12327</span>
<span id="L12328" rel="#L12328">12328</span>
<span id="L12329" rel="#L12329">12329</span>
<span id="L12330" rel="#L12330">12330</span>
<span id="L12331" rel="#L12331">12331</span>
<span id="L12332" rel="#L12332">12332</span>
<span id="L12333" rel="#L12333">12333</span>
<span id="L12334" rel="#L12334">12334</span>
<span id="L12335" rel="#L12335">12335</span>
<span id="L12336" rel="#L12336">12336</span>
<span id="L12337" rel="#L12337">12337</span>
<span id="L12338" rel="#L12338">12338</span>
<span id="L12339" rel="#L12339">12339</span>
<span id="L12340" rel="#L12340">12340</span>
<span id="L12341" rel="#L12341">12341</span>
<span id="L12342" rel="#L12342">12342</span>
<span id="L12343" rel="#L12343">12343</span>
<span id="L12344" rel="#L12344">12344</span>
<span id="L12345" rel="#L12345">12345</span>
<span id="L12346" rel="#L12346">12346</span>
<span id="L12347" rel="#L12347">12347</span>
<span id="L12348" rel="#L12348">12348</span>
<span id="L12349" rel="#L12349">12349</span>
<span id="L12350" rel="#L12350">12350</span>
<span id="L12351" rel="#L12351">12351</span>
<span id="L12352" rel="#L12352">12352</span>
<span id="L12353" rel="#L12353">12353</span>
<span id="L12354" rel="#L12354">12354</span>
<span id="L12355" rel="#L12355">12355</span>
<span id="L12356" rel="#L12356">12356</span>
<span id="L12357" rel="#L12357">12357</span>
<span id="L12358" rel="#L12358">12358</span>
<span id="L12359" rel="#L12359">12359</span>
<span id="L12360" rel="#L12360">12360</span>
<span id="L12361" rel="#L12361">12361</span>
<span id="L12362" rel="#L12362">12362</span>
<span id="L12363" rel="#L12363">12363</span>
<span id="L12364" rel="#L12364">12364</span>
<span id="L12365" rel="#L12365">12365</span>
<span id="L12366" rel="#L12366">12366</span>
<span id="L12367" rel="#L12367">12367</span>
<span id="L12368" rel="#L12368">12368</span>
<span id="L12369" rel="#L12369">12369</span>
<span id="L12370" rel="#L12370">12370</span>
<span id="L12371" rel="#L12371">12371</span>
<span id="L12372" rel="#L12372">12372</span>
<span id="L12373" rel="#L12373">12373</span>
<span id="L12374" rel="#L12374">12374</span>
<span id="L12375" rel="#L12375">12375</span>
<span id="L12376" rel="#L12376">12376</span>
<span id="L12377" rel="#L12377">12377</span>
<span id="L12378" rel="#L12378">12378</span>
<span id="L12379" rel="#L12379">12379</span>
<span id="L12380" rel="#L12380">12380</span>
<span id="L12381" rel="#L12381">12381</span>
<span id="L12382" rel="#L12382">12382</span>
<span id="L12383" rel="#L12383">12383</span>
<span id="L12384" rel="#L12384">12384</span>
<span id="L12385" rel="#L12385">12385</span>
<span id="L12386" rel="#L12386">12386</span>
<span id="L12387" rel="#L12387">12387</span>
<span id="L12388" rel="#L12388">12388</span>
<span id="L12389" rel="#L12389">12389</span>
<span id="L12390" rel="#L12390">12390</span>
<span id="L12391" rel="#L12391">12391</span>
<span id="L12392" rel="#L12392">12392</span>
<span id="L12393" rel="#L12393">12393</span>
<span id="L12394" rel="#L12394">12394</span>
<span id="L12395" rel="#L12395">12395</span>
<span id="L12396" rel="#L12396">12396</span>
<span id="L12397" rel="#L12397">12397</span>
<span id="L12398" rel="#L12398">12398</span>
<span id="L12399" rel="#L12399">12399</span>
<span id="L12400" rel="#L12400">12400</span>
<span id="L12401" rel="#L12401">12401</span>
<span id="L12402" rel="#L12402">12402</span>
<span id="L12403" rel="#L12403">12403</span>
<span id="L12404" rel="#L12404">12404</span>
<span id="L12405" rel="#L12405">12405</span>
<span id="L12406" rel="#L12406">12406</span>
<span id="L12407" rel="#L12407">12407</span>
<span id="L12408" rel="#L12408">12408</span>
<span id="L12409" rel="#L12409">12409</span>
<span id="L12410" rel="#L12410">12410</span>
<span id="L12411" rel="#L12411">12411</span>
<span id="L12412" rel="#L12412">12412</span>
<span id="L12413" rel="#L12413">12413</span>
<span id="L12414" rel="#L12414">12414</span>
<span id="L12415" rel="#L12415">12415</span>
<span id="L12416" rel="#L12416">12416</span>
<span id="L12417" rel="#L12417">12417</span>
<span id="L12418" rel="#L12418">12418</span>
<span id="L12419" rel="#L12419">12419</span>
<span id="L12420" rel="#L12420">12420</span>
<span id="L12421" rel="#L12421">12421</span>
<span id="L12422" rel="#L12422">12422</span>
<span id="L12423" rel="#L12423">12423</span>
<span id="L12424" rel="#L12424">12424</span>
<span id="L12425" rel="#L12425">12425</span>
<span id="L12426" rel="#L12426">12426</span>
<span id="L12427" rel="#L12427">12427</span>
<span id="L12428" rel="#L12428">12428</span>
<span id="L12429" rel="#L12429">12429</span>
<span id="L12430" rel="#L12430">12430</span>
<span id="L12431" rel="#L12431">12431</span>
<span id="L12432" rel="#L12432">12432</span>
<span id="L12433" rel="#L12433">12433</span>
<span id="L12434" rel="#L12434">12434</span>
<span id="L12435" rel="#L12435">12435</span>
<span id="L12436" rel="#L12436">12436</span>
<span id="L12437" rel="#L12437">12437</span>
<span id="L12438" rel="#L12438">12438</span>
<span id="L12439" rel="#L12439">12439</span>
<span id="L12440" rel="#L12440">12440</span>
<span id="L12441" rel="#L12441">12441</span>
<span id="L12442" rel="#L12442">12442</span>
<span id="L12443" rel="#L12443">12443</span>
<span id="L12444" rel="#L12444">12444</span>
<span id="L12445" rel="#L12445">12445</span>
<span id="L12446" rel="#L12446">12446</span>
<span id="L12447" rel="#L12447">12447</span>
<span id="L12448" rel="#L12448">12448</span>
<span id="L12449" rel="#L12449">12449</span>
<span id="L12450" rel="#L12450">12450</span>
<span id="L12451" rel="#L12451">12451</span>
<span id="L12452" rel="#L12452">12452</span>
<span id="L12453" rel="#L12453">12453</span>
<span id="L12454" rel="#L12454">12454</span>
<span id="L12455" rel="#L12455">12455</span>
<span id="L12456" rel="#L12456">12456</span>
<span id="L12457" rel="#L12457">12457</span>
<span id="L12458" rel="#L12458">12458</span>
<span id="L12459" rel="#L12459">12459</span>
<span id="L12460" rel="#L12460">12460</span>
<span id="L12461" rel="#L12461">12461</span>
<span id="L12462" rel="#L12462">12462</span>
<span id="L12463" rel="#L12463">12463</span>
<span id="L12464" rel="#L12464">12464</span>
<span id="L12465" rel="#L12465">12465</span>
<span id="L12466" rel="#L12466">12466</span>
<span id="L12467" rel="#L12467">12467</span>
<span id="L12468" rel="#L12468">12468</span>
<span id="L12469" rel="#L12469">12469</span>
<span id="L12470" rel="#L12470">12470</span>
<span id="L12471" rel="#L12471">12471</span>
<span id="L12472" rel="#L12472">12472</span>
<span id="L12473" rel="#L12473">12473</span>
<span id="L12474" rel="#L12474">12474</span>
<span id="L12475" rel="#L12475">12475</span>
<span id="L12476" rel="#L12476">12476</span>
<span id="L12477" rel="#L12477">12477</span>
<span id="L12478" rel="#L12478">12478</span>
<span id="L12479" rel="#L12479">12479</span>
<span id="L12480" rel="#L12480">12480</span>
<span id="L12481" rel="#L12481">12481</span>
<span id="L12482" rel="#L12482">12482</span>
<span id="L12483" rel="#L12483">12483</span>
<span id="L12484" rel="#L12484">12484</span>
<span id="L12485" rel="#L12485">12485</span>
<span id="L12486" rel="#L12486">12486</span>
<span id="L12487" rel="#L12487">12487</span>
<span id="L12488" rel="#L12488">12488</span>
<span id="L12489" rel="#L12489">12489</span>
<span id="L12490" rel="#L12490">12490</span>
<span id="L12491" rel="#L12491">12491</span>
<span id="L12492" rel="#L12492">12492</span>
<span id="L12493" rel="#L12493">12493</span>
<span id="L12494" rel="#L12494">12494</span>
<span id="L12495" rel="#L12495">12495</span>
<span id="L12496" rel="#L12496">12496</span>
<span id="L12497" rel="#L12497">12497</span>
<span id="L12498" rel="#L12498">12498</span>
<span id="L12499" rel="#L12499">12499</span>
<span id="L12500" rel="#L12500">12500</span>
<span id="L12501" rel="#L12501">12501</span>
<span id="L12502" rel="#L12502">12502</span>
<span id="L12503" rel="#L12503">12503</span>
<span id="L12504" rel="#L12504">12504</span>
<span id="L12505" rel="#L12505">12505</span>
<span id="L12506" rel="#L12506">12506</span>
<span id="L12507" rel="#L12507">12507</span>
<span id="L12508" rel="#L12508">12508</span>
<span id="L12509" rel="#L12509">12509</span>
<span id="L12510" rel="#L12510">12510</span>
<span id="L12511" rel="#L12511">12511</span>
<span id="L12512" rel="#L12512">12512</span>
<span id="L12513" rel="#L12513">12513</span>
<span id="L12514" rel="#L12514">12514</span>
<span id="L12515" rel="#L12515">12515</span>
<span id="L12516" rel="#L12516">12516</span>
<span id="L12517" rel="#L12517">12517</span>
<span id="L12518" rel="#L12518">12518</span>
<span id="L12519" rel="#L12519">12519</span>
<span id="L12520" rel="#L12520">12520</span>
<span id="L12521" rel="#L12521">12521</span>
<span id="L12522" rel="#L12522">12522</span>
<span id="L12523" rel="#L12523">12523</span>
<span id="L12524" rel="#L12524">12524</span>
<span id="L12525" rel="#L12525">12525</span>
<span id="L12526" rel="#L12526">12526</span>
<span id="L12527" rel="#L12527">12527</span>
<span id="L12528" rel="#L12528">12528</span>
<span id="L12529" rel="#L12529">12529</span>
<span id="L12530" rel="#L12530">12530</span>
<span id="L12531" rel="#L12531">12531</span>
<span id="L12532" rel="#L12532">12532</span>
<span id="L12533" rel="#L12533">12533</span>
<span id="L12534" rel="#L12534">12534</span>
<span id="L12535" rel="#L12535">12535</span>
<span id="L12536" rel="#L12536">12536</span>
<span id="L12537" rel="#L12537">12537</span>
<span id="L12538" rel="#L12538">12538</span>
<span id="L12539" rel="#L12539">12539</span>
<span id="L12540" rel="#L12540">12540</span>
<span id="L12541" rel="#L12541">12541</span>
<span id="L12542" rel="#L12542">12542</span>
<span id="L12543" rel="#L12543">12543</span>
<span id="L12544" rel="#L12544">12544</span>
<span id="L12545" rel="#L12545">12545</span>
<span id="L12546" rel="#L12546">12546</span>
<span id="L12547" rel="#L12547">12547</span>
<span id="L12548" rel="#L12548">12548</span>
<span id="L12549" rel="#L12549">12549</span>
<span id="L12550" rel="#L12550">12550</span>
<span id="L12551" rel="#L12551">12551</span>
<span id="L12552" rel="#L12552">12552</span>
<span id="L12553" rel="#L12553">12553</span>
<span id="L12554" rel="#L12554">12554</span>
<span id="L12555" rel="#L12555">12555</span>
<span id="L12556" rel="#L12556">12556</span>
<span id="L12557" rel="#L12557">12557</span>
<span id="L12558" rel="#L12558">12558</span>
<span id="L12559" rel="#L12559">12559</span>
<span id="L12560" rel="#L12560">12560</span>
<span id="L12561" rel="#L12561">12561</span>
<span id="L12562" rel="#L12562">12562</span>
<span id="L12563" rel="#L12563">12563</span>
<span id="L12564" rel="#L12564">12564</span>
<span id="L12565" rel="#L12565">12565</span>
<span id="L12566" rel="#L12566">12566</span>
<span id="L12567" rel="#L12567">12567</span>
<span id="L12568" rel="#L12568">12568</span>
<span id="L12569" rel="#L12569">12569</span>
<span id="L12570" rel="#L12570">12570</span>
<span id="L12571" rel="#L12571">12571</span>
<span id="L12572" rel="#L12572">12572</span>
<span id="L12573" rel="#L12573">12573</span>
<span id="L12574" rel="#L12574">12574</span>
<span id="L12575" rel="#L12575">12575</span>
<span id="L12576" rel="#L12576">12576</span>
<span id="L12577" rel="#L12577">12577</span>
<span id="L12578" rel="#L12578">12578</span>
<span id="L12579" rel="#L12579">12579</span>
<span id="L12580" rel="#L12580">12580</span>
<span id="L12581" rel="#L12581">12581</span>
<span id="L12582" rel="#L12582">12582</span>
<span id="L12583" rel="#L12583">12583</span>
<span id="L12584" rel="#L12584">12584</span>
<span id="L12585" rel="#L12585">12585</span>
<span id="L12586" rel="#L12586">12586</span>
<span id="L12587" rel="#L12587">12587</span>
<span id="L12588" rel="#L12588">12588</span>
<span id="L12589" rel="#L12589">12589</span>
<span id="L12590" rel="#L12590">12590</span>
<span id="L12591" rel="#L12591">12591</span>
<span id="L12592" rel="#L12592">12592</span>
<span id="L12593" rel="#L12593">12593</span>
<span id="L12594" rel="#L12594">12594</span>
<span id="L12595" rel="#L12595">12595</span>
<span id="L12596" rel="#L12596">12596</span>
<span id="L12597" rel="#L12597">12597</span>
<span id="L12598" rel="#L12598">12598</span>
<span id="L12599" rel="#L12599">12599</span>
<span id="L12600" rel="#L12600">12600</span>
<span id="L12601" rel="#L12601">12601</span>
<span id="L12602" rel="#L12602">12602</span>
<span id="L12603" rel="#L12603">12603</span>
<span id="L12604" rel="#L12604">12604</span>
<span id="L12605" rel="#L12605">12605</span>
<span id="L12606" rel="#L12606">12606</span>
<span id="L12607" rel="#L12607">12607</span>
<span id="L12608" rel="#L12608">12608</span>
<span id="L12609" rel="#L12609">12609</span>
<span id="L12610" rel="#L12610">12610</span>
<span id="L12611" rel="#L12611">12611</span>
<span id="L12612" rel="#L12612">12612</span>
<span id="L12613" rel="#L12613">12613</span>
<span id="L12614" rel="#L12614">12614</span>
<span id="L12615" rel="#L12615">12615</span>
<span id="L12616" rel="#L12616">12616</span>
<span id="L12617" rel="#L12617">12617</span>
<span id="L12618" rel="#L12618">12618</span>
<span id="L12619" rel="#L12619">12619</span>
<span id="L12620" rel="#L12620">12620</span>
<span id="L12621" rel="#L12621">12621</span>
<span id="L12622" rel="#L12622">12622</span>
<span id="L12623" rel="#L12623">12623</span>
<span id="L12624" rel="#L12624">12624</span>
<span id="L12625" rel="#L12625">12625</span>
<span id="L12626" rel="#L12626">12626</span>
<span id="L12627" rel="#L12627">12627</span>
<span id="L12628" rel="#L12628">12628</span>
<span id="L12629" rel="#L12629">12629</span>
<span id="L12630" rel="#L12630">12630</span>
<span id="L12631" rel="#L12631">12631</span>
<span id="L12632" rel="#L12632">12632</span>
<span id="L12633" rel="#L12633">12633</span>
<span id="L12634" rel="#L12634">12634</span>
<span id="L12635" rel="#L12635">12635</span>
<span id="L12636" rel="#L12636">12636</span>
<span id="L12637" rel="#L12637">12637</span>
<span id="L12638" rel="#L12638">12638</span>
<span id="L12639" rel="#L12639">12639</span>
<span id="L12640" rel="#L12640">12640</span>
<span id="L12641" rel="#L12641">12641</span>
<span id="L12642" rel="#L12642">12642</span>
<span id="L12643" rel="#L12643">12643</span>
<span id="L12644" rel="#L12644">12644</span>
<span id="L12645" rel="#L12645">12645</span>
<span id="L12646" rel="#L12646">12646</span>
<span id="L12647" rel="#L12647">12647</span>
<span id="L12648" rel="#L12648">12648</span>
<span id="L12649" rel="#L12649">12649</span>
<span id="L12650" rel="#L12650">12650</span>
<span id="L12651" rel="#L12651">12651</span>
<span id="L12652" rel="#L12652">12652</span>
<span id="L12653" rel="#L12653">12653</span>
<span id="L12654" rel="#L12654">12654</span>
<span id="L12655" rel="#L12655">12655</span>
<span id="L12656" rel="#L12656">12656</span>
<span id="L12657" rel="#L12657">12657</span>
<span id="L12658" rel="#L12658">12658</span>
<span id="L12659" rel="#L12659">12659</span>
<span id="L12660" rel="#L12660">12660</span>
<span id="L12661" rel="#L12661">12661</span>
<span id="L12662" rel="#L12662">12662</span>
<span id="L12663" rel="#L12663">12663</span>
<span id="L12664" rel="#L12664">12664</span>
<span id="L12665" rel="#L12665">12665</span>
<span id="L12666" rel="#L12666">12666</span>
<span id="L12667" rel="#L12667">12667</span>
<span id="L12668" rel="#L12668">12668</span>
<span id="L12669" rel="#L12669">12669</span>
<span id="L12670" rel="#L12670">12670</span>
<span id="L12671" rel="#L12671">12671</span>
<span id="L12672" rel="#L12672">12672</span>
<span id="L12673" rel="#L12673">12673</span>
<span id="L12674" rel="#L12674">12674</span>
<span id="L12675" rel="#L12675">12675</span>
<span id="L12676" rel="#L12676">12676</span>
<span id="L12677" rel="#L12677">12677</span>
<span id="L12678" rel="#L12678">12678</span>
<span id="L12679" rel="#L12679">12679</span>
<span id="L12680" rel="#L12680">12680</span>
<span id="L12681" rel="#L12681">12681</span>
<span id="L12682" rel="#L12682">12682</span>
<span id="L12683" rel="#L12683">12683</span>
<span id="L12684" rel="#L12684">12684</span>
<span id="L12685" rel="#L12685">12685</span>
<span id="L12686" rel="#L12686">12686</span>
<span id="L12687" rel="#L12687">12687</span>
<span id="L12688" rel="#L12688">12688</span>
<span id="L12689" rel="#L12689">12689</span>
<span id="L12690" rel="#L12690">12690</span>
<span id="L12691" rel="#L12691">12691</span>
<span id="L12692" rel="#L12692">12692</span>
<span id="L12693" rel="#L12693">12693</span>
<span id="L12694" rel="#L12694">12694</span>
<span id="L12695" rel="#L12695">12695</span>
<span id="L12696" rel="#L12696">12696</span>
<span id="L12697" rel="#L12697">12697</span>
<span id="L12698" rel="#L12698">12698</span>
<span id="L12699" rel="#L12699">12699</span>
<span id="L12700" rel="#L12700">12700</span>
<span id="L12701" rel="#L12701">12701</span>
<span id="L12702" rel="#L12702">12702</span>
<span id="L12703" rel="#L12703">12703</span>
<span id="L12704" rel="#L12704">12704</span>
<span id="L12705" rel="#L12705">12705</span>
<span id="L12706" rel="#L12706">12706</span>
<span id="L12707" rel="#L12707">12707</span>
<span id="L12708" rel="#L12708">12708</span>
<span id="L12709" rel="#L12709">12709</span>
<span id="L12710" rel="#L12710">12710</span>
<span id="L12711" rel="#L12711">12711</span>
<span id="L12712" rel="#L12712">12712</span>
<span id="L12713" rel="#L12713">12713</span>
<span id="L12714" rel="#L12714">12714</span>
<span id="L12715" rel="#L12715">12715</span>
<span id="L12716" rel="#L12716">12716</span>
<span id="L12717" rel="#L12717">12717</span>
<span id="L12718" rel="#L12718">12718</span>
<span id="L12719" rel="#L12719">12719</span>
<span id="L12720" rel="#L12720">12720</span>
<span id="L12721" rel="#L12721">12721</span>
<span id="L12722" rel="#L12722">12722</span>
<span id="L12723" rel="#L12723">12723</span>
<span id="L12724" rel="#L12724">12724</span>
<span id="L12725" rel="#L12725">12725</span>
<span id="L12726" rel="#L12726">12726</span>
<span id="L12727" rel="#L12727">12727</span>
<span id="L12728" rel="#L12728">12728</span>
<span id="L12729" rel="#L12729">12729</span>
<span id="L12730" rel="#L12730">12730</span>
<span id="L12731" rel="#L12731">12731</span>
<span id="L12732" rel="#L12732">12732</span>
<span id="L12733" rel="#L12733">12733</span>
<span id="L12734" rel="#L12734">12734</span>
<span id="L12735" rel="#L12735">12735</span>
<span id="L12736" rel="#L12736">12736</span>
<span id="L12737" rel="#L12737">12737</span>
<span id="L12738" rel="#L12738">12738</span>
<span id="L12739" rel="#L12739">12739</span>
<span id="L12740" rel="#L12740">12740</span>
<span id="L12741" rel="#L12741">12741</span>
<span id="L12742" rel="#L12742">12742</span>
<span id="L12743" rel="#L12743">12743</span>
<span id="L12744" rel="#L12744">12744</span>
<span id="L12745" rel="#L12745">12745</span>
<span id="L12746" rel="#L12746">12746</span>
<span id="L12747" rel="#L12747">12747</span>
<span id="L12748" rel="#L12748">12748</span>
<span id="L12749" rel="#L12749">12749</span>
<span id="L12750" rel="#L12750">12750</span>
<span id="L12751" rel="#L12751">12751</span>
<span id="L12752" rel="#L12752">12752</span>
<span id="L12753" rel="#L12753">12753</span>
<span id="L12754" rel="#L12754">12754</span>
<span id="L12755" rel="#L12755">12755</span>
<span id="L12756" rel="#L12756">12756</span>
<span id="L12757" rel="#L12757">12757</span>
<span id="L12758" rel="#L12758">12758</span>
<span id="L12759" rel="#L12759">12759</span>
<span id="L12760" rel="#L12760">12760</span>
<span id="L12761" rel="#L12761">12761</span>
<span id="L12762" rel="#L12762">12762</span>
<span id="L12763" rel="#L12763">12763</span>
<span id="L12764" rel="#L12764">12764</span>
<span id="L12765" rel="#L12765">12765</span>
<span id="L12766" rel="#L12766">12766</span>
<span id="L12767" rel="#L12767">12767</span>
<span id="L12768" rel="#L12768">12768</span>
<span id="L12769" rel="#L12769">12769</span>
<span id="L12770" rel="#L12770">12770</span>
<span id="L12771" rel="#L12771">12771</span>
<span id="L12772" rel="#L12772">12772</span>
<span id="L12773" rel="#L12773">12773</span>
<span id="L12774" rel="#L12774">12774</span>
<span id="L12775" rel="#L12775">12775</span>
<span id="L12776" rel="#L12776">12776</span>
<span id="L12777" rel="#L12777">12777</span>
<span id="L12778" rel="#L12778">12778</span>
<span id="L12779" rel="#L12779">12779</span>
<span id="L12780" rel="#L12780">12780</span>
<span id="L12781" rel="#L12781">12781</span>
<span id="L12782" rel="#L12782">12782</span>
<span id="L12783" rel="#L12783">12783</span>
<span id="L12784" rel="#L12784">12784</span>
<span id="L12785" rel="#L12785">12785</span>
<span id="L12786" rel="#L12786">12786</span>
<span id="L12787" rel="#L12787">12787</span>
<span id="L12788" rel="#L12788">12788</span>
<span id="L12789" rel="#L12789">12789</span>
<span id="L12790" rel="#L12790">12790</span>
<span id="L12791" rel="#L12791">12791</span>
<span id="L12792" rel="#L12792">12792</span>
<span id="L12793" rel="#L12793">12793</span>
<span id="L12794" rel="#L12794">12794</span>
<span id="L12795" rel="#L12795">12795</span>
<span id="L12796" rel="#L12796">12796</span>
<span id="L12797" rel="#L12797">12797</span>
<span id="L12798" rel="#L12798">12798</span>
<span id="L12799" rel="#L12799">12799</span>
<span id="L12800" rel="#L12800">12800</span>
<span id="L12801" rel="#L12801">12801</span>
<span id="L12802" rel="#L12802">12802</span>
<span id="L12803" rel="#L12803">12803</span>
<span id="L12804" rel="#L12804">12804</span>
<span id="L12805" rel="#L12805">12805</span>
<span id="L12806" rel="#L12806">12806</span>
<span id="L12807" rel="#L12807">12807</span>
<span id="L12808" rel="#L12808">12808</span>
<span id="L12809" rel="#L12809">12809</span>
<span id="L12810" rel="#L12810">12810</span>
<span id="L12811" rel="#L12811">12811</span>
<span id="L12812" rel="#L12812">12812</span>
<span id="L12813" rel="#L12813">12813</span>
<span id="L12814" rel="#L12814">12814</span>
<span id="L12815" rel="#L12815">12815</span>
<span id="L12816" rel="#L12816">12816</span>
<span id="L12817" rel="#L12817">12817</span>
<span id="L12818" rel="#L12818">12818</span>
<span id="L12819" rel="#L12819">12819</span>
<span id="L12820" rel="#L12820">12820</span>
<span id="L12821" rel="#L12821">12821</span>
<span id="L12822" rel="#L12822">12822</span>
<span id="L12823" rel="#L12823">12823</span>
<span id="L12824" rel="#L12824">12824</span>
<span id="L12825" rel="#L12825">12825</span>
<span id="L12826" rel="#L12826">12826</span>
<span id="L12827" rel="#L12827">12827</span>
<span id="L12828" rel="#L12828">12828</span>
<span id="L12829" rel="#L12829">12829</span>
<span id="L12830" rel="#L12830">12830</span>
<span id="L12831" rel="#L12831">12831</span>
<span id="L12832" rel="#L12832">12832</span>
<span id="L12833" rel="#L12833">12833</span>
<span id="L12834" rel="#L12834">12834</span>
<span id="L12835" rel="#L12835">12835</span>
<span id="L12836" rel="#L12836">12836</span>
<span id="L12837" rel="#L12837">12837</span>
<span id="L12838" rel="#L12838">12838</span>
<span id="L12839" rel="#L12839">12839</span>
<span id="L12840" rel="#L12840">12840</span>
<span id="L12841" rel="#L12841">12841</span>
<span id="L12842" rel="#L12842">12842</span>
<span id="L12843" rel="#L12843">12843</span>
<span id="L12844" rel="#L12844">12844</span>
<span id="L12845" rel="#L12845">12845</span>
<span id="L12846" rel="#L12846">12846</span>
<span id="L12847" rel="#L12847">12847</span>
<span id="L12848" rel="#L12848">12848</span>
<span id="L12849" rel="#L12849">12849</span>
<span id="L12850" rel="#L12850">12850</span>
<span id="L12851" rel="#L12851">12851</span>
<span id="L12852" rel="#L12852">12852</span>
<span id="L12853" rel="#L12853">12853</span>
<span id="L12854" rel="#L12854">12854</span>
<span id="L12855" rel="#L12855">12855</span>
<span id="L12856" rel="#L12856">12856</span>
<span id="L12857" rel="#L12857">12857</span>
<span id="L12858" rel="#L12858">12858</span>
<span id="L12859" rel="#L12859">12859</span>
<span id="L12860" rel="#L12860">12860</span>
<span id="L12861" rel="#L12861">12861</span>
<span id="L12862" rel="#L12862">12862</span>
<span id="L12863" rel="#L12863">12863</span>
<span id="L12864" rel="#L12864">12864</span>
<span id="L12865" rel="#L12865">12865</span>
<span id="L12866" rel="#L12866">12866</span>
<span id="L12867" rel="#L12867">12867</span>
<span id="L12868" rel="#L12868">12868</span>
<span id="L12869" rel="#L12869">12869</span>
<span id="L12870" rel="#L12870">12870</span>
<span id="L12871" rel="#L12871">12871</span>
<span id="L12872" rel="#L12872">12872</span>
<span id="L12873" rel="#L12873">12873</span>
<span id="L12874" rel="#L12874">12874</span>
<span id="L12875" rel="#L12875">12875</span>
<span id="L12876" rel="#L12876">12876</span>
<span id="L12877" rel="#L12877">12877</span>
<span id="L12878" rel="#L12878">12878</span>
<span id="L12879" rel="#L12879">12879</span>
<span id="L12880" rel="#L12880">12880</span>
<span id="L12881" rel="#L12881">12881</span>
<span id="L12882" rel="#L12882">12882</span>
<span id="L12883" rel="#L12883">12883</span>
<span id="L12884" rel="#L12884">12884</span>
<span id="L12885" rel="#L12885">12885</span>
<span id="L12886" rel="#L12886">12886</span>
<span id="L12887" rel="#L12887">12887</span>
<span id="L12888" rel="#L12888">12888</span>
<span id="L12889" rel="#L12889">12889</span>
<span id="L12890" rel="#L12890">12890</span>
<span id="L12891" rel="#L12891">12891</span>
<span id="L12892" rel="#L12892">12892</span>
<span id="L12893" rel="#L12893">12893</span>
<span id="L12894" rel="#L12894">12894</span>
<span id="L12895" rel="#L12895">12895</span>
<span id="L12896" rel="#L12896">12896</span>
<span id="L12897" rel="#L12897">12897</span>
<span id="L12898" rel="#L12898">12898</span>
<span id="L12899" rel="#L12899">12899</span>
<span id="L12900" rel="#L12900">12900</span>
<span id="L12901" rel="#L12901">12901</span>
<span id="L12902" rel="#L12902">12902</span>
<span id="L12903" rel="#L12903">12903</span>
<span id="L12904" rel="#L12904">12904</span>
<span id="L12905" rel="#L12905">12905</span>
<span id="L12906" rel="#L12906">12906</span>
<span id="L12907" rel="#L12907">12907</span>
<span id="L12908" rel="#L12908">12908</span>
<span id="L12909" rel="#L12909">12909</span>
<span id="L12910" rel="#L12910">12910</span>
<span id="L12911" rel="#L12911">12911</span>
<span id="L12912" rel="#L12912">12912</span>
<span id="L12913" rel="#L12913">12913</span>
<span id="L12914" rel="#L12914">12914</span>
<span id="L12915" rel="#L12915">12915</span>
<span id="L12916" rel="#L12916">12916</span>
<span id="L12917" rel="#L12917">12917</span>
<span id="L12918" rel="#L12918">12918</span>
<span id="L12919" rel="#L12919">12919</span>
<span id="L12920" rel="#L12920">12920</span>
<span id="L12921" rel="#L12921">12921</span>
<span id="L12922" rel="#L12922">12922</span>
<span id="L12923" rel="#L12923">12923</span>
<span id="L12924" rel="#L12924">12924</span>
<span id="L12925" rel="#L12925">12925</span>
<span id="L12926" rel="#L12926">12926</span>
<span id="L12927" rel="#L12927">12927</span>
<span id="L12928" rel="#L12928">12928</span>
<span id="L12929" rel="#L12929">12929</span>
<span id="L12930" rel="#L12930">12930</span>
<span id="L12931" rel="#L12931">12931</span>
<span id="L12932" rel="#L12932">12932</span>
<span id="L12933" rel="#L12933">12933</span>
<span id="L12934" rel="#L12934">12934</span>
<span id="L12935" rel="#L12935">12935</span>
<span id="L12936" rel="#L12936">12936</span>
<span id="L12937" rel="#L12937">12937</span>
<span id="L12938" rel="#L12938">12938</span>
<span id="L12939" rel="#L12939">12939</span>
<span id="L12940" rel="#L12940">12940</span>
<span id="L12941" rel="#L12941">12941</span>
<span id="L12942" rel="#L12942">12942</span>
<span id="L12943" rel="#L12943">12943</span>
<span id="L12944" rel="#L12944">12944</span>
<span id="L12945" rel="#L12945">12945</span>
<span id="L12946" rel="#L12946">12946</span>
<span id="L12947" rel="#L12947">12947</span>
<span id="L12948" rel="#L12948">12948</span>
<span id="L12949" rel="#L12949">12949</span>
<span id="L12950" rel="#L12950">12950</span>
<span id="L12951" rel="#L12951">12951</span>
<span id="L12952" rel="#L12952">12952</span>
<span id="L12953" rel="#L12953">12953</span>
<span id="L12954" rel="#L12954">12954</span>
<span id="L12955" rel="#L12955">12955</span>
<span id="L12956" rel="#L12956">12956</span>
<span id="L12957" rel="#L12957">12957</span>
<span id="L12958" rel="#L12958">12958</span>
<span id="L12959" rel="#L12959">12959</span>
<span id="L12960" rel="#L12960">12960</span>
<span id="L12961" rel="#L12961">12961</span>
<span id="L12962" rel="#L12962">12962</span>
<span id="L12963" rel="#L12963">12963</span>
<span id="L12964" rel="#L12964">12964</span>
<span id="L12965" rel="#L12965">12965</span>
<span id="L12966" rel="#L12966">12966</span>
<span id="L12967" rel="#L12967">12967</span>
<span id="L12968" rel="#L12968">12968</span>
<span id="L12969" rel="#L12969">12969</span>
<span id="L12970" rel="#L12970">12970</span>
<span id="L12971" rel="#L12971">12971</span>
<span id="L12972" rel="#L12972">12972</span>
<span id="L12973" rel="#L12973">12973</span>
<span id="L12974" rel="#L12974">12974</span>
<span id="L12975" rel="#L12975">12975</span>
<span id="L12976" rel="#L12976">12976</span>
<span id="L12977" rel="#L12977">12977</span>
<span id="L12978" rel="#L12978">12978</span>
<span id="L12979" rel="#L12979">12979</span>
<span id="L12980" rel="#L12980">12980</span>
<span id="L12981" rel="#L12981">12981</span>
<span id="L12982" rel="#L12982">12982</span>
<span id="L12983" rel="#L12983">12983</span>
<span id="L12984" rel="#L12984">12984</span>
<span id="L12985" rel="#L12985">12985</span>
<span id="L12986" rel="#L12986">12986</span>
<span id="L12987" rel="#L12987">12987</span>
<span id="L12988" rel="#L12988">12988</span>
<span id="L12989" rel="#L12989">12989</span>
<span id="L12990" rel="#L12990">12990</span>
<span id="L12991" rel="#L12991">12991</span>
<span id="L12992" rel="#L12992">12992</span>
<span id="L12993" rel="#L12993">12993</span>
<span id="L12994" rel="#L12994">12994</span>
<span id="L12995" rel="#L12995">12995</span>
<span id="L12996" rel="#L12996">12996</span>
<span id="L12997" rel="#L12997">12997</span>
<span id="L12998" rel="#L12998">12998</span>
<span id="L12999" rel="#L12999">12999</span>
<span id="L13000" rel="#L13000">13000</span>
<span id="L13001" rel="#L13001">13001</span>
<span id="L13002" rel="#L13002">13002</span>
<span id="L13003" rel="#L13003">13003</span>
<span id="L13004" rel="#L13004">13004</span>
<span id="L13005" rel="#L13005">13005</span>
<span id="L13006" rel="#L13006">13006</span>
<span id="L13007" rel="#L13007">13007</span>
<span id="L13008" rel="#L13008">13008</span>
<span id="L13009" rel="#L13009">13009</span>
<span id="L13010" rel="#L13010">13010</span>
<span id="L13011" rel="#L13011">13011</span>
<span id="L13012" rel="#L13012">13012</span>
<span id="L13013" rel="#L13013">13013</span>
<span id="L13014" rel="#L13014">13014</span>
<span id="L13015" rel="#L13015">13015</span>
<span id="L13016" rel="#L13016">13016</span>
<span id="L13017" rel="#L13017">13017</span>
<span id="L13018" rel="#L13018">13018</span>
<span id="L13019" rel="#L13019">13019</span>
<span id="L13020" rel="#L13020">13020</span>
<span id="L13021" rel="#L13021">13021</span>
<span id="L13022" rel="#L13022">13022</span>
<span id="L13023" rel="#L13023">13023</span>
<span id="L13024" rel="#L13024">13024</span>
<span id="L13025" rel="#L13025">13025</span>
<span id="L13026" rel="#L13026">13026</span>
<span id="L13027" rel="#L13027">13027</span>
<span id="L13028" rel="#L13028">13028</span>
<span id="L13029" rel="#L13029">13029</span>
<span id="L13030" rel="#L13030">13030</span>
<span id="L13031" rel="#L13031">13031</span>
<span id="L13032" rel="#L13032">13032</span>
<span id="L13033" rel="#L13033">13033</span>
<span id="L13034" rel="#L13034">13034</span>
<span id="L13035" rel="#L13035">13035</span>
<span id="L13036" rel="#L13036">13036</span>
<span id="L13037" rel="#L13037">13037</span>
<span id="L13038" rel="#L13038">13038</span>
<span id="L13039" rel="#L13039">13039</span>
<span id="L13040" rel="#L13040">13040</span>
<span id="L13041" rel="#L13041">13041</span>
<span id="L13042" rel="#L13042">13042</span>
<span id="L13043" rel="#L13043">13043</span>
<span id="L13044" rel="#L13044">13044</span>
<span id="L13045" rel="#L13045">13045</span>
<span id="L13046" rel="#L13046">13046</span>
<span id="L13047" rel="#L13047">13047</span>
<span id="L13048" rel="#L13048">13048</span>
<span id="L13049" rel="#L13049">13049</span>
<span id="L13050" rel="#L13050">13050</span>
<span id="L13051" rel="#L13051">13051</span>
<span id="L13052" rel="#L13052">13052</span>
<span id="L13053" rel="#L13053">13053</span>
<span id="L13054" rel="#L13054">13054</span>
<span id="L13055" rel="#L13055">13055</span>
<span id="L13056" rel="#L13056">13056</span>
<span id="L13057" rel="#L13057">13057</span>
<span id="L13058" rel="#L13058">13058</span>
<span id="L13059" rel="#L13059">13059</span>
<span id="L13060" rel="#L13060">13060</span>
<span id="L13061" rel="#L13061">13061</span>
<span id="L13062" rel="#L13062">13062</span>
<span id="L13063" rel="#L13063">13063</span>
<span id="L13064" rel="#L13064">13064</span>
<span id="L13065" rel="#L13065">13065</span>
<span id="L13066" rel="#L13066">13066</span>
<span id="L13067" rel="#L13067">13067</span>
<span id="L13068" rel="#L13068">13068</span>
<span id="L13069" rel="#L13069">13069</span>
<span id="L13070" rel="#L13070">13070</span>
<span id="L13071" rel="#L13071">13071</span>
<span id="L13072" rel="#L13072">13072</span>
<span id="L13073" rel="#L13073">13073</span>
<span id="L13074" rel="#L13074">13074</span>
<span id="L13075" rel="#L13075">13075</span>
<span id="L13076" rel="#L13076">13076</span>
<span id="L13077" rel="#L13077">13077</span>
<span id="L13078" rel="#L13078">13078</span>
<span id="L13079" rel="#L13079">13079</span>
<span id="L13080" rel="#L13080">13080</span>
<span id="L13081" rel="#L13081">13081</span>
<span id="L13082" rel="#L13082">13082</span>
<span id="L13083" rel="#L13083">13083</span>
<span id="L13084" rel="#L13084">13084</span>
<span id="L13085" rel="#L13085">13085</span>
<span id="L13086" rel="#L13086">13086</span>
<span id="L13087" rel="#L13087">13087</span>
<span id="L13088" rel="#L13088">13088</span>
<span id="L13089" rel="#L13089">13089</span>
<span id="L13090" rel="#L13090">13090</span>
<span id="L13091" rel="#L13091">13091</span>
<span id="L13092" rel="#L13092">13092</span>
<span id="L13093" rel="#L13093">13093</span>
<span id="L13094" rel="#L13094">13094</span>
<span id="L13095" rel="#L13095">13095</span>
<span id="L13096" rel="#L13096">13096</span>
<span id="L13097" rel="#L13097">13097</span>
<span id="L13098" rel="#L13098">13098</span>
<span id="L13099" rel="#L13099">13099</span>
<span id="L13100" rel="#L13100">13100</span>
<span id="L13101" rel="#L13101">13101</span>
<span id="L13102" rel="#L13102">13102</span>
<span id="L13103" rel="#L13103">13103</span>
<span id="L13104" rel="#L13104">13104</span>
<span id="L13105" rel="#L13105">13105</span>
<span id="L13106" rel="#L13106">13106</span>
<span id="L13107" rel="#L13107">13107</span>
<span id="L13108" rel="#L13108">13108</span>
<span id="L13109" rel="#L13109">13109</span>
<span id="L13110" rel="#L13110">13110</span>
<span id="L13111" rel="#L13111">13111</span>
<span id="L13112" rel="#L13112">13112</span>
<span id="L13113" rel="#L13113">13113</span>
<span id="L13114" rel="#L13114">13114</span>
<span id="L13115" rel="#L13115">13115</span>
<span id="L13116" rel="#L13116">13116</span>
<span id="L13117" rel="#L13117">13117</span>
<span id="L13118" rel="#L13118">13118</span>
<span id="L13119" rel="#L13119">13119</span>
<span id="L13120" rel="#L13120">13120</span>
<span id="L13121" rel="#L13121">13121</span>
<span id="L13122" rel="#L13122">13122</span>
<span id="L13123" rel="#L13123">13123</span>
<span id="L13124" rel="#L13124">13124</span>
<span id="L13125" rel="#L13125">13125</span>
<span id="L13126" rel="#L13126">13126</span>
<span id="L13127" rel="#L13127">13127</span>
<span id="L13128" rel="#L13128">13128</span>
<span id="L13129" rel="#L13129">13129</span>
<span id="L13130" rel="#L13130">13130</span>
<span id="L13131" rel="#L13131">13131</span>
<span id="L13132" rel="#L13132">13132</span>
<span id="L13133" rel="#L13133">13133</span>
<span id="L13134" rel="#L13134">13134</span>
<span id="L13135" rel="#L13135">13135</span>
<span id="L13136" rel="#L13136">13136</span>
<span id="L13137" rel="#L13137">13137</span>
<span id="L13138" rel="#L13138">13138</span>
<span id="L13139" rel="#L13139">13139</span>
<span id="L13140" rel="#L13140">13140</span>
<span id="L13141" rel="#L13141">13141</span>
<span id="L13142" rel="#L13142">13142</span>
<span id="L13143" rel="#L13143">13143</span>
<span id="L13144" rel="#L13144">13144</span>
<span id="L13145" rel="#L13145">13145</span>
<span id="L13146" rel="#L13146">13146</span>
<span id="L13147" rel="#L13147">13147</span>
<span id="L13148" rel="#L13148">13148</span>
<span id="L13149" rel="#L13149">13149</span>
<span id="L13150" rel="#L13150">13150</span>
<span id="L13151" rel="#L13151">13151</span>
<span id="L13152" rel="#L13152">13152</span>
<span id="L13153" rel="#L13153">13153</span>
<span id="L13154" rel="#L13154">13154</span>
<span id="L13155" rel="#L13155">13155</span>
<span id="L13156" rel="#L13156">13156</span>
<span id="L13157" rel="#L13157">13157</span>
<span id="L13158" rel="#L13158">13158</span>
<span id="L13159" rel="#L13159">13159</span>
<span id="L13160" rel="#L13160">13160</span>
<span id="L13161" rel="#L13161">13161</span>
<span id="L13162" rel="#L13162">13162</span>
<span id="L13163" rel="#L13163">13163</span>
<span id="L13164" rel="#L13164">13164</span>
<span id="L13165" rel="#L13165">13165</span>
<span id="L13166" rel="#L13166">13166</span>
<span id="L13167" rel="#L13167">13167</span>
<span id="L13168" rel="#L13168">13168</span>
<span id="L13169" rel="#L13169">13169</span>
<span id="L13170" rel="#L13170">13170</span>
<span id="L13171" rel="#L13171">13171</span>
<span id="L13172" rel="#L13172">13172</span>
<span id="L13173" rel="#L13173">13173</span>
<span id="L13174" rel="#L13174">13174</span>
<span id="L13175" rel="#L13175">13175</span>
<span id="L13176" rel="#L13176">13176</span>
<span id="L13177" rel="#L13177">13177</span>
<span id="L13178" rel="#L13178">13178</span>
<span id="L13179" rel="#L13179">13179</span>
<span id="L13180" rel="#L13180">13180</span>
<span id="L13181" rel="#L13181">13181</span>
<span id="L13182" rel="#L13182">13182</span>
<span id="L13183" rel="#L13183">13183</span>
<span id="L13184" rel="#L13184">13184</span>
<span id="L13185" rel="#L13185">13185</span>
<span id="L13186" rel="#L13186">13186</span>
<span id="L13187" rel="#L13187">13187</span>
<span id="L13188" rel="#L13188">13188</span>
<span id="L13189" rel="#L13189">13189</span>
<span id="L13190" rel="#L13190">13190</span>
<span id="L13191" rel="#L13191">13191</span>
<span id="L13192" rel="#L13192">13192</span>
<span id="L13193" rel="#L13193">13193</span>
<span id="L13194" rel="#L13194">13194</span>
<span id="L13195" rel="#L13195">13195</span>
<span id="L13196" rel="#L13196">13196</span>
<span id="L13197" rel="#L13197">13197</span>
<span id="L13198" rel="#L13198">13198</span>
<span id="L13199" rel="#L13199">13199</span>
<span id="L13200" rel="#L13200">13200</span>
<span id="L13201" rel="#L13201">13201</span>
<span id="L13202" rel="#L13202">13202</span>
<span id="L13203" rel="#L13203">13203</span>
<span id="L13204" rel="#L13204">13204</span>
<span id="L13205" rel="#L13205">13205</span>
<span id="L13206" rel="#L13206">13206</span>
<span id="L13207" rel="#L13207">13207</span>
<span id="L13208" rel="#L13208">13208</span>
<span id="L13209" rel="#L13209">13209</span>
<span id="L13210" rel="#L13210">13210</span>
<span id="L13211" rel="#L13211">13211</span>
<span id="L13212" rel="#L13212">13212</span>
<span id="L13213" rel="#L13213">13213</span>
<span id="L13214" rel="#L13214">13214</span>
<span id="L13215" rel="#L13215">13215</span>
<span id="L13216" rel="#L13216">13216</span>
<span id="L13217" rel="#L13217">13217</span>
<span id="L13218" rel="#L13218">13218</span>
<span id="L13219" rel="#L13219">13219</span>
<span id="L13220" rel="#L13220">13220</span>
<span id="L13221" rel="#L13221">13221</span>
<span id="L13222" rel="#L13222">13222</span>
<span id="L13223" rel="#L13223">13223</span>
<span id="L13224" rel="#L13224">13224</span>
<span id="L13225" rel="#L13225">13225</span>
<span id="L13226" rel="#L13226">13226</span>
<span id="L13227" rel="#L13227">13227</span>
<span id="L13228" rel="#L13228">13228</span>
<span id="L13229" rel="#L13229">13229</span>
<span id="L13230" rel="#L13230">13230</span>
<span id="L13231" rel="#L13231">13231</span>
<span id="L13232" rel="#L13232">13232</span>
<span id="L13233" rel="#L13233">13233</span>
<span id="L13234" rel="#L13234">13234</span>
<span id="L13235" rel="#L13235">13235</span>
<span id="L13236" rel="#L13236">13236</span>
<span id="L13237" rel="#L13237">13237</span>
<span id="L13238" rel="#L13238">13238</span>
<span id="L13239" rel="#L13239">13239</span>
<span id="L13240" rel="#L13240">13240</span>
<span id="L13241" rel="#L13241">13241</span>
<span id="L13242" rel="#L13242">13242</span>
<span id="L13243" rel="#L13243">13243</span>
<span id="L13244" rel="#L13244">13244</span>
<span id="L13245" rel="#L13245">13245</span>
<span id="L13246" rel="#L13246">13246</span>
<span id="L13247" rel="#L13247">13247</span>
<span id="L13248" rel="#L13248">13248</span>
<span id="L13249" rel="#L13249">13249</span>
<span id="L13250" rel="#L13250">13250</span>
<span id="L13251" rel="#L13251">13251</span>
<span id="L13252" rel="#L13252">13252</span>
<span id="L13253" rel="#L13253">13253</span>
<span id="L13254" rel="#L13254">13254</span>
<span id="L13255" rel="#L13255">13255</span>
<span id="L13256" rel="#L13256">13256</span>
<span id="L13257" rel="#L13257">13257</span>
<span id="L13258" rel="#L13258">13258</span>
<span id="L13259" rel="#L13259">13259</span>
<span id="L13260" rel="#L13260">13260</span>
<span id="L13261" rel="#L13261">13261</span>
<span id="L13262" rel="#L13262">13262</span>

            </td>
            <td class="blob-line-code"><div class="code-body highlight"><pre><div class='line' id='LC1'><span class="cm">/**</span></div><div class='line' id='LC2'><span class="cm"> * crafty 0.6.2</span></div><div class='line' id='LC3'><span class="cm"> * http://craftyjs.com/</span></div><div class='line' id='LC4'><span class="cm"> *</span></div><div class='line' id='LC5'><span class="cm"> * Copyright 2014, Louis Stowasser</span></div><div class='line' id='LC6'><span class="cm"> * Dual licensed under the MIT or GPL licenses.</span></div><div class='line' id='LC7'><span class="cm"> */</span></div><div class='line' id='LC8'><br/></div><div class='line' id='LC9'><br/></div><div class='line' id='LC10'><span class="p">;(</span><span class="kd">function</span> <span class="nx">e</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">function</span> <span class="nx">s</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">u</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">]){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">]){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">require</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="o">&amp;&amp;</span><span class="nx">require</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">u</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">)</span><span class="k">return</span> <span class="nx">a</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="o">!</span><span class="mi">0</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span><span class="k">return</span> <span class="nx">i</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="o">!</span><span class="mi">0</span><span class="p">);</span><span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Cannot find module &#39;&quot;</span><span class="o">+</span><span class="nx">o</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)}</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="nx">exports</span><span class="o">:</span><span class="p">{}};</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">o</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="nx">e</span><span class="p">];</span><span class="k">return</span> <span class="nx">s</span><span class="p">(</span><span class="nx">n</span><span class="o">?</span><span class="nx">n</span><span class="o">:</span><span class="nx">e</span><span class="p">)},</span><span class="nx">f</span><span class="p">,</span><span class="nx">f</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">n</span><span class="p">,</span><span class="nx">r</span><span class="p">)}</span><span class="k">return</span> <span class="nx">n</span><span class="p">[</span><span class="nx">o</span><span class="p">].</span><span class="nx">exports</span><span class="p">}</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">require</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="o">&amp;&amp;</span><span class="nx">require</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">o</span><span class="o">&lt;</span><span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">o</span><span class="o">++</span><span class="p">)</span><span class="nx">s</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">o</span><span class="p">]);</span><span class="k">return</span> <span class="nx">s</span><span class="p">})({</span><span class="mi">1</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC12'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span></div><div class='line' id='LC13'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./HashMap.js&#39;</span><span class="p">);</span></div><div class='line' id='LC14'><span class="c1">// Crafty._rectPool</span></div><div class='line' id='LC15'><span class="c1">//</span></div><div class='line' id='LC16'><span class="c1">// This is a private object used internally by 2D methods</span></div><div class='line' id='LC17'><span class="c1">// Cascade and _attr need to keep track of an entity&#39;s old position,</span></div><div class='line' id='LC18'><span class="c1">// but we want to avoid creating temp objects every time an attribute is set.</span></div><div class='line' id='LC19'><span class="c1">// The solution is to have a pool of objects that can be reused.</span></div><div class='line' id='LC20'><span class="c1">//</span></div><div class='line' id='LC21'><span class="c1">// The current implementation makes a BIG ASSUMPTION:  that if multiple rectangles are requested,</span></div><div class='line' id='LC22'><span class="c1">// the later one is recycled before any preceding ones.  This matches how they are used in the code.</span></div><div class='line' id='LC23'><span class="c1">// Each rect is created by a triggered event, and will be recycled by the time the event is complete.</span></div><div class='line' id='LC24'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">_rectPool</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC25'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pool</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC26'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pointer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC27'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC28'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC29'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">pointer</span><span class="p">)</span></div><div class='line' id='LC30'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pool</span><span class="p">.</span><span class="nx">push</span><span class="p">({});</span></div><div class='line' id='LC31'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">pool</span><span class="p">[</span><span class="nx">pointer</span><span class="o">++</span><span class="p">];</span></div><div class='line' id='LC32'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC33'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC34'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC35'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC36'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">r</span><span class="p">;</span></div><div class='line' id='LC37'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC38'><br/></div><div class='line' id='LC39'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">copy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC40'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">pointer</span><span class="p">)</span></div><div class='line' id='LC41'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pool</span><span class="p">.</span><span class="nx">push</span><span class="p">({});</span></div><div class='line' id='LC42'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">pool</span><span class="p">[</span><span class="nx">pointer</span><span class="o">++</span><span class="p">];</span></div><div class='line' id='LC43'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC44'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC45'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC46'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC47'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">r</span><span class="p">;</span></div><div class='line' id='LC48'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC49'><br/></div><div class='line' id='LC50'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">recycle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC51'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pointer</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC52'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC53'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC54'><span class="p">})();</span></div><div class='line' id='LC55'><br/></div><div class='line' id='LC56'><br/></div><div class='line' id='LC57'><span class="cm">/**@</span></div><div class='line' id='LC58'><span class="cm"> * #Crafty.map</span></div><div class='line' id='LC59'><span class="cm"> * @category 2D</span></div><div class='line' id='LC60'><span class="cm"> * Functions related with querying entities.</span></div><div class='line' id='LC61'><span class="cm"> * @see Crafty.HashMap</span></div><div class='line' id='LC62'><span class="cm"> */</span></div><div class='line' id='LC63'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashMap</span><span class="p">();</span></div><div class='line' id='LC64'><span class="kd">var</span> <span class="nx">M</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">,</span></div><div class='line' id='LC65'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Mc</span> <span class="o">=</span> <span class="nx">M</span><span class="p">.</span><span class="nx">cos</span><span class="p">,</span></div><div class='line' id='LC66'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Ms</span> <span class="o">=</span> <span class="nx">M</span><span class="p">.</span><span class="nx">sin</span><span class="p">,</span></div><div class='line' id='LC67'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">PI</span> <span class="o">=</span> <span class="nx">M</span><span class="p">.</span><span class="nx">PI</span><span class="p">,</span></div><div class='line' id='LC68'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DEG_TO_RAD</span> <span class="o">=</span> <span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span></div><div class='line' id='LC69'><br/></div><div class='line' id='LC70'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC71'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">zeroFill</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">number</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC72'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span> <span class="o">-=</span> <span class="nx">number</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC73'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC74'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">width</span> <span class="o">+</span> <span class="p">(</span><span class="sr">/\./</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">number</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">number</span><span class="p">;</span></div><div class='line' id='LC75'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">number</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span></div><div class='line' id='LC76'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC77'><span class="p">});</span></div><div class='line' id='LC78'><br/></div><div class='line' id='LC79'><span class="cm">/**@</span></div><div class='line' id='LC80'><span class="cm"> * #2D</span></div><div class='line' id='LC81'><span class="cm"> * @category 2D</span></div><div class='line' id='LC82'><span class="cm"> * Component for any entity that has a position on the stage.</span></div><div class='line' id='LC83'><span class="cm"> * @trigger Move - when the entity has moved - { _x:Number, _y:Number, _w:Number, _h:Number } - Old position</span></div><div class='line' id='LC84'><span class="cm"> * @trigger Invalidate - when the entity needs to be redrawn</span></div><div class='line' id='LC85'><span class="cm"> * @trigger Rotate - when the entity is rotated - { cos:Number, sin:Number, deg:Number, rad:Number, o: {x:Number, y:Number}}</span></div><div class='line' id='LC86'><span class="cm"> */</span></div><div class='line' id='LC87'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC88'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC89'><span class="cm">     * #.x</span></div><div class='line' id='LC90'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC91'><span class="cm">     * The `x` position on the stage. When modified, will automatically be redrawn.</span></div><div class='line' id='LC92'><span class="cm">     * Is actually a getter/setter so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC93'><span class="cm">     * use the `._x` property.</span></div><div class='line' id='LC94'><span class="cm">     * @see ._attr</span></div><div class='line' id='LC95'><span class="cm">     */</span></div><div class='line' id='LC96'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC97'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC98'><span class="cm">     * #.y</span></div><div class='line' id='LC99'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC100'><span class="cm">     * The `y` position on the stage. When modified, will automatically be redrawn.</span></div><div class='line' id='LC101'><span class="cm">     * Is actually a getter/setter so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC102'><span class="cm">     * use the `._y` property.</span></div><div class='line' id='LC103'><span class="cm">     * @see ._attr</span></div><div class='line' id='LC104'><span class="cm">     */</span></div><div class='line' id='LC105'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC106'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC107'><span class="cm">     * #.w</span></div><div class='line' id='LC108'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC109'><span class="cm">     * The width of the entity. When modified, will automatically be redrawn.</span></div><div class='line' id='LC110'><span class="cm">     * Is actually a getter/setter so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC111'><span class="cm">     * use the `._w` property.</span></div><div class='line' id='LC112'><span class="cm">     *</span></div><div class='line' id='LC113'><span class="cm">     * Changing this value is not recommended as canvas has terrible resize quality and DOM will just clip the image.</span></div><div class='line' id='LC114'><span class="cm">     * @see ._attr</span></div><div class='line' id='LC115'><span class="cm">     */</span></div><div class='line' id='LC116'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC117'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC118'><span class="cm">     * #.h</span></div><div class='line' id='LC119'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC120'><span class="cm">     * The height of the entity. When modified, will automatically be redrawn.</span></div><div class='line' id='LC121'><span class="cm">     * Is actually a getter/setter so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC122'><span class="cm">     * use the `._h` property.</span></div><div class='line' id='LC123'><span class="cm">     *</span></div><div class='line' id='LC124'><span class="cm">     * Changing this value is not recommended as canvas has terrible resize quality and DOM will just clip the image.</span></div><div class='line' id='LC125'><span class="cm">     * @see ._attr</span></div><div class='line' id='LC126'><span class="cm">     */</span></div><div class='line' id='LC127'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC128'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC129'><span class="cm">     * #.z</span></div><div class='line' id='LC130'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC131'><span class="cm">     * The `z` index on the stage. When modified, will automatically be redrawn.</span></div><div class='line' id='LC132'><span class="cm">     * Is actually a getter/setter so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC133'><span class="cm">     * use the `._z` property.</span></div><div class='line' id='LC134'><span class="cm">     *</span></div><div class='line' id='LC135'><span class="cm">     * A higher `z` value will be closer to the front of the stage. A smaller `z` value will be closer to the back.</span></div><div class='line' id='LC136'><span class="cm">     * A global Z index is produced based on its `z` value as well as the GID (which entity was created first).</span></div><div class='line' id='LC137'><span class="cm">     * Therefore entities will naturally maintain order depending on when it was created if same z value.</span></div><div class='line' id='LC138'><span class="cm">     *</span></div><div class='line' id='LC139'><span class="cm">     * `z` is required to be an integer, e.g. `z=11.2` is not allowed.</span></div><div class='line' id='LC140'><span class="cm">     * @see ._attr</span></div><div class='line' id='LC141'><span class="cm">     */</span></div><div class='line' id='LC142'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_z</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC143'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC144'><span class="cm">     * #.rotation</span></div><div class='line' id='LC145'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC146'><span class="cm">     * The rotation state of the entity, in clockwise degrees.</span></div><div class='line' id='LC147'><span class="cm">     * `this.rotation = 0` sets it to its original orientation; `this.rotation = 10`</span></div><div class='line' id='LC148'><span class="cm">     * sets it to 10 degrees clockwise from its original orientation;</span></div><div class='line' id='LC149'><span class="cm">     * `this.rotation = -10` sets it to 10 degrees counterclockwise from its</span></div><div class='line' id='LC150'><span class="cm">     * original orientation, etc.</span></div><div class='line' id='LC151'><span class="cm">     *</span></div><div class='line' id='LC152'><span class="cm">     * When modified, will automatically be redrawn. Is actually a getter/setter</span></div><div class='line' id='LC153'><span class="cm">     * so when using this value for calculations and not modifying it,</span></div><div class='line' id='LC154'><span class="cm">     * use the `._rotation` property.</span></div><div class='line' id='LC155'><span class="cm">     *</span></div><div class='line' id='LC156'><span class="cm">     * `this.rotation = 0` does the same thing as `this.rotation = 360` or `720` or</span></div><div class='line' id='LC157'><span class="cm">     * `-360` or `36000` etc. So you can keep increasing or decreasing the angle for continuous</span></div><div class='line' id='LC158'><span class="cm">     * rotation. (Numerical errors do not occur until you get to millions of degrees.)</span></div><div class='line' id='LC159'><span class="cm">     *</span></div><div class='line' id='LC160'><span class="cm">     * The default is to rotate the entity around its (initial) top-left corner; use</span></div><div class='line' id='LC161'><span class="cm">     * `.origin()` to change that.</span></div><div class='line' id='LC162'><span class="cm">     *</span></div><div class='line' id='LC163'><span class="cm">     * @see ._attr, .origin</span></div><div class='line' id='LC164'><span class="cm">     */</span></div><div class='line' id='LC165'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_rotation</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC166'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC167'><span class="cm">     * #.alpha</span></div><div class='line' id='LC168'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC169'><span class="cm">     * Transparency of an entity. Must be a decimal value between 0.0 being fully transparent to 1.0 being fully opaque.</span></div><div class='line' id='LC170'><span class="cm">     */</span></div><div class='line' id='LC171'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_alpha</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span></div><div class='line' id='LC172'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC173'><span class="cm">     * #.visible</span></div><div class='line' id='LC174'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC175'><span class="cm">     * If the entity is visible or not. Accepts a true or false value.</span></div><div class='line' id='LC176'><span class="cm">     * Can be used for optimization by setting an entities visibility to false when not needed to be drawn.</span></div><div class='line' id='LC177'><span class="cm">     *</span></div><div class='line' id='LC178'><span class="cm">     * The entity will still exist and can be collided with but just won&#39;t be drawn.</span></div><div class='line' id='LC179'><span class="cm">     * @see Crafty.DrawManager.draw, Crafty.DrawManager.drawAll</span></div><div class='line' id='LC180'><span class="cm">     */</span></div><div class='line' id='LC181'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_visible</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC182'><br/></div><div class='line' id='LC183'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC184'><span class="cm">     * #._globalZ</span></div><div class='line' id='LC185'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC186'><span class="cm">     * When two entities overlap, the one with the larger `_globalZ` will be on top of the other.</span></div><div class='line' id='LC187'><span class="cm">     * @see Crafty.DrawManager.draw, Crafty.DrawManager.drawAll</span></div><div class='line' id='LC188'><span class="cm">     */</span></div><div class='line' id='LC189'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_globalZ</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC190'><br/></div><div class='line' id='LC191'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_origin</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC192'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_mbr</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC193'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_entry</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC194'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_children</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC195'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_parent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC196'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_changed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC197'><br/></div><div class='line' id='LC198'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_defineGetterSetter_setter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create getters and setters using __defineSetter__ and __defineGetter__</span></div><div class='line' id='LC200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_w&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_h&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_z&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;rotation&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_rotation&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_alpha&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_visible&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC224'><br/></div><div class='line' id='LC225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">;</span></div><div class='line' id='LC239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;rotation&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span><span class="p">;</span></div><div class='line' id='LC242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span><span class="p">;</span></div><div class='line' id='LC248'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC250'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_parent</span><span class="p">;</span></div><div class='line' id='LC251'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;numChildren&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC255'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC256'><br/></div><div class='line' id='LC257'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_defineGetterSetter_defineProperty</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC263'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC264'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC265'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC266'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC267'><br/></div><div class='line' id='LC268'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC269'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC270'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC274'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC277'><br/></div><div class='line' id='LC278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_w&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC286'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC287'><br/></div><div class='line' id='LC288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_h&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC291'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC295'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC297'><br/></div><div class='line' id='LC298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC300'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_z&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC302'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">;</span></div><div class='line' id='LC304'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC307'><br/></div><div class='line' id='LC308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;rotation&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_rotation&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC311'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span><span class="p">;</span></div><div class='line' id='LC314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC317'><br/></div><div class='line' id='LC318'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC319'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC320'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_alpha&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC321'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC322'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC323'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC324'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC325'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC326'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC327'><br/></div><div class='line' id='LC328'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_visible&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span><span class="p">;</span></div><div class='line' id='LC334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC337'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC338'><br/></div><div class='line' id='LC339'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_globalZ</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC342'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC343'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC344'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC345'><br/></div><div class='line' id='LC346'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// offsets for the basic bounding box</span></div><div class='line' id='LC347'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_bx1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC348'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_bx2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC349'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_by1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC350'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_by2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC351'><br/></div><div class='line' id='LC352'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC353'><br/></div><div class='line' id='LC354'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">setter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC355'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_defineGetterSetter_setter</span><span class="p">();</span></div><div class='line' id='LC356'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC357'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//IE9 supports Object.defineProperty</span></div><div class='line' id='LC358'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_defineGetterSetter_defineProperty</span><span class="p">();</span></div><div class='line' id='LC359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC360'><br/></div><div class='line' id='LC361'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert self into the HashMap</span></div><div class='line' id='LC362'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_entry</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC363'><br/></div><div class='line' id='LC364'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//when object changes, update HashMap</span></div><div class='line' id='LC365'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Move&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC366'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Choose the largest bounding region that exists</span></div><div class='line' id='LC367'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">area</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_entry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">area</span><span class="p">);</span></div><div class='line' id='LC369'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Move children (if any) by the same amount</span></div><div class='line' id='LC370'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC371'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cascade</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC372'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC373'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC374'><br/></div><div class='line' id='LC375'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC376'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Choose the largest bounding region that exists</span></div><div class='line' id='LC377'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC378'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_entry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">old</span><span class="p">);</span></div><div class='line' id='LC379'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Rotate children (if any) by the same amount</span></div><div class='line' id='LC380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cascade</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC384'><br/></div><div class='line' id='LC385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//when object is removed, remove from HashMap and destroy attached children</span></div><div class='line' id='LC386'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC388'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// delete the child&#39;s _parent link, or else the child will splice itself out of</span></div><div class='line' id='LC390'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// this._children while destroying itself (which messes up this for-loop iteration).</span></div><div class='line' id='LC391'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_parent</span><span class="p">;</span></div><div class='line' id='LC392'><br/></div><div class='line' id='LC393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Destroy child if possible (It&#39;s not always possible, e.g. the polygon attached</span></div><div class='line' id='LC394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// by areaMap has no .destroy(), it will just get garbage-collected.)</span></div><div class='line' id='LC395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">destroy</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span></div><div class='line' id='LC397'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC401'><br/></div><div class='line' id='LC402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_parent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_parent</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC405'><br/></div><div class='line' id='LC406'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC407'><br/></div><div class='line' id='LC408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">detach</span><span class="p">();</span></div><div class='line' id='LC409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC410'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC411'><br/></div><div class='line' id='LC412'><br/></div><div class='line' id='LC413'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC414'><span class="cm">     * #.offsetBoundary</span></div><div class='line' id='LC415'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC416'><span class="cm">     * Extends the MBR of the entity by a specified amount.</span></div><div class='line' id='LC417'><span class="cm">     * </span></div><div class='line' id='LC418'><span class="cm">     * @trigger BoundaryOffset - when the MBR offset changes</span></div><div class='line' id='LC419'><span class="cm">     * @sign public this .offsetBoundary(Number dx1, Number dy1, Number dx2, Number dy2)</span></div><div class='line' id='LC420'><span class="cm">     * @param dx1 - Extends the MBR to the left by this amount</span></div><div class='line' id='LC421'><span class="cm">     * @param dy1 - Extends the MBR upward by this amount</span></div><div class='line' id='LC422'><span class="cm">     * @param dx2 - Extends the MBR to the right by this amount</span></div><div class='line' id='LC423'><span class="cm">     * @param dy2 - Extends the MBR downward by this amount</span></div><div class='line' id='LC424'><span class="cm">     *</span></div><div class='line' id='LC425'><span class="cm">     * @sign public this .offsetBoundary(Number offset)</span></div><div class='line' id='LC426'><span class="cm">     * @param offset - Extend the MBR in all directions by this amount</span></div><div class='line' id='LC427'><span class="cm">     *</span></div><div class='line' id='LC428'><span class="cm">     * You would most likely use this function to ensure that custom canvas rendering beyond the extent of the entity&#39;s normal bounds is not clipped.</span></div><div class='line' id='LC429'><span class="cm">     */</span></div><div class='line' id='LC430'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offsetBoundary</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">){</span></div><div class='line' id='LC431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span></div><div class='line' id='LC432'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y1</span> <span class="o">=</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">y2</span> <span class="o">=</span> <span class="nx">x1</span><span class="p">;</span></div><div class='line' id='LC433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_bx1</span> <span class="o">=</span> <span class="nx">x1</span><span class="p">;</span></div><div class='line' id='LC434'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_bx2</span> <span class="o">=</span> <span class="nx">x2</span><span class="p">;</span></div><div class='line' id='LC435'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_by1</span> <span class="o">=</span> <span class="nx">y1</span><span class="p">;</span></div><div class='line' id='LC436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_by2</span> <span class="o">=</span> <span class="nx">y2</span><span class="p">;</span></div><div class='line' id='LC437'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;BoundaryOffset&quot;</span><span class="p">);</span></div><div class='line' id='LC438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC440'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC441'><br/></div><div class='line' id='LC442'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC443'><span class="cm">     * Calculates the MBR when rotated some number of radians about an origin point o.</span></div><div class='line' id='LC444'><span class="cm">     * Necessary on a rotation, or a resize</span></div><div class='line' id='LC445'><span class="cm">     */</span></div><div class='line' id='LC446'><br/></div><div class='line' id='LC447'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_calculateMBR</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ox</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rad</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">;</span></div><div class='line' id='LC451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// axis-aligned (unrotated) coordinates, relative to the origin point</span></div><div class='line' id='LC452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">dx1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_bx1</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">,</span></div><div class='line' id='LC453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dx2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_bx2</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">,</span></div><div class='line' id='LC454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_by1</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">,</span></div><div class='line' id='LC455'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_by2</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">;</span></div><div class='line' id='LC456'><br/></div><div class='line' id='LC457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ct</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rad</span><span class="p">),</span></div><div class='line' id='LC458'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">st</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rad</span><span class="p">);</span></div><div class='line' id='LC459'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Special case 90 degree rotations to prevent rounding problems</span></div><div class='line' id='LC460'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ct</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ct</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">ct</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">ct</span><span class="p">;</span></div><div class='line' id='LC461'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">st</span> <span class="o">=</span> <span class="p">(</span><span class="nx">st</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">st</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="nx">e</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">st</span><span class="p">;</span></div><div class='line' id='LC462'><br/></div><div class='line' id='LC463'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculate the new points relative to the origin, then find the new (absolute) bounding coordinates!</span></div><div class='line' id='LC464'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">x0</span> <span class="o">=</span>   <span class="nx">dx1</span> <span class="o">*</span> <span class="nx">ct</span> <span class="o">+</span> <span class="nx">dy1</span> <span class="o">*</span> <span class="nx">st</span><span class="p">,</span></div><div class='line' id='LC465'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y0</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">dx1</span> <span class="o">*</span> <span class="nx">st</span> <span class="o">+</span> <span class="nx">dy1</span> <span class="o">*</span> <span class="nx">ct</span><span class="p">,</span></div><div class='line' id='LC466'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x1</span> <span class="o">=</span>   <span class="nx">dx2</span> <span class="o">*</span> <span class="nx">ct</span> <span class="o">+</span> <span class="nx">dy1</span> <span class="o">*</span> <span class="nx">st</span><span class="p">,</span></div><div class='line' id='LC467'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y1</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">dx2</span> <span class="o">*</span> <span class="nx">st</span> <span class="o">+</span> <span class="nx">dy1</span> <span class="o">*</span> <span class="nx">ct</span><span class="p">,</span></div><div class='line' id='LC468'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x2</span> <span class="o">=</span>   <span class="nx">dx2</span> <span class="o">*</span> <span class="nx">ct</span> <span class="o">+</span> <span class="nx">dy2</span> <span class="o">*</span> <span class="nx">st</span><span class="p">,</span></div><div class='line' id='LC469'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y2</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">dx2</span> <span class="o">*</span> <span class="nx">st</span> <span class="o">+</span> <span class="nx">dy2</span> <span class="o">*</span> <span class="nx">ct</span><span class="p">,</span></div><div class='line' id='LC470'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x3</span> <span class="o">=</span>   <span class="nx">dx1</span> <span class="o">*</span> <span class="nx">ct</span> <span class="o">+</span> <span class="nx">dy2</span> <span class="o">*</span> <span class="nx">st</span><span class="p">,</span></div><div class='line' id='LC471'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y3</span> <span class="o">=</span> <span class="o">-</span> <span class="nx">dx1</span> <span class="o">*</span> <span class="nx">st</span> <span class="o">+</span> <span class="nx">dy2</span> <span class="o">*</span> <span class="nx">ct</span><span class="p">,</span></div><div class='line' id='LC472'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">minx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">x1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">x3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">ox</span><span class="p">),</span></div><div class='line' id='LC473'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">miny</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">y0</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">y2</span><span class="p">,</span> <span class="nx">y3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">oy</span><span class="p">),</span></div><div class='line' id='LC474'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">x0</span><span class="p">,</span> <span class="nx">x1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">x3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">ox</span><span class="p">),</span></div><div class='line' id='LC475'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">y0</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">y2</span><span class="p">,</span> <span class="nx">y3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">oy</span><span class="p">);</span></div><div class='line' id='LC476'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC477'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC478'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="nx">minx</span><span class="p">,</span></div><div class='line' id='LC479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="nx">miny</span><span class="p">,</span></div><div class='line' id='LC480'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="nx">maxx</span> <span class="o">-</span> <span class="nx">minx</span><span class="p">,</span></div><div class='line' id='LC481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="nx">maxy</span> <span class="o">-</span> <span class="nx">miny</span></div><div class='line' id='LC482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">minx</span><span class="p">;</span></div><div class='line' id='LC485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">miny</span><span class="p">;</span></div><div class='line' id='LC486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">maxx</span> <span class="o">-</span> <span class="nx">minx</span><span class="p">;</span></div><div class='line' id='LC487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">maxy</span> <span class="o">-</span> <span class="nx">miny</span><span class="p">;</span></div><div class='line' id='LC488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC489'><br/></div><div class='line' id='LC490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If a collision hitbox exists AND sits outside the entity, find a bounding box for both.</span></div><div class='line' id='LC491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// `_cbr` contains information about a bounding circle of the hitbox. </span></div><div class='line' id='LC492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The bounds of `_cbr` will be the union of the `_mbr` and the bounding box of that circle.</span></div><div class='line' id='LC493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This will not be a minimal region, but since it&#39;s only used for the broad phase pass it&#39;s good enough. </span></div><div class='line' id='LC494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//</span></div><div class='line' id='LC495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// cbr is calculated by the `_checkBounds` method of the &quot;Collision&quot; component</span></div><div class='line' id='LC496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span><span class="p">;</span></div><div class='line' id='LC498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cx</span> <span class="o">=</span> <span class="nx">cbr</span><span class="p">.</span><span class="nx">cx</span><span class="p">,</span> <span class="nx">cy</span> <span class="o">=</span> <span class="nx">cbr</span><span class="p">.</span><span class="nx">cy</span><span class="p">,</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">cbr</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span></div><div class='line' id='LC499'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cx2</span> <span class="o">=</span> <span class="nx">ox</span> <span class="o">+</span> <span class="p">(</span><span class="nx">cx</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ct</span> <span class="o">+</span> <span class="p">(</span><span class="nx">cy</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">st</span><span class="p">;</span></div><div class='line' id='LC500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cy2</span> <span class="o">=</span> <span class="nx">oy</span> <span class="o">-</span> <span class="p">(</span><span class="nx">cx</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">-</span> <span class="nx">ox</span><span class="p">)</span> <span class="o">*</span> <span class="nx">st</span> <span class="o">+</span> <span class="p">(</span><span class="nx">cy</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="nx">oy</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ct</span><span class="p">;</span></div><div class='line' id='LC501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">cx2</span> <span class="o">-</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">minx</span><span class="p">);</span></div><div class='line' id='LC502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">cy2</span> <span class="o">-</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">miny</span><span class="p">);</span></div><div class='line' id='LC503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">cx2</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">maxx</span><span class="p">)</span> <span class="o">-</span> <span class="nx">cbr</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cbr</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">cy2</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">maxy</span><span class="p">)</span> <span class="o">-</span> <span class="nx">cbr</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC506'><br/></div><div class='line' id='LC507'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC508'><br/></div><div class='line' id='LC509'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC510'><span class="cm">     * Handle changes that need to happen on a rotation</span></div><div class='line' id='LC511'><span class="cm">     */</span></div><div class='line' id='LC512'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_rotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="nx">v</span> <span class="o">%</span> <span class="mi">360</span><span class="p">);</span> <span class="c1">//angle always between 0 and 359</span></div><div class='line' id='LC514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">difference</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">-</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// skip if there&#39;s no rotation!</span></div><div class='line' id='LC516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">difference</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC520'><br/></div><div class='line' id='LC521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Calculate the new MBR</span></div><div class='line' id='LC522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rad</span> <span class="o">=</span> <span class="nx">theta</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">,</span></div><div class='line' id='LC523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">o</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC525'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span></div><div class='line' id='LC526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC527'><br/></div><div class='line' id='LC528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC529'><br/></div><div class='line' id='LC530'><br/></div><div class='line' id='LC531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//trigger &quot;Rotate&quot; event</span></div><div class='line' id='LC532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">drad</span> <span class="o">=</span> <span class="nx">difference</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">,</span></div><div class='line' id='LC533'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ct</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rad</span><span class="p">),</span></div><div class='line' id='LC534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">st</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rad</span><span class="p">);</span></div><div class='line' id='LC535'><br/></div><div class='line' id='LC536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cos</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">drad</span><span class="p">),</span></div><div class='line' id='LC538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sin</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">drad</span><span class="p">),</span></div><div class='line' id='LC539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deg</span><span class="o">:</span> <span class="nx">difference</span><span class="p">,</span></div><div class='line' id='LC540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rad</span><span class="o">:</span> <span class="nx">drad</span><span class="p">,</span></div><div class='line' id='LC541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">o</span><span class="o">:</span> <span class="nx">o</span></div><div class='line' id='LC542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC543'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC544'><br/></div><div class='line' id='LC545'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC546'><span class="cm">     * #.area</span></div><div class='line' id='LC547'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC548'><span class="cm">     * @sign public Number .area(void)</span></div><div class='line' id='LC549'><span class="cm">     * Calculates the area of the entity</span></div><div class='line' id='LC550'><span class="cm">     */</span></div><div class='line' id='LC551'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">area</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC552'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC553'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC554'><br/></div><div class='line' id='LC555'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC556'><span class="cm">     * #.intersect</span></div><div class='line' id='LC557'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC558'><span class="cm">     * @sign public Boolean .intersect(Number x, Number y, Number w, Number h)</span></div><div class='line' id='LC559'><span class="cm">     * @param x - X position of the rect</span></div><div class='line' id='LC560'><span class="cm">     * @param y - Y position of the rect</span></div><div class='line' id='LC561'><span class="cm">     * @param w - Width of the rect</span></div><div class='line' id='LC562'><span class="cm">     * @param h - Height of the rect</span></div><div class='line' id='LC563'><span class="cm">     * @sign public Boolean .intersect(Object rect)</span></div><div class='line' id='LC564'><span class="cm">     * @param rect - An object that must have the `x, y, w, h` values as properties</span></div><div class='line' id='LC565'><span class="cm">     * Determines if this entity intersects a rectangle.  If the entity is rotated, its MBR is used for the test.</span></div><div class='line' id='LC566'><span class="cm">     */</span></div><div class='line' id='LC567'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">intersect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC569'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC575'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span><span class="o">:</span> <span class="nx">w</span><span class="p">,</span></div><div class='line' id='LC576'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="o">:</span> <span class="nx">h</span></div><div class='line' id='LC577'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC578'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC579'><br/></div><div class='line' id='LC580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">w</span> <span class="o">&amp;&amp;</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC581'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;&amp;</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_h</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&gt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC582'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC583'><br/></div><div class='line' id='LC584'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC585'><span class="cm">     * #.within</span></div><div class='line' id='LC586'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC587'><span class="cm">     * @sign public Boolean .within(Number x, Number y, Number w, Number h)</span></div><div class='line' id='LC588'><span class="cm">     * @param x - X position of the rect</span></div><div class='line' id='LC589'><span class="cm">     * @param y - Y position of the rect</span></div><div class='line' id='LC590'><span class="cm">     * @param w - Width of the rect</span></div><div class='line' id='LC591'><span class="cm">     * @param h - Height of the rect</span></div><div class='line' id='LC592'><span class="cm">     * @sign public Boolean .within(Object rect)</span></div><div class='line' id='LC593'><span class="cm">     * @param rect - An object that must have the `_x, _y, _w, _h` values as properties</span></div><div class='line' id='LC594'><span class="cm">     * Determines if this current entity is within another rectangle.</span></div><div class='line' id='LC595'><span class="cm">     */</span></div><div class='line' id='LC596'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">within</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC597'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC601'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC604'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="nx">w</span><span class="p">,</span></div><div class='line' id='LC605'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="nx">h</span></div><div class='line' id='LC606'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC607'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC608'><br/></div><div class='line' id='LC609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC610'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&gt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC611'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC612'><br/></div><div class='line' id='LC613'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC614'><span class="cm">     * #.contains</span></div><div class='line' id='LC615'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC616'><span class="cm">     * @sign public Boolean .contains(Number x, Number y, Number w, Number h)</span></div><div class='line' id='LC617'><span class="cm">     * @param x - X position of the rect</span></div><div class='line' id='LC618'><span class="cm">     * @param y - Y position of the rect</span></div><div class='line' id='LC619'><span class="cm">     * @param w - Width of the rect</span></div><div class='line' id='LC620'><span class="cm">     * @param h - Height of the rect</span></div><div class='line' id='LC621'><span class="cm">     * @sign public Boolean .contains(Object rect)</span></div><div class='line' id='LC622'><span class="cm">     * @param rect - An object that must have the `_x, _y, _w, _h` values as properties.</span></div><div class='line' id='LC623'><span class="cm">     * Determines if the rectangle is within the current entity.  If the entity is rotated, its MBR is used for the test.</span></div><div class='line' id='LC624'><span class="cm">     */</span></div><div class='line' id='LC625'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">contains</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC626'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC627'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC628'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC629'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC631'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC632'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="nx">w</span><span class="p">,</span></div><div class='line' id='LC634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="nx">h</span></div><div class='line' id='LC635'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC637'><br/></div><div class='line' id='LC638'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&gt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&lt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC639'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&gt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&lt;=</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC640'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC641'><br/></div><div class='line' id='LC642'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC643'><span class="cm">     * #.pos</span></div><div class='line' id='LC644'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC645'><span class="cm">     * @sign public Object .pos(void)</span></div><div class='line' id='LC646'><span class="cm">     * Returns the x, y, w, h properties as a rect object</span></div><div class='line' id='LC647'><span class="cm">     * (a rect object is just an object with the keys _x, _y, _w, _h).</span></div><div class='line' id='LC648'><span class="cm">     *</span></div><div class='line' id='LC649'><span class="cm">     * The keys have an underscore prefix. This is due to the x, y, w, h</span></div><div class='line' id='LC650'><span class="cm">     * properties being merely setters and getters that wrap the properties with an underscore (_x, _y, _w, _h).</span></div><div class='line' id='LC651'><span class="cm">     */</span></div><div class='line' id='LC652'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC653'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC654'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">),</span></div><div class='line' id='LC655'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">),</span></div><div class='line' id='LC656'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">),</span></div><div class='line' id='LC657'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">)</span></div><div class='line' id='LC658'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC659'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC660'><br/></div><div class='line' id='LC661'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC662'><span class="cm">     * #.mbr</span></div><div class='line' id='LC663'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC664'><span class="cm">     * @sign public Object .mbr()</span></div><div class='line' id='LC665'><span class="cm">     * Returns the minimum bounding rectangle. If there is no rotation</span></div><div class='line' id='LC666'><span class="cm">     * on the entity it will return the rect.</span></div><div class='line' id='LC667'><span class="cm">     */</span></div><div class='line' id='LC668'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC669'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">();</span></div><div class='line' id='LC670'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC671'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_x</span><span class="p">),</span></div><div class='line' id='LC672'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_y</span><span class="p">),</span></div><div class='line' id='LC673'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_w</span><span class="p">),</span></div><div class='line' id='LC674'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">.</span><span class="nx">_h</span><span class="p">)</span></div><div class='line' id='LC675'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC676'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC677'><br/></div><div class='line' id='LC678'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC679'><span class="cm">     * #.isAt</span></div><div class='line' id='LC680'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC681'><span class="cm">     * @sign public Boolean .isAt(Number x, Number y)</span></div><div class='line' id='LC682'><span class="cm">     * @param x - X position of the point</span></div><div class='line' id='LC683'><span class="cm">     * @param y - Y position of the point</span></div><div class='line' id='LC684'><span class="cm">     * Determines whether a point is contained by the entity. Unlike other methods,</span></div><div class='line' id='LC685'><span class="cm">     * an object can&#39;t be passed. The arguments require the x and y value.</span></div><div class='line' id='LC686'><span class="cm">     *</span></div><div class='line' id='LC687'><span class="cm">     * The given point is tested against the first of the following that exists: a mapArea associated with &quot;Mouse&quot;, the hitarea associated with &quot;Collision&quot;, or the object&#39;s MBR.</span></div><div class='line' id='LC688'><span class="cm">     */</span></div><div class='line' id='LC689'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">isAt</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC690'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mapArea</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC691'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapArea</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC692'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC693'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC694'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC695'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC696'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;=</span> <span class="nx">x</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC697'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">mbr</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&gt;=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC698'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC699'><br/></div><div class='line' id='LC700'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC701'><span class="cm">     * #.move</span></div><div class='line' id='LC702'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC703'><span class="cm">     * @sign public this .move(String dir, Number by)</span></div><div class='line' id='LC704'><span class="cm">     * @param dir - Direction to move (n,s,e,w,ne,nw,se,sw)</span></div><div class='line' id='LC705'><span class="cm">     * @param by - Amount to move in the specified direction</span></div><div class='line' id='LC706'><span class="cm">     * Quick method to move the entity in a direction (n, s, e, w, ne, nw, se, sw) by an amount of pixels.</span></div><div class='line' id='LC707'><span class="cm">     */</span></div><div class='line' id='LC708'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">move</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">by</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC709'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dir</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">by</span><span class="p">;</span></div><div class='line' id='LC710'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dir</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">by</span><span class="p">;</span></div><div class='line' id='LC711'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dir</span> <span class="o">===</span> <span class="s1">&#39;e&#39;</span> <span class="o">||</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">by</span><span class="p">;</span></div><div class='line' id='LC712'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dir</span> <span class="o">===</span> <span class="s1">&#39;w&#39;</span> <span class="o">||</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">by</span><span class="p">;</span></div><div class='line' id='LC713'><br/></div><div class='line' id='LC714'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC715'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC716'><br/></div><div class='line' id='LC717'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC718'><span class="cm">     * #.shift</span></div><div class='line' id='LC719'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC720'><span class="cm">     * @sign public this .shift(Number x, Number y, Number w, Number h)</span></div><div class='line' id='LC721'><span class="cm">     * @param x - Amount to move X</span></div><div class='line' id='LC722'><span class="cm">     * @param y - Amount to move Y</span></div><div class='line' id='LC723'><span class="cm">     * @param w - Amount to widen</span></div><div class='line' id='LC724'><span class="cm">     * @param h - Amount to increase height</span></div><div class='line' id='LC725'><span class="cm">     * Shift or move the entity by an amount. Use negative values</span></div><div class='line' id='LC726'><span class="cm">     * for an opposite direction.</span></div><div class='line' id='LC727'><span class="cm">     */</span></div><div class='line' id='LC728'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shift</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">+=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">+=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC733'><br/></div><div class='line' id='LC734'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC735'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC736'><br/></div><div class='line' id='LC737'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC738'><span class="cm">     * #._cascade</span></div><div class='line' id='LC739'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC740'><span class="cm">     * @sign public void ._cascade(e)</span></div><div class='line' id='LC741'><span class="cm">     * @param e - An object describing the motion</span></div><div class='line' id='LC742'><span class="cm">     * Move or rotate the entity&#39;s children according to a certain motion.</span></div><div class='line' id='LC743'><span class="cm">     * This method is part of a function bound to &quot;Move&quot;: It is used</span></div><div class='line' id='LC744'><span class="cm">     * internally for ensuring that when a parent moves, the child also</span></div><div class='line' id='LC745'><span class="cm">     * moves in the same way.</span></div><div class='line' id='LC746'><span class="cm">     */</span></div><div class='line' id='LC747'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_cascade</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">//no change in position</span></div><div class='line' id='LC749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">children</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">,</span></div><div class='line' id='LC751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//rotation</span></div><div class='line' id='LC754'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">cos</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC756'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;rotate&#39;</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC758'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC759'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//use current position</span></div><div class='line' id='LC761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC763'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dw</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span></div><div class='line' id='LC764'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dh</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC765'><br/></div><div class='line' id='LC766'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC767'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">shift</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">dw</span><span class="p">,</span> <span class="nx">dh</span><span class="p">);</span></div><div class='line' id='LC769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC771'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC772'><br/></div><div class='line' id='LC773'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC774'><span class="cm">     * #.attach</span></div><div class='line' id='LC775'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC776'><span class="cm">     * @sign public this .attach(Entity obj[, .., Entity objN])</span></div><div class='line' id='LC777'><span class="cm">     * @param obj - Child entity(s) to attach</span></div><div class='line' id='LC778'><span class="cm">     * Sets one or more entities to be children, with the current entity (`this`)</span></div><div class='line' id='LC779'><span class="cm">     * as the parent. When the parent moves or rotates, its children move or</span></div><div class='line' id='LC780'><span class="cm">     * rotate by the same amount. (But not vice-versa: If you move a child, it</span></div><div class='line' id='LC781'><span class="cm">     * will not move the parent.) When the parent is destroyed, its children are</span></div><div class='line' id='LC782'><span class="cm">     * destroyed.</span></div><div class='line' id='LC783'><span class="cm">     *</span></div><div class='line' id='LC784'><span class="cm">     * For any entity, `this._children` is the array of its children entity</span></div><div class='line' id='LC785'><span class="cm">     * objects (if any), and `this._parent` is its parent entity object (if any).</span></div><div class='line' id='LC786'><span class="cm">     *</span></div><div class='line' id='LC787'><span class="cm">     * As many objects as wanted can be attached, and a hierarchy of objects is</span></div><div class='line' id='LC788'><span class="cm">     * possible by attaching.</span></div><div class='line' id='LC789'><span class="cm">     */</span></div><div class='line' id='LC790'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">attach</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">arg</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">,</span></div><div class='line' id='LC793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC794'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC795'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_parent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_parent</span><span class="p">.</span><span class="nx">detach</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC803'><br/></div><div class='line' id='LC804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC805'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC806'><br/></div><div class='line' id='LC807'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC808'><span class="cm">     * #.detach</span></div><div class='line' id='LC809'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC810'><span class="cm">     * @sign public this .detach([Entity obj])</span></div><div class='line' id='LC811'><span class="cm">     * @param obj - The entity to detach. Left blank will remove all attached entities</span></div><div class='line' id='LC812'><span class="cm">     * Stop an entity from following the current entity. Passing no arguments will stop</span></div><div class='line' id='LC813'><span class="cm">     * every entity attached.</span></div><div class='line' id='LC814'><span class="cm">     */</span></div><div class='line' id='LC815'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">detach</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC816'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC817'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if nothing passed, remove all attached objects</span></div><div class='line' id='LC818'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC819'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC820'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC821'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC822'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC823'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC824'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC825'><br/></div><div class='line' id='LC826'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if obj passed, find the handler and unbind</span></div><div class='line' id='LC827'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC828'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC829'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_children</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC831'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC832'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC833'><br/></div><div class='line' id='LC834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC835'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC836'><br/></div><div class='line' id='LC837'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC838'><span class="cm">     * #.origin</span></div><div class='line' id='LC839'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC840'><span class="cm">     * @sign public this .origin(Number x, Number y)</span></div><div class='line' id='LC841'><span class="cm">     * @param x - Pixel value of origin offset on the X axis</span></div><div class='line' id='LC842'><span class="cm">     * @param y - Pixel value of origin offset on the Y axis</span></div><div class='line' id='LC843'><span class="cm">     * @sign public this .origin(String offset)</span></div><div class='line' id='LC844'><span class="cm">     * @param offset - Combination of center, top, bottom, middle, left and right</span></div><div class='line' id='LC845'><span class="cm">     * Set the origin point of an entity for it to rotate around.</span></div><div class='line' id='LC846'><span class="cm">     *</span></div><div class='line' id='LC847'><span class="cm">     * @example</span></div><div class='line' id='LC848'><span class="cm">     * ~~~</span></div><div class='line' id='LC849'><span class="cm">     * this.origin(&quot;top left&quot;)</span></div><div class='line' id='LC850'><span class="cm">     * this.origin(&quot;center&quot;)</span></div><div class='line' id='LC851'><span class="cm">     * this.origin(&quot;bottom right&quot;)</span></div><div class='line' id='LC852'><span class="cm">     * this.origin(&quot;middle right&quot;)</span></div><div class='line' id='LC853'><span class="cm">     * ~~~</span></div><div class='line' id='LC854'><span class="cm">     *</span></div><div class='line' id='LC855'><span class="cm">     * @see .rotation</span></div><div class='line' id='LC856'><span class="cm">     */</span></div><div class='line' id='LC857'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">origin</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC858'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//text based origin</span></div><div class='line' id='LC859'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC860'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;centre&quot;</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;center&quot;</span> <span class="o">||</span> <span class="nx">x</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC861'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC862'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC863'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC864'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span></div><div class='line' id='LC865'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;top&quot;</span><span class="p">)</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC866'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;bottom&quot;</span><span class="p">)</span> <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC867'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;middle&quot;</span> <span class="o">||</span> <span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;center&quot;</span> <span class="o">||</span> <span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;centre&quot;</span><span class="p">)</span> <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC868'><br/></div><div class='line' id='LC869'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;center&quot;</span> <span class="o">||</span> <span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;centre&quot;</span> <span class="o">||</span> <span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;middle&quot;</span><span class="p">)</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC870'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC871'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC873'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC874'><br/></div><div class='line' id='LC875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC877'><br/></div><div class='line' id='LC878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC879'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC880'><br/></div><div class='line' id='LC881'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC882'><span class="cm">     * #.flip</span></div><div class='line' id='LC883'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC884'><span class="cm">     * @trigger Invalidate - when the entity has flipped</span></div><div class='line' id='LC885'><span class="cm">     * @sign public this .flip(String dir)</span></div><div class='line' id='LC886'><span class="cm">     * @param dir - Flip direction</span></div><div class='line' id='LC887'><span class="cm">     *</span></div><div class='line' id='LC888'><span class="cm">     * Flip entity on passed direction</span></div><div class='line' id='LC889'><span class="cm">     *</span></div><div class='line' id='LC890'><span class="cm">     * @example</span></div><div class='line' id='LC891'><span class="cm">     * ~~~</span></div><div class='line' id='LC892'><span class="cm">     * this.flip(&quot;X&quot;)</span></div><div class='line' id='LC893'><span class="cm">     * ~~~</span></div><div class='line' id='LC894'><span class="cm">     */</span></div><div class='line' id='LC895'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">flip</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dir</span> <span class="o">=</span> <span class="nx">dir</span> <span class="o">||</span> <span class="s2">&quot;X&quot;</span><span class="p">;</span></div><div class='line' id='LC897'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">[</span><span class="s2">&quot;_flip&quot;</span> <span class="o">+</span> <span class="nx">dir</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC898'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="s2">&quot;_flip&quot;</span> <span class="o">+</span> <span class="nx">dir</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC899'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC902'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC903'><br/></div><div class='line' id='LC904'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC905'><span class="cm">     * #.unflip</span></div><div class='line' id='LC906'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC907'><span class="cm">     * @trigger Invalidate - when the entity has unflipped</span></div><div class='line' id='LC908'><span class="cm">     * @sign public this .unflip(String dir)</span></div><div class='line' id='LC909'><span class="cm">     * @param dir - Unflip direction</span></div><div class='line' id='LC910'><span class="cm">     *</span></div><div class='line' id='LC911'><span class="cm">     * Unflip entity on passed direction (if it&#39;s flipped)</span></div><div class='line' id='LC912'><span class="cm">     *</span></div><div class='line' id='LC913'><span class="cm">     * @example</span></div><div class='line' id='LC914'><span class="cm">     * ~~~</span></div><div class='line' id='LC915'><span class="cm">     * this.unflip(&quot;X&quot;)</span></div><div class='line' id='LC916'><span class="cm">     * ~~~</span></div><div class='line' id='LC917'><span class="cm">     */</span></div><div class='line' id='LC918'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unflip</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dir</span> <span class="o">=</span> <span class="nx">dir</span> <span class="o">||</span> <span class="s2">&quot;X&quot;</span><span class="p">;</span></div><div class='line' id='LC920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="s2">&quot;_flip&quot;</span> <span class="o">+</span> <span class="nx">dir</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="s2">&quot;_flip&quot;</span> <span class="o">+</span> <span class="nx">dir</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC925'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC926'><br/></div><div class='line' id='LC927'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC928'><span class="cm">     * Method for rotation rather than through a setter</span></div><div class='line' id='LC929'><span class="cm">     */</span></div><div class='line' id='LC930'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC931'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">;</span></div><div class='line' id='LC932'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x2</span> <span class="o">=</span>  <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">cos</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sin</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span></div><div class='line' id='LC933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y2</span> <span class="o">=</span>  <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">cos</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sin</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_rotation&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">deg</span><span class="p">);</span></div><div class='line' id='LC935'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="nx">x2</span> <span class="p">);</span></div><div class='line' id='LC936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="nx">y2</span> <span class="p">);</span></div><div class='line' id='LC937'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC938'><br/></div><div class='line' id='LC939'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC940'><span class="cm">     * #._attr</span></div><div class='line' id='LC941'><span class="cm">     * @comp 2D</span></div><div class='line' id='LC942'><span class="cm">     * Setter method for all 2D properties including</span></div><div class='line' id='LC943'><span class="cm">     * x, y, w, h, alpha, rotation and visible.</span></div><div class='line' id='LC944'><span class="cm">     */</span></div><div class='line' id='LC945'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_attr</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC946'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Return if there is no change</span></div><div class='line' id='LC947'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC948'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//keep a reference of the old positions</span></div><div class='line' id='LC951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">_rectPool</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC952'><br/></div><div class='line' id='LC953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">mbr</span><span class="p">;</span></div><div class='line' id='LC954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if rotation, use the rotate method</span></div><div class='line' id='LC955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_rotation&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_rotate</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// _rotate triggers &quot;Rotate&quot;</span></div><div class='line' id='LC957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//set the global Z and trigger reorder just in case</span></div><div class='line' id='LC958'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_z&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC959'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_globalZ</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">zeroFill</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">//magic number 10^5 is the max num of entities</span></div><div class='line' id='LC960'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;reorder&quot;</span><span class="p">);</span></div><div class='line' id='LC961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if the rect bounds change, update the MBR and trigger move</span></div><div class='line' id='LC962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_x&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_y&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// mbr is the minimal bounding rectangle of the entity</span></div><div class='line' id='LC964'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">;</span></div><div class='line' id='LC965'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">mbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">-=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">-</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// cbr is a non-minmal bounding rectangle that contains both hitbox and mbr</span></div><div class='line' id='LC968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// It will exist only when the collision hitbox sits outside the entity</span></div><div class='line' id='LC969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span><span class="p">){</span></div><div class='line' id='LC970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">-=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">-</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC974'><br/></div><div class='line' id='LC975'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Move&quot;</span><span class="p">,</span> <span class="nx">old</span><span class="p">);</span></div><div class='line' id='LC976'><br/></div><div class='line' id='LC977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_h&#39;</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_w&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mbr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">;</span></div><div class='line' id='LC979'><br/></div><div class='line' id='LC980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oldValue</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span></div><div class='line' id='LC981'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC982'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">mbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC983'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC984'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_w&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">axis</span><span class="o">:</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span></div><div class='line' id='LC988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">amount</span><span class="o">:</span> <span class="nx">value</span> <span class="o">-</span> <span class="nx">oldValue</span></div><div class='line' id='LC989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_h&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC992'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">axis</span><span class="o">:</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span></div><div class='line' id='LC993'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">amount</span><span class="o">:</span> <span class="nx">value</span> <span class="o">-</span> <span class="nx">oldValue</span></div><div class='line' id='LC994'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC995'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC996'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Move&quot;</span><span class="p">,</span> <span class="nx">old</span><span class="p">);</span></div><div class='line' id='LC997'><br/></div><div class='line' id='LC998'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC999'><br/></div><div class='line' id='LC1000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//everything will assume the value</span></div><div class='line' id='LC1001'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC1002'><br/></div><div class='line' id='LC1003'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// flag for redraw</span></div><div class='line' id='LC1004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC1005'><br/></div><div class='line' id='LC1006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">_rectPool</span><span class="p">.</span><span class="nx">recycle</span><span class="p">(</span><span class="nx">old</span><span class="p">);</span></div><div class='line' id='LC1007'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1008'><span class="p">});</span></div><div class='line' id='LC1009'><br/></div><div class='line' id='LC1010'><span class="cm">/**@</span></div><div class='line' id='LC1011'><span class="cm"> * #Gravity</span></div><div class='line' id='LC1012'><span class="cm"> * @category 2D</span></div><div class='line' id='LC1013'><span class="cm"> * @trigger Moved - When entity has moved on y-axis a Moved event is triggered with an object specifying the old position {x: old_x, y: old_y}</span></div><div class='line' id='LC1014'><span class="cm"> * </span></div><div class='line' id='LC1015'><span class="cm"> * Adds gravitational pull to the entity.</span></div><div class='line' id='LC1016'><span class="cm"> */</span></div><div class='line' id='LC1017'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Gravity&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1018'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_gravityConst</span><span class="o">:</span> <span class="mf">0.2</span><span class="p">,</span></div><div class='line' id='LC1019'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_gy</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1020'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_falling</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC1021'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_anti</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC1022'><br/></div><div class='line' id='LC1023'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">);</span></div><div class='line' id='LC1025'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1026'><br/></div><div class='line' id='LC1027'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1028'><span class="cm">     * #.gravity</span></div><div class='line' id='LC1029'><span class="cm">     * @comp Gravity</span></div><div class='line' id='LC1030'><span class="cm">     * @sign public this .gravity([comp])</span></div><div class='line' id='LC1031'><span class="cm">     * @param comp - The name of a component that will stop this entity from falling</span></div><div class='line' id='LC1032'><span class="cm">     *</span></div><div class='line' id='LC1033'><span class="cm">     * Enable gravity for this entity no matter whether comp parameter is not specified,</span></div><div class='line' id='LC1034'><span class="cm">     * If comp parameter is specified all entities with that component will stop this entity from falling.</span></div><div class='line' id='LC1035'><span class="cm">     * For a player entity in a platform game this would be a component that is added to all entities</span></div><div class='line' id='LC1036'><span class="cm">     * that the player should be able to walk on.</span></div><div class='line' id='LC1037'><span class="cm">     *</span></div><div class='line' id='LC1038'><span class="cm">     * @example</span></div><div class='line' id='LC1039'><span class="cm">     * ~~~</span></div><div class='line' id='LC1040'><span class="cm">     * Crafty.e(&quot;2D, DOM, Color, Gravity&quot;)</span></div><div class='line' id='LC1041'><span class="cm">     *   .color(&quot;red&quot;)</span></div><div class='line' id='LC1042'><span class="cm">     *   .attr({ w: 100, h: 100 })</span></div><div class='line' id='LC1043'><span class="cm">     *   .gravity(&quot;platform&quot;);</span></div><div class='line' id='LC1044'><span class="cm">     * ~~~</span></div><div class='line' id='LC1045'><span class="cm">     */</span></div><div class='line' id='LC1046'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gravity</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">comp</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_anti</span> <span class="o">=</span> <span class="nx">comp</span><span class="p">;</span></div><div class='line' id='LC1048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//set to 0 if Twoway component is not present</span></div><div class='line' id='LC1049'><br/></div><div class='line' id='LC1050'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enterFrame</span><span class="p">);</span></div><div class='line' id='LC1051'><br/></div><div class='line' id='LC1052'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1053'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1054'><br/></div><div class='line' id='LC1055'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1056'><span class="cm">     * #.gravityConst</span></div><div class='line' id='LC1057'><span class="cm">     * @comp Gravity</span></div><div class='line' id='LC1058'><span class="cm">     * @sign public this .gravityConst(g)</span></div><div class='line' id='LC1059'><span class="cm">     * @param g - gravitational constant</span></div><div class='line' id='LC1060'><span class="cm">     *</span></div><div class='line' id='LC1061'><span class="cm">     * Set the gravitational constant to g. The default is .2. The greater g, the faster the object falls.</span></div><div class='line' id='LC1062'><span class="cm">     *</span></div><div class='line' id='LC1063'><span class="cm">     * @example</span></div><div class='line' id='LC1064'><span class="cm">     * ~~~</span></div><div class='line' id='LC1065'><span class="cm">     * Crafty.e(&quot;2D, DOM, Color, Gravity&quot;)</span></div><div class='line' id='LC1066'><span class="cm">     *   .color(&quot;red&quot;)</span></div><div class='line' id='LC1067'><span class="cm">     *   .attr({ w: 100, h: 100 })</span></div><div class='line' id='LC1068'><span class="cm">     *   .gravity(&quot;platform&quot;)</span></div><div class='line' id='LC1069'><span class="cm">     *   .gravityConst(2)</span></div><div class='line' id='LC1070'><span class="cm">     * ~~~</span></div><div class='line' id='LC1071'><span class="cm">     */</span></div><div class='line' id='LC1072'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gravityConst</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_gravityConst</span> <span class="o">=</span> <span class="nx">g</span><span class="p">;</span></div><div class='line' id='LC1074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1075'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1076'><br/></div><div class='line' id='LC1077'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_enterFrame</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_falling</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1079'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if falling, move the players Y</span></div><div class='line' id='LC1080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_gy</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_gravityConst</span><span class="p">;</span></div><div class='line' id='LC1081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_gy</span><span class="p">;</span></div><div class='line' id='LC1082'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Moved&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_gy</span> <span class="p">});</span></div><div class='line' id='LC1083'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC1084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_gy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//reset change in y</span></div><div class='line' id='LC1085'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1086'><br/></div><div class='line' id='LC1087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">hit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC1088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">(),</span></div><div class='line' id='LC1089'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">;</span></div><div class='line' id='LC1091'><br/></div><div class='line' id='LC1092'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Increase by 1 to make sure map.search() finds the floor</span></div><div class='line' id='LC1093'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC1094'><br/></div><div class='line' id='LC1095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//map.search wants _x and intersect wants x...</span></div><div class='line' id='LC1096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC1097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC1098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC1099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC1100'><br/></div><div class='line' id='LC1101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span></div><div class='line' id='LC1102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC1103'><br/></div><div class='line' id='LC1104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC1106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check for an intersection directly below the player</span></div><div class='line' id='LC1107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">!==</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_anti</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC1108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hit</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC1109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC1110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1112'><br/></div><div class='line' id='LC1113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">hit</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//stop falling if found and player is moving down</span></div><div class='line' id='LC1114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_falling</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_gy</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_up</span><span class="p">)){</span></div><div class='line' id='LC1115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">stopFalling</span><span class="p">(</span><span class="nx">hit</span><span class="p">);</span></div><div class='line' id='LC1116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC1118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_falling</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">//keep falling otherwise</span></div><div class='line' id='LC1119'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1120'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1121'><br/></div><div class='line' id='LC1122'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stopFalling</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">_y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span> <span class="c1">//move object</span></div><div class='line' id='LC1124'><br/></div><div class='line' id='LC1125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//this._gy = -1 * this._bounce;</span></div><div class='line' id='LC1126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_falling</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC1127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_up</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_up</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC1128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;hit&quot;</span><span class="p">);</span></div><div class='line' id='LC1129'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1130'><br/></div><div class='line' id='LC1131'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1132'><span class="cm">     * #.antigravity</span></div><div class='line' id='LC1133'><span class="cm">     * @comp Gravity</span></div><div class='line' id='LC1134'><span class="cm">     * @sign public this .antigravity()</span></div><div class='line' id='LC1135'><span class="cm">     * Disable gravity for this component. It can be reenabled by calling .gravity()</span></div><div class='line' id='LC1136'><span class="cm">     */</span></div><div class='line' id='LC1137'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">antigravity</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enterFrame</span><span class="p">);</span></div><div class='line' id='LC1139'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1140'><span class="p">});</span></div><div class='line' id='LC1141'><br/></div><div class='line' id='LC1142'><span class="cm">/**@</span></div><div class='line' id='LC1143'><span class="cm"> * #Crafty.polygon</span></div><div class='line' id='LC1144'><span class="cm"> * @category 2D</span></div><div class='line' id='LC1145'><span class="cm"> *</span></div><div class='line' id='LC1146'><span class="cm"> * Polygon object used for hitboxes and click maps. Must pass an Array for each point as an</span></div><div class='line' id='LC1147'><span class="cm"> * argument where index 0 is the x position and index 1 is the y position.</span></div><div class='line' id='LC1148'><span class="cm"> *</span></div><div class='line' id='LC1149'><span class="cm"> * For example one point of a polygon will look like this: `[0,5]` where the `x` is `0` and the `y` is `5`.</span></div><div class='line' id='LC1150'><span class="cm"> *</span></div><div class='line' id='LC1151'><span class="cm"> * Can pass an array of the points or simply put each point as an argument.</span></div><div class='line' id='LC1152'><span class="cm"> *</span></div><div class='line' id='LC1153'><span class="cm"> * When creating a polygon for an entity, each point should be offset or relative from the entities `x` and `y`</span></div><div class='line' id='LC1154'><span class="cm"> * (don&#39;t include the absolute values as it will automatically calculate this).</span></div><div class='line' id='LC1155'><span class="cm"> *</span></div><div class='line' id='LC1156'><span class="cm"> *</span></div><div class='line' id='LC1157'><span class="cm"> * @example</span></div><div class='line' id='LC1158'><span class="cm"> * ~~~</span></div><div class='line' id='LC1159'><span class="cm"> * new Crafty.polygon([50,0],[100,100],[0,100]);</span></div><div class='line' id='LC1160'><span class="cm"> * new Crafty.polygon([[50,0],[100,100],[0,100]]);</span></div><div class='line' id='LC1161'><span class="cm"> * ~~~</span></div><div class='line' id='LC1162'><span class="cm"> */</span></div><div class='line' id='LC1163'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">poly</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1164'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC1166'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1167'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">points</span> <span class="o">=</span> <span class="nx">poly</span><span class="p">;</span></div><div class='line' id='LC1168'><span class="p">};</span></div><div class='line' id='LC1169'><br/></div><div class='line' id='LC1170'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1171'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1172'><span class="cm">     * #.containsPoint</span></div><div class='line' id='LC1173'><span class="cm">     * @comp Crafty.polygon</span></div><div class='line' id='LC1174'><span class="cm">     * @sign public Boolean .containsPoint(Number x, Number y)</span></div><div class='line' id='LC1175'><span class="cm">     * @param x - X position of the point</span></div><div class='line' id='LC1176'><span class="cm">     * @param y - Y position of the point</span></div><div class='line' id='LC1177'><span class="cm">     *</span></div><div class='line' id='LC1178'><span class="cm">     * Method is used to determine if a given point is contained by the polygon.</span></div><div class='line' id='LC1179'><span class="cm">     *</span></div><div class='line' id='LC1180'><span class="cm">     * @example</span></div><div class='line' id='LC1181'><span class="cm">     * ~~~</span></div><div class='line' id='LC1182'><span class="cm">     * var poly = new Crafty.polygon([50,0],[100,100],[0,100]);</span></div><div class='line' id='LC1183'><span class="cm">     * poly.containsPoint(50, 50); //TRUE</span></div><div class='line' id='LC1184'><span class="cm">     * poly.containsPoint(0, 0); //FALSE</span></div><div class='line' id='LC1185'><span class="cm">     * ~~~</span></div><div class='line' id='LC1186'><span class="cm">     */</span></div><div class='line' id='LC1187'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">containsPoint</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">,</span></div><div class='line' id='LC1189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC1190'><br/></div><div class='line' id='LC1191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(((</span><span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">y</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">y</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nx">p</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span></div><div class='line' id='LC1193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="o">!</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC1194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1196'><br/></div><div class='line' id='LC1197'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC1198'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1199'><br/></div><div class='line' id='LC1200'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1201'><span class="cm">     * #.shift</span></div><div class='line' id='LC1202'><span class="cm">     * @comp Crafty.polygon</span></div><div class='line' id='LC1203'><span class="cm">     * @sign public void .shift(Number x, Number y)</span></div><div class='line' id='LC1204'><span class="cm">     * @param x - Amount to shift the `x` axis</span></div><div class='line' id='LC1205'><span class="cm">     * @param y - Amount to shift the `y` axis</span></div><div class='line' id='LC1206'><span class="cm">     *</span></div><div class='line' id='LC1207'><span class="cm">     * Shifts every single point in the polygon by the specified amount.</span></div><div class='line' id='LC1208'><span class="cm">     *</span></div><div class='line' id='LC1209'><span class="cm">     * @example</span></div><div class='line' id='LC1210'><span class="cm">     * ~~~</span></div><div class='line' id='LC1211'><span class="cm">     * var poly = new Crafty.polygon([50,0],[100,100],[0,100]);</span></div><div class='line' id='LC1212'><span class="cm">     * poly.shift(5,5);</span></div><div class='line' id='LC1213'><span class="cm">     * //[[55,5], [105,5], [5,105]];</span></div><div class='line' id='LC1214'><span class="cm">     * ~~~</span></div><div class='line' id='LC1215'><span class="cm">     */</span></div><div class='line' id='LC1216'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shift</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC1219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC1220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC1222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC1223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1225'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1226'><br/></div><div class='line' id='LC1227'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC1230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1231'><br/></div><div class='line' id='LC1232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC1234'><br/></div><div class='line' id='LC1235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">cos</span> <span class="o">+</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sin</span><span class="p">;</span></div><div class='line' id='LC1236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">sin</span> <span class="o">+</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="nx">e</span><span class="p">.</span><span class="nx">cos</span><span class="p">;</span></div><div class='line' id='LC1237'><br/></div><div class='line' id='LC1238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC1239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1241'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1242'><span class="p">};</span></div><div class='line' id='LC1243'><br/></div><div class='line' id='LC1244'><span class="cm">/**@</span></div><div class='line' id='LC1245'><span class="cm"> * #Crafty.circle</span></div><div class='line' id='LC1246'><span class="cm"> * @category 2D</span></div><div class='line' id='LC1247'><span class="cm"> * Circle object used for hitboxes and click maps. Must pass a `x`, a `y` and a `radius` value.</span></div><div class='line' id='LC1248'><span class="cm"> *</span></div><div class='line' id='LC1249'><span class="cm"> *@example</span></div><div class='line' id='LC1250'><span class="cm"> * ~~~</span></div><div class='line' id='LC1251'><span class="cm"> * var centerX = 5,</span></div><div class='line' id='LC1252'><span class="cm"> *     centerY = 10,</span></div><div class='line' id='LC1253'><span class="cm"> *     radius = 25;</span></div><div class='line' id='LC1254'><span class="cm"> *</span></div><div class='line' id='LC1255'><span class="cm"> * new Crafty.circle(centerX, centerY, radius);</span></div><div class='line' id='LC1256'><span class="cm"> * ~~~</span></div><div class='line' id='LC1257'><span class="cm"> *</span></div><div class='line' id='LC1258'><span class="cm"> * When creating a circle for an entity, each point should be offset or relative from the entities `x` and `y`</span></div><div class='line' id='LC1259'><span class="cm"> * (don&#39;t include the absolute values as it will automatically calculate this).</span></div><div class='line' id='LC1260'><span class="cm"> */</span></div><div class='line' id='LC1261'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">circle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1262'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC1263'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1264'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span></div><div class='line' id='LC1265'><br/></div><div class='line' id='LC1266'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Creates an octagon that approximate the circle for backward compatibility.</span></div><div class='line' id='LC1267'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC1268'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">theta</span><span class="p">;</span></div><div class='line' id='LC1269'><br/></div><div class='line' id='LC1270'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">theta</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span></div><div class='line' id='LC1272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span> <span class="o">*</span> <span class="nx">radius</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span> <span class="o">*</span> <span class="nx">radius</span><span class="p">)];</span></div><div class='line' id='LC1273'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1274'><span class="p">};</span></div><div class='line' id='LC1275'><br/></div><div class='line' id='LC1276'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1277'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1278'><span class="cm">     * #.containsPoint</span></div><div class='line' id='LC1279'><span class="cm">     * @comp Crafty.circle</span></div><div class='line' id='LC1280'><span class="cm">     * @sign public Boolean .containsPoint(Number x, Number y)</span></div><div class='line' id='LC1281'><span class="cm">     * @param x - X position of the point</span></div><div class='line' id='LC1282'><span class="cm">     * @param y - Y position of the point</span></div><div class='line' id='LC1283'><span class="cm">     *</span></div><div class='line' id='LC1284'><span class="cm">     * Method is used to determine if a given point is contained by the circle.</span></div><div class='line' id='LC1285'><span class="cm">     *</span></div><div class='line' id='LC1286'><span class="cm">     * @example</span></div><div class='line' id='LC1287'><span class="cm">     * ~~~</span></div><div class='line' id='LC1288'><span class="cm">     * var circle = new Crafty.circle(0, 0, 10);</span></div><div class='line' id='LC1289'><span class="cm">     * circle.containsPoint(0, 0); //TRUE</span></div><div class='line' id='LC1290'><span class="cm">     * circle.containsPoint(50, 50); //FALSE</span></div><div class='line' id='LC1291'><span class="cm">     * ~~~</span></div><div class='line' id='LC1292'><span class="cm">     */</span></div><div class='line' id='LC1293'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">containsPoint</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">radius</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span></div><div class='line' id='LC1295'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sqrt</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">,</span></div><div class='line' id='LC1296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deltaX</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC1297'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deltaY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1298'><br/></div><div class='line' id='LC1299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">deltaX</span> <span class="o">*</span> <span class="nx">deltaX</span> <span class="o">+</span> <span class="nx">deltaY</span> <span class="o">*</span> <span class="nx">deltaY</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">radius</span> <span class="o">*</span> <span class="nx">radius</span><span class="p">);</span></div><div class='line' id='LC1300'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1301'><br/></div><div class='line' id='LC1302'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1303'><span class="cm">     * #.shift</span></div><div class='line' id='LC1304'><span class="cm">     * @comp Crafty.circle</span></div><div class='line' id='LC1305'><span class="cm">     * @sign public void .shift(Number x, Number y)</span></div><div class='line' id='LC1306'><span class="cm">     * @param x - Amount to shift the `x` axis</span></div><div class='line' id='LC1307'><span class="cm">     * @param y - Amount to shift the `y` axis</span></div><div class='line' id='LC1308'><span class="cm">     *</span></div><div class='line' id='LC1309'><span class="cm">     * Shifts the circle by the specified amount.</span></div><div class='line' id='LC1310'><span class="cm">     *</span></div><div class='line' id='LC1311'><span class="cm">     * @example</span></div><div class='line' id='LC1312'><span class="cm">     * ~~~</span></div><div class='line' id='LC1313'><span class="cm">     * var circle = new Crafty.circle(0, 0, 10);</span></div><div class='line' id='LC1314'><span class="cm">     * circle.shift(5,5);</span></div><div class='line' id='LC1315'><span class="cm">     * //{x: 5, y: 5, radius: 10};</span></div><div class='line' id='LC1316'><span class="cm">     * ~~~</span></div><div class='line' id='LC1317'><span class="cm">     */</span></div><div class='line' id='LC1318'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shift</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1319'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC1320'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1321'><br/></div><div class='line' id='LC1322'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1323'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC1324'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC1325'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1326'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC1327'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC1328'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC1329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1330'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1331'><br/></div><div class='line' id='LC1332'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rotate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We are a circle, we don&#39;t have to rotate :)</span></div><div class='line' id='LC1334'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1335'><span class="p">};</span></div><div class='line' id='LC1336'><br/></div><div class='line' id='LC1337'><br/></div><div class='line' id='LC1338'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">matrix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1339'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">mtx</span> <span class="o">=</span> <span class="nx">m</span><span class="p">;</span></div><div class='line' id='LC1340'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC1341'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC1342'><span class="p">};</span></div><div class='line' id='LC1343'><br/></div><div class='line' id='LC1344'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">matrix</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1345'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1346'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">!=</span> <span class="nx">other</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1347'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC1348'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1349'><br/></div><div class='line' id='LC1350'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC1351'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1352'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC1353'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">other</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1354'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC1355'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1356'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sum</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mtx</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">k</span><span class="p">]</span> <span class="o">*</span> <span class="nx">other</span><span class="p">.</span><span class="nx">mtx</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC1357'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1358'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">sum</span><span class="p">;</span></div><div class='line' id='LC1359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1360'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1361'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">matrix</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span></div><div class='line' id='LC1362'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1363'><br/></div><div class='line' id='LC1364'><br/></div><div class='line' id='LC1365'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1366'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//test if out of bounds</span></div><div class='line' id='LC1367'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">row</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">row</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">mtx</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">col</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">col</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">mtx</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC1368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mtx</span><span class="p">[</span><span class="nx">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC1369'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1370'><span class="p">};</span></div><div class='line' id='LC1371'><br/></div><div class='line' id='LC1372'><span class="p">},{</span><span class="s2">&quot;./HashMap.js&quot;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">2</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC1373'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC1374'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC1375'><br/></div><div class='line' id='LC1376'><span class="cm">/**@</span></div><div class='line' id='LC1377'><span class="cm"> * #DOM</span></div><div class='line' id='LC1378'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC1379'><span class="cm"> * Draws entities as DOM nodes, specifically `&lt;DIV&gt;`s.</span></div><div class='line' id='LC1380'><span class="cm"> */</span></div><div class='line' id='LC1381'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;DOM&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1382'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1383'><span class="cm">     * #._element</span></div><div class='line' id='LC1384'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1385'><span class="cm">     * The DOM element used to represent the entity.</span></div><div class='line' id='LC1386'><span class="cm">     */</span></div><div class='line' id='LC1387'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_element</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC1388'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//holds current styles, so we can check if there are changes to be written to the DOM</span></div><div class='line' id='LC1389'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_cssStyles</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC1390'><br/></div><div class='line' id='LC1391'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1392'><span class="cm">     * #.avoidCss3dTransforms</span></div><div class='line' id='LC1393'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1394'><span class="cm">     * Avoids using of CSS 3D Transform for positioning when true. Default value is false.</span></div><div class='line' id='LC1395'><span class="cm">     */</span></div><div class='line' id='LC1396'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">avoidCss3dTransforms</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC1397'><br/></div><div class='line' id='LC1398'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">visibility</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">left</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">top</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1405'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">zIndex</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1406'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">opacity</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1407'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">transformOrigin</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC1408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">transform</span><span class="o">:</span> <span class="s1">&#39;&#39;</span></div><div class='line' id='LC1409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC1410'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span></div><div class='line' id='LC1411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">);</span></div><div class='line' id='LC1412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">;</span></div><div class='line' id='LC1413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;ent&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC1414'><br/></div><div class='line' id='LC1415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1416'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_changed</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC1418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">addDom</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC1419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1420'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC1421'><br/></div><div class='line' id='LC1422'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">updateClass</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1423'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1424'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">,</span></div><div class='line' id='LC1425'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC1426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1427'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC1428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1429'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC1430'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">str</span><span class="p">;</span></div><div class='line' id='LC1431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1432'><br/></div><div class='line' id='LC1433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">removeClass</span><span class="p">(</span><span class="nx">removedComponent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1434'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1435'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">,</span></div><div class='line' id='LC1436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC1437'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">!=</span> <span class="nx">removedComponent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC1440'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC1443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">str</span><span class="p">;</span></div><div class='line' id='LC1444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1445'><br/></div><div class='line' id='LC1446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;NewComponent&quot;</span><span class="p">,</span> <span class="nx">updateClass</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="nx">removeClass</span><span class="p">);</span></div><div class='line' id='LC1447'><br/></div><div class='line' id='LC1448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">undraw</span><span class="p">);</span></div><div class='line' id='LC1449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">compName</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">compName</span> <span class="o">===</span> <span class="s2">&quot;DOM&quot;</span><span class="p">)</span></div><div class='line' id='LC1451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">undraw</span><span class="p">();</span></div><div class='line' id='LC1452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC1453'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1454'><br/></div><div class='line' id='LC1455'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1456'><span class="cm">     * #.getDomId</span></div><div class='line' id='LC1457'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1458'><span class="cm">     * @sign public this .getId()</span></div><div class='line' id='LC1459'><span class="cm">     *</span></div><div class='line' id='LC1460'><span class="cm">     * Get the Id of the DOM element used to represent the entity.</span></div><div class='line' id='LC1461'><span class="cm">     */</span></div><div class='line' id='LC1462'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">getDomId</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1463'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></div><div class='line' id='LC1464'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1465'><br/></div><div class='line' id='LC1466'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1467'><span class="cm">     * #.DOM</span></div><div class='line' id='LC1468'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1469'><span class="cm">     * @trigger Draw - when the entity is ready to be drawn to the stage - { style:String, type:&quot;DOM&quot;, co}</span></div><div class='line' id='LC1470'><span class="cm">     * @sign public this .DOM(HTMLElement elem)</span></div><div class='line' id='LC1471'><span class="cm">     * @param elem - HTML element that will replace the dynamically created one</span></div><div class='line' id='LC1472'><span class="cm">     *</span></div><div class='line' id='LC1473'><span class="cm">     * Pass a DOM element to use rather than one created. Will set `._element` to this value. Removes the old element.</span></div><div class='line' id='LC1474'><span class="cm">     */</span></div><div class='line' id='LC1475'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DOM</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1476'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">&amp;&amp;</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1477'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">undraw</span><span class="p">();</span></div><div class='line' id='LC1478'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span></div><div class='line' id='LC1479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span></div><div class='line' id='LC1480'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1482'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1483'><br/></div><div class='line' id='LC1484'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1485'><span class="cm">     * #.draw</span></div><div class='line' id='LC1486'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1487'><span class="cm">     * @sign public this .draw(void)</span></div><div class='line' id='LC1488'><span class="cm">     *</span></div><div class='line' id='LC1489'><span class="cm">     * Updates the CSS properties of the node to draw on the stage.</span></div><div class='line' id='LC1490'><span class="cm">     */</span></div><div class='line' id='LC1491'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span></div><div class='line' id='LC1493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">||</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC1494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC1496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></div><div class='line' id='LC1497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span><span class="o">:</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span></div><div class='line' id='LC1498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="o">:</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span></div><div class='line' id='LC1499'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prefix</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span></div><div class='line' id='LC1501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trans</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC1502'><br/></div><div class='line' id='LC1503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_visible</span><span class="p">;</span></div><div class='line' id='LC1505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_visible</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span></div><div class='line' id='LC1507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC1508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">&quot;visible&quot;</span><span class="p">;</span></div><div class='line' id='LC1509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1511'><br/></div><div class='line' id='LC1512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//utilize CSS3 if supported</span></div><div class='line' id='LC1513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">css3dtransform</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">avoidCss3dTransforms</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trans</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;translate3d(&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="o">~~</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px,&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="o">~~</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px,0)&quot;</span><span class="p">);</span></div><div class='line' id='LC1515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC1516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">left</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC1518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="o">~~</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">top</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC1522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="o">~~</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1525'><br/></div><div class='line' id='LC1526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">width</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC1528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="o">~~</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1529'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1530'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">height</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC1532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="o">~~</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1533'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1535'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">;</span></div><div class='line' id='LC1536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">;</span></div><div class='line' id='LC1537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1538'><br/></div><div class='line' id='LC1539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC1541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC1542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;Opacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC1543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1544'><br/></div><div class='line' id='LC1545'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1546'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">origin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s2">&quot;px &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1547'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">transformOrigin</span> <span class="o">=</span> <span class="nx">origin</span><span class="p">;</span></div><div class='line' id='LC1548'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;TransformOrigin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">origin</span><span class="p">;</span></div><div class='line' id='LC1549'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">css3dtransform</span><span class="p">)</span> <span class="nx">trans</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;rotateZ(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">+</span> <span class="s2">&quot;deg)&quot;</span><span class="p">);</span></div><div class='line' id='LC1550'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">trans</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;rotate(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">+</span> <span class="s2">&quot;deg)&quot;</span><span class="p">);</span></div><div class='line' id='LC1551'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1552'><br/></div><div class='line' id='LC1553'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1554'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trans</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;scaleX(-1)&quot;</span><span class="p">);</span></div><div class='line' id='LC1555'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1556'><br/></div><div class='line' id='LC1557'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1558'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trans</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;scaleY(-1)&quot;</span><span class="p">);</span></div><div class='line' id='LC1559'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1560'><br/></div><div class='line' id='LC1561'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">transform</span> <span class="o">!=</span> <span class="nx">trans</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC1562'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="nx">trans</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span></div><div class='line' id='LC1563'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">transform</span><span class="p">;</span></div><div class='line' id='LC1564'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cssStyles</span><span class="p">.</span><span class="nx">transform</span><span class="p">;</span></div><div class='line' id='LC1565'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1566'><br/></div><div class='line' id='LC1567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="o">:</span> <span class="nx">style</span><span class="p">,</span></div><div class='line' id='LC1569'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;DOM&quot;</span><span class="p">,</span></div><div class='line' id='LC1570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="o">:</span> <span class="nx">co</span></div><div class='line' id='LC1571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC1572'><br/></div><div class='line' id='LC1573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1574'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1575'><br/></div><div class='line' id='LC1576'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1577'><span class="cm">     * #.undraw</span></div><div class='line' id='LC1578'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1579'><span class="cm">     * @sign public this .undraw(void)</span></div><div class='line' id='LC1580'><span class="cm">     *</span></div><div class='line' id='LC1581'><span class="cm">     * Removes the element from the stage.</span></div><div class='line' id='LC1582'><span class="cm">     */</span></div><div class='line' id='LC1583'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">undraw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1584'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1585'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">);</span></div><div class='line' id='LC1586'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1587'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1588'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1589'><br/></div><div class='line' id='LC1590'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1591'><span class="cm">     * #.css</span></div><div class='line' id='LC1592'><span class="cm">     * @comp DOM</span></div><div class='line' id='LC1593'><span class="cm">     * @sign public css(String property, String value)</span></div><div class='line' id='LC1594'><span class="cm">     * @param property - CSS property to modify</span></div><div class='line' id='LC1595'><span class="cm">     * @param value - Value to give the CSS property</span></div><div class='line' id='LC1596'><span class="cm">     *</span></div><div class='line' id='LC1597'><span class="cm">     * @sign public  css(Object map)</span></div><div class='line' id='LC1598'><span class="cm">     * @param map - Object where the key is the CSS property and the value is CSS value</span></div><div class='line' id='LC1599'><span class="cm">     *</span></div><div class='line' id='LC1600'><span class="cm">     * Apply CSS styles to the element.</span></div><div class='line' id='LC1601'><span class="cm">     *</span></div><div class='line' id='LC1602'><span class="cm">     * Can pass an object where the key is the style property and the value is style value.</span></div><div class='line' id='LC1603'><span class="cm">     *</span></div><div class='line' id='LC1604'><span class="cm">     * For setting one style, simply pass the style as the first argument and the value as the second.</span></div><div class='line' id='LC1605'><span class="cm">     *</span></div><div class='line' id='LC1606'><span class="cm">     * The notation can be CSS or JS (e.g. `text-align` or `textAlign`).</span></div><div class='line' id='LC1607'><span class="cm">     *</span></div><div class='line' id='LC1608'><span class="cm">     * To return a value, pass the property.</span></div><div class='line' id='LC1609'><span class="cm">     *</span></div><div class='line' id='LC1610'><span class="cm">     * Note: For entities with &quot;Text&quot; component, some css properties are controlled by separate functions</span></div><div class='line' id='LC1611'><span class="cm">     * `.textFont()` and `.textColor()`, and ignore `.css()` settings. See Text component for details.</span></div><div class='line' id='LC1612'><span class="cm">     *</span></div><div class='line' id='LC1613'><span class="cm">     * @example</span></div><div class='line' id='LC1614'><span class="cm">     * ~~~</span></div><div class='line' id='LC1615'><span class="cm">     * this.css({&#39;text-align&#39;, &#39;center&#39;, &#39;text-decoration&#39;: &#39;line-through&#39;});</span></div><div class='line' id='LC1616'><span class="cm">     * this.css(&quot;textAlign&quot;, &quot;center&quot;);</span></div><div class='line' id='LC1617'><span class="cm">     * this.css(&quot;text-align&quot;); //returns center</span></div><div class='line' id='LC1618'><span class="cm">     * ~~~</span></div><div class='line' id='LC1619'><span class="cm">     */</span></div><div class='line' id='LC1620'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">css</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">key</span><span class="p">,</span></div><div class='line' id='LC1622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">,</span></div><div class='line' id='LC1623'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">val</span><span class="p">,</span></div><div class='line' id='LC1624'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span></div><div class='line' id='LC1625'><br/></div><div class='line' id='LC1626'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if an object passed</span></div><div class='line' id='LC1627'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1628'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1629'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC1630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">val</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC1631'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="nx">val</span> <span class="o">+=</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span></div><div class='line' id='LC1632'><br/></div><div class='line' id='LC1633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="nx">key</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span></div><div class='line' id='LC1634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1635'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC1636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if a value is passed, set the property</span></div><div class='line' id='LC1637'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1638'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="nx">value</span> <span class="o">+=</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span></div><div class='line' id='LC1639'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="nx">obj</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC1640'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//otherwise return the computed property</span></div><div class='line' id='LC1641'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC1642'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1643'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1644'><br/></div><div class='line' id='LC1645'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC1646'><br/></div><div class='line' id='LC1647'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1648'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1649'><span class="p">});</span></div><div class='line' id='LC1650'><br/></div><div class='line' id='LC1651'><br/></div><div class='line' id='LC1652'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC1653'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1654'><span class="cm">     * #Crafty.DOM</span></div><div class='line' id='LC1655'><span class="cm">     * @category Graphics</span></div><div class='line' id='LC1656'><span class="cm">     *</span></div><div class='line' id='LC1657'><span class="cm">     * Collection of utilities for using the DOM.</span></div><div class='line' id='LC1658'><span class="cm">     */</span></div><div class='line' id='LC1659'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DOM</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC1660'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1661'><span class="cm">         * #Crafty.DOM.window</span></div><div class='line' id='LC1662'><span class="cm">         * @comp Crafty.DOM</span></div><div class='line' id='LC1663'><span class="cm">         *</span></div><div class='line' id='LC1664'><span class="cm">         * Object with `width` and `height` values representing the width</span></div><div class='line' id='LC1665'><span class="cm">         * and height of the `window`.</span></div><div class='line' id='LC1666'><span class="cm">         */</span></div><div class='line' id='LC1667'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC1668'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1669'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">||</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">);</span></div><div class='line' id='LC1670'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">||</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">);</span></div><div class='line' id='LC1671'><br/></div><div class='line' id='LC1672'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Bind scene rendering (see drawing.js)</span></div><div class='line' id='LC1673'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">renderDOM</span><span class="p">);</span></div><div class='line' id='LC1674'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Resize the viewport</span></div><div class='line' id='LC1675'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resize</span><span class="p">);</span></div><div class='line' id='LC1676'><br/></div><div class='line' id='LC1677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1678'><br/></div><div class='line' id='LC1679'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_resize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC1680'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1681'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC1682'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1683'><br/></div><div class='line' id='LC1684'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1685'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC1686'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1687'><br/></div><div class='line' id='LC1688'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1689'><span class="cm">         * #Crafty.DOM.inner</span></div><div class='line' id='LC1690'><span class="cm">         * @comp Crafty.DOM</span></div><div class='line' id='LC1691'><span class="cm">         * @sign public Object Crafty.DOM.inner(HTMLElement obj)</span></div><div class='line' id='LC1692'><span class="cm">         * @param obj - HTML element to calculate the position</span></div><div class='line' id='LC1693'><span class="cm">         * @returns Object with `x` key being the `x` position, `y` being the `y` position</span></div><div class='line' id='LC1694'><span class="cm">         *</span></div><div class='line' id='LC1695'><span class="cm">         * Find a DOM elements position including</span></div><div class='line' id='LC1696'><span class="cm">         * padding and border.</span></div><div class='line' id='LC1697'><span class="cm">         */</span></div><div class='line' id='LC1698'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">inner</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1699'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">(),</span></div><div class='line' id='LC1700'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">),</span></div><div class='line' id='LC1701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">),</span></div><div class='line' id='LC1702'><br/></div><div class='line' id='LC1703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//border left</span></div><div class='line' id='LC1704'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">borderX</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;border-left-width&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;borderLeftWidth&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC1705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">borderY</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;border-top-width&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="s1">&#39;borderTopWidth&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC1706'><br/></div><div class='line' id='LC1707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">+=</span> <span class="nx">borderX</span><span class="p">;</span></div><div class='line' id='LC1708'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">+=</span> <span class="nx">borderY</span><span class="p">;</span></div><div class='line' id='LC1709'><br/></div><div class='line' id='LC1710'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC1711'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC1712'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">y</span></div><div class='line' id='LC1713'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC1714'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1715'><br/></div><div class='line' id='LC1716'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1717'><span class="cm">         * #Crafty.DOM.getStyle</span></div><div class='line' id='LC1718'><span class="cm">         * @comp Crafty.DOM</span></div><div class='line' id='LC1719'><span class="cm">         * @sign public Object Crafty.DOM.getStyle(HTMLElement obj, String property)</span></div><div class='line' id='LC1720'><span class="cm">         * @param obj - HTML element to find the style</span></div><div class='line' id='LC1721'><span class="cm">         * @param property - Style to return</span></div><div class='line' id='LC1722'><span class="cm">         *</span></div><div class='line' id='LC1723'><span class="cm">         * Determine the value of a style on an HTML element. Notation can be</span></div><div class='line' id='LC1724'><span class="cm">         * in either CSS or JS.</span></div><div class='line' id='LC1725'><span class="cm">         */</span></div><div class='line' id='LC1726'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">getStyle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1727'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">result</span><span class="p">;</span></div><div class='line' id='LC1728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">)</span></div><div class='line' id='LC1729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="nx">prop</span><span class="p">)];</span></div><div class='line' id='LC1730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">)</span></div><div class='line' id='LC1731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kc">null</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">csselize</span><span class="p">(</span><span class="nx">prop</span><span class="p">));</span></div><div class='line' id='LC1732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">result</span><span class="p">;</span></div><div class='line' id='LC1733'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1734'><br/></div><div class='line' id='LC1735'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC1736'><span class="cm">         * Used in the Zepto framework</span></div><div class='line' id='LC1737'><span class="cm">         *</span></div><div class='line' id='LC1738'><span class="cm">         * Converts CSS notation to JS notation</span></div><div class='line' id='LC1739'><span class="cm">         */</span></div><div class='line' id='LC1740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">camelize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-+(.)?/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">chr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1742'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">chr</span> <span class="o">?</span> <span class="nx">chr</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></div><div class='line' id='LC1743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC1744'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1745'><br/></div><div class='line' id='LC1746'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC1747'><span class="cm">         * Converts JS notation to CSS notation</span></div><div class='line' id='LC1748'><span class="cm">         */</span></div><div class='line' id='LC1749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">csselize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[A-Z]/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">chr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">chr</span> <span class="o">?</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">chr</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></div><div class='line' id='LC1752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC1753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1754'><br/></div><div class='line' id='LC1755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1756'><span class="cm">         * #Crafty.DOM.translate</span></div><div class='line' id='LC1757'><span class="cm">         * @comp Crafty.DOM</span></div><div class='line' id='LC1758'><span class="cm">         * @sign public Object Crafty.DOM.translate(Number clientX, Number clientY)</span></div><div class='line' id='LC1759'><span class="cm">         * @param clientX - clientX position in the browser screen</span></div><div class='line' id='LC1760'><span class="cm">         * @param clientY - clientY position in the browser screen</span></div><div class='line' id='LC1761'><span class="cm">         * @return Object `{x: ..., y: ...}` with Crafty coordinates.</span></div><div class='line' id='LC1762'><span class="cm">         * </span></div><div class='line' id='LC1763'><span class="cm">         * The parameters clientX and clientY are pixel coordinates within the visible</span></div><div class='line' id='LC1764'><span class="cm">         * browser window. This function translates those to Crafty coordinates (i.e.,</span></div><div class='line' id='LC1765'><span class="cm">         * the coordinates that you might apply to an entity), by taking into account</span></div><div class='line' id='LC1766'><span class="cm">         * where the stage is within the screen, what the current viewport is, etc.</span></div><div class='line' id='LC1767'><span class="cm">         */</span></div><div class='line' id='LC1768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">translate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">clientY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span></div><div class='line' id='LC1770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span></div><div class='line' id='LC1771'><br/></div><div class='line' id='LC1772'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC1773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="p">(</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span> <span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">||</span> <span class="mi">0</span> <span class="p">))</span> <span class="o">/</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC1774'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="p">(</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span> <span class="nx">doc</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">||</span> <span class="nx">body</span> <span class="o">&amp;&amp;</span> <span class="nx">body</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">||</span> <span class="mi">0</span> <span class="p">))</span> <span class="o">/</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span></div><div class='line' id='LC1775'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC1776'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1777'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1778'><span class="p">});</span></div><div class='line' id='LC1779'><br/></div><div class='line' id='LC1780'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">3</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC1781'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC1782'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC1783'><br/></div><div class='line' id='LC1784'><span class="cm">/**@</span></div><div class='line' id='LC1785'><span class="cm"> * #DebugCanvas</span></div><div class='line' id='LC1786'><span class="cm"> * @category Debug</span></div><div class='line' id='LC1787'><span class="cm"> * @trigger Draw - when the entity is ready to be drawn to the stage</span></div><div class='line' id='LC1788'><span class="cm"> * @trigger NoCanvas - if the browser does not support canvas</span></div><div class='line' id='LC1789'><span class="cm"> *</span></div><div class='line' id='LC1790'><span class="cm"> * When this component is added to an entity it will be drawn by the DebugCanvas layer.</span></div><div class='line' id='LC1791'><span class="cm"> *</span></div><div class='line' id='LC1792'><span class="cm"> * Crafty.debugCanvas.init() will be automatically called if it is not called already to initialize the canvas element.</span></div><div class='line' id='LC1793'><span class="cm"> *</span></div><div class='line' id='LC1794'><span class="cm"> * To visualise an object&#39;s MBR, use &quot;VisibleMBR&quot;.  To visualise a &quot;Collision&quot; object&#39;s hitbox, use &quot;WiredHitBox&quot; or &quot;SolidHitBox&quot;.</span></div><div class='line' id='LC1795'><span class="cm"> * @see DebugPolygon,  DebugRectangle</span></div><div class='line' id='LC1796'><span class="cm"> */</span></div><div class='line' id='LC1797'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;DebugCanvas&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1798'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">);</span></div><div class='line' id='LC1800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span></div><div class='line' id='LC1801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC1802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC1803'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_debug</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC1804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">alpha</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span></div><div class='line' id='LC1805'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lineWidth</span><span class="o">:</span> <span class="mi">1</span></div><div class='line' id='LC1806'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC1807'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onDebugRemove</span><span class="p">);</span></div><div class='line' id='LC1808'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onDebugDestroy</span><span class="p">);</span></div><div class='line' id='LC1809'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1810'><br/></div><div class='line' id='LC1811'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// When component is removed</span></div><div class='line' id='LC1812'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onDebugRemove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;DebugCanvas&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1814'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC1815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1816'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1817'><br/></div><div class='line' id='LC1818'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//When entity is destroyed</span></div><div class='line' id='LC1819'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onDebugDestroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1820'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC1821'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1822'><br/></div><div class='line' id='LC1823'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1824'><span class="cm">     * #.debugAlpha</span></div><div class='line' id='LC1825'><span class="cm">     * @comp DebugCanvas</span></div><div class='line' id='LC1826'><span class="cm">     * @sign public  .debugAlpha(Number alpha)</span></div><div class='line' id='LC1827'><span class="cm">     * @param alpha - The alpha level the component will be drawn with</span></div><div class='line' id='LC1828'><span class="cm">     */</span></div><div class='line' id='LC1829'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugAlpha</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">alpha</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">alpha</span> <span class="o">=</span> <span class="nx">alpha</span><span class="p">;</span></div><div class='line' id='LC1831'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1832'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1833'><br/></div><div class='line' id='LC1834'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1835'><span class="cm">     * #.debugFill</span></div><div class='line' id='LC1836'><span class="cm">     * @comp DebugCanvas</span></div><div class='line' id='LC1837'><span class="cm">     * @sign public  .debugFill([String fillStyle])</span></div><div class='line' id='LC1838'><span class="cm">     * @param fillStyle - The color the component will be filled with.  Defaults to &quot;red&quot;. Pass the boolean false to turn off filling.</span></div><div class='line' id='LC1839'><span class="cm">     * @example</span></div><div class='line' id='LC1840'><span class="cm">     * ~~~</span></div><div class='line' id='LC1841'><span class="cm">     * var myEntity = Crafty.e(&quot;2D, Collision, SolidHitBox &quot;).debugFill(&quot;purple&quot;)</span></div><div class='line' id='LC1842'><span class="cm">     * ~~~</span></div><div class='line' id='LC1843'><span class="cm">     */</span></div><div class='line' id='LC1844'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugFill</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fillStyle</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fillStyle</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC1846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span></div><div class='line' id='LC1847'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">fillStyle</span><span class="p">;</span></div><div class='line' id='LC1848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1849'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1850'><br/></div><div class='line' id='LC1851'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1852'><span class="cm">     * #.debugStroke</span></div><div class='line' id='LC1853'><span class="cm">     * @comp DebugCanvas</span></div><div class='line' id='LC1854'><span class="cm">     * @sign public  .debugStroke([String strokeStyle])</span></div><div class='line' id='LC1855'><span class="cm">     * @param strokeStyle - The color the component will be outlined with.  Defaults to &quot;red&quot;.  Pass the boolean false to turn this off.</span></div><div class='line' id='LC1856'><span class="cm">     * @example</span></div><div class='line' id='LC1857'><span class="cm">     * ~~~</span></div><div class='line' id='LC1858'><span class="cm">     * var myEntity = Crafty.e(&quot;2D, Collision, WiredHitBox &quot;).debugStroke(&quot;white&quot;)</span></div><div class='line' id='LC1859'><span class="cm">     * ~~~</span></div><div class='line' id='LC1860'><span class="cm">     */</span></div><div class='line' id='LC1861'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugStroke</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">strokeStyle</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1862'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">strokeStyle</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC1863'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span></div><div class='line' id='LC1864'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">strokeStyle</span><span class="p">;</span></div><div class='line' id='LC1865'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1866'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1867'><br/></div><div class='line' id='LC1868'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugDraw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1869'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ga</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span><span class="p">;</span></div><div class='line' id='LC1870'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">props</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">;</span></div><div class='line' id='LC1871'><br/></div><div class='line' id='LC1872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">alpha</span><span class="p">)</span></div><div class='line' id='LC1873'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">alpha</span><span class="p">;</span></div><div class='line' id='LC1874'><br/></div><div class='line' id='LC1875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="p">)</span></div><div class='line' id='LC1876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="p">;</span></div><div class='line' id='LC1877'><br/></div><div class='line' id='LC1878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">)</span></div><div class='line' id='LC1879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">;</span></div><div class='line' id='LC1880'><br/></div><div class='line' id='LC1881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">)</span></div><div class='line' id='LC1882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">;</span></div><div class='line' id='LC1883'><br/></div><div class='line' id='LC1884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;DebugDraw&quot;</span><span class="p">);</span></div><div class='line' id='LC1885'><br/></div><div class='line' id='LC1886'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="nx">ga</span><span class="p">;</span></div><div class='line' id='LC1887'><br/></div><div class='line' id='LC1888'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1889'><br/></div><div class='line' id='LC1890'><br/></div><div class='line' id='LC1891'><span class="p">});</span></div><div class='line' id='LC1892'><br/></div><div class='line' id='LC1893'><br/></div><div class='line' id='LC1894'><br/></div><div class='line' id='LC1895'><span class="cm">/**@</span></div><div class='line' id='LC1896'><span class="cm"> * #DebugRectangle</span></div><div class='line' id='LC1897'><span class="cm"> * @category Debug</span></div><div class='line' id='LC1898'><span class="cm"> *</span></div><div class='line' id='LC1899'><span class="cm"> * A component for rendering an object with a position and dimensions to the debug canvas.</span></div><div class='line' id='LC1900'><span class="cm"> *</span></div><div class='line' id='LC1901'><span class="cm"> *</span></div><div class='line' id='LC1902'><span class="cm"> * ~~~</span></div><div class='line' id='LC1903'><span class="cm"> * var myEntity = Crafty.e(&quot;2D, DebugRectangle&quot;)</span></div><div class='line' id='LC1904'><span class="cm"> *                      .attr({x: 13, y: 37, w: 42, h: 42})</span></div><div class='line' id='LC1905'><span class="cm"> *                      .debugStroke(&quot;green&quot;);</span></div><div class='line' id='LC1906'><span class="cm"> * myEntity.debugRectangle(myEntity)</span></div><div class='line' id='LC1907'><span class="cm"> *~~~</span></div><div class='line' id='LC1908'><span class="cm"> * @see DebugCanvas</span></div><div class='line' id='LC1909'><span class="cm"> */</span></div><div class='line' id='LC1910'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;DebugRectangle&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1911'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1912'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D, DebugCanvas&quot;</span><span class="p">);</span></div><div class='line' id='LC1913'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1914'><br/></div><div class='line' id='LC1915'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC1916'><span class="cm">     * #.debugRectangle</span></div><div class='line' id='LC1917'><span class="cm">     * @comp DebugRectangle</span></div><div class='line' id='LC1918'><span class="cm">     * @sign public  .debugRectangle(Object rect)</span></div><div class='line' id='LC1919'><span class="cm">     * @param rect - an object with _x, _y, _w, and _h to draw</span></div><div class='line' id='LC1920'><span class="cm">     * Sets the rectangle that this component draws to the debug canvas.</span></div><div class='line' id='LC1921'><span class="cm">     *</span></div><div class='line' id='LC1922'><span class="cm">     */</span></div><div class='line' id='LC1923'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugRectangle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">debugRect</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">;</span></div><div class='line' id='LC1925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;DebugDraw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawDebugRect</span><span class="p">);</span></div><div class='line' id='LC1926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;DebugDraw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawDebugRect</span><span class="p">);</span></div><div class='line' id='LC1927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC1928'><br/></div><div class='line' id='LC1929'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1930'><br/></div><div class='line' id='LC1931'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawDebugRect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1932'><br/></div><div class='line' id='LC1933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC1934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">debugRect</span><span class="p">;</span></div><div class='line' id='LC1935'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rect</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">rect</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC1936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC1937'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&amp;&amp;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC1938'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">)</span></div><div class='line' id='LC1939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC1940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="p">)</span></div><div class='line' id='LC1941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC1942'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1943'><br/></div><div class='line' id='LC1944'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1945'><br/></div><div class='line' id='LC1946'><br/></div><div class='line' id='LC1947'><br/></div><div class='line' id='LC1948'><span class="p">});</span></div><div class='line' id='LC1949'><br/></div><div class='line' id='LC1950'><br/></div><div class='line' id='LC1951'><br/></div><div class='line' id='LC1952'><span class="cm">/**@</span></div><div class='line' id='LC1953'><span class="cm"> * #VisibleMBR</span></div><div class='line' id='LC1954'><span class="cm"> * @category Debug</span></div><div class='line' id='LC1955'><span class="cm"> *</span></div><div class='line' id='LC1956'><span class="cm"> * Adding this component to an entity will cause it&#39;s MBR to be drawn to the debug canvas.</span></div><div class='line' id='LC1957'><span class="cm"> *</span></div><div class='line' id='LC1958'><span class="cm"> * The methods of DebugCanvas can be used to control this component&#39;s appearance.</span></div><div class='line' id='LC1959'><span class="cm"> * @see 2D, DebugRectangle, DebugCanvas</span></div><div class='line' id='LC1960'><span class="cm"> */</span></div><div class='line' id='LC1961'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;VisibleMBR&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1962'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;DebugRectangle&quot;</span><span class="p">)</span></div><div class='line' id='LC1964'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">debugFill</span><span class="p">(</span><span class="s2">&quot;purple&quot;</span><span class="p">)</span></div><div class='line' id='LC1965'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_assignRect</span><span class="p">);</span></div><div class='line' id='LC1966'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1967'><br/></div><div class='line' id='LC1968'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Internal method for updating the MBR drawn.</span></div><div class='line' id='LC1969'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_assignRect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">)</span></div><div class='line' id='LC1971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">debugRectangle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">);</span></div><div class='line' id='LC1972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC1973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">debugRectangle</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC1974'><br/></div><div class='line' id='LC1975'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC1976'><br/></div><div class='line' id='LC1977'><br/></div><div class='line' id='LC1978'><span class="p">});</span></div><div class='line' id='LC1979'><br/></div><div class='line' id='LC1980'><br/></div><div class='line' id='LC1981'><span class="cm">/**@</span></div><div class='line' id='LC1982'><span class="cm"> * #DebugPolygon</span></div><div class='line' id='LC1983'><span class="cm"> * @category Debug</span></div><div class='line' id='LC1984'><span class="cm"> *</span></div><div class='line' id='LC1985'><span class="cm"> * For drawing a polygon to the debug canvas</span></div><div class='line' id='LC1986'><span class="cm"> *</span></div><div class='line' id='LC1987'><span class="cm"> * The methods of DebugCanvas can be used to control this component&#39;s appearance -- by default it is neither filled nor outlined</span></div><div class='line' id='LC1988'><span class="cm"> *</span></div><div class='line' id='LC1989'><span class="cm"> * For debugging hitboxes, use WiredHitBox or SolidHitBox.  For debugging MBR, use VisibleMBR</span></div><div class='line' id='LC1990'><span class="cm"> *</span></div><div class='line' id='LC1991'><span class="cm"> * @see DebugCanvas</span></div><div class='line' id='LC1992'><span class="cm"> */</span></div><div class='line' id='LC1993'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;DebugPolygon&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC1994'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC1995'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D, DebugCanvas&quot;</span><span class="p">);</span></div><div class='line' id='LC1996'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC1997'><br/></div><div class='line' id='LC1998'><br/></div><div class='line' id='LC1999'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2000'><span class="cm">     * #.debugPolygon</span></div><div class='line' id='LC2001'><span class="cm">     * @comp DebugPolygon</span></div><div class='line' id='LC2002'><span class="cm">     * @sign public  .debugPolygon(Polygon poly)</span></div><div class='line' id='LC2003'><span class="cm">     * @param poly - a polygon to render</span></div><div class='line' id='LC2004'><span class="cm">     * Sets the polygon that this component renders to the debug canvas.</span></div><div class='line' id='LC2005'><span class="cm">     *</span></div><div class='line' id='LC2006'><span class="cm">     */</span></div><div class='line' id='LC2007'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debugPolygon</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">poly</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">polygon</span> <span class="o">=</span> <span class="nx">poly</span><span class="p">;</span></div><div class='line' id='LC2009'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;DebugDraw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawDebugPolygon</span><span class="p">);</span></div><div class='line' id='LC2010'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;DebugDraw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawDebugPolygon</span><span class="p">);</span></div><div class='line' id='LC2011'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC2012'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2013'><br/></div><div class='line' id='LC2014'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawDebugPolygon</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2015'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">polygon</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC2016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC2017'><br/></div><div class='line' id='LC2018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC2019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span></div><div class='line' id='LC2020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">polygon</span><span class="p">.</span><span class="nx">points</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">polygon</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">p</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">polygon</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">p</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span></div><div class='line' id='LC2022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span></div><div class='line' id='LC2024'><br/></div><div class='line' id='LC2025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">)</span></div><div class='line' id='LC2026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span></div><div class='line' id='LC2027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_debug</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="p">)</span></div><div class='line' id='LC2028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span></div><div class='line' id='LC2029'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2030'><span class="p">});</span></div><div class='line' id='LC2031'><br/></div><div class='line' id='LC2032'><br/></div><div class='line' id='LC2033'><span class="cm">/**@</span></div><div class='line' id='LC2034'><span class="cm"> * #WiredHitBox</span></div><div class='line' id='LC2035'><span class="cm"> * @category Debug</span></div><div class='line' id='LC2036'><span class="cm"> *</span></div><div class='line' id='LC2037'><span class="cm"> * Adding this component to an entity with a Collision component will cause its collision polygon to be drawn to the debug canvas as an outline</span></div><div class='line' id='LC2038'><span class="cm"> *</span></div><div class='line' id='LC2039'><span class="cm"> * The methods of DebugCanvas can be used to control this component&#39;s appearance.</span></div><div class='line' id='LC2040'><span class="cm"> * @see DebugPolygon, DebugCanvas</span></div><div class='line' id='LC2041'><span class="cm"> */</span></div><div class='line' id='LC2042'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;WiredHitBox&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC2043'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;DebugPolygon&quot;</span><span class="p">)</span></div><div class='line' id='LC2045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">debugStroke</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span></div><div class='line' id='LC2046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">matchHitBox</span><span class="p">();</span></div><div class='line' id='LC2047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;NewHitbox&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchHitBox</span><span class="p">);</span></div><div class='line' id='LC2048'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2049'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">matchHitBox</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2050'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">debugPolygon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span></div><div class='line' id='LC2051'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2052'><span class="p">});</span></div><div class='line' id='LC2053'><br/></div><div class='line' id='LC2054'><span class="cm">/**@</span></div><div class='line' id='LC2055'><span class="cm"> * #SolidHitBox</span></div><div class='line' id='LC2056'><span class="cm"> * @category Debug</span></div><div class='line' id='LC2057'><span class="cm"> *</span></div><div class='line' id='LC2058'><span class="cm"> * Adding this component to an entity with a Collision component will cause its collision polygon to be drawn to the debug canvas, with a default alpha level of 0.7.</span></div><div class='line' id='LC2059'><span class="cm"> *</span></div><div class='line' id='LC2060'><span class="cm"> * The methods of DebugCanvas can be used to control this component&#39;s appearance.</span></div><div class='line' id='LC2061'><span class="cm"> * @see DebugPolygon, DebugCanvas</span></div><div class='line' id='LC2062'><span class="cm"> */</span></div><div class='line' id='LC2063'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;SolidHitBox&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC2064'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2065'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;Collision, DebugPolygon&quot;</span><span class="p">)</span></div><div class='line' id='LC2066'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">debugFill</span><span class="p">(</span><span class="s2">&quot;orange&quot;</span><span class="p">).</span><span class="nx">debugAlpha</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span></div><div class='line' id='LC2067'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">matchHitBox</span><span class="p">();</span></div><div class='line' id='LC2068'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;NewHitbox&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchHitBox</span><span class="p">);</span></div><div class='line' id='LC2069'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2070'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">matchHitBox</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">debugPolygon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span></div><div class='line' id='LC2072'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2073'><span class="p">});</span></div><div class='line' id='LC2074'><br/></div><div class='line' id='LC2075'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2076'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC2077'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entities</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC2078'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onetimeEntities</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC2079'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ent</span><span class="p">);</span></div><div class='line' id='LC2081'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2082'><br/></div><div class='line' id='LC2083'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">entities</span><span class="p">;</span></div><div class='line' id='LC2085'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span></div><div class='line' id='LC2086'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">ent</span><span class="p">)</span></div><div class='line' id='LC2087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">list</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC2088'><br/></div><div class='line' id='LC2089'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2090'><br/></div><div class='line' id='LC2091'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Mostly copied from canvas.init()</span></div><div class='line' id='LC2092'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Called the first time a &quot;DebugCanvas&quot; component is added to an entity</span></div><div class='line' id='LC2093'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We should consider how to abstract the idea of multiple canvases</span></div><div class='line' id='LC2094'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if canvas is supported</span></div><div class='line' id='LC2097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NoCanvas&quot;</span><span class="p">);</span></div><div class='line' id='LC2099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC2100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC2101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2102'><br/></div><div class='line' id='LC2103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create an empty canvas element</span></div><div class='line' id='LC2104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC2105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span></div><div class='line' id='LC2106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC2107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC2108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span></div><div class='line' id='LC2109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC2110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC2111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;debug-canvas&quot;</span><span class="p">;</span></div><div class='line' id='LC2112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The debug canvas should be on the very top; the highest a regular zindex can get is ~10000</span></div><div class='line' id='LC2113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">;</span></div><div class='line' id='LC2114'><br/></div><div class='line' id='LC2115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC2116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span></div><div class='line' id='LC2117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">_canvas</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC2118'><br/></div><div class='line' id='LC2119'><br/></div><div class='line' id='LC2120'><br/></div><div class='line' id='LC2121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2122'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Bind rendering of canvas context (see drawing.js)</span></div><div class='line' id='LC2123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">renderScene</span><span class="p">);</span></div><div class='line' id='LC2124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">renderScene</span><span class="p">);</span></div><div class='line' id='LC2125'><br/></div><div class='line' id='LC2126'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2127'><br/></div><div class='line' id='LC2128'><br/></div><div class='line' id='LC2129'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// copied from drawAll()</span></div><div class='line' id='LC2130'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">renderScene</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">rect</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">rect</span><span class="p">();</span></div><div class='line' id='LC2132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">entities</span><span class="p">,</span></div><div class='line' id='LC2133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC2135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DebugCanvas</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span></div><div class='line' id='LC2136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC2137'><br/></div><div class='line' id='LC2138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span></div><div class='line' id='LC2139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC2140'><br/></div><div class='line' id='LC2141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC2142'><br/></div><div class='line' id='LC2143'><br/></div><div class='line' id='LC2144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//sort the objects by the global Z</span></div><div class='line' id='LC2145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//q.sort(zsort);</span></div><div class='line' id='LC2146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC2148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">.</span><span class="nx">debugDraw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span></div><div class='line' id='LC2149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2150'><br/></div><div class='line' id='LC2151'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2152'><br/></div><div class='line' id='LC2153'><span class="p">};</span></div><div class='line' id='LC2154'><br/></div><div class='line' id='LC2155'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">4</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC2156'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC2157'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC2158'><br/></div><div class='line' id='LC2159'><span class="cm">/**</span></div><div class='line' id='LC2160'><span class="cm"> * Spatial HashMap for broad phase collision</span></div><div class='line' id='LC2161'><span class="cm"> *</span></div><div class='line' id='LC2162'><span class="cm"> * @author Louis Stowasser</span></div><div class='line' id='LC2163'><span class="cm"> */</span></div><div class='line' id='LC2164'><br/></div><div class='line' id='LC2165'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2166'><span class="cm">     * #Crafty.HashMap.constructor</span></div><div class='line' id='LC2167'><span class="cm">     * @comp Crafty.HashMap</span></div><div class='line' id='LC2168'><span class="cm">     * @sign public void Crafty.HashMap([cellsize])</span></div><div class='line' id='LC2169'><span class="cm">     * @param cellsize - the cell size. If omitted, `cellsize` is 64.</span></div><div class='line' id='LC2170'><span class="cm">     *</span></div><div class='line' id='LC2171'><span class="cm">     * Set `cellsize`.</span></div><div class='line' id='LC2172'><span class="cm">     * And create `this.map`.</span></div><div class='line' id='LC2173'><span class="cm">     */</span></div><div class='line' id='LC2174'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cellsize</span><span class="p">,</span></div><div class='line' id='LC2175'><br/></div><div class='line' id='LC2176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cell</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cellsize</span> <span class="o">=</span> <span class="nx">cell</span> <span class="o">||</span> <span class="mi">64</span><span class="p">;</span></div><div class='line' id='LC2178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2180'><br/></div><div class='line' id='LC2181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">SPACE</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span></div><div class='line' id='LC2182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keyHolder</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2183'><br/></div><div class='line' id='LC2184'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2185'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2186'><span class="cm">         * #Crafty.map.insert</span></div><div class='line' id='LC2187'><span class="cm">         * @comp Crafty.map</span></div><div class='line' id='LC2188'><span class="cm">         * @sign public Object Crafty.map.insert(Object obj)</span></div><div class='line' id='LC2189'><span class="cm">         * @param obj - An entity to be inserted.</span></div><div class='line' id='LC2190'><span class="cm">         *</span></div><div class='line' id='LC2191'><span class="cm">         * `obj` is inserted in &#39;.map&#39; of the corresponding broad phase cells. An object of the following fields is returned.</span></div><div class='line' id='LC2192'><span class="cm">         * ~~~</span></div><div class='line' id='LC2193'><span class="cm">         * - the object that keep track of cells (keys)</span></div><div class='line' id='LC2194'><span class="cm">         * - `obj`</span></div><div class='line' id='LC2195'><span class="cm">         * - the HashMap object</span></div><div class='line' id='LC2196'><span class="cm">         * ~~~</span></div><div class='line' id='LC2197'><span class="cm">         */</span></div><div class='line' id='LC2198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">insert</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">obj</span><span class="p">),</span></div><div class='line' id='LC2200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Entry</span><span class="p">(</span><span class="nx">keys</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="k">this</span><span class="p">),</span></div><div class='line' id='LC2201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span><span class="p">,</span></div><div class='line' id='LC2203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span><span class="p">;</span></div><div class='line' id='LC2204'><br/></div><div class='line' id='LC2205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert into all x buckets</span></div><div class='line' id='LC2206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert into all y buckets</span></div><div class='line' id='LC2208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">;</span></div><div class='line' id='LC2210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">hash</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">hash</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC2211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">hash</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC2212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2214'><br/></div><div class='line' id='LC2215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entry</span><span class="p">;</span></div><div class='line' id='LC2216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2217'><br/></div><div class='line' id='LC2218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2219'><span class="cm">         * #Crafty.map.search</span></div><div class='line' id='LC2220'><span class="cm">         * @comp Crafty.map</span></div><div class='line' id='LC2221'><span class="cm">         * @sign public Object Crafty.map.search(Object rect[, Boolean filter])</span></div><div class='line' id='LC2222'><span class="cm">         * @param rect - the rectangular region to search for entities.</span></div><div class='line' id='LC2223'><span class="cm">         * @param filter - Default value is true. Otherwise, must be false.</span></div><div class='line' id='LC2224'><span class="cm">         *</span></div><div class='line' id='LC2225'><span class="cm">         * - If `filter` is `false`, just search for all the entries in the give `rect` region by broad phase collision. Entity may be returned duplicated.</span></div><div class='line' id='LC2226'><span class="cm">         * - If `filter` is `true`, filter the above results by checking that they actually overlap `rect`.</span></div><div class='line' id='LC2227'><span class="cm">         * The easier usage is with `filter`=`true`. For performance reason, you may use `filter`=`false`, and filter the result yourself. See examples in drawing.js and collision.js</span></div><div class='line' id='LC2228'><span class="cm">         */</span></div><div class='line' id='LC2229'><br/></div><div class='line' id='LC2230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">search</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="nx">keyHolder</span><span class="p">),</span></div><div class='line' id='LC2232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span></div><div class='line' id='LC2233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC2234'><br/></div><div class='line' id='LC2235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">filter</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">//default filter to true</span></div><div class='line' id='LC2236'><br/></div><div class='line' id='LC2237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//search in all x buckets</span></div><div class='line' id='LC2238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert into all y buckets</span></div><div class='line' id='LC2240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC2242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cell</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span></div><div class='line' id='LC2244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cell</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span></div><div class='line' id='LC2245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2248'><br/></div><div class='line' id='LC2249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2250'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">finalresult</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC2251'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">found</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//add unique elements to lookup table with the entity ID as unique key</span></div><div class='line' id='LC2253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC2255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">//skip if deleted</span></div><div class='line' id='LC2256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//unique ID</span></div><div class='line' id='LC2257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC2258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if not added to hash and that actually intersects</span></div><div class='line' id='LC2259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">found</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC2260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_h</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&gt;</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span></div><div class='line' id='LC2261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">found</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC2262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2263'><br/></div><div class='line' id='LC2264'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over lookup table and copy to final array</span></div><div class='line' id='LC2265'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">obj</span> <span class="k">in</span> <span class="nx">found</span><span class="p">)</span> <span class="nx">finalresult</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">found</span><span class="p">[</span><span class="nx">obj</span><span class="p">]);</span></div><div class='line' id='LC2266'><br/></div><div class='line' id='LC2267'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">finalresult</span><span class="p">;</span></div><div class='line' id='LC2268'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC2269'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">results</span><span class="p">;</span></div><div class='line' id='LC2270'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2272'><br/></div><div class='line' id='LC2273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2274'><span class="cm">         * #Crafty.map.remove</span></div><div class='line' id='LC2275'><span class="cm">         * @comp Crafty.map</span></div><div class='line' id='LC2276'><span class="cm">         * @sign public void Crafty.map.remove([Object keys, ]Object obj)</span></div><div class='line' id='LC2277'><span class="cm">         * @param keys - key region. If omitted, it will be derived from obj by `Crafty.HashMap.key`.</span></div><div class='line' id='LC2278'><span class="cm">         * @param obj - need more document.</span></div><div class='line' id='LC2279'><span class="cm">         *</span></div><div class='line' id='LC2280'><span class="cm">         * Remove an entity in a broad phase map.</span></div><div class='line' id='LC2281'><span class="cm">         * - The second form is only used in Crafty.HashMap to save time for computing keys again, where keys were computed previously from obj. End users should not call this form directly.</span></div><div class='line' id='LC2282'><span class="cm">         *</span></div><div class='line' id='LC2283'><span class="cm">         * @example</span></div><div class='line' id='LC2284'><span class="cm">         * ~~~</span></div><div class='line' id='LC2285'><span class="cm">         * Crafty.map.remove(e);</span></div><div class='line' id='LC2286'><span class="cm">         * ~~~</span></div><div class='line' id='LC2287'><span class="cm">         */</span></div><div class='line' id='LC2288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keys</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span><span class="p">,</span> <span class="nx">hash</span><span class="p">;</span></div><div class='line' id='LC2291'><br/></div><div class='line' id='LC2292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">;</span></div><div class='line' id='LC2294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span> <span class="o">=</span> <span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keyHolder</span><span class="p">);</span></div><div class='line' id='LC2295'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2296'><br/></div><div class='line' id='LC2297'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//search in all x buckets</span></div><div class='line' id='LC2298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert into all y buckets</span></div><div class='line' id='LC2300'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">;</span></div><div class='line' id='LC2302'><br/></div><div class='line' id='LC2303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">hash</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC2304'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cell</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">hash</span><span class="p">],</span></div><div class='line' id='LC2305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">m</span><span class="p">,</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC2306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over objs in cell and delete</span></div><div class='line' id='LC2307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">m</span><span class="o">++</span><span class="p">)</span></div><div class='line' id='LC2308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cell</span><span class="p">[</span><span class="nx">m</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span><span class="p">[</span><span class="nx">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div><div class='line' id='LC2309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC2310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2311'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2314'><br/></div><div class='line' id='LC2315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2316'><span class="cm">         * #Crafty.map.refresh</span></div><div class='line' id='LC2317'><span class="cm">         * @comp Crafty.map</span></div><div class='line' id='LC2318'><span class="cm">         * @sign public void Crafty.map.remove(Entry entry)</span></div><div class='line' id='LC2319'><span class="cm">         * @param entry - An entry to update</span></div><div class='line' id='LC2320'><span class="cm">         *</span></div><div class='line' id='LC2321'><span class="cm">         * Refresh an entry&#39;s keys, and its position in the broad phrase map.</span></div><div class='line' id='LC2322'><span class="cm">         *</span></div><div class='line' id='LC2323'><span class="cm">         * @example</span></div><div class='line' id='LC2324'><span class="cm">         * ~~~</span></div><div class='line' id='LC2325'><span class="cm">         * Crafty.map.refresh(e);</span></div><div class='line' id='LC2326'><span class="cm">         * ~~~</span></div><div class='line' id='LC2327'><span class="cm">         */</span></div><div class='line' id='LC2328'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">refresh</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">keys</span><span class="p">;</span></div><div class='line' id='LC2330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC2331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cell</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">n</span><span class="p">;</span></div><div class='line' id='LC2332'><br/></div><div class='line' id='LC2333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//First delete current object from appropriate cells</span></div><div class='line' id='LC2334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC2337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cell</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">n</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC2339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over objs in cell and delete</span></div><div class='line' id='LC2340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">m</span><span class="o">++</span><span class="p">)</span></div><div class='line' id='LC2341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">cell</span><span class="p">[</span><span class="nx">m</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">cell</span><span class="p">[</span><span class="nx">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div><div class='line' id='LC2342'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC2343'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2344'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2345'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2346'><br/></div><div class='line' id='LC2347'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//update keys</span></div><div class='line' id='LC2348'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keys</span><span class="p">);</span></div><div class='line' id='LC2349'><br/></div><div class='line' id='LC2350'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//insert into all rows and columns</span></div><div class='line' id='LC2351'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2352'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2353'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC2354'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cell</span><span class="p">)</span> <span class="nx">cell</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[(</span><span class="nx">i</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC2355'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cell</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC2356'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2357'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2358'><br/></div><div class='line' id='LC2359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entry</span><span class="p">;</span></div><div class='line' id='LC2360'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2361'><br/></div><div class='line' id='LC2362'><br/></div><div class='line' id='LC2363'><br/></div><div class='line' id='LC2364'><br/></div><div class='line' id='LC2365'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2366'><span class="cm">         * #Crafty.map.boundaries</span></div><div class='line' id='LC2367'><span class="cm">         * @comp Crafty.map</span></div><div class='line' id='LC2368'><span class="cm">         * @sign public Object Crafty.map.boundaries()</span></div><div class='line' id='LC2369'><span class="cm">         *</span></div><div class='line' id='LC2370'><span class="cm">         * The return `Object` is of the following format.</span></div><div class='line' id='LC2371'><span class="cm">         * ~~~</span></div><div class='line' id='LC2372'><span class="cm">         * {</span></div><div class='line' id='LC2373'><span class="cm">         *   min: {</span></div><div class='line' id='LC2374'><span class="cm">         *     x: val_x,</span></div><div class='line' id='LC2375'><span class="cm">         *     y: val_y</span></div><div class='line' id='LC2376'><span class="cm">         *   },</span></div><div class='line' id='LC2377'><span class="cm">         *   max: {</span></div><div class='line' id='LC2378'><span class="cm">         *     x: val_x,</span></div><div class='line' id='LC2379'><span class="cm">         *     y: val_y</span></div><div class='line' id='LC2380'><span class="cm">         *   }</span></div><div class='line' id='LC2381'><span class="cm">         * }</span></div><div class='line' id='LC2382'><span class="cm">         * ~~~</span></div><div class='line' id='LC2383'><span class="cm">         */</span></div><div class='line' id='LC2384'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">boundaries</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">ent</span><span class="p">,</span></div><div class='line' id='LC2386'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">max</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2388'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span></div><div class='line' id='LC2389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="o">-</span><span class="kc">Infinity</span></div><div class='line' id='LC2390'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2391'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">min</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span></div><div class='line' id='LC2393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="kc">Infinity</span></div><div class='line' id='LC2394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coords</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2397'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">max</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span></div><div class='line' id='LC2399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="o">-</span><span class="kc">Infinity</span></div><div class='line' id='LC2400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">min</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span></div><div class='line' id='LC2403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="kc">Infinity</span></div><div class='line' id='LC2404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2405'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC2406'><br/></div><div class='line' id='LC2407'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Using broad phase hash to speed up the computation of boundaries.</span></div><div class='line' id='LC2408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">h</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">].</span><span class="nx">length</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC2410'><br/></div><div class='line' id='LC2411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//broad phase coordinate</span></div><div class='line' id='LC2412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span></div><div class='line' id='LC2413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span></div><div class='line' id='LC2414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">^</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC2416'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC2419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC2420'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">k</span><span class="p">];</span></div><div class='line' id='LC2421'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//make sure that this is a Crafty entity</span></div><div class='line' id='LC2422'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ent</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;requires&#39;</span> <span class="k">in</span> <span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2423'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coords</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">w</span><span class="p">);</span></div><div class='line' id='LC2424'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2425'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2427'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC2429'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC2430'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">k</span><span class="p">];</span></div><div class='line' id='LC2431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ent</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;requires&#39;</span> <span class="k">in</span> <span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2432'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coords</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span></div><div class='line' id='LC2433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2434'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2435'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&gt;=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2437'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span></div><div class='line' id='LC2438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC2439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">k</span><span class="p">];</span></div><div class='line' id='LC2440'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ent</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;requires&#39;</span> <span class="k">in</span> <span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coords</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span></div><div class='line' id='LC2442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hash</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">j</span><span class="p">;</span></div><div class='line' id='LC2447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC2448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">k</span><span class="p">];</span></div><div class='line' id='LC2449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ent</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;requires&#39;</span> <span class="k">in</span> <span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coords</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">coords</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC2451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2455'><br/></div><div class='line' id='LC2456'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">coords</span><span class="p">;</span></div><div class='line' id='LC2457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2458'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC2459'><br/></div><div class='line' id='LC2460'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2461'><span class="cm">     * #Crafty.HashMap</span></div><div class='line' id='LC2462'><span class="cm">     * @category 2D</span></div><div class='line' id='LC2463'><span class="cm">     * Broad-phase collision detection engine. See background information at</span></div><div class='line' id='LC2464'><span class="cm">     *</span></div><div class='line' id='LC2465'><span class="cm">     * - [N Tutorial B - Broad-Phase Collision](http://www.metanetsoftware.com/technique/tutorialB.html)</span></div><div class='line' id='LC2466'><span class="cm">     * - [Broad-Phase Collision Detection with CUDA](http.developer.nvidia.com/GPUGems3/gpugems3_ch32.html)</span></div><div class='line' id='LC2467'><span class="cm">     * @see Crafty.map</span></div><div class='line' id='LC2468'><span class="cm">     */</span></div><div class='line' id='LC2469'><br/></div><div class='line' id='LC2470'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2471'><span class="cm">     * #Crafty.HashMap.key</span></div><div class='line' id='LC2472'><span class="cm">     * @comp Crafty.HashMap</span></div><div class='line' id='LC2473'><span class="cm">     * @sign public Object Crafty.HashMap.key(Object obj)</span></div><div class='line' id='LC2474'><span class="cm">     * @param obj - an Object that has .mbr() or _x, _y, _w and _h.</span></div><div class='line' id='LC2475'><span class="cm">     * Get the rectangular region (in terms of the grid, with grid size `cellsize`), where the object may fall in. This region is determined by the object&#39;s bounding box.</span></div><div class='line' id='LC2476'><span class="cm">     * The `cellsize` is 64 by default.</span></div><div class='line' id='LC2477'><span class="cm">     *</span></div><div class='line' id='LC2478'><span class="cm">     * @see Crafty.HashMap.constructor</span></div><div class='line' id='LC2479'><span class="cm">     */</span></div><div class='line' id='LC2480'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span><span class="p">;</span></div><div class='line' id='LC2483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2487'><br/></div><div class='line' id='LC2488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_x</span> <span class="o">/</span> <span class="nx">cellsize</span><span class="p">);</span></div><div class='line' id='LC2489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_y</span> <span class="o">/</span> <span class="nx">cellsize</span><span class="p">);</span></div><div class='line' id='LC2490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_w</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_x</span><span class="p">)</span> <span class="o">/</span> <span class="nx">cellsize</span><span class="p">);</span></div><div class='line' id='LC2491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_h</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">cellsize</span><span class="p">);</span></div><div class='line' id='LC2492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">keys</span><span class="p">;</span></div><div class='line' id='LC2493'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC2494'><br/></div><div class='line' id='LC2495'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">HashMap</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x1</span> <span class="o">+</span> <span class="nx">SPACE</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y1</span> <span class="o">+</span> <span class="nx">SPACE</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">x2</span> <span class="o">+</span> <span class="nx">SPACE</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">y2</span><span class="p">;</span></div><div class='line' id='LC2497'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC2498'><br/></div><div class='line' id='LC2499'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">Entry</span><span class="p">(</span><span class="nx">keys</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">;</span></div><div class='line' id='LC2501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="nx">map</span><span class="p">;</span></div><div class='line' id='LC2502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC2503'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2504'><br/></div><div class='line' id='LC2505'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Entry</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if buckets change</span></div><div class='line' id='LC2508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">HashMap</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">HashMap</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="nx">keyHolder</span><span class="p">))</span> <span class="o">!=</span> <span class="nx">HashMap</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">keys</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC2509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC2510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2512'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC2513'><br/></div><div class='line' id='LC2514'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HashMap</span><span class="p">;</span></div><div class='line' id='LC2515'><br/></div><div class='line' id='LC2516'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">5</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC2517'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC2518'>	<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC2519'><br/></div><div class='line' id='LC2520'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2521'>	<span class="k">this</span><span class="p">.</span><span class="nx">timePerFrame</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">FPS</span><span class="p">();</span></div><div class='line' id='LC2522'>	<span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">duration</span><span class="p">;</span>   <span class="c1">//default duration given in ms</span></div><div class='line' id='LC2523'>	<span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span></div><div class='line' id='LC2524'><span class="p">};</span></div><div class='line' id='LC2525'><br/></div><div class='line' id='LC2526'><br/></div><div class='line' id='LC2527'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2528'>	<span class="nx">duration</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2529'>	<span class="nx">clock</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2530'>	<span class="nx">steps</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC2531'>	<span class="nx">complete</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC2532'>	<span class="nx">paused</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC2533'><br/></div><div class='line' id='LC2534'>	<span class="c1">// init values</span></div><div class='line' id='LC2535'>	<span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2536'>		<span class="k">this</span><span class="p">.</span><span class="nx">loops</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC2537'>		<span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC2538'>		<span class="k">this</span><span class="p">.</span><span class="nx">complete</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC2539'>		<span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC2540'>	<span class="p">},</span></div><div class='line' id='LC2541'><br/></div><div class='line' id='LC2542'>	<span class="nx">repeat</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loopCount</span><span class="p">){</span></div><div class='line' id='LC2543'>		<span class="k">this</span><span class="p">.</span><span class="nx">loops</span> <span class="o">=</span> <span class="nx">loopCount</span><span class="p">;</span></div><div class='line' id='LC2544'>	<span class="p">},</span></div><div class='line' id='LC2545'><br/></div><div class='line' id='LC2546'>	<span class="nx">setProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span> <span class="nx">loopCount</span><span class="p">){</span></div><div class='line' id='LC2547'>		<span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="nx">progress</span><span class="p">;</span></div><div class='line' id='LC2548'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">loopCount</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC2549'>			<span class="k">this</span><span class="p">.</span><span class="nx">loops</span> <span class="o">=</span> <span class="nx">loopCount</span><span class="p">;</span></div><div class='line' id='LC2550'><br/></div><div class='line' id='LC2551'>	<span class="p">},</span></div><div class='line' id='LC2552'><br/></div><div class='line' id='LC2553'>	<span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2554'>		<span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC2555'>	<span class="p">},</span></div><div class='line' id='LC2556'><br/></div><div class='line' id='LC2557'>	<span class="nx">resume</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2558'>		<span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC2559'>		<span class="k">this</span><span class="p">.</span><span class="nx">complete</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC2560'>	<span class="p">},</span></div><div class='line' id='LC2561'><br/></div><div class='line' id='LC2562'>	<span class="c1">// Increment the clock by some amount dt</span></div><div class='line' id='LC2563'>	<span class="c1">// Handles looping and sets a flag on completion</span></div><div class='line' id='LC2564'>	<span class="nx">tick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dt</span><span class="p">){</span></div><div class='line' id='LC2565'>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC2566'>		<span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">+=</span> <span class="nx">dt</span><span class="p">;</span></div><div class='line' id='LC2567'>		<span class="k">this</span><span class="p">.</span><span class="nx">frames</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clock</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">timePerFrame</span><span class="p">);</span></div><div class='line' id='LC2568'>		<span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">complete</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span></div><div class='line' id='LC2569'>			<span class="k">this</span><span class="p">.</span><span class="nx">loops</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC2570'>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC2571'>				<span class="k">this</span><span class="p">.</span><span class="nx">clock</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span></div><div class='line' id='LC2572'>			<span class="k">else</span></div><div class='line' id='LC2573'>				<span class="k">this</span><span class="p">.</span><span class="nx">complete</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC2574'>		<span class="p">}</span></div><div class='line' id='LC2575'>	<span class="p">},</span></div><div class='line' id='LC2576'><br/></div><div class='line' id='LC2577'>	<span class="c1">// same as value for now; with other time value functions would be more useful</span></div><div class='line' id='LC2578'>	<span class="nx">time</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2579'>		<span class="k">return</span> <span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clock</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">);</span></div><div class='line' id='LC2580'><br/></div><div class='line' id='LC2581'>	<span class="p">},</span></div><div class='line' id='LC2582'><br/></div><div class='line' id='LC2583'>	<span class="c1">// Value is where along the tweening curve we are</span></div><div class='line' id='LC2584'>	<span class="c1">// For now it&#39;s simply linear; but we can easily add new types</span></div><div class='line' id='LC2585'>	<span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2586'>		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">();</span></div><div class='line' id='LC2587'>	<span class="p">}</span></div><div class='line' id='LC2588'><br/></div><div class='line' id='LC2589'><span class="p">};</span></div><div class='line' id='LC2590'><br/></div><div class='line' id='LC2591'><br/></div><div class='line' id='LC2592'><br/></div><div class='line' id='LC2593'><br/></div><div class='line' id='LC2594'><br/></div><div class='line' id='LC2595'><br/></div><div class='line' id='LC2596'><br/></div><div class='line' id='LC2597'><span class="cm">/**@</span></div><div class='line' id='LC2598'><span class="cm"> * #Tween</span></div><div class='line' id='LC2599'><span class="cm"> * @category Animation</span></div><div class='line' id='LC2600'><span class="cm"> * @trigger TweenEnd - when a tween finishes - String - property</span></div><div class='line' id='LC2601'><span class="cm"> *</span></div><div class='line' id='LC2602'><span class="cm"> * Component to animate the change in 2D properties over time.</span></div><div class='line' id='LC2603'><span class="cm"> */</span></div><div class='line' id='LC2604'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Tween&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC2605'><br/></div><div class='line' id='LC2606'>	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC2607'>		<span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2608'>		<span class="k">this</span><span class="p">.</span><span class="nx">tweenStart</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2609'>		<span class="k">this</span><span class="p">.</span><span class="nx">tweens</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC2610'>		<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tweenTick</span><span class="p">);</span></div><div class='line' id='LC2611'><br/></div><div class='line' id='LC2612'>	<span class="p">},</span></div><div class='line' id='LC2613'><br/></div><div class='line' id='LC2614'>	<span class="nx">_tweenTick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">frameData</span><span class="p">){</span></div><div class='line' id='LC2615'>		<span class="kd">var</span> <span class="nx">tween</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC2616'>		<span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweens</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">){</span></div><div class='line' id='LC2617'>			<span class="nx">tween</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweens</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC2618'>			<span class="nx">tween</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="nx">frameData</span><span class="p">.</span><span class="nx">dt</span><span class="p">);</span></div><div class='line' id='LC2619'>			<span class="nx">v</span>  <span class="o">=</span> <span class="nx">tween</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span></div><div class='line' id='LC2620'>			<span class="k">this</span><span class="p">.</span><span class="nx">_doTween</span><span class="p">(</span><span class="nx">tween</span><span class="p">.</span><span class="nx">props</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC2621'>			<span class="k">if</span> <span class="p">(</span><span class="nx">tween</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2622'>				<span class="k">this</span><span class="p">.</span><span class="nx">tweens</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC2623'>				<span class="k">this</span><span class="p">.</span><span class="nx">_endTween</span><span class="p">(</span><span class="nx">tween</span><span class="p">.</span><span class="nx">props</span><span class="p">);</span></div><div class='line' id='LC2624'>			<span class="p">}</span></div><div class='line' id='LC2625'>		<span class="p">}</span></div><div class='line' id='LC2626'>	<span class="p">},</span></div><div class='line' id='LC2627'><br/></div><div class='line' id='LC2628'>	<span class="nx">_doTween</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">v</span><span class="p">){</span></div><div class='line' id='LC2629'>		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">props</span><span class="p">)</span></div><div class='line' id='LC2630'>			<span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">v</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweenStart</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">props</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span></div><div class='line' id='LC2631'><br/></div><div class='line' id='LC2632'>	<span class="p">},</span></div><div class='line' id='LC2633'><br/></div><div class='line' id='LC2634'><br/></div><div class='line' id='LC2635'><br/></div><div class='line' id='LC2636'>	<span class="cm">/**@</span></div><div class='line' id='LC2637'><span class="cm">	* #.tween</span></div><div class='line' id='LC2638'><span class="cm">	* @comp Tween</span></div><div class='line' id='LC2639'><span class="cm">	* @sign public this .tween(Object properties, Number|String duration)</span></div><div class='line' id='LC2640'><span class="cm">	* @param properties - Object of numeric properties and what they should animate to</span></div><div class='line' id='LC2641'><span class="cm">	* @param duration - Duration to animate the properties over, in milliseconds.</span></div><div class='line' id='LC2642'><span class="cm">	*</span></div><div class='line' id='LC2643'><span class="cm">	* This method will animate numeric properties over the specified duration.</span></div><div class='line' id='LC2644'><span class="cm">	* These include `x`, `y`, `w`, `h`, `alpha` and `rotation`.</span></div><div class='line' id='LC2645'><span class="cm">	*</span></div><div class='line' id='LC2646'><span class="cm">	* The object passed should have the properties as keys and the value should be the resulting</span></div><div class='line' id='LC2647'><span class="cm">	* values of the properties.  The passed object might be modified if later calls to tween animate the same properties.</span></div><div class='line' id='LC2648'><span class="cm">	*</span></div><div class='line' id='LC2649'><span class="cm">	* @example</span></div><div class='line' id='LC2650'><span class="cm">	* Move an object to 100,100 and fade out over 200 ms.</span></div><div class='line' id='LC2651'><span class="cm">	* ~~~</span></div><div class='line' id='LC2652'><span class="cm">	* Crafty.e(&quot;2D, Tween&quot;)</span></div><div class='line' id='LC2653'><span class="cm">	*    .attr({alpha: 1.0, x: 0, y: 0})</span></div><div class='line' id='LC2654'><span class="cm">	*    .tween({alpha: 0.0, x: 100, y: 100}, 200)</span></div><div class='line' id='LC2655'><span class="cm">	* ~~~</span></div><div class='line' id='LC2656'><span class="cm">	* @example</span></div><div class='line' id='LC2657'><span class="cm">	* Rotate an object over 2 seconds</span></div><div class='line' id='LC2658'><span class="cm">	* ~~~</span></div><div class='line' id='LC2659'><span class="cm">	* Crafty.e(&quot;2D, Tween&quot;)</span></div><div class='line' id='LC2660'><span class="cm">	*    .attr({rotate:0})</span></div><div class='line' id='LC2661'><span class="cm">	*    .tween({rotate:180}, 2000)</span></div><div class='line' id='LC2662'><span class="cm">	* ~~~</span></div><div class='line' id='LC2663'><span class="cm">	*</span></div><div class='line' id='LC2664'><span class="cm">	*/</span></div><div class='line' id='LC2665'>	<span class="nx">tween</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2666'><br/></div><div class='line' id='LC2667'>		<span class="kd">var</span> <span class="nx">tween</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC2668'>			<span class="nx">props</span><span class="o">:</span> <span class="nx">props</span><span class="p">,</span></div><div class='line' id='LC2669'>			<span class="nx">easing</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span></div><div class='line' id='LC2670'>		<span class="p">};</span></div><div class='line' id='LC2671'><br/></div><div class='line' id='LC2672'>		<span class="c1">// Tweens are grouped together by the original function call.</span></div><div class='line' id='LC2673'>		<span class="c1">// Individual properties must belong to only a single group</span></div><div class='line' id='LC2674'>		<span class="c1">// When a new tween starts, if it already belongs to a group, move it to the new one</span></div><div class='line' id='LC2675'>		<span class="c1">// Record the group it currently belongs to, as well as its starting coordinate.</span></div><div class='line' id='LC2676'>		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">propname</span> <span class="k">in</span> <span class="nx">props</span><span class="p">){</span></div><div class='line' id='LC2677'>			<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span><span class="p">[</span><span class="nx">propname</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC2678'>				<span class="k">this</span><span class="p">.</span><span class="nx">cancelTween</span><span class="p">(</span><span class="nx">propname</span><span class="p">);</span></div><div class='line' id='LC2679'>			<span class="k">this</span><span class="p">.</span><span class="nx">tweenStart</span><span class="p">[</span><span class="nx">propname</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">propname</span><span class="p">];</span></div><div class='line' id='LC2680'>			<span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span><span class="p">[</span><span class="nx">propname</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">;</span></div><div class='line' id='LC2681'>		<span class="p">}</span></div><div class='line' id='LC2682'>		<span class="k">this</span><span class="p">.</span><span class="nx">tweens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tween</span><span class="p">);</span></div><div class='line' id='LC2683'><br/></div><div class='line' id='LC2684'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC2685'><br/></div><div class='line' id='LC2686'>	<span class="p">},</span></div><div class='line' id='LC2687'><br/></div><div class='line' id='LC2688'>	<span class="cm">/**@</span></div><div class='line' id='LC2689'><span class="cm">	* #.cancelTween</span></div><div class='line' id='LC2690'><span class="cm">	* @comp Tween</span></div><div class='line' id='LC2691'><span class="cm">	* @sign public this .cancelTween(String target)</span></div><div class='line' id='LC2692'><span class="cm">	* @param target - The property to cancel</span></div><div class='line' id='LC2693'><span class="cm">	*</span></div><div class='line' id='LC2694'><span class="cm">	* @sign public this .cancelTween(Object target)</span></div><div class='line' id='LC2695'><span class="cm">	* @param target - An object containing the properties to cancel.</span></div><div class='line' id='LC2696'><span class="cm">	*</span></div><div class='line' id='LC2697'><span class="cm">	* Stops tweening the specified property or properties.</span></div><div class='line' id='LC2698'><span class="cm">	* Passing the object used to start the tween might be a typical use of the second signature.</span></div><div class='line' id='LC2699'><span class="cm">	*/</span></div><div class='line' id='LC2700'>	<span class="nx">cancelTween</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">){</span></div><div class='line' id='LC2701'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">){</span></div><div class='line' id='LC2702'>			<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span><span class="p">[</span><span class="nx">target</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span> <span class="p">)</span></div><div class='line' id='LC2703'>				<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span><span class="p">[</span><span class="nx">target</span><span class="p">][</span><span class="nx">target</span><span class="p">];</span></div><div class='line' id='LC2704'>		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2705'>			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">propname</span> <span class="k">in</span> <span class="nx">target</span><span class="p">)</span></div><div class='line' id='LC2706'>				<span class="k">this</span><span class="p">.</span><span class="nx">cancelTween</span><span class="p">(</span><span class="nx">propname</span><span class="p">);</span></div><div class='line' id='LC2707'>		<span class="p">}</span></div><div class='line' id='LC2708'><br/></div><div class='line' id='LC2709'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC2710'><br/></div><div class='line' id='LC2711'>	<span class="p">},</span></div><div class='line' id='LC2712'><br/></div><div class='line' id='LC2713'>	<span class="cm">/*</span></div><div class='line' id='LC2714'><span class="cm">	* Stops tweening the specified group of properties, and fires the &quot;TweenEnd&quot; event.</span></div><div class='line' id='LC2715'><span class="cm">	*/</span></div><div class='line' id='LC2716'>	<span class="nx">_endTween</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">properties</span><span class="p">){</span></div><div class='line' id='LC2717'>		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">propname</span> <span class="k">in</span> <span class="nx">properties</span><span class="p">){</span></div><div class='line' id='LC2718'>			<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">tweenGroup</span><span class="p">[</span><span class="nx">propname</span><span class="p">];</span></div><div class='line' id='LC2719'>		<span class="p">}</span></div><div class='line' id='LC2720'>		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;TweenEnd&quot;</span><span class="p">,</span> <span class="nx">properties</span><span class="p">);</span></div><div class='line' id='LC2721'>	<span class="p">}</span></div><div class='line' id='LC2722'><span class="p">});</span></div><div class='line' id='LC2723'><br/></div><div class='line' id='LC2724'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">6</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC2725'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC2726'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC2727'><br/></div><div class='line' id='LC2728'><span class="cm">/**@</span></div><div class='line' id='LC2729'><span class="cm"> * #Canvas</span></div><div class='line' id='LC2730'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC2731'><span class="cm"> * @trigger Draw - when the entity is ready to be drawn to the stage - {type: &quot;canvas&quot;, pos, co, ctx}</span></div><div class='line' id='LC2732'><span class="cm"> * @trigger NoCanvas - if the browser does not support canvas</span></div><div class='line' id='LC2733'><span class="cm"> *</span></div><div class='line' id='LC2734'><span class="cm"> * When this component is added to an entity it will be drawn to the global canvas element. The canvas element (and hence all Canvas entities) is always rendered below any DOM entities.</span></div><div class='line' id='LC2735'><span class="cm"> *</span></div><div class='line' id='LC2736'><span class="cm"> * Crafty.canvas.init() will be automatically called if it is not called already to initialize the canvas element.</span></div><div class='line' id='LC2737'><span class="cm"> *</span></div><div class='line' id='LC2738'><span class="cm"> * Create a canvas entity like this</span></div><div class='line' id='LC2739'><span class="cm"> * ~~~</span></div><div class='line' id='LC2740'><span class="cm"> * var myEntity = Crafty.e(&quot;2D, Canvas, Color&quot;)</span></div><div class='line' id='LC2741'><span class="cm"> *      .color(&quot;green&quot;)</span></div><div class='line' id='LC2742'><span class="cm"> *      .attr({x: 13, y: 37, w: 42, h: 42});</span></div><div class='line' id='LC2743'><span class="cm"> *~~~</span></div><div class='line' id='LC2744'><span class="cm"> */</span></div><div class='line' id='LC2745'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Canvas&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC2746'><br/></div><div class='line' id='LC2747'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC2750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2751'><br/></div><div class='line' id='LC2752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//increment the amount of canvas objs</span></div><div class='line' id='LC2753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">total2D</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC2754'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Allocate an object to hold this components current region</span></div><div class='line' id='LC2755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">currentRect</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC2756'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC2757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">addCanvas</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC2758'><br/></div><div class='line' id='LC2759'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//flag if changed</span></div><div class='line' id='LC2761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC2763'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">addCanvas</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC2764'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2765'><br/></div><div class='line' id='LC2766'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC2767'><br/></div><div class='line' id='LC2768'><br/></div><div class='line' id='LC2769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">total2D</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC2771'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC2772'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">addCanvas</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC2773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC2774'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2775'><br/></div><div class='line' id='LC2776'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2777'><span class="cm">     * #.draw</span></div><div class='line' id='LC2778'><span class="cm">     * @comp Canvas</span></div><div class='line' id='LC2779'><span class="cm">     * @sign public this .draw([[Context ctx, ]Number x, Number y, Number w, Number h])</span></div><div class='line' id='LC2780'><span class="cm">     * @param ctx - Canvas 2D context if drawing on another canvas is required</span></div><div class='line' id='LC2781'><span class="cm">     * @param x - X offset for drawing a segment</span></div><div class='line' id='LC2782'><span class="cm">     * @param y - Y offset for drawing a segment</span></div><div class='line' id='LC2783'><span class="cm">     * @param w - Width of the segment to draw</span></div><div class='line' id='LC2784'><span class="cm">     * @param h - Height of the segment to draw</span></div><div class='line' id='LC2785'><span class="cm">     *</span></div><div class='line' id='LC2786'><span class="cm">     * Method to draw the entity on the canvas element. Can pass rect values for redrawing a segment of the entity.</span></div><div class='line' id='LC2787'><span class="cm">     */</span></div><div class='line' id='LC2788'><br/></div><div class='line' id='LC2789'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Cache the various objects and arrays used in draw:</span></div><div class='line' id='LC2790'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawVars</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;canvas&quot;</span><span class="p">,</span></div><div class='line' id='LC2792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC2793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC2794'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coord</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC2795'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC2799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC2800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2801'><br/></div><div class='line' id='LC2802'><br/></div><div class='line' id='LC2803'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2804'><br/></div><div class='line' id='LC2805'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2806'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ready</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC2807'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2808'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC2809'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC2810'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC2811'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span></div><div class='line' id='LC2812'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC2813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2814'><br/></div><div class='line' id='LC2815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">pos</span><span class="p">;</span></div><div class='line' id='LC2816'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span></div><div class='line' id='LC2817'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span></div><div class='line' id='LC2818'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">);</span></div><div class='line' id='LC2819'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">h</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC2820'><br/></div><div class='line' id='LC2821'><br/></div><div class='line' id='LC2822'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span> <span class="o">=</span> <span class="nx">ctx</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC2823'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">||</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC2824'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">co</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">co</span><span class="p">;</span></div><div class='line' id='LC2825'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC2826'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC2827'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">||</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC2828'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">||</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span></div><div class='line' id='LC2829'><br/></div><div class='line' id='LC2830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2831'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span></div><div class='line' id='LC2832'><br/></div><div class='line' id='LC2833'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC2834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC2835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC2836'><br/></div><div class='line' id='LC2837'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">rotate</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">));</span></div><div class='line' id='LC2838'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2839'><br/></div><div class='line' id='LC2840'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span></div><div class='line' id='LC2842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">scale</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">));</span></div><div class='line' id='LC2843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span><span class="p">);</span></div><div class='line' id='LC2845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2847'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC2848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2850'><br/></div><div class='line' id='LC2851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">globalpha</span><span class="p">;</span></div><div class='line' id='LC2852'><br/></div><div class='line' id='LC2853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//draw with alpha</span></div><div class='line' id='LC2854'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">globalpha</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">globalAlpha</span><span class="p">;</span></div><div class='line' id='LC2856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span><span class="p">;</span></div><div class='line' id='LC2857'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2858'><br/></div><div class='line' id='LC2859'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC2860'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">);</span></div><div class='line' id='LC2861'><br/></div><div class='line' id='LC2862'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC2863'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span></div><div class='line' id='LC2864'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2865'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">globalpha</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2866'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="nx">globalpha</span><span class="p">;</span></div><div class='line' id='LC2867'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2868'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC2869'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2870'><span class="p">});</span></div><div class='line' id='LC2871'><br/></div><div class='line' id='LC2872'><span class="cm">/**@</span></div><div class='line' id='LC2873'><span class="cm"> * #Crafty.canvas</span></div><div class='line' id='LC2874'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC2875'><span class="cm"> *</span></div><div class='line' id='LC2876'><span class="cm"> * Collection of methods to draw on canvas.</span></div><div class='line' id='LC2877'><span class="cm"> */</span></div><div class='line' id='LC2878'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC2879'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">canvas</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC2880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2881'><span class="cm">         * #Crafty.canvas.context</span></div><div class='line' id='LC2882'><span class="cm">         * @comp Crafty.canvas</span></div><div class='line' id='LC2883'><span class="cm">         *</span></div><div class='line' id='LC2884'><span class="cm">         * This will return the 2D context of the main canvas element.</span></div><div class='line' id='LC2885'><span class="cm">         * The value returned from `Crafty.canvas._canvas.getContext(&#39;2d&#39;)`.</span></div><div class='line' id='LC2886'><span class="cm">         */</span></div><div class='line' id='LC2887'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC2888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2889'><span class="cm">         * #Crafty.canvas._canvas</span></div><div class='line' id='LC2890'><span class="cm">         * @comp Crafty.canvas</span></div><div class='line' id='LC2891'><span class="cm">         *</span></div><div class='line' id='LC2892'><span class="cm">         * Main Canvas element</span></div><div class='line' id='LC2893'><span class="cm">         */</span></div><div class='line' id='LC2894'><br/></div><div class='line' id='LC2895'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2896'><span class="cm">         * #Crafty.canvas.init</span></div><div class='line' id='LC2897'><span class="cm">         * @comp Crafty.canvas</span></div><div class='line' id='LC2898'><span class="cm">         * @sign public void Crafty.canvas.init(void)</span></div><div class='line' id='LC2899'><span class="cm">         * @trigger NoCanvas - triggered if `Crafty.support.canvas` is false</span></div><div class='line' id='LC2900'><span class="cm">         *</span></div><div class='line' id='LC2901'><span class="cm">         * Creates a `canvas` element inside `Crafty.stage.elem`. Must be called</span></div><div class='line' id='LC2902'><span class="cm">         * before any entities with the Canvas component can be drawn.</span></div><div class='line' id='LC2903'><span class="cm">         *</span></div><div class='line' id='LC2904'><span class="cm">         * This method will automatically be called if no `Crafty.canvas.context` is</span></div><div class='line' id='LC2905'><span class="cm">         * found.</span></div><div class='line' id='LC2906'><span class="cm">         */</span></div><div class='line' id='LC2907'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if canvas is supported</span></div><div class='line' id='LC2909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC2910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NoCanvas&quot;</span><span class="p">);</span></div><div class='line' id='LC2911'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC2912'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC2913'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2914'><br/></div><div class='line' id='LC2915'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create an empty canvas element</span></div><div class='line' id='LC2916'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC2917'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span></div><div class='line' id='LC2918'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC2919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC2920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span></div><div class='line' id='LC2921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC2922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC2923'><br/></div><div class='line' id='LC2924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC2925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span></div><div class='line' id='LC2926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">_canvas</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC2927'><br/></div><div class='line' id='LC2928'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Set any existing transformations</span></div><div class='line' id='LC2929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">zoom</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC2930'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span></div><div class='line' id='LC2931'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">zoom</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">);</span></div><div class='line' id='LC2932'><br/></div><div class='line' id='LC2933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Bind rendering of canvas context (see drawing.js)</span></div><div class='line' id='LC2934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">renderCanvas</span><span class="p">);</span></div><div class='line' id='LC2935'><br/></div><div class='line' id='LC2936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resize</span><span class="p">);</span></div><div class='line' id='LC2937'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2938'><br/></div><div class='line' id='LC2939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Resize the canvas element to the current viewport</span></div><div class='line' id='LC2940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_resize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">_canvas</span><span class="p">;</span></div><div class='line' id='LC2942'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC2943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC2944'><br/></div><div class='line' id='LC2945'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2946'><br/></div><div class='line' id='LC2947'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC2948'><span class="p">});</span></div><div class='line' id='LC2949'><br/></div><div class='line' id='LC2950'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">7</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC2951'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC2952'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span></div><div class='line' id='LC2953'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DEG_TO_RAD</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span></div><div class='line' id='LC2954'><br/></div><div class='line' id='LC2955'><span class="cm">/**@</span></div><div class='line' id='LC2956'><span class="cm"> * #Collision</span></div><div class='line' id='LC2957'><span class="cm"> * @category 2D</span></div><div class='line' id='LC2958'><span class="cm"> * Component to detect collision between any two convex polygons.</span></div><div class='line' id='LC2959'><span class="cm"> */</span></div><div class='line' id='LC2960'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Collision&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC2961'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2962'><span class="cm">     * #.init</span></div><div class='line' id='LC2963'><span class="cm">     * @comp Collision</span></div><div class='line' id='LC2964'><span class="cm">     * Create a rectangle polygon based on the x, y, w, h dimensions.</span></div><div class='line' id='LC2965'><span class="cm">     *</span></div><div class='line' id='LC2966'><span class="cm">     * By default, the collision hitbox will match the dimensions (x, y, w, h) and rotation of the object.</span></div><div class='line' id='LC2967'><span class="cm">     */</span></div><div class='line' id='LC2968'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">);</span></div><div class='line' id='LC2970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">collision</span><span class="p">();</span></div><div class='line' id='LC2971'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2972'><br/></div><div class='line' id='LC2973'><br/></div><div class='line' id='LC2974'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Run by Crafty when the component is removed</span></div><div class='line' id='LC2975'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC2976'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC2977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resizeMap</span><span class="p">);</span></div><div class='line' id='LC2978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_checkBounds</span><span class="p">);</span></div><div class='line' id='LC2979'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC2980'><br/></div><div class='line' id='LC2981'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC2982'><span class="cm">     * #.collision</span></div><div class='line' id='LC2983'><span class="cm">     * @comp Collision</span></div><div class='line' id='LC2984'><span class="cm">     *</span></div><div class='line' id='LC2985'><span class="cm">     * @trigger NewHitbox - when a new hitbox is assigned - Crafty.polygon</span></div><div class='line' id='LC2986'><span class="cm">     *</span></div><div class='line' id='LC2987'><span class="cm">     * @sign public this .collision([Crafty.polygon polygon])</span></div><div class='line' id='LC2988'><span class="cm">     * @param polygon - Crafty.polygon object that will act as the hit area</span></div><div class='line' id='LC2989'><span class="cm">     *</span></div><div class='line' id='LC2990'><span class="cm">     * @sign public this .collision(Array point1, .., Array pointN)</span></div><div class='line' id='LC2991'><span class="cm">     * @param point# - Array with an `x` and `y` position to generate a polygon</span></div><div class='line' id='LC2992'><span class="cm">     *</span></div><div class='line' id='LC2993'><span class="cm">     * Constructor takes a polygon or array of points to use as the hit area.</span></div><div class='line' id='LC2994'><span class="cm">     *</span></div><div class='line' id='LC2995'><span class="cm">     * The hit area (polygon) must be a convex shape and not concave</span></div><div class='line' id='LC2996'><span class="cm">     * for the collision detection to work.</span></div><div class='line' id='LC2997'><span class="cm">     *</span></div><div class='line' id='LC2998'><span class="cm">     * Points are relative to the object&#39;s position and its unrotated state.</span></div><div class='line' id='LC2999'><span class="cm">     *</span></div><div class='line' id='LC3000'><span class="cm">     * If no parameter is passed, the x, y, w, h properties of the entity will be used, and the hitbox will be resized when the entity is.</span></div><div class='line' id='LC3001'><span class="cm">     *</span></div><div class='line' id='LC3002'><span class="cm">     * If a hitbox is set that is outside of the bounds of the entity itself, there will be a small performance penalty as it is tracked separately.</span></div><div class='line' id='LC3003'><span class="cm">     *</span></div><div class='line' id='LC3004'><span class="cm">     * @example</span></div><div class='line' id='LC3005'><span class="cm">     * ~~~</span></div><div class='line' id='LC3006'><span class="cm">     * Crafty.e(&quot;2D, Collision&quot;).collision(</span></div><div class='line' id='LC3007'><span class="cm">     *     new Crafty.polygon([50,0], [100,100], [0,100])</span></div><div class='line' id='LC3008'><span class="cm">     * );</span></div><div class='line' id='LC3009'><span class="cm">     *</span></div><div class='line' id='LC3010'><span class="cm">     * Crafty.e(&quot;2D, Collision&quot;).collision([50,0], [100,100], [0,100]);</span></div><div class='line' id='LC3011'><span class="cm">     * ~~~</span></div><div class='line' id='LC3012'><span class="cm">     *</span></div><div class='line' id='LC3013'><span class="cm">     * @see Crafty.polygon</span></div><div class='line' id='LC3014'><span class="cm">     */</span></div><div class='line' id='LC3015'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">collision</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">poly</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Unbind anything bound to &quot;Resize&quot;</span></div><div class='line' id='LC3017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resizeMap</span><span class="p">);</span></div><div class='line' id='LC3018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_checkBounds</span><span class="p">);</span></div><div class='line' id='LC3019'><br/></div><div class='line' id='LC3020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC3021'><br/></div><div class='line' id='LC3022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">poly</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If no polygon is specified, then a polygon is created that matches the bounds of the entity</span></div><div class='line' id='LC3024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// It will be adjusted on a &quot;Resize&quot; event</span></div><div class='line' id='LC3025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">]);</span></div><div class='line' id='LC3026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_resizeMap</span><span class="p">);</span></div><div class='line' id='LC3027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Otherwise, we set the specified hitbox, converting from a list of arguments to a polygon if necessary</span></div><div class='line' id='LC3030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//convert args to array to create polygon</span></div><div class='line' id='LC3032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC3033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span></div><div class='line' id='LC3034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Check to see if the polygon sits outside the entity, and set _cbr appropriately</span></div><div class='line' id='LC3036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// On resize, the new bounds will be checked if necessary</span></div><div class='line' id='LC3037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_findBounds</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">points</span><span class="p">);</span></div><div class='line' id='LC3038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3039'><br/></div><div class='line' id='LC3040'><br/></div><div class='line' id='LC3041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If the entity is currently rotated, the points in the hitbox must also be rotated</span></div><div class='line' id='LC3042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rotation</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span><span class="p">.</span><span class="nx">rotate</span><span class="p">({</span></div><div class='line' id='LC3044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cos</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">),</span></div><div class='line' id='LC3045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sin</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">),</span></div><div class='line' id='LC3046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">o</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC3047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC3048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC3049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3050'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC3051'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3052'><br/></div><div class='line' id='LC3053'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Finally, assign the hitbox, and attach it to the &quot;Collision&quot; entity</span></div><div class='line' id='LC3054'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="nx">poly</span><span class="p">;</span></div><div class='line' id='LC3055'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span></div><div class='line' id='LC3056'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">shift</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC3057'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NewHitbox&quot;</span><span class="p">,</span> <span class="nx">poly</span><span class="p">);</span></div><div class='line' id='LC3058'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC3059'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3060'><br/></div><div class='line' id='LC3061'><br/></div><div class='line' id='LC3062'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If the hitbox is set by hand, it might extend beyond the entity.</span></div><div class='line' id='LC3063'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// In such a case, we need to track this separately.</span></div><div class='line' id='LC3064'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This function finds a (non-minimal) bounding circle around the hitbox.</span></div><div class='line' id='LC3065'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//</span></div><div class='line' id='LC3066'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// It uses a pretty naive algorithm to do so, for more complicated options see [wikipedia](http://en.wikipedia.org/wiki/Bounding_sphere).</span></div><div class='line' id='LC3067'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_findBounds</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">points</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3068'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">minX</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="nx">maxX</span> <span class="o">=</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span> <span class="nx">minY</span><span class="o">=</span><span class="kc">Infinity</span><span class="p">,</span> <span class="nx">maxY</span><span class="o">=-</span><span class="kc">Infinity</span><span class="p">;</span></div><div class='line' id='LC3069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">p</span><span class="p">;</span></div><div class='line' id='LC3070'><br/></div><div class='line' id='LC3071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculate the MBR of the points by finding the min/max x and y</span></div><div class='line' id='LC3072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">){</span></div><div class='line' id='LC3073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">p</span> <span class="o">=</span> <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC3074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">minX</span><span class="p">)</span></div><div class='line' id='LC3075'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">minX</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC3076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">maxX</span><span class="p">)</span></div><div class='line' id='LC3077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxX</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC3078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">minY</span><span class="p">)</span></div><div class='line' id='LC3079'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">minY</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC3080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">maxY</span><span class="p">)</span></div><div class='line' id='LC3081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxY</span> <span class="o">=</span> <span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC3082'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3083'><br/></div><div class='line' id='LC3084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This describes a circle centered on the MBR of the points, with a diameter equal to its diagonal</span></div><div class='line' id='LC3085'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// It will be used to find a rough bounding box round the points, even if they&#39;ve been rotated</span></div><div class='line' id='LC3086'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">cbr</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cx</span><span class="o">:</span> <span class="p">(</span><span class="nx">minX</span> <span class="o">+</span> <span class="nx">maxX</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC3088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cy</span><span class="o">:</span> <span class="p">(</span><span class="nx">minY</span> <span class="o">+</span> <span class="nx">maxY</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC3089'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="nx">maxX</span> <span class="o">-</span> <span class="nx">minX</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nx">maxX</span> <span class="o">-</span> <span class="nx">minX</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">maxY</span> <span class="o">-</span> <span class="nx">minY</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nx">maxY</span> <span class="o">-</span> <span class="nx">minY</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC3090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3091'><br/></div><div class='line' id='LC3092'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We need to worry about resizing, but only if resizing could possibly change whether the hitbox is in or out of bounds</span></div><div class='line' id='LC3093'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Thus if the upper-left corner is out of bounds, then there&#39;s no need to recheck on resize</span></div><div class='line' id='LC3094'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">minX</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">minY</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_checkBounds</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&lt;</span> <span class="nx">maxX</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&lt;</span> <span class="nx">maxY</span> <span class="p">){</span></div><div class='line' id='LC3097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="nx">cbr</span><span class="p">;</span></div><div class='line' id='LC3098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC3099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC3102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Resize&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_checkBounds</span><span class="p">);</span></div><div class='line' id='LC3105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC3107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If the hitbox is within the entity, _cbr is null</span></div><div class='line' id='LC3108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Otherwise, set it, and immediately calculate the bounding box.</span></div><div class='line' id='LC3109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">minX</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">minY</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">maxX</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span> <span class="nx">maxY</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">){</span></div><div class='line' id='LC3110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">=</span> <span class="nx">cbr</span><span class="p">;</span></div><div class='line' id='LC3114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_calculateMBR</span><span class="p">();</span></div><div class='line' id='LC3115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC3118'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3119'><br/></div><div class='line' id='LC3120'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The default behavior is to match the hitbox to the entity.  </span></div><div class='line' id='LC3121'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This function will change the hitbox when a &quot;Resize&quot; event triggers. </span></div><div class='line' id='LC3122'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_resizeMap</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3123'><br/></div><div class='line' id='LC3124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">rot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">*</span> <span class="nx">DEG_TO_RAD</span><span class="p">,</span></div><div class='line' id='LC3125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">points</span><span class="p">;</span></div><div class='line' id='LC3126'><br/></div><div class='line' id='LC3127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Depending on the change of axis, move the corners of the rectangle appropriately</span></div><div class='line' id='LC3128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">axis</span> <span class="o">===</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3129'><br/></div><div class='line' id='LC3130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rot</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">amount</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rot</span><span class="p">);</span></div><div class='line' id='LC3132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">amount</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rot</span><span class="p">);</span></div><div class='line' id='LC3133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span></div><div class='line' id='LC3135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC3136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3137'><br/></div><div class='line' id='LC3138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// &quot;top right&quot; point shifts on change of w</span></div><div class='line' id='LC3139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC3140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC3141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3142'><br/></div><div class='line' id='LC3143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rot</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">amount</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rot</span><span class="p">);</span></div><div class='line' id='LC3145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="nx">e</span><span class="p">.</span><span class="nx">amount</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rot</span><span class="p">);</span></div><div class='line' id='LC3146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC3148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span></div><div class='line' id='LC3149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3150'><br/></div><div class='line' id='LC3151'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// &quot;bottom left&quot; point shifts on change of h</span></div><div class='line' id='LC3152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC3153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC3154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3155'><br/></div><div class='line' id='LC3156'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// &quot;bottom right&quot; point shifts on either change</span></div><div class='line' id='LC3157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC3158'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC3159'><br/></div><div class='line' id='LC3160'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3161'><br/></div><div class='line' id='LC3162'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3163'><span class="cm">     * #.hit</span></div><div class='line' id='LC3164'><span class="cm">     * @comp Collision</span></div><div class='line' id='LC3165'><span class="cm">     * @sign public Boolean/Array hit(String component)</span></div><div class='line' id='LC3166'><span class="cm">     * @param component - Check collision with entities that has this component</span></div><div class='line' id='LC3167'><span class="cm">     * @return `false` if no collision. If a collision is detected, returns an Array of objects that are colliding.</span></div><div class='line' id='LC3168'><span class="cm">     *</span></div><div class='line' id='LC3169'><span class="cm">     * Takes an argument for a component to test collision for. If a collision is found, an array of</span></div><div class='line' id='LC3170'><span class="cm">     * every object in collision along with the amount of overlap is passed.</span></div><div class='line' id='LC3171'><span class="cm">     *</span></div><div class='line' id='LC3172'><span class="cm">     * If no collision, will return false. The return collision data will be an Array of Objects with the</span></div><div class='line' id='LC3173'><span class="cm">     * type of collision used, the object collided and if the type used was SAT (a polygon was used as the hitbox) then an amount of overlap.\</span></div><div class='line' id='LC3174'><span class="cm">     * ~~~</span></div><div class='line' id='LC3175'><span class="cm">     * [{</span></div><div class='line' id='LC3176'><span class="cm">     *    obj: [entity],</span></div><div class='line' id='LC3177'><span class="cm">     *    type: &quot;MBR&quot; or &quot;SAT&quot;,</span></div><div class='line' id='LC3178'><span class="cm">     *    overlap: [number]</span></div><div class='line' id='LC3179'><span class="cm">     * }]</span></div><div class='line' id='LC3180'><span class="cm">     * ~~~</span></div><div class='line' id='LC3181'><span class="cm">     * `MBR` is your standard axis aligned rectangle intersection (`.intersect` in the 2D component).</span></div><div class='line' id='LC3182'><span class="cm">     * `SAT` is collision between any convex polygon.</span></div><div class='line' id='LC3183'><span class="cm">     *</span></div><div class='line' id='LC3184'><span class="cm">     * @see .onHit, 2D</span></div><div class='line' id='LC3185'><span class="cm">     */</span></div><div class='line' id='LC3186'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">area</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">,</span></div><div class='line' id='LC3188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">results</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">area</span><span class="p">,</span> <span class="kc">false</span><span class="p">),</span></div><div class='line' id='LC3189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC3190'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC3191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dupes</span> <span class="o">=</span> <span class="p">{},</span></div><div class='line' id='LC3192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">oarea</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span></div><div class='line' id='LC3193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hasMap</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;map&#39;</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;containsPoint&#39;</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">),</span></div><div class='line' id='LC3194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalresult</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC3195'><br/></div><div class='line' id='LC3196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3197'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3199'><br/></div><div class='line' id='LC3200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC3202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oarea</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_cbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span> <span class="c1">//use the mbr</span></div><div class='line' id='LC3203'><br/></div><div class='line' id='LC3204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC3205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC3206'><br/></div><div class='line' id='LC3207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if not added to hash and that actually intersects</span></div><div class='line' id='LC3208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dupes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">comp</span><span class="p">]</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC3209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oarea</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span> <span class="nx">oarea</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">oarea</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC3210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oarea</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&amp;&amp;</span> <span class="nx">oarea</span><span class="p">.</span><span class="nx">_h</span> <span class="o">+</span> <span class="nx">oarea</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&gt;</span> <span class="nx">area</span><span class="p">.</span><span class="nx">_y</span><span class="p">)</span></div><div class='line' id='LC3211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dupes</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC3212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3213'><br/></div><div class='line' id='LC3214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">dupes</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">dupes</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC3216'><br/></div><div class='line' id='LC3217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">hasMap</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;map&#39;</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">SAT</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_SAT</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span></div><div class='line' id='LC3219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">SAT</span><span class="p">.</span><span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC3220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">SAT</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;SAT&quot;</span><span class="p">;</span></div><div class='line' id='LC3221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">SAT</span><span class="p">)</span> <span class="nx">finalresult</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">SAT</span><span class="p">);</span></div><div class='line' id='LC3222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalresult</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span></div><div class='line' id='LC3224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="o">:</span> <span class="nx">obj</span><span class="p">,</span></div><div class='line' id='LC3225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;MBR&quot;</span></div><div class='line' id='LC3226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC3227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3229'><br/></div><div class='line' id='LC3230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">finalresult</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3233'><br/></div><div class='line' id='LC3234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">finalresult</span><span class="p">;</span></div><div class='line' id='LC3235'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3236'><br/></div><div class='line' id='LC3237'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3238'><span class="cm">     * #.onHit</span></div><div class='line' id='LC3239'><span class="cm">     * @comp Collision</span></div><div class='line' id='LC3240'><span class="cm">     * @sign public this .onHit(String component, Function hit[, Function noHit])</span></div><div class='line' id='LC3241'><span class="cm">     * @param component - Component to check collisions for</span></div><div class='line' id='LC3242'><span class="cm">     * @param hit - Callback method to execute upon collision with component.  Will be passed the results of the collision check in the same format documented for hit().</span></div><div class='line' id='LC3243'><span class="cm">     * @param noHit - Callback method executed once as soon as collision stops</span></div><div class='line' id='LC3244'><span class="cm">     *</span></div><div class='line' id='LC3245'><span class="cm">     * Creates an EnterFrame event calling .hit() each frame.  When a collision is detected the callback will be invoked.</span></div><div class='line' id='LC3246'><span class="cm">     *</span></div><div class='line' id='LC3247'><span class="cm">     * @see .hit</span></div><div class='line' id='LC3248'><span class="cm">     */</span></div><div class='line' id='LC3249'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onHit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">comp</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">callbackOff</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3250'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">justHit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3251'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">hitdata</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hit</span><span class="p">(</span><span class="nx">comp</span><span class="p">);</span></div><div class='line' id='LC3253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">hitdata</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">justHit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">hitdata</span><span class="p">);</span></div><div class='line' id='LC3256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">justHit</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callbackOff</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbackOff</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC3259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">justHit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC3263'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC3264'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3265'><br/></div><div class='line' id='LC3266'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_SAT</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">poly1</span><span class="p">,</span> <span class="nx">poly2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3267'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">points1</span> <span class="o">=</span> <span class="nx">poly1</span><span class="p">.</span><span class="nx">points</span><span class="p">,</span></div><div class='line' id='LC3268'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">points2</span> <span class="o">=</span> <span class="nx">poly2</span><span class="p">.</span><span class="nx">points</span><span class="p">,</span></div><div class='line' id='LC3269'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC3270'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">points1</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC3271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span><span class="p">,</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">points2</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC3272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC3274'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC3275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC3277'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">min1</span><span class="p">,</span> <span class="nx">min2</span><span class="p">,</span></div><div class='line' id='LC3278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">max1</span><span class="p">,</span> <span class="nx">max2</span><span class="p">,</span></div><div class='line' id='LC3279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">interval</span><span class="p">,</span></div><div class='line' id='LC3280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MTV</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MTV2</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MN</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dot</span><span class="p">,</span></div><div class='line' id='LC3284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">nextPoint</span><span class="p">,</span></div><div class='line' id='LC3285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentPoint</span><span class="p">;</span></div><div class='line' id='LC3286'><br/></div><div class='line' id='LC3287'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop through the edges of Polygon 1</span></div><div class='line' id='LC3288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">nextPoint</span> <span class="o">=</span> <span class="nx">points1</span><span class="p">[(</span><span class="nx">i</span> <span class="o">==</span> <span class="nx">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span></div><div class='line' id='LC3290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentPoint</span> <span class="o">=</span> <span class="nx">points1</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC3291'><br/></div><div class='line' id='LC3292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//generate the normal for the current edge</span></div><div class='line' id='LC3293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">nextPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span></div><div class='line' id='LC3294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nextPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></div><div class='line' id='LC3295'><br/></div><div class='line' id='LC3296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//normalize the vector</span></div><div class='line' id='LC3297'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC3298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">/=</span> <span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC3299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">/=</span> <span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC3300'><br/></div><div class='line' id='LC3301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//default min max</span></div><div class='line' id='LC3302'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">min1</span> <span class="o">=</span> <span class="nx">min2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC3303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">max1</span> <span class="o">=</span> <span class="nx">max2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC3304'><br/></div><div class='line' id='LC3305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//project all vertices from poly1 onto axis</span></div><div class='line' id='LC3306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dot</span> <span class="o">=</span> <span class="nx">points1</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">points1</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&gt;</span> <span class="nx">max1</span> <span class="o">||</span> <span class="nx">max1</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">max1</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&lt;</span> <span class="nx">min1</span> <span class="o">||</span> <span class="nx">min1</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">min1</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3311'><br/></div><div class='line' id='LC3312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//project all vertices from poly2 onto axis</span></div><div class='line' id='LC3313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">k</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dot</span> <span class="o">=</span> <span class="nx">points2</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">points2</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&gt;</span> <span class="nx">max2</span> <span class="o">||</span> <span class="nx">max2</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">max2</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&lt;</span> <span class="nx">min2</span> <span class="o">||</span> <span class="nx">min2</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">min2</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3317'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3318'><br/></div><div class='line' id='LC3319'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//calculate the minimum translation vector should be negative</span></div><div class='line' id='LC3320'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">min1</span> <span class="o">&lt;</span> <span class="nx">min2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3321'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">interval</span> <span class="o">=</span> <span class="nx">min2</span> <span class="o">-</span> <span class="nx">max1</span><span class="p">;</span></div><div class='line' id='LC3322'><br/></div><div class='line' id='LC3323'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC3324'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3325'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3326'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">interval</span> <span class="o">=</span> <span class="nx">min1</span> <span class="o">-</span> <span class="nx">max2</span><span class="p">;</span></div><div class='line' id='LC3327'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3328'><br/></div><div class='line' id='LC3329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//exit early if positive</span></div><div class='line' id='LC3330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">interval</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3333'><br/></div><div class='line' id='LC3334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">MTV</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">interval</span> <span class="o">&gt;</span> <span class="nx">MTV</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MTV</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">;</span></div><div class='line' id='LC3336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MN</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC3338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC3339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3342'><br/></div><div class='line' id='LC3343'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop through the edges of Polygon 2</span></div><div class='line' id='LC3344'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">k</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3345'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">nextPoint</span> <span class="o">=</span> <span class="nx">points2</span><span class="p">[(</span><span class="nx">i</span> <span class="o">==</span> <span class="nx">k</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span></div><div class='line' id='LC3346'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentPoint</span> <span class="o">=</span> <span class="nx">points2</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC3347'><br/></div><div class='line' id='LC3348'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//generate the normal for the current edge</span></div><div class='line' id='LC3349'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nx">nextPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span></div><div class='line' id='LC3350'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nextPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">currentPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></div><div class='line' id='LC3351'><br/></div><div class='line' id='LC3352'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//normalize the vector</span></div><div class='line' id='LC3353'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC3354'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">/=</span> <span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC3355'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">/=</span> <span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC3356'><br/></div><div class='line' id='LC3357'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//default min max</span></div><div class='line' id='LC3358'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">min1</span> <span class="o">=</span> <span class="nx">min2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC3359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">max1</span> <span class="o">=</span> <span class="nx">max2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC3360'><br/></div><div class='line' id='LC3361'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//project all vertices from poly1 onto axis</span></div><div class='line' id='LC3362'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3363'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dot</span> <span class="o">=</span> <span class="nx">points1</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">points1</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3364'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&gt;</span> <span class="nx">max1</span> <span class="o">||</span> <span class="nx">max1</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">max1</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3365'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&lt;</span> <span class="nx">min1</span> <span class="o">||</span> <span class="nx">min1</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">min1</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3366'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3367'><br/></div><div class='line' id='LC3368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//project all vertices from poly2 onto axis</span></div><div class='line' id='LC3369'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">k</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3370'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dot</span> <span class="o">=</span> <span class="nx">points2</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">points2</span><span class="p">[</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3371'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&gt;</span> <span class="nx">max2</span> <span class="o">||</span> <span class="nx">max2</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">max2</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3372'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dot</span> <span class="o">&lt;</span> <span class="nx">min2</span> <span class="o">||</span> <span class="nx">min2</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">min2</span> <span class="o">=</span> <span class="nx">dot</span><span class="p">;</span></div><div class='line' id='LC3373'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3374'><br/></div><div class='line' id='LC3375'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//calculate the minimum translation vector should be negative</span></div><div class='line' id='LC3376'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">min1</span> <span class="o">&lt;</span> <span class="nx">min2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3377'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">interval</span> <span class="o">=</span> <span class="nx">min2</span> <span class="o">-</span> <span class="nx">max1</span><span class="p">;</span></div><div class='line' id='LC3378'><br/></div><div class='line' id='LC3379'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC3380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">normal</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">interval</span> <span class="o">=</span> <span class="nx">min1</span> <span class="o">-</span> <span class="nx">max2</span><span class="p">;</span></div><div class='line' id='LC3383'><br/></div><div class='line' id='LC3384'><br/></div><div class='line' id='LC3385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3386'><br/></div><div class='line' id='LC3387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//exit early if positive</span></div><div class='line' id='LC3388'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">interval</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3390'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3391'><br/></div><div class='line' id='LC3392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">MTV</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">interval</span> <span class="o">&gt;</span> <span class="nx">MTV</span><span class="p">)</span> <span class="nx">MTV</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">;</span></div><div class='line' id='LC3393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">interval</span> <span class="o">&gt;</span> <span class="nx">MTV2</span> <span class="o">||</span> <span class="nx">MTV2</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MTV2</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">;</span></div><div class='line' id='LC3395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MN</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC3397'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC3398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3401'><br/></div><div class='line' id='LC3402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC3403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">overlap</span><span class="o">:</span> <span class="nx">MTV2</span><span class="p">,</span></div><div class='line' id='LC3404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">normal</span><span class="o">:</span> <span class="nx">MN</span></div><div class='line' id='LC3405'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3406'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3407'><span class="p">});</span></div><div class='line' id='LC3408'><br/></div><div class='line' id='LC3409'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">8</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC3410'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC3411'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC3412'><br/></div><div class='line' id='LC3413'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC3414'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">over</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">//object mouseover, waiting for out</span></div><div class='line' id='LC3415'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mouseObjs</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC3416'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mousePos</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC3417'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastEvent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3418'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keydown</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC3419'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">selected</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC3420'><br/></div><div class='line' id='LC3421'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3422'><span class="cm">     * #Crafty.keydown</span></div><div class='line' id='LC3423'><span class="cm">     * @category Input</span></div><div class='line' id='LC3424'><span class="cm">     * Remembering what keys (referred by Unicode) are down.</span></div><div class='line' id='LC3425'><span class="cm">     *</span></div><div class='line' id='LC3426'><span class="cm">     * @example</span></div><div class='line' id='LC3427'><span class="cm">     * ~~~</span></div><div class='line' id='LC3428'><span class="cm">     * Crafty.c(&quot;Keyboard&quot;, {</span></div><div class='line' id='LC3429'><span class="cm">     *   isDown: function (key) {</span></div><div class='line' id='LC3430'><span class="cm">     *     if (typeof key === &quot;string&quot;) {</span></div><div class='line' id='LC3431'><span class="cm">     *       key = Crafty.keys[key];</span></div><div class='line' id='LC3432'><span class="cm">     *     }</span></div><div class='line' id='LC3433'><span class="cm">     *     return !!Crafty.keydown[key];</span></div><div class='line' id='LC3434'><span class="cm">     *   }</span></div><div class='line' id='LC3435'><span class="cm">     * });</span></div><div class='line' id='LC3436'><span class="cm">     * ~~~</span></div><div class='line' id='LC3437'><span class="cm">     * @see Keyboard, Crafty.keys</span></div><div class='line' id='LC3438'><span class="cm">     */</span></div><div class='line' id='LC3439'><br/></div><div class='line' id='LC3440'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">detectBlur</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">&lt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC3442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">&lt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">));</span></div><div class='line' id='LC3443'><br/></div><div class='line' id='LC3444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">selected</span> <span class="o">&amp;&amp;</span> <span class="nx">selected</span><span class="p">)</span></div><div class='line' id='LC3445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CraftyFocus&quot;</span><span class="p">);</span></div><div class='line' id='LC3446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">selected</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">selected</span><span class="p">)</span></div><div class='line' id='LC3447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CraftyBlur&quot;</span><span class="p">);</span></div><div class='line' id='LC3448'><br/></div><div class='line' id='LC3449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="nx">selected</span><span class="p">;</span></div><div class='line' id='LC3450'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3451'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3452'><span class="cm">     * #Crafty.mouseDispatch</span></div><div class='line' id='LC3453'><span class="cm">     * @category Input</span></div><div class='line' id='LC3454'><span class="cm">     *</span></div><div class='line' id='LC3455'><span class="cm">     * Internal method which dispatches mouse events received by Crafty (crafty.stage.elem).</span></div><div class='line' id='LC3456'><span class="cm">     * The mouse events get dispatched to the closest entity to the source of the event (if available).</span></div><div class='line' id='LC3457'><span class="cm">     *</span></div><div class='line' id='LC3458'><span class="cm">     * This method also sets a global property Crafty.lastEvent, which holds the most recent event that</span></div><div class='line' id='LC3459'><span class="cm">     * occured (useful for determining mouse position in every frame).</span></div><div class='line' id='LC3460'><span class="cm">     * ~~~</span></div><div class='line' id='LC3461'><span class="cm">     * var newestX = Crafty.lastEvent.realX,</span></div><div class='line' id='LC3462'><span class="cm">     *     newestY = Crafty.lastEvent.realY;</span></div><div class='line' id='LC3463'><span class="cm">     * ~~~</span></div><div class='line' id='LC3464'><span class="cm">     *</span></div><div class='line' id='LC3465'><span class="cm">     * Notable properties of a MouseEvent e:</span></div><div class='line' id='LC3466'><span class="cm">     * ~~~</span></div><div class='line' id='LC3467'><span class="cm">     * //(x,y) coordinates of mouse event in web browser screen space</span></div><div class='line' id='LC3468'><span class="cm">     * e.clientX, e.clientY	</span></div><div class='line' id='LC3469'><span class="cm">     * //(x,y) coordinates of mouse event in world/viewport space</span></div><div class='line' id='LC3470'><span class="cm">     * e.realX, e.realY		</span></div><div class='line' id='LC3471'><span class="cm">     * // Normalized mouse button according to Crafty.mouseButtons</span></div><div class='line' id='LC3472'><span class="cm">     * e.mouseButton			</span></div><div class='line' id='LC3473'><span class="cm">     * ~~~</span></div><div class='line' id='LC3474'><span class="cm">     * @see Crafty.touchDispatch</span></div><div class='line' id='LC3475'><span class="cm">     */</span></div><div class='line' id='LC3476'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mouseDispatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3477'><br/></div><div class='line' id='LC3478'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC3479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">lastEvent</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC3480'><br/></div><div class='line' id='LC3481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">maxz</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC3482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">,</span></div><div class='line' id='LC3483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span><span class="p">,</span></div><div class='line' id='LC3484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC3485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">,</span></div><div class='line' id='LC3486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">),</span></div><div class='line' id='LC3487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC3488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dupes</span> <span class="o">=</span> <span class="p">{},</span></div><div class='line' id='LC3489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tar</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">srcElement</span><span class="p">,</span></div><div class='line' id='LC3490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span></div><div class='line' id='LC3491'><br/></div><div class='line' id='LC3492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Normalize button according to http://unixpapa.com/js/mouse.html</span></div><div class='line' id='LC3493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">mouseButton</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">LEFT</span> <span class="o">:</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">button</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">MIDDLE</span> <span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">);</span></div><div class='line' id='LC3495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">mouseButton</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">LEFT</span> <span class="o">:</span> <span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">MIDDLE</span> <span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">RIGHT</span><span class="p">);</span></div><div class='line' id='LC3497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3498'><br/></div><div class='line' id='LC3499'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">realX</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC3500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">realY</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mousePos</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3501'><br/></div><div class='line' id='LC3502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if it&#39;s a DOM element with Mouse component we are done</span></div><div class='line' id='LC3503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">tar</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!=</span> <span class="s2">&quot;CANVAS&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">tar</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">tar</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;ent&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tar</span> <span class="o">=</span> <span class="nx">tar</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span></div><div class='line' id='LC3506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">tar</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;ent&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">));</span></div><div class='line' id='LC3508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">ent</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;Mouse&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">isAt</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span></div><div class='line' id='LC3509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span> <span class="o">=</span> <span class="nx">ent</span><span class="p">;</span></div><div class='line' id='LC3510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//else we search for an entity with Mouse component</span></div><div class='line' id='LC3512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">closest</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span></div><div class='line' id='LC3514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC3515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC3516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC3517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="mi">1</span></div><div class='line' id='LC3518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC3519'><br/></div><div class='line' id='LC3520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">__c</span><span class="p">.</span><span class="nx">Mouse</span> <span class="o">||</span> <span class="o">!</span><span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">_visible</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC3522'><br/></div><div class='line' id='LC3523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span></div><div class='line' id='LC3524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3525'><br/></div><div class='line' id='LC3526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//weed out duplicates</span></div><div class='line' id='LC3527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dupes</span><span class="p">[</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC3528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">dupes</span><span class="p">[</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3529'><br/></div><div class='line' id='LC3530'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">mapArea</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">mapArea</span><span class="p">.</span><span class="nx">containsPoint</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC3532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3533'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">isAt</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span> <span class="nx">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3535'><br/></div><div class='line' id='LC3536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">flag</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">_z</span> <span class="o">&gt;=</span> <span class="nx">maxz</span> <span class="o">||</span> <span class="nx">maxz</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC3537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if the Z is the same, select the closest GUID</span></div><div class='line' id='LC3538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">_z</span> <span class="o">===</span> <span class="nx">maxz</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC3539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC3540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxz</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_z</span><span class="p">;</span></div><div class='line' id='LC3542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC3543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3544'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3545'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3546'><br/></div><div class='line' id='LC3547'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//found closest object to mouse</span></div><div class='line' id='LC3548'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">closest</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3549'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//click must mousedown and out on tile</span></div><div class='line' id='LC3550'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3551'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseDown&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3552'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3553'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseUp&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3554'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;dblclick&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3555'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;DoubleClick&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3556'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;click&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3557'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Click&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3558'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3559'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseMove&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3560'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">over</span> <span class="o">!==</span> <span class="nx">closest</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//if new mousemove, it is over</span></div><div class='line' id='LC3561'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">over</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3562'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">over</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseOut&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span> <span class="c1">//if over wasn&#39;t null, send mouseout</span></div><div class='line' id='LC3563'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">over</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3564'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3565'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">over</span> <span class="o">=</span> <span class="nx">closest</span><span class="p">;</span></div><div class='line' id='LC3566'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseOver&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="nx">closest</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span> <span class="c1">//trigger whatever it is</span></div><div class='line' id='LC3569'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousemove&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">over</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">over</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MouseOut&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">over</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3575'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">mouselook</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3576'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3577'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">mouselook</span><span class="p">(</span><span class="s1">&#39;drag&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3578'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">mouselook</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">);</span></div><div class='line' id='LC3580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3581'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3582'><br/></div><div class='line' id='LC3583'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3584'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">lastEvent</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC3585'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3586'><br/></div><div class='line' id='LC3587'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3588'><br/></div><div class='line' id='LC3589'><br/></div><div class='line' id='LC3590'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3591'><span class="cm">     * #Crafty.touchDispatch</span></div><div class='line' id='LC3592'><span class="cm">     * @category Input</span></div><div class='line' id='LC3593'><span class="cm">     *</span></div><div class='line' id='LC3594'><span class="cm">     * TouchEvents have a different structure then MouseEvents.</span></div><div class='line' id='LC3595'><span class="cm">     * The relevant data lives in e.changedTouches[0].</span></div><div class='line' id='LC3596'><span class="cm">     * To normalize TouchEvents we catch them and dispatch a mock MouseEvent instead.</span></div><div class='line' id='LC3597'><span class="cm">     *</span></div><div class='line' id='LC3598'><span class="cm">     * @see Crafty.mouseDispatch</span></div><div class='line' id='LC3599'><span class="cm">     */</span></div><div class='line' id='LC3600'><br/></div><div class='line' id='LC3601'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">touchDispatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">type</span><span class="p">,</span></div><div class='line' id='LC3603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastEvent</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">lastEvent</span><span class="p">;</span></div><div class='line' id='LC3604'><br/></div><div class='line' id='LC3605'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;touchstart&quot;</span><span class="p">)</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">;</span></div><div class='line' id='LC3606'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;touchmove&quot;</span><span class="p">)</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">;</span></div><div class='line' id='LC3607'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;touchend&quot;</span><span class="p">)</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">;</span></div><div class='line' id='LC3608'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;touchcancel&quot;</span><span class="p">)</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">;</span></div><div class='line' id='LC3609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;touchleave&quot;</span><span class="p">)</span> <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">;</span></div><div class='line' id='LC3610'><br/></div><div class='line' id='LC3611'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">touches</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3612'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC3613'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3614'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC3615'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3616'><br/></div><div class='line' id='LC3617'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">simulatedEvent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;MouseEvent&quot;</span><span class="p">);</span></div><div class='line' id='LC3618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">simulatedEvent</span><span class="p">.</span><span class="nx">initMouseEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC3619'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span></div><div class='line' id='LC3620'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span></div><div class='line' id='LC3621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span></div><div class='line' id='LC3622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span></div><div class='line' id='LC3623'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span></div><div class='line' id='LC3624'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC3625'><br/></div><div class='line' id='LC3626'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">simulatedEvent</span><span class="p">);</span></div><div class='line' id='LC3627'><br/></div><div class='line' id='LC3628'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// trigger click when it should be triggered</span></div><div class='line' id='LC3629'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">lastEvent</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">lastEvent</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;mousedown&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;mouseup&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;click&#39;</span><span class="p">;</span></div><div class='line' id='LC3631'><br/></div><div class='line' id='LC3632'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">simulatedEvent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;MouseEvent&quot;</span><span class="p">);</span></div><div class='line' id='LC3633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">simulatedEvent</span><span class="p">.</span><span class="nx">initMouseEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC3634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span></div><div class='line' id='LC3635'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span></div><div class='line' id='LC3636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span></div><div class='line' id='LC3637'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span></div><div class='line' id='LC3638'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span></div><div class='line' id='LC3639'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC3640'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">first</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">simulatedEvent</span><span class="p">);</span></div><div class='line' id='LC3641'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3642'><br/></div><div class='line' id='LC3643'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Don&#39;t prevent default actions if target node is input or textarea.</span></div><div class='line' id='LC3644'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!==</span> <span class="s1">&#39;INPUT&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!==</span> <span class="s1">&#39;TEXTAREA&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3645'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3646'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></div><div class='line' id='LC3647'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3648'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3649'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3650'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3651'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3652'><br/></div><div class='line' id='LC3653'><br/></div><div class='line' id='LC3654'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3655'><span class="cm">     * #KeyboardEvent</span></div><div class='line' id='LC3656'><span class="cm">     * @category Input</span></div><div class='line' id='LC3657'><span class="cm">     * Keyboard Event triggered by Crafty Core</span></div><div class='line' id='LC3658'><span class="cm">     * @trigger KeyDown - is triggered for each entity when the DOM &#39;keydown&#39; event is triggered.</span></div><div class='line' id='LC3659'><span class="cm">     * @trigger KeyUp - is triggered for each entity when the DOM &#39;keyup&#39; event is triggered.</span></div><div class='line' id='LC3660'><span class="cm">     *</span></div><div class='line' id='LC3661'><span class="cm">     * @example</span></div><div class='line' id='LC3662'><span class="cm">     * ~~~</span></div><div class='line' id='LC3663'><span class="cm">     * Crafty.e(&quot;2D, DOM, Color&quot;)</span></div><div class='line' id='LC3664'><span class="cm">     *   .attr({x: 100, y: 100, w: 50, h: 50})</span></div><div class='line' id='LC3665'><span class="cm">     *   .color(&quot;red&quot;)</span></div><div class='line' id='LC3666'><span class="cm">     *   .bind(&#39;KeyDown&#39;, function(e) {</span></div><div class='line' id='LC3667'><span class="cm">     *     if(e.key == Crafty.keys.LEFT_ARROW) {</span></div><div class='line' id='LC3668'><span class="cm">     *       this.x = this.x-1;</span></div><div class='line' id='LC3669'><span class="cm">     *     } else if (e.key == Crafty.keys.RIGHT_ARROW) {</span></div><div class='line' id='LC3670'><span class="cm">     *       this.x = this.x+1;</span></div><div class='line' id='LC3671'><span class="cm">     *     } else if (e.key == Crafty.keys.UP_ARROW) {</span></div><div class='line' id='LC3672'><span class="cm">     *       this.y = this.y-1;</span></div><div class='line' id='LC3673'><span class="cm">     *     } else if (e.key == Crafty.keys.DOWN_ARROW) {</span></div><div class='line' id='LC3674'><span class="cm">     *       this.y = this.y+1;</span></div><div class='line' id='LC3675'><span class="cm">     *     }</span></div><div class='line' id='LC3676'><span class="cm">     *   });</span></div><div class='line' id='LC3677'><span class="cm">     * ~~~</span></div><div class='line' id='LC3678'><span class="cm">     *</span></div><div class='line' id='LC3679'><span class="cm">     * @see Crafty.keys</span></div><div class='line' id='LC3680'><span class="cm">     */</span></div><div class='line' id='LC3681'><br/></div><div class='line' id='LC3682'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3683'><span class="cm">     * #Crafty.eventObject</span></div><div class='line' id='LC3684'><span class="cm">     * @category Input</span></div><div class='line' id='LC3685'><span class="cm">     *</span></div><div class='line' id='LC3686'><span class="cm">     * Event Object used in Crafty for cross browser compatibility</span></div><div class='line' id='LC3687'><span class="cm">     */</span></div><div class='line' id='LC3688'><br/></div><div class='line' id='LC3689'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3690'><span class="cm">     * #.key</span></div><div class='line' id='LC3691'><span class="cm">     * @comp Crafty.eventObject</span></div><div class='line' id='LC3692'><span class="cm">     *</span></div><div class='line' id='LC3693'><span class="cm">     * Unicode of the key pressed</span></div><div class='line' id='LC3694'><span class="cm">     */</span></div><div class='line' id='LC3695'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keyboardDispatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3696'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Use a Crafty-standard event object to avoid cross-browser issues</span></div><div class='line' id='LC3697'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">original</span> <span class="o">=</span> <span class="nx">e</span><span class="p">,</span></div><div class='line' id='LC3698'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">evnt</span> <span class="o">=</span> <span class="p">{},</span></div><div class='line' id='LC3699'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">props</span> <span class="o">=</span> <span class="s2">&quot;char charCode keyCode type shiftKey ctrlKey metaKey timestamp&quot;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span></div><div class='line' id='LC3700'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="p">;)</span> <span class="p">{</span></div><div class='line' id='LC3701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC3702'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">evnt</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">original</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span></div><div class='line' id='LC3703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3704'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">evnt</span><span class="p">.</span><span class="nx">which</span> <span class="o">=</span> <span class="nx">original</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">?</span> <span class="nx">original</span><span class="p">.</span><span class="nx">charCode</span> <span class="o">:</span> <span class="nx">original</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span></div><div class='line' id='LC3705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">evnt</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">original</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">original</span><span class="p">.</span><span class="nx">which</span><span class="p">;</span></div><div class='line' id='LC3706'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">evnt</span><span class="p">.</span><span class="nx">originalEvent</span> <span class="o">=</span> <span class="nx">original</span><span class="p">;</span></div><div class='line' id='LC3707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span> <span class="o">=</span> <span class="nx">evnt</span><span class="p">;</span></div><div class='line' id='LC3708'><br/></div><div class='line' id='LC3709'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;keydown&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3710'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3711'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3712'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;KeyDown&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3713'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3714'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;keyup&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3715'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC3716'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;KeyUp&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3717'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3718'><br/></div><div class='line' id='LC3719'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//prevent default actions for all keys except backspace and F1-F12 and except actions in INPUT and TEXTAREA.</span></div><div class='line' id='LC3720'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//prevent bubbling up for all keys except backspace and F1-F12.</span></div><div class='line' id='LC3721'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Among others this prevent the arrow keys from scrolling the parent page</span></div><div class='line' id='LC3722'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//of an iframe hosting the game</span></div><div class='line' id='LC3723'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">selected</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">&gt;=</span> <span class="mi">112</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">&lt;=</span> <span class="mi">135</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC3724'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">)</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span></div><div class='line' id='LC3725'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">e</span><span class="p">.</span><span class="nx">cancelBubble</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3726'><br/></div><div class='line' id='LC3727'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Don&#39;t prevent default actions if target node is input or textarea.</span></div><div class='line' id='LC3728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!==</span> <span class="s1">&#39;INPUT&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">!==</span> <span class="s1">&#39;TEXTAREA&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></div><div class='line' id='LC3731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3733'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3734'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3735'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3736'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3737'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3738'><span class="p">});</span></div><div class='line' id='LC3739'><br/></div><div class='line' id='LC3740'><span class="c1">//initialize the input events onload</span></div><div class='line' id='LC3741'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3742'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keyboardDispatch</span><span class="p">);</span></div><div class='line' id='LC3743'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keyboardDispatch</span><span class="p">);</span></div><div class='line' id='LC3744'><br/></div><div class='line' id='LC3745'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3746'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3747'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">detectBlur</span><span class="p">);</span></div><div class='line' id='LC3748'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3749'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3750'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3751'><br/></div><div class='line' id='LC3752'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchstart&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3753'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchmove&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3754'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchend&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3755'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchcancel&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3756'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchleave&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3757'><span class="p">});</span></div><div class='line' id='LC3758'><br/></div><div class='line' id='LC3759'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;CraftyStop&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3760'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keyboardDispatch</span><span class="p">);</span></div><div class='line' id='LC3761'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;keyup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keyboardDispatch</span><span class="p">);</span></div><div class='line' id='LC3762'><br/></div><div class='line' id='LC3763'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3764'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3765'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3766'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3767'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;dblclick&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseDispatch</span><span class="p">);</span></div><div class='line' id='LC3769'><br/></div><div class='line' id='LC3770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchstart&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3771'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchmove&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3772'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchend&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchcancel&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3774'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchleave&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">touchDispatch</span><span class="p">);</span></div><div class='line' id='LC3775'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3776'><br/></div><div class='line' id='LC3777'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">detectBlur</span><span class="p">);</span></div><div class='line' id='LC3778'><span class="p">});</span></div><div class='line' id='LC3779'><br/></div><div class='line' id='LC3780'><span class="cm">/**@</span></div><div class='line' id='LC3781'><span class="cm"> * #Mouse</span></div><div class='line' id='LC3782'><span class="cm"> * @category Input</span></div><div class='line' id='LC3783'><span class="cm"> * Provides the entity with mouse related events</span></div><div class='line' id='LC3784'><span class="cm"> * @trigger MouseOver - when the mouse enters the entity - MouseEvent</span></div><div class='line' id='LC3785'><span class="cm"> * @trigger MouseOut - when the mouse leaves the entity - MouseEvent</span></div><div class='line' id='LC3786'><span class="cm"> * @trigger MouseDown - when the mouse button is pressed on the entity - MouseEvent</span></div><div class='line' id='LC3787'><span class="cm"> * @trigger MouseUp - when the mouse button is released on the entity - MouseEvent</span></div><div class='line' id='LC3788'><span class="cm"> * @trigger Click - when the user clicks the entity. [See documentation](http://www.quirksmode.org/dom/events/click.html) - MouseEvent</span></div><div class='line' id='LC3789'><span class="cm"> * @trigger DoubleClick - when the user double clicks the entity - MouseEvent</span></div><div class='line' id='LC3790'><span class="cm"> * @trigger MouseMove - when the mouse is over the entity and moves - MouseEvent</span></div><div class='line' id='LC3791'><span class="cm"> * Crafty adds the mouseButton property to MouseEvents that match one of</span></div><div class='line' id='LC3792'><span class="cm"> *</span></div><div class='line' id='LC3793'><span class="cm"> * - Crafty.mouseButtons.LEFT</span></div><div class='line' id='LC3794'><span class="cm"> * - Crafty.mouseButtons.RIGHT</span></div><div class='line' id='LC3795'><span class="cm"> * - Crafty.mouseButtons.MIDDLE</span></div><div class='line' id='LC3796'><span class="cm"> *</span></div><div class='line' id='LC3797'><span class="cm"> * @example</span></div><div class='line' id='LC3798'><span class="cm"> * ~~~</span></div><div class='line' id='LC3799'><span class="cm"> * myEntity.bind(&#39;Click&#39;, function() {</span></div><div class='line' id='LC3800'><span class="cm"> *      console.log(&quot;Clicked!!&quot;);</span></div><div class='line' id='LC3801'><span class="cm"> * })</span></div><div class='line' id='LC3802'><span class="cm"> *</span></div><div class='line' id='LC3803'><span class="cm"> * myEntity.bind(&#39;MouseUp&#39;, function(e) {</span></div><div class='line' id='LC3804'><span class="cm"> *    if( e.mouseButton == Crafty.mouseButtons.RIGHT )</span></div><div class='line' id='LC3805'><span class="cm"> *        console.log(&quot;Clicked right button&quot;);</span></div><div class='line' id='LC3806'><span class="cm"> * })</span></div><div class='line' id='LC3807'><span class="cm"> * ~~~</span></div><div class='line' id='LC3808'><span class="cm"> * @see Crafty.mouseDispatch</span></div><div class='line' id='LC3809'><span class="cm"> */</span></div><div class='line' id='LC3810'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC3811'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3812'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC3813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3814'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC3815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC3816'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3817'><br/></div><div class='line' id='LC3818'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3819'><span class="cm">     * #.areaMap</span></div><div class='line' id='LC3820'><span class="cm">     * @comp Mouse</span></div><div class='line' id='LC3821'><span class="cm">     * @sign public this .areaMap(Crafty.polygon polygon)</span></div><div class='line' id='LC3822'><span class="cm">     * @param polygon - Instance of Crafty.polygon used to check if the mouse coordinates are inside this region</span></div><div class='line' id='LC3823'><span class="cm">     * @sign public this .areaMap(Array point1, .., Array pointN)</span></div><div class='line' id='LC3824'><span class="cm">     * @param point# - Array with an `x` and `y` position to generate a polygon</span></div><div class='line' id='LC3825'><span class="cm">     *</span></div><div class='line' id='LC3826'><span class="cm">     * Assign a polygon to the entity so that mouse events will only be triggered if</span></div><div class='line' id='LC3827'><span class="cm">     * the coordinates are inside the given polygon.</span></div><div class='line' id='LC3828'><span class="cm">     *</span></div><div class='line' id='LC3829'><span class="cm">     * @example</span></div><div class='line' id='LC3830'><span class="cm">     * ~~~</span></div><div class='line' id='LC3831'><span class="cm">     * Crafty.e(&quot;2D, DOM, Color, Mouse&quot;)</span></div><div class='line' id='LC3832'><span class="cm">     *     .color(&quot;red&quot;)</span></div><div class='line' id='LC3833'><span class="cm">     *     .attr({ w: 100, h: 100 })</span></div><div class='line' id='LC3834'><span class="cm">     *     .bind(&#39;MouseOver&#39;, function() {console.log(&quot;over&quot;)})</span></div><div class='line' id='LC3835'><span class="cm">     *     .areaMap([0,0], [50,0], [50,50], [0,50])</span></div><div class='line' id='LC3836'><span class="cm">     * ~~~</span></div><div class='line' id='LC3837'><span class="cm">     *</span></div><div class='line' id='LC3838'><span class="cm">     * @see Crafty.polygon</span></div><div class='line' id='LC3839'><span class="cm">     */</span></div><div class='line' id='LC3840'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">areaMap</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">poly</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create polygon</span></div><div class='line' id='LC3842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//convert args to array to create polygon</span></div><div class='line' id='LC3844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC3845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span></div><div class='line' id='LC3846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3847'><br/></div><div class='line' id='LC3848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">poly</span><span class="p">.</span><span class="nx">shift</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC3849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//this.map = poly;</span></div><div class='line' id='LC3850'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">mapArea</span> <span class="o">=</span> <span class="nx">poly</span><span class="p">;</span></div><div class='line' id='LC3851'><br/></div><div class='line' id='LC3852'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mapArea</span><span class="p">);</span></div><div class='line' id='LC3853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC3854'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3855'><span class="p">});</span></div><div class='line' id='LC3856'><br/></div><div class='line' id='LC3857'><span class="cm">/**@</span></div><div class='line' id='LC3858'><span class="cm"> * #Draggable</span></div><div class='line' id='LC3859'><span class="cm"> * @category Input</span></div><div class='line' id='LC3860'><span class="cm"> * Enable drag and drop of the entity.</span></div><div class='line' id='LC3861'><span class="cm"> * @trigger Dragging - is triggered each frame the entity is being dragged - MouseEvent</span></div><div class='line' id='LC3862'><span class="cm"> * @trigger StartDrag - is triggered when dragging begins - MouseEvent</span></div><div class='line' id='LC3863'><span class="cm"> * @trigger StopDrag - is triggered when dragging ends - MouseEvent</span></div><div class='line' id='LC3864'><span class="cm"> */</span></div><div class='line' id='LC3865'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Draggable&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC3866'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_origMouseDOMPos</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3867'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_oldX</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3868'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_oldY</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3869'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_dragging</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC3870'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_dir</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC3871'><br/></div><div class='line' id='LC3872'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Note: the code is not tested with zoom, etc., that may distort the direction between the viewport and the coordinate on the canvas.</span></div><div class='line' id='LC3873'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3874'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">);</span></div><div class='line' id='LC3875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">enableDrag</span><span class="p">();</span></div><div class='line' id='LC3876'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3877'><br/></div><div class='line' id='LC3878'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_ondrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// While a drag is occurring, this method is bound to the mousemove DOM event</span></div><div class='line' id='LC3880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">);</span></div><div class='line' id='LC3881'><br/></div><div class='line' id='LC3882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ignore invalid 0 0 position - strange problem on ipad</span></div><div class='line' id='LC3883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3885'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3886'><br/></div><div class='line' id='LC3887'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_dir</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origMouseDOMPos</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dir</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origMouseDOMPos</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dir</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3889'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oldX</span> <span class="o">+</span> <span class="nx">len</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dir</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC3890'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oldY</span> <span class="o">+</span> <span class="nx">len</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dir</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC3891'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3892'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oldX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origMouseDOMPos</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span></div><div class='line' id='LC3893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_oldY</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origMouseDOMPos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC3894'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3895'><br/></div><div class='line' id='LC3896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Dragging&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3897'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3898'><br/></div><div class='line' id='LC3899'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_ondown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// When dragging is enabled, this method is bound to the MouseDown crafty event</span></div><div class='line' id='LC3901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">mouseButton</span> <span class="o">!==</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseButtons</span><span class="p">.</span><span class="nx">LEFT</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC3902'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_startDrag</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3903'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3904'><br/></div><div class='line' id='LC3905'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_onup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3906'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// While a drag is occurring, this method is bound to mouseup DOM event</span></div><div class='line' id='LC3907'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ondrag</span><span class="p">);</span></div><div class='line' id='LC3909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onup</span><span class="p">);</span></div><div class='line' id='LC3910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3911'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopDrag&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3912'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3913'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3914'><br/></div><div class='line' id='LC3915'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3916'><span class="cm">     * #.dragDirection</span></div><div class='line' id='LC3917'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC3918'><span class="cm">     * @sign public this .dragDirection()</span></div><div class='line' id='LC3919'><span class="cm">     * Remove any previously specified direction.</span></div><div class='line' id='LC3920'><span class="cm">     *</span></div><div class='line' id='LC3921'><span class="cm">     * @sign public this .dragDirection(vector)</span></div><div class='line' id='LC3922'><span class="cm">     * @param vector - Of the form of {x: valx, y: valy}, the vector (valx, valy) denotes the move direction.</span></div><div class='line' id='LC3923'><span class="cm">     *</span></div><div class='line' id='LC3924'><span class="cm">     * @sign public this .dragDirection(degree)</span></div><div class='line' id='LC3925'><span class="cm">     * @param degree - A number, the degree (clockwise) of the move direction with respect to the x axis.</span></div><div class='line' id='LC3926'><span class="cm">     * Specify the dragging direction.</span></div><div class='line' id='LC3927'><span class="cm">     *</span></div><div class='line' id='LC3928'><span class="cm">     * @example</span></div><div class='line' id='LC3929'><span class="cm">     * ~~~</span></div><div class='line' id='LC3930'><span class="cm">     * this.dragDirection()</span></div><div class='line' id='LC3931'><span class="cm">     * this.dragDirection({x:1, y:0}) //Horizontal</span></div><div class='line' id='LC3932'><span class="cm">     * this.dragDirection({x:0, y:1}) //Vertical</span></div><div class='line' id='LC3933'><span class="cm">     * // Note: because of the orientation of x and y axis,</span></div><div class='line' id='LC3934'><span class="cm">     * // this is 45 degree clockwise with respect to the x axis.</span></div><div class='line' id='LC3935'><span class="cm">     * this.dragDirection({x:1, y:1}) //45 degree.</span></div><div class='line' id='LC3936'><span class="cm">     * this.dragDirection(60) //60 degree.</span></div><div class='line' id='LC3937'><span class="cm">     * ~~~</span></div><div class='line' id='LC3938'><span class="cm">     */</span></div><div class='line' id='LC3939'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dragDirection</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">dir</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dir</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC3942'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="nx">dir</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//dir is a number</span></div><div class='line' id='LC3943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dir</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3944'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">dir</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">),</span></div><div class='line' id='LC3945'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">dir</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span></div><div class='line' id='LC3946'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3947'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC3948'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">dir</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC3949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dir</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC3950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">r</span><span class="p">,</span></div><div class='line' id='LC3951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="nx">r</span></div><div class='line' id='LC3952'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC3953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC3954'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3955'><br/></div><div class='line' id='LC3956'><br/></div><div class='line' id='LC3957'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3958'><span class="cm">     * #._startDrag</span></div><div class='line' id='LC3959'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC3960'><span class="cm">     * Internal method for starting a drag of an entity either programatically or via Mouse click</span></div><div class='line' id='LC3961'><span class="cm">     *</span></div><div class='line' id='LC3962'><span class="cm">     * @param e - a mouse event</span></div><div class='line' id='LC3963'><span class="cm">     */</span></div><div class='line' id='LC3964'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_startDrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC3965'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origMouseDOMPos</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">);</span></div><div class='line' id='LC3966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_oldX</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC3967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_oldY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC3968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC3969'><br/></div><div class='line' id='LC3970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ondrag</span><span class="p">);</span></div><div class='line' id='LC3971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onup</span><span class="p">);</span></div><div class='line' id='LC3972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StartDrag&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC3973'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3974'><br/></div><div class='line' id='LC3975'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3976'><span class="cm">     * #.stopDrag</span></div><div class='line' id='LC3977'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC3978'><span class="cm">     * @sign public this .stopDrag(void)</span></div><div class='line' id='LC3979'><span class="cm">     * @trigger StopDrag - Called right after the mouse listeners are removed</span></div><div class='line' id='LC3980'><span class="cm">     *</span></div><div class='line' id='LC3981'><span class="cm">     * Stop the entity from dragging. Essentially reproducing the drop.</span></div><div class='line' id='LC3982'><span class="cm">     *</span></div><div class='line' id='LC3983'><span class="cm">     * @see .startDrag</span></div><div class='line' id='LC3984'><span class="cm">     */</span></div><div class='line' id='LC3985'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stopDrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC3986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ondrag</span><span class="p">);</span></div><div class='line' id='LC3987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">removeEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onup</span><span class="p">);</span></div><div class='line' id='LC3988'><br/></div><div class='line' id='LC3989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC3990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopDrag&quot;</span><span class="p">);</span></div><div class='line' id='LC3991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC3992'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC3993'><br/></div><div class='line' id='LC3994'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC3995'><span class="cm">     * #.startDrag</span></div><div class='line' id='LC3996'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC3997'><span class="cm">     * @sign public this .startDrag(void)</span></div><div class='line' id='LC3998'><span class="cm">     *</span></div><div class='line' id='LC3999'><span class="cm">     * Make the entity follow the mouse positions.</span></div><div class='line' id='LC4000'><span class="cm">     *</span></div><div class='line' id='LC4001'><span class="cm">     * @see .stopDrag</span></div><div class='line' id='LC4002'><span class="cm">     */</span></div><div class='line' id='LC4003'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startDrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4005'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Use the last known position of the mouse</span></div><div class='line' id='LC4006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_startDrag</span><span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">lastEvent</span><span class="p">);</span></div><div class='line' id='LC4007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4009'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4010'><br/></div><div class='line' id='LC4011'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4012'><span class="cm">     * #.enableDrag</span></div><div class='line' id='LC4013'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC4014'><span class="cm">     * @sign public this .enableDrag(void)</span></div><div class='line' id='LC4015'><span class="cm">     *</span></div><div class='line' id='LC4016'><span class="cm">     * Rebind the mouse events. Use if `.disableDrag` has been called.</span></div><div class='line' id='LC4017'><span class="cm">     *</span></div><div class='line' id='LC4018'><span class="cm">     * @see .disableDrag</span></div><div class='line' id='LC4019'><span class="cm">     */</span></div><div class='line' id='LC4020'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">enableDrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;MouseDown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ondown</span><span class="p">);</span></div><div class='line' id='LC4022'><br/></div><div class='line' id='LC4023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onup</span><span class="p">);</span></div><div class='line' id='LC4024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4025'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4026'><br/></div><div class='line' id='LC4027'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4028'><span class="cm">     * #.disableDrag</span></div><div class='line' id='LC4029'><span class="cm">     * @comp Draggable</span></div><div class='line' id='LC4030'><span class="cm">     * @sign public this .disableDrag(void)</span></div><div class='line' id='LC4031'><span class="cm">     *</span></div><div class='line' id='LC4032'><span class="cm">     * Stops entity from being draggable. Reenable with `.enableDrag()`.</span></div><div class='line' id='LC4033'><span class="cm">     *</span></div><div class='line' id='LC4034'><span class="cm">     * @see .enableDrag</span></div><div class='line' id='LC4035'><span class="cm">     */</span></div><div class='line' id='LC4036'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">disableDrag</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;MouseDown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ondown</span><span class="p">);</span></div><div class='line' id='LC4038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_dragging</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">stopDrag</span><span class="p">();</span></div><div class='line' id='LC4040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4042'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4043'><span class="p">});</span></div><div class='line' id='LC4044'><br/></div><div class='line' id='LC4045'><span class="cm">/**@</span></div><div class='line' id='LC4046'><span class="cm"> * #Keyboard</span></div><div class='line' id='LC4047'><span class="cm"> * @category Input</span></div><div class='line' id='LC4048'><span class="cm"> * Give entities keyboard events (`keydown` and `keyup`).</span></div><div class='line' id='LC4049'><span class="cm"> */</span></div><div class='line' id='LC4050'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4051'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4052'><span class="cm">     * #.isDown</span></div><div class='line' id='LC4053'><span class="cm">     * @comp Keyboard</span></div><div class='line' id='LC4054'><span class="cm">     * @sign public Boolean isDown(String keyName)</span></div><div class='line' id='LC4055'><span class="cm">     * @param keyName - Name of the key to check. See `Crafty.keys`.</span></div><div class='line' id='LC4056'><span class="cm">     * @sign public Boolean isDown(Number keyCode)</span></div><div class='line' id='LC4057'><span class="cm">     * @param keyCode - Key code in `Crafty.keys`.</span></div><div class='line' id='LC4058'><span class="cm">     *</span></div><div class='line' id='LC4059'><span class="cm">     * Determine if a certain key is currently down.</span></div><div class='line' id='LC4060'><span class="cm">     *</span></div><div class='line' id='LC4061'><span class="cm">     * @example</span></div><div class='line' id='LC4062'><span class="cm">     * ~~~</span></div><div class='line' id='LC4063'><span class="cm">     * entity.requires(&#39;Keyboard&#39;).bind(&#39;KeyDown&#39;, function () { if (this.isDown(&#39;SPACE&#39;)) jump(); });</span></div><div class='line' id='LC4064'><span class="cm">     * ~~~</span></div><div class='line' id='LC4065'><span class="cm">     *</span></div><div class='line' id='LC4066'><span class="cm">     * @see Crafty.keys</span></div><div class='line' id='LC4067'><span class="cm">     */</span></div><div class='line' id='LC4068'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">isDown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">key</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC4071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="o">!!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC4073'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4074'><span class="p">});</span></div><div class='line' id='LC4075'><br/></div><div class='line' id='LC4076'><span class="cm">/**@</span></div><div class='line' id='LC4077'><span class="cm"> * #Multiway</span></div><div class='line' id='LC4078'><span class="cm"> * @category Input</span></div><div class='line' id='LC4079'><span class="cm"> * Used to bind keys to directions and have the entity move accordingly</span></div><div class='line' id='LC4080'><span class="cm"> * @trigger NewDirection - triggered when direction changes - { x:Number, y:Number } - New direction</span></div><div class='line' id='LC4081'><span class="cm"> * @trigger Moved - triggered on movement on either x or y axis. If the entity has moved on both axes for diagonal movement the event is triggered twice - { x:Number, y:Number } - Old position</span></div><div class='line' id='LC4082'><span class="cm"> */</span></div><div class='line' id='LC4083'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Multiway&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4084'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_speed</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span></div><div class='line' id='LC4085'><br/></div><div class='line' id='LC4086'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_keydown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC4088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span></div><div class='line' id='LC4089'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span></div><div class='line' id='LC4090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;NewDirection&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">);</span></div><div class='line' id='LC4091'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4092'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4093'><br/></div><div class='line' id='LC4094'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_keyup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC4096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span></div><div class='line' id='LC4097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span></div><div class='line' id='LC4098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;NewDirection&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">);</span></div><div class='line' id='LC4099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4100'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4101'><br/></div><div class='line' id='LC4102'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_enterframe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">disableControls</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC4104'><br/></div><div class='line' id='LC4105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC4107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Moved&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC4109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC4110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC4114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Moved&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC4116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_movement</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC4117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4119'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4120'><br/></div><div class='line' id='LC4121'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_initializeControl</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4122'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;KeyDown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keydown</span><span class="p">)</span></div><div class='line' id='LC4123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;KeyUp&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keyup</span><span class="p">)</span></div><div class='line' id='LC4124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enterframe</span><span class="p">)</span></div><div class='line' id='LC4125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;KeyDown&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keydown</span><span class="p">)</span></div><div class='line' id='LC4126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;KeyUp&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keyup</span><span class="p">)</span></div><div class='line' id='LC4127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_enterframe</span><span class="p">);</span></div><div class='line' id='LC4128'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4129'><br/></div><div class='line' id='LC4130'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4131'><span class="cm">     * #.multiway</span></div><div class='line' id='LC4132'><span class="cm">     * @comp Multiway</span></div><div class='line' id='LC4133'><span class="cm">     * @sign public this .multiway([Number speed,] Object keyBindings )</span></div><div class='line' id='LC4134'><span class="cm">     * @param speed - Amount of pixels to move the entity whilst a key is down</span></div><div class='line' id='LC4135'><span class="cm">     * @param keyBindings - What keys should make the entity go in which direction. Direction is specified in degrees</span></div><div class='line' id='LC4136'><span class="cm">     * Constructor to initialize the speed and keyBindings. Component will listen to key events and move the entity appropriately.</span></div><div class='line' id='LC4137'><span class="cm">     *</span></div><div class='line' id='LC4138'><span class="cm">     * When direction changes a NewDirection event is triggered with an object detailing the new direction: {x: x_movement, y: y_movement}</span></div><div class='line' id='LC4139'><span class="cm">     * When entity has moved on either x- or y-axis a Moved event is triggered with an object specifying the old position {x: old_x, y: old_y}</span></div><div class='line' id='LC4140'><span class="cm">     *</span></div><div class='line' id='LC4141'><span class="cm">     * @example</span></div><div class='line' id='LC4142'><span class="cm">     * ~~~</span></div><div class='line' id='LC4143'><span class="cm">     * this.multiway(3, {UP_ARROW: -90, DOWN_ARROW: 90, RIGHT_ARROW: 0, LEFT_ARROW: 180});</span></div><div class='line' id='LC4144'><span class="cm">     * this.multiway({x:3,y:1.5}, {UP_ARROW: -90, DOWN_ARROW: 90, RIGHT_ARROW: 0, LEFT_ARROW: 180});</span></div><div class='line' id='LC4145'><span class="cm">     * this.multiway({W: -90, S: 90, D: 0, A: 180});</span></div><div class='line' id='LC4146'><span class="cm">     * ~~~</span></div><div class='line' id='LC4147'><span class="cm">     */</span></div><div class='line' id='LC4148'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">multiway</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">speed</span><span class="p">,</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_keyDirection</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_keys</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4151'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_movement</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC4152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC4154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC4155'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC4156'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span></div><div class='line' id='LC4157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">3</span></div><div class='line' id='LC4158'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC4159'><br/></div><div class='line' id='LC4160'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4161'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">speed</span><span class="p">.</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">speed</span><span class="p">.</span><span class="nx">y</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4162'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC4163'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC4164'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">;</span></div><div class='line' id='LC4166'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_speed</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">;</span></div><div class='line' id='LC4167'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">;</span></div><div class='line' id='LC4170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4171'><br/></div><div class='line' id='LC4172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_keyDirection</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">;</span></div><div class='line' id='LC4173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">speed</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_speed</span><span class="p">);</span></div><div class='line' id='LC4174'><br/></div><div class='line' id='LC4175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_initializeControl</span><span class="p">();</span></div><div class='line' id='LC4176'><br/></div><div class='line' id='LC4177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Apply movement if key is down when created</span></div><div class='line' id='LC4178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">keys</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">k</span><span class="p">]])</span> <span class="p">{</span></div><div class='line' id='LC4180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;KeyDown&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">key</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span></div><div class='line' id='LC4182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4183'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4184'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4185'><br/></div><div class='line' id='LC4186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4187'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4188'><br/></div><div class='line' id='LC4189'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4190'><span class="cm">     * #.enableControl</span></div><div class='line' id='LC4191'><span class="cm">     * @comp Multiway</span></div><div class='line' id='LC4192'><span class="cm">     * @sign public this .enableControl()</span></div><div class='line' id='LC4193'><span class="cm">     *</span></div><div class='line' id='LC4194'><span class="cm">     * Enable the component to listen to key events.</span></div><div class='line' id='LC4195'><span class="cm">     *</span></div><div class='line' id='LC4196'><span class="cm">     * @example</span></div><div class='line' id='LC4197'><span class="cm">     * ~~~</span></div><div class='line' id='LC4198'><span class="cm">     * this.enableControl();</span></div><div class='line' id='LC4199'><span class="cm">     * ~~~</span></div><div class='line' id='LC4200'><span class="cm">     */</span></div><div class='line' id='LC4201'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">enableControl</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">disableControls</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC4203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4204'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4205'><br/></div><div class='line' id='LC4206'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4207'><span class="cm">     * #.disableControl</span></div><div class='line' id='LC4208'><span class="cm">     * @comp Multiway</span></div><div class='line' id='LC4209'><span class="cm">     * @sign public this .disableControl()</span></div><div class='line' id='LC4210'><span class="cm">     *</span></div><div class='line' id='LC4211'><span class="cm">     * Disable the component to listen to key events.</span></div><div class='line' id='LC4212'><span class="cm">     *</span></div><div class='line' id='LC4213'><span class="cm">     * @example</span></div><div class='line' id='LC4214'><span class="cm">     * ~~~</span></div><div class='line' id='LC4215'><span class="cm">     * this.disableControl();</span></div><div class='line' id='LC4216'><span class="cm">     * ~~~</span></div><div class='line' id='LC4217'><span class="cm">     */</span></div><div class='line' id='LC4218'><br/></div><div class='line' id='LC4219'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">disableControl</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">disableControls</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4222'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4223'><br/></div><div class='line' id='LC4224'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4225'><span class="cm">     * #.speed</span></div><div class='line' id='LC4226'><span class="cm">     * @comp Multiway</span></div><div class='line' id='LC4227'><span class="cm">     * @sign public this .speed(Number speed)</span></div><div class='line' id='LC4228'><span class="cm">     * @param speed - The speed the entity has.</span></div><div class='line' id='LC4229'><span class="cm">     *</span></div><div class='line' id='LC4230'><span class="cm">     * Change the speed that the entity moves with.</span></div><div class='line' id='LC4231'><span class="cm">     *</span></div><div class='line' id='LC4232'><span class="cm">     * @example</span></div><div class='line' id='LC4233'><span class="cm">     * ~~~</span></div><div class='line' id='LC4234'><span class="cm">     * this.speed(2);</span></div><div class='line' id='LC4235'><span class="cm">     * ~~~</span></div><div class='line' id='LC4236'><span class="cm">     */</span></div><div class='line' id='LC4237'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">speed</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">speed</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_keyDirection</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">keyCode</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">||</span> <span class="nx">k</span><span class="p">;</span></div><div class='line' id='LC4240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_keys</span><span class="p">[</span><span class="nx">keyCode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC4241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_keyDirection</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="nx">speed</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span></div><div class='line' id='LC4242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_keyDirection</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="nx">speed</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span></div><div class='line' id='LC4243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC4244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4246'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4247'><span class="p">});</span></div><div class='line' id='LC4248'><br/></div><div class='line' id='LC4249'><span class="cm">/**@</span></div><div class='line' id='LC4250'><span class="cm"> * #Fourway</span></div><div class='line' id='LC4251'><span class="cm"> * @category Input</span></div><div class='line' id='LC4252'><span class="cm"> * Move an entity in four directions by using the</span></div><div class='line' id='LC4253'><span class="cm"> * arrow keys or `W`, `A`, `S`, `D`.</span></div><div class='line' id='LC4254'><span class="cm"> */</span></div><div class='line' id='LC4255'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Fourway&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4256'><br/></div><div class='line' id='LC4257'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;Multiway&quot;</span><span class="p">);</span></div><div class='line' id='LC4259'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4260'><br/></div><div class='line' id='LC4261'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4262'><span class="cm">     * #.fourway</span></div><div class='line' id='LC4263'><span class="cm">     * @comp Fourway</span></div><div class='line' id='LC4264'><span class="cm">     * @sign public this .fourway(Number speed)</span></div><div class='line' id='LC4265'><span class="cm">     * @param speed - Amount of pixels to move the entity whilst a key is down</span></div><div class='line' id='LC4266'><span class="cm">     * Constructor to initialize the speed. Component will listen for key events and move the entity appropriately.</span></div><div class='line' id='LC4267'><span class="cm">     * This includes `Up Arrow`, `Right Arrow`, `Down Arrow`, `Left Arrow` as well as `W`, `A`, `S`, `D`.</span></div><div class='line' id='LC4268'><span class="cm">     *</span></div><div class='line' id='LC4269'><span class="cm">     * When direction changes a NewDirection event is triggered with an object detailing the new direction: {x: x_movement, y: y_movement}</span></div><div class='line' id='LC4270'><span class="cm">     * When entity has moved on either x- or y-axis a Moved event is triggered with an object specifying the old position {x: old_x, y: old_y}</span></div><div class='line' id='LC4271'><span class="cm">     *</span></div><div class='line' id='LC4272'><span class="cm">     * The key presses will move the entity in that direction by the speed passed in the argument.</span></div><div class='line' id='LC4273'><span class="cm">     *</span></div><div class='line' id='LC4274'><span class="cm">     * @see Multiway</span></div><div class='line' id='LC4275'><span class="cm">     */</span></div><div class='line' id='LC4276'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">fourway</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">speed</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4277'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">multiway</span><span class="p">(</span><span class="nx">speed</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">UP_ARROW</span><span class="o">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC4279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DOWN_ARROW</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC4280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">RIGHT_ARROW</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">LEFT_ARROW</span><span class="o">:</span> <span class="mi">180</span><span class="p">,</span></div><div class='line' id='LC4282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">W</span><span class="o">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC4283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">S</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC4284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">D</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">A</span><span class="o">:</span> <span class="mi">180</span><span class="p">,</span></div><div class='line' id='LC4286'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Z</span><span class="o">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC4287'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Q</span><span class="o">:</span> <span class="mi">180</span></div><div class='line' id='LC4288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4289'><br/></div><div class='line' id='LC4290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4291'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4292'><span class="p">});</span></div><div class='line' id='LC4293'><br/></div><div class='line' id='LC4294'><span class="cm">/**@</span></div><div class='line' id='LC4295'><span class="cm"> * #Twoway</span></div><div class='line' id='LC4296'><span class="cm"> * @category Input</span></div><div class='line' id='LC4297'><span class="cm"> * @trigger NewDirection - When direction changes a NewDirection event is triggered with an object detailing the new direction: {x: x_movement, y: y_movement}. This is consistent with Fourway and Multiway components.</span></div><div class='line' id='LC4298'><span class="cm"> * @trigger Moved - When entity has moved on x-axis a Moved event is triggered with an object specifying the old position {x: old_x, y: old_y}</span></div><div class='line' id='LC4299'><span class="cm"> * </span></div><div class='line' id='LC4300'><span class="cm"> * Move an entity left or right using the arrow keys or `D` and `A` and jump using up arrow or `W`.</span></div><div class='line' id='LC4301'><span class="cm"> */</span></div><div class='line' id='LC4302'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Twoway&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4303'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_speed</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span></div><div class='line' id='LC4304'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_up</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC4305'><br/></div><div class='line' id='LC4306'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;Fourway, Keyboard, Gravity&quot;</span><span class="p">);</span></div><div class='line' id='LC4308'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4309'><br/></div><div class='line' id='LC4310'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4311'><span class="cm">     * #.twoway</span></div><div class='line' id='LC4312'><span class="cm">     * @comp Twoway</span></div><div class='line' id='LC4313'><span class="cm">     * @sign public this .twoway(Number speed[, Number jump])</span></div><div class='line' id='LC4314'><span class="cm">     * @param speed - Amount of pixels to move left or right</span></div><div class='line' id='LC4315'><span class="cm">     * @param jump - Vertical jump speed</span></div><div class='line' id='LC4316'><span class="cm">     *</span></div><div class='line' id='LC4317'><span class="cm">     * Constructor to initialize the speed and power of jump. Component will</span></div><div class='line' id='LC4318'><span class="cm">     * listen for key events and move the entity appropriately. This includes</span></div><div class='line' id='LC4319'><span class="cm">     * `Up Arrow`, `Right Arrow`, `Left Arrow` as well as `W`, `A`, `D`. Used with the</span></div><div class='line' id='LC4320'><span class="cm">     * `gravity` component to simulate jumping.</span></div><div class='line' id='LC4321'><span class="cm">     *</span></div><div class='line' id='LC4322'><span class="cm">     * The key presses will move the entity in that direction by the speed passed in</span></div><div class='line' id='LC4323'><span class="cm">     * the argument. Pressing the `Up Arrow` or `W` will cause the entity to jump.</span></div><div class='line' id='LC4324'><span class="cm">     *</span></div><div class='line' id='LC4325'><span class="cm">     * @see Gravity, Fourway</span></div><div class='line' id='LC4326'><span class="cm">     */</span></div><div class='line' id='LC4327'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">twoway</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">speed</span><span class="p">,</span> <span class="nx">jump</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4328'><br/></div><div class='line' id='LC4329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">multiway</span><span class="p">(</span><span class="nx">speed</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC4330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">RIGHT_ARROW</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">LEFT_ARROW</span><span class="o">:</span> <span class="mi">180</span><span class="p">,</span></div><div class='line' id='LC4332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">D</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">A</span><span class="o">:</span> <span class="mi">180</span><span class="p">,</span></div><div class='line' id='LC4334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Q</span><span class="o">:</span> <span class="mi">180</span></div><div class='line' id='LC4335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4336'><br/></div><div class='line' id='LC4337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">speed</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">=</span> <span class="nx">speed</span><span class="p">;</span></div><div class='line' id='LC4338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">){</span></div><div class='line' id='LC4339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_speed</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC4340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span><span class="p">{</span></div><div class='line' id='LC4341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span> <span class="o">=</span> <span class="nx">jump</span><span class="p">;</span></div><div class='line' id='LC4342'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4343'><br/></div><div class='line' id='LC4344'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4345'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">disableControls</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC4346'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_up</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4347'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span><span class="p">;</span></div><div class='line' id='LC4348'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_falling</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4349'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Moved&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_jumpSpeed</span> <span class="p">});</span></div><div class='line' id='LC4350'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4351'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;KeyDown&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4352'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_falling</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">UP_ARROW</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">W</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nx">Z</span><span class="p">))</span></div><div class='line' id='LC4353'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_up</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4354'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4355'><br/></div><div class='line' id='LC4356'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4357'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4358'><span class="p">});</span></div><div class='line' id='LC4359'><br/></div><div class='line' id='LC4360'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">9</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC4361'><span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./version&#39;</span><span class="p">);</span></div><div class='line' id='LC4362'><br/></div><div class='line' id='LC4363'><span class="cm">/**@</span></div><div class='line' id='LC4364'><span class="cm"> * #Crafty</span></div><div class='line' id='LC4365'><span class="cm"> * @category Core</span></div><div class='line' id='LC4366'><span class="cm"> * Select a set of or single entities by components or an entity&#39;s ID.</span></div><div class='line' id='LC4367'><span class="cm"> *</span></div><div class='line' id='LC4368'><span class="cm"> * Crafty uses syntax similar to jQuery by having a selector engine to select entities by their components.</span></div><div class='line' id='LC4369'><span class="cm"> *</span></div><div class='line' id='LC4370'><span class="cm"> * If there is more than one match, the return value is an Array-like object listing the ID numbers of each matching entity. If there is exactly one match, the entity itself is returned. If you&#39;re not sure how many matches to expect, check the number of matches via Crafty(...).length. Alternatively, use Crafty(...).each(...), which works in all cases.</span></div><div class='line' id='LC4371'><span class="cm"> *</span></div><div class='line' id='LC4372'><span class="cm"> * @example</span></div><div class='line' id='LC4373'><span class="cm"> * ~~~</span></div><div class='line' id='LC4374'><span class="cm"> *    Crafty(&quot;MyComponent&quot;)</span></div><div class='line' id='LC4375'><span class="cm"> *    Crafty(&quot;Hello 2D Component&quot;)</span></div><div class='line' id='LC4376'><span class="cm"> *    Crafty(&quot;Hello, 2D, Component&quot;)</span></div><div class='line' id='LC4377'><span class="cm"> * ~~~</span></div><div class='line' id='LC4378'><span class="cm"> *</span></div><div class='line' id='LC4379'><span class="cm"> * The first selector will return all entities that have the component `MyComponent`. The second will return all entities that have `Hello` and `2D` and `Component` whereas the last will return all entities that have at least one of those components (or).</span></div><div class='line' id='LC4380'><span class="cm"> *</span></div><div class='line' id='LC4381'><span class="cm"> * ~~~</span></div><div class='line' id='LC4382'><span class="cm"> *   Crafty(&quot;*&quot;)</span></div><div class='line' id='LC4383'><span class="cm"> * ~~~</span></div><div class='line' id='LC4384'><span class="cm"> * Passing `*` will select all entities.</span></div><div class='line' id='LC4385'><span class="cm"> *</span></div><div class='line' id='LC4386'><span class="cm"> * ~~~</span></div><div class='line' id='LC4387'><span class="cm"> *   Crafty(1)</span></div><div class='line' id='LC4388'><span class="cm"> * ~~~</span></div><div class='line' id='LC4389'><span class="cm"> * Passing an integer will select the entity with that `ID`.</span></div><div class='line' id='LC4390'><span class="cm"> *</span></div><div class='line' id='LC4391'><span class="cm"> * To work directly with an array of entities, use the `get()` method on a selection.</span></div><div class='line' id='LC4392'><span class="cm"> * To call a function in the context of each entity, use the `.each()` method.</span></div><div class='line' id='LC4393'><span class="cm"> *</span></div><div class='line' id='LC4394'><span class="cm"> * The event related methods such as `bind` and `trigger` will work on selections of entities.</span></div><div class='line' id='LC4395'><span class="cm"> *</span></div><div class='line' id='LC4396'><span class="cm"> * @see .get</span></div><div class='line' id='LC4397'><span class="cm"> * @see .each</span></div><div class='line' id='LC4398'><span class="cm"> */</span></div><div class='line' id='LC4399'><br/></div><div class='line' id='LC4400'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4401'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span></div><div class='line' id='LC4402'><span class="p">},</span></div><div class='line' id='LC4403'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Internal variables</span></div><div class='line' id='LC4404'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">GUID</span><span class="p">,</span> <span class="nx">frame</span><span class="p">,</span> <span class="nx">components</span><span class="p">,</span> <span class="nx">entities</span><span class="p">,</span> <span class="nx">handlers</span><span class="p">,</span> <span class="nx">onloads</span><span class="p">,</span></div><div class='line' id='LC4405'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">slice</span><span class="p">,</span> <span class="nx">rlist</span><span class="p">,</span> <span class="nx">rspace</span><span class="p">,</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC4406'><br/></div><div class='line' id='LC4407'><br/></div><div class='line' id='LC4408'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">initState</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">GUID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//GUID for entity IDs</span></div><div class='line' id='LC4410'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4411'><br/></div><div class='line' id='LC4412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">components</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">//map of components and their functions</span></div><div class='line' id='LC4413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entities</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">//map of entities and their data</span></div><div class='line' id='LC4414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">handlers</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">//global event handlers</span></div><div class='line' id='LC4415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onloads</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">//temporary storage of onload handlers</span></div><div class='line' id='LC4416'><br/></div><div class='line' id='LC4417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span></div><div class='line' id='LC4418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rlist</span> <span class="o">=</span> <span class="sr">/\s*,\s*/</span><span class="p">;</span></div><div class='line' id='LC4419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rspace</span> <span class="o">=</span> <span class="sr">/\s+/</span><span class="p">;</span></div><div class='line' id='LC4420'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC4421'><br/></div><div class='line' id='LC4422'><span class="nx">initState</span><span class="p">();</span></div><div class='line' id='LC4423'><br/></div><div class='line' id='LC4424'><span class="cm">/**@</span></div><div class='line' id='LC4425'><span class="cm"> * #Crafty Core</span></div><div class='line' id='LC4426'><span class="cm"> * @category Core</span></div><div class='line' id='LC4427'><span class="cm"> * @trigger NewEntityName - After setting new name for entity - String - entity name</span></div><div class='line' id='LC4428'><span class="cm"> * @trigger NewComponent - when a new component is added to the entity - String - Component</span></div><div class='line' id='LC4429'><span class="cm"> * @trigger RemoveComponent - when a component is removed from the entity - String - Component</span></div><div class='line' id='LC4430'><span class="cm"> * @trigger Remove - when the entity is removed by calling .destroy()</span></div><div class='line' id='LC4431'><span class="cm"> *</span></div><div class='line' id='LC4432'><span class="cm"> * Set of methods added to every single entity.</span></div><div class='line' id='LC4433'><span class="cm"> */</span></div><div class='line' id='LC4434'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">fn</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC4435'><br/></div><div class='line' id='LC4436'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4437'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//select entities by component</span></div><div class='line' id='LC4438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">selector</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//index elements</span></div><div class='line' id='LC4440'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">,</span> <span class="c1">//entity forEach</span></div><div class='line' id='LC4441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">,</span></div><div class='line' id='LC4442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">and</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">//flags for multiple</span></div><div class='line' id='LC4443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">or</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC4444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">del</span><span class="p">,</span></div><div class='line' id='LC4445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comps</span><span class="p">,</span></div><div class='line' id='LC4446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">score</span><span class="p">,</span></div><div class='line' id='LC4447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">;</span></div><div class='line' id='LC4448'><br/></div><div class='line' id='LC4449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">selector</span> <span class="o">===</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">e</span> <span class="k">in</span> <span class="nx">entities</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// entities is something like {2:entity2, 3:entity3, 11:entity11, ...}</span></div><div class='line' id='LC4453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The for...in loop sets e to &quot;2&quot;, &quot;3&quot;, &quot;11&quot;, ... i.e. all</span></div><div class='line' id='LC4454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// the entity ID numbers. e is a string, so +e converts to number type.</span></div><div class='line' id='LC4455'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC4456'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC4457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4458'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC4459'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// if there&#39;s only one entity, return the actual entity</span></div><div class='line' id='LC4460'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4461'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></div><div class='line' id='LC4462'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4463'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4464'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4465'><br/></div><div class='line' id='LC4466'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//multiple components OR</span></div><div class='line' id='LC4467'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4468'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">or</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4469'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">del</span> <span class="o">=</span> <span class="nx">rlist</span><span class="p">;</span></div><div class='line' id='LC4470'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//deal with multiple components AND</span></div><div class='line' id='LC4471'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4472'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">and</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4473'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">del</span> <span class="o">=</span> <span class="nx">rspace</span><span class="p">;</span></div><div class='line' id='LC4474'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4475'><br/></div><div class='line' id='LC4476'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over entities</span></div><div class='line' id='LC4477'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">e</span> <span class="k">in</span> <span class="nx">entities</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4478'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entities</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">//skip</span></div><div class='line' id='LC4479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span></div><div class='line' id='LC4480'><br/></div><div class='line' id='LC4481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">and</span> <span class="o">||</span> <span class="nx">or</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//multiple components</span></div><div class='line' id='LC4482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comps</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">del</span><span class="p">);</span></div><div class='line' id='LC4483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">comps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4486'><br/></div><div class='line' id='LC4487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="c1">//loop over components</span></div><div class='line' id='LC4488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="nx">score</span><span class="o">++</span><span class="p">;</span> <span class="c1">//if component exists add to score</span></div><div class='line' id='LC4489'><br/></div><div class='line' id='LC4490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if anded comps and has all OR ored comps and at least 1</span></div><div class='line' id='LC4491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">and</span> <span class="o">&amp;&amp;</span> <span class="nx">score</span> <span class="o">===</span> <span class="nx">l</span> <span class="o">||</span> <span class="nx">or</span> <span class="o">&amp;&amp;</span> <span class="nx">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">elem</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC4492'><br/></div><div class='line' id='LC4493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">selector</span><span class="p">])</span> <span class="k">this</span><span class="p">[</span><span class="nx">elem</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="o">+</span><span class="nx">e</span><span class="p">;</span> <span class="c1">//convert to int</span></div><div class='line' id='LC4494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4495'><br/></div><div class='line' id='LC4496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//extend all common components</span></div><div class='line' id='LC4497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">and</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">or</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">components</span><span class="p">[</span><span class="nx">selector</span><span class="p">]);</span></div><div class='line' id='LC4498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">comps</span> <span class="o">&amp;&amp;</span> <span class="nx">and</span><span class="p">)</span></div><div class='line' id='LC4499'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">components</span><span class="p">[</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span></div><div class='line' id='LC4500'><br/></div><div class='line' id='LC4501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">;</span> <span class="c1">//length is the last index (already incremented)</span></div><div class='line' id='LC4502'><br/></div><div class='line' id='LC4503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// if there&#39;s only one entity, return the actual entity</span></div><div class='line' id='LC4504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">elem</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]];</span></div><div class='line' id='LC4506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4507'><br/></div><div class='line' id='LC4508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//Select a specific entity</span></div><div class='line' id='LC4509'><br/></div><div class='line' id='LC4510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//nothin passed creates God entity</span></div><div class='line' id='LC4511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">selector</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">selector</span> <span class="k">in</span> <span class="nx">entities</span><span class="p">))</span> <span class="nx">entities</span><span class="p">[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4514'><br/></div><div class='line' id='LC4515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if not exists, return undefined</span></div><div class='line' id='LC4516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">selector</span> <span class="k">in</span> <span class="nx">entities</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC4517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC4518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4520'><br/></div><div class='line' id='LC4521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">selector</span><span class="p">;</span></div><div class='line' id='LC4522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC4523'><br/></div><div class='line' id='LC4524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//update from the cache</span></div><div class='line' id='LC4525'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4526'><br/></div><div class='line' id='LC4527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//update to the cache if NULL</span></div><div class='line' id='LC4528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entities</span><span class="p">[</span><span class="nx">selector</span><span class="p">])</span> <span class="nx">entities</span><span class="p">[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4529'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">[</span><span class="nx">selector</span><span class="p">];</span> <span class="c1">//return the cached selector</span></div><div class='line' id='LC4530'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4531'><br/></div><div class='line' id='LC4532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4533'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4534'><br/></div><div class='line' id='LC4535'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4536'><span class="cm">     * #.setName</span></div><div class='line' id='LC4537'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4538'><span class="cm">     * @sign public this .setName(String name)</span></div><div class='line' id='LC4539'><span class="cm">     * @param name - A human readable name for debugging purposes.</span></div><div class='line' id='LC4540'><span class="cm">     *</span></div><div class='line' id='LC4541'><span class="cm">     * @example</span></div><div class='line' id='LC4542'><span class="cm">     * ~~~</span></div><div class='line' id='LC4543'><span class="cm">     * this.setName(&quot;Player&quot;);</span></div><div class='line' id='LC4544'><span class="cm">     * ~~~</span></div><div class='line' id='LC4545'><span class="cm">     */</span></div><div class='line' id='LC4546'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setName</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4547'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">entityName</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span></div><div class='line' id='LC4548'><br/></div><div class='line' id='LC4549'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_entityName</span> <span class="o">=</span> <span class="nx">entityName</span><span class="p">;</span></div><div class='line' id='LC4550'><br/></div><div class='line' id='LC4551'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NewEntityName&quot;</span><span class="p">,</span> <span class="nx">entityName</span><span class="p">);</span></div><div class='line' id='LC4552'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4553'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4554'><br/></div><div class='line' id='LC4555'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4556'><span class="cm">     * #.addComponent</span></div><div class='line' id='LC4557'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4558'><span class="cm">     * @sign public this .addComponent(String componentList)</span></div><div class='line' id='LC4559'><span class="cm">     * @param componentList - A string of components to add separated by a comma `,`</span></div><div class='line' id='LC4560'><span class="cm">     * @sign public this .addComponent(String Component1[, .., String ComponentN])</span></div><div class='line' id='LC4561'><span class="cm">     * @param Component# - Component ID to add.</span></div><div class='line' id='LC4562'><span class="cm">     * Adds a component to the selected entities or entity.</span></div><div class='line' id='LC4563'><span class="cm">     *</span></div><div class='line' id='LC4564'><span class="cm">     * Components are used to extend the functionality of entities.</span></div><div class='line' id='LC4565'><span class="cm">     * This means it will copy properties and assign methods to</span></div><div class='line' id='LC4566'><span class="cm">     * augment the functionality of the entity.</span></div><div class='line' id='LC4567'><span class="cm">     *</span></div><div class='line' id='LC4568'><span class="cm">     * For adding multiple components, you can either pass a string with</span></div><div class='line' id='LC4569'><span class="cm">     * all the component names (separated by commas), or pass each component name as</span></div><div class='line' id='LC4570'><span class="cm">     * an argument.</span></div><div class='line' id='LC4571'><span class="cm">     *</span></div><div class='line' id='LC4572'><span class="cm">     * If the component has a function named `init` it will be called.</span></div><div class='line' id='LC4573'><span class="cm">     *</span></div><div class='line' id='LC4574'><span class="cm">     * If the entity already has the component, the component is skipped (nothing happens).</span></div><div class='line' id='LC4575'><span class="cm">     *</span></div><div class='line' id='LC4576'><span class="cm">     * @example</span></div><div class='line' id='LC4577'><span class="cm">     * ~~~</span></div><div class='line' id='LC4578'><span class="cm">     * this.addComponent(&quot;2D, Canvas&quot;);</span></div><div class='line' id='LC4579'><span class="cm">     * this.addComponent(&quot;2D&quot;, &quot;Canvas&quot;);</span></div><div class='line' id='LC4580'><span class="cm">     * ~~~</span></div><div class='line' id='LC4581'><span class="cm">     */</span></div><div class='line' id='LC4582'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addComponent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4583'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">uninit</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC4584'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4585'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ul</span><span class="p">,</span> <span class="c1">//array of components to init</span></div><div class='line' id='LC4586'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4587'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">,</span> <span class="nx">comps</span><span class="p">,</span> <span class="nx">comp</span><span class="p">;</span></div><div class='line' id='LC4588'><br/></div><div class='line' id='LC4589'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//add multiple arguments</span></div><div class='line' id='LC4590'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4591'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4592'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4593'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">uninit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4594'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4595'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//split components if contains comma</span></div><div class='line' id='LC4596'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4597'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comps</span> <span class="o">=</span> <span class="nx">id</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">rlist</span><span class="p">);</span></div><div class='line' id='LC4598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">comps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">uninit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4601'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//single component passed</span></div><div class='line' id='LC4603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4604'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">uninit</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span></div><div class='line' id='LC4605'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4606'><br/></div><div class='line' id='LC4607'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//extend the components</span></div><div class='line' id='LC4608'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ul</span> <span class="o">=</span> <span class="nx">uninit</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">c</span> <span class="o">&lt;</span> <span class="nx">ul</span><span class="p">;</span> <span class="nx">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4610'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">uninit</span><span class="p">[</span><span class="nx">c</span><span class="p">]]</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span></div><div class='line' id='LC4611'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC4612'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">uninit</span><span class="p">[</span><span class="nx">c</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC4613'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">uninit</span><span class="p">[</span><span class="nx">c</span><span class="p">]];</span></div><div class='line' id='LC4614'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">comp</span><span class="p">);</span></div><div class='line' id='LC4615'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if constructor, call it</span></div><div class='line' id='LC4616'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">comp</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;init&quot;</span> <span class="k">in</span> <span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4617'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC4618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4619'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4620'><br/></div><div class='line' id='LC4621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NewComponent&quot;</span><span class="p">,</span> <span class="nx">uninit</span><span class="p">);</span></div><div class='line' id='LC4622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4623'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4624'><br/></div><div class='line' id='LC4625'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4626'><span class="cm">     * #.toggleComponent</span></div><div class='line' id='LC4627'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4628'><span class="cm">     * @sign public this .toggleComponent(String ComponentList)</span></div><div class='line' id='LC4629'><span class="cm">     * @param ComponentList - A string of components to add or remove separated by a comma `,`</span></div><div class='line' id='LC4630'><span class="cm">     * @sign public this .toggleComponent(String Component1[, .., String componentN])</span></div><div class='line' id='LC4631'><span class="cm">     * @param Component# - Component ID to add or remove.</span></div><div class='line' id='LC4632'><span class="cm">     * Add or Remove Components from an entity.</span></div><div class='line' id='LC4633'><span class="cm">     *</span></div><div class='line' id='LC4634'><span class="cm">     * @example</span></div><div class='line' id='LC4635'><span class="cm">     * ~~~</span></div><div class='line' id='LC4636'><span class="cm">     * var e = Crafty.e(&quot;2D,DOM,Test&quot;);</span></div><div class='line' id='LC4637'><span class="cm">     * e.toggleComponent(&quot;Test,Test2&quot;); //Remove Test, add Test2</span></div><div class='line' id='LC4638'><span class="cm">     * e.toggleComponent(&quot;Test,Test2&quot;); //Add Test, remove Test2</span></div><div class='line' id='LC4639'><span class="cm">     * ~~~</span></div><div class='line' id='LC4640'><span class="cm">     *</span></div><div class='line' id='LC4641'><span class="cm">     * ~~~</span></div><div class='line' id='LC4642'><span class="cm">     * var e = Crafty.e(&quot;2D,DOM,Test&quot;);</span></div><div class='line' id='LC4643'><span class="cm">     * e.toggleComponent(&quot;Test&quot;,&quot;Test2&quot;); //Remove Test, add Test2</span></div><div class='line' id='LC4644'><span class="cm">     * e.toggleComponent(&quot;Test&quot;,&quot;Test2&quot;); //Add Test, remove Test2</span></div><div class='line' id='LC4645'><span class="cm">     * e.toggleComponent(&quot;Test&quot;);         //Remove Test</span></div><div class='line' id='LC4646'><span class="cm">     * ~~~</span></div><div class='line' id='LC4647'><span class="cm">     */</span></div><div class='line' id='LC4648'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">toggleComponent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toggle</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4649'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4650'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">,</span> <span class="nx">comps</span><span class="p">;</span></div><div class='line' id='LC4651'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4652'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4653'><br/></div><div class='line' id='LC4654'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4655'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span></div><div class='line' id='LC4656'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">removeComponent</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4657'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4658'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4659'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4660'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4661'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//split components if contains comma</span></div><div class='line' id='LC4662'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">toggle</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4663'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comps</span> <span class="o">=</span> <span class="nx">toggle</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">rlist</span><span class="p">);</span></div><div class='line' id='LC4664'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">comps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4665'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4666'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span></div><div class='line' id='LC4667'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">removeComponent</span><span class="p">(</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4668'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4669'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">comps</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC4670'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4671'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4672'><br/></div><div class='line' id='LC4673'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//single component passed</span></div><div class='line' id='LC4674'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4675'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">toggle</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC4676'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">removeComponent</span><span class="p">(</span><span class="nx">toggle</span><span class="p">);</span></div><div class='line' id='LC4677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC4678'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">toggle</span><span class="p">);</span></div><div class='line' id='LC4679'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4680'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4681'><br/></div><div class='line' id='LC4682'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4683'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4684'><br/></div><div class='line' id='LC4685'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4686'><span class="cm">     * #.requires</span></div><div class='line' id='LC4687'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4688'><span class="cm">     * @sign public this .requires(String componentList)</span></div><div class='line' id='LC4689'><span class="cm">     * @param componentList - List of components that must be added</span></div><div class='line' id='LC4690'><span class="cm">     *</span></div><div class='line' id='LC4691'><span class="cm">     * Makes sure the entity has the components listed. If the entity does not</span></div><div class='line' id='LC4692'><span class="cm">     * have the component, it will add it.</span></div><div class='line' id='LC4693'><span class="cm">     *</span></div><div class='line' id='LC4694'><span class="cm">     * (In the current version of Crafty, this function behaves exactly the same</span></div><div class='line' id='LC4695'><span class="cm">     * as `addComponent`. By convention, developers have used `requires` for</span></div><div class='line' id='LC4696'><span class="cm">     * component dependencies -- i.e. to indicate specifically that one component</span></div><div class='line' id='LC4697'><span class="cm">     * will only work properly if another component is present -- and used</span></div><div class='line' id='LC4698'><span class="cm">     * `addComponent` in all other situations.)</span></div><div class='line' id='LC4699'><span class="cm">     *</span></div><div class='line' id='LC4700'><span class="cm">     * @see .addComponent</span></div><div class='line' id='LC4701'><span class="cm">     */</span></div><div class='line' id='LC4702'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">requires</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">list</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span></div><div class='line' id='LC4704'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4705'><br/></div><div class='line' id='LC4706'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4707'><span class="cm">     * #.removeComponent</span></div><div class='line' id='LC4708'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4709'><span class="cm">     * @sign public this .removeComponent(String Component[, soft])</span></div><div class='line' id='LC4710'><span class="cm">     * @param component - Component to remove</span></div><div class='line' id='LC4711'><span class="cm">     * @param soft - Whether to soft remove it (defaults to `true`)</span></div><div class='line' id='LC4712'><span class="cm">     *</span></div><div class='line' id='LC4713'><span class="cm">     * Removes a component from an entity. A soft remove (the default) will only</span></div><div class='line' id='LC4714'><span class="cm">     * refrain `.has()` from returning true. Hard will remove all</span></div><div class='line' id='LC4715'><span class="cm">     * associated properties and methods.</span></div><div class='line' id='LC4716'><span class="cm">     *</span></div><div class='line' id='LC4717'><span class="cm">     * @example</span></div><div class='line' id='LC4718'><span class="cm">     * ~~~</span></div><div class='line' id='LC4719'><span class="cm">     * var e = Crafty.e(&quot;2D,DOM,Test&quot;);</span></div><div class='line' id='LC4720'><span class="cm">     * e.removeComponent(&quot;Test&quot;);        //Soft remove Test component</span></div><div class='line' id='LC4721'><span class="cm">     * e.removeComponent(&quot;Test&quot;, false); //Hard remove Test component</span></div><div class='line' id='LC4722'><span class="cm">     * ~~~</span></div><div class='line' id='LC4723'><span class="cm">     */</span></div><div class='line' id='LC4724'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">removeComponent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">soft</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4725'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">comp</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC4726'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span></div><div class='line' id='LC4727'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">comp</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;remove&quot;</span> <span class="k">in</span> <span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span><span class="p">.</span><span class="nx">remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC4729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">soft</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span></div><div class='line' id='LC4733'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4734'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4735'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC4736'><br/></div><div class='line' id='LC4737'><br/></div><div class='line' id='LC4738'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4739'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4740'><br/></div><div class='line' id='LC4741'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4742'><span class="cm">     * #.getId</span></div><div class='line' id='LC4743'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4744'><span class="cm">     * @sign public Number .getId(void)</span></div><div class='line' id='LC4745'><span class="cm">     * Returns the ID of this entity.</span></div><div class='line' id='LC4746'><span class="cm">     *</span></div><div class='line' id='LC4747'><span class="cm">     * For better performance, simply use the this[0] property.</span></div><div class='line' id='LC4748'><span class="cm">     *</span></div><div class='line' id='LC4749'><span class="cm">     * @example</span></div><div class='line' id='LC4750'><span class="cm">     * Finding out the `ID` of an entity can be done by returning the property `0`.</span></div><div class='line' id='LC4751'><span class="cm">     * ~~~</span></div><div class='line' id='LC4752'><span class="cm">     *    var ent = Crafty.e(&quot;2D&quot;);</span></div><div class='line' id='LC4753'><span class="cm">     *    ent[0]; //ID</span></div><div class='line' id='LC4754'><span class="cm">     *    ent.getId(); //also ID</span></div><div class='line' id='LC4755'><span class="cm">     * ~~~</span></div><div class='line' id='LC4756'><span class="cm">     */</span></div><div class='line' id='LC4757'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">getId</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4758'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC4759'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4760'><br/></div><div class='line' id='LC4761'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4762'><span class="cm">     * #.has</span></div><div class='line' id='LC4763'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4764'><span class="cm">     * @sign public Boolean .has(String component)</span></div><div class='line' id='LC4765'><span class="cm">     * Returns `true` or `false` depending on if the</span></div><div class='line' id='LC4766'><span class="cm">     * entity has the given component.</span></div><div class='line' id='LC4767'><span class="cm">     *</span></div><div class='line' id='LC4768'><span class="cm">     * For better performance, simply use the `.__c` object</span></div><div class='line' id='LC4769'><span class="cm">     * which will be `true` if the entity has the component or</span></div><div class='line' id='LC4770'><span class="cm">     * will not exist (or be `false`).</span></div><div class='line' id='LC4771'><span class="cm">     */</span></div><div class='line' id='LC4772'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">has</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC4774'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4775'><br/></div><div class='line' id='LC4776'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4777'><span class="cm">     * #.attr</span></div><div class='line' id='LC4778'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4779'><span class="cm">     * @sign public this .attr(String property, * value)</span></div><div class='line' id='LC4780'><span class="cm">     * @param property - Property of the entity to modify</span></div><div class='line' id='LC4781'><span class="cm">     * @param value - Value to set the property to</span></div><div class='line' id='LC4782'><span class="cm">     * @sign public this .attr(Object map)</span></div><div class='line' id='LC4783'><span class="cm">     * @param map - Object where the key is the property to modify and the value as the property value</span></div><div class='line' id='LC4784'><span class="cm">     * @trigger Change - when properties change - {key: value}</span></div><div class='line' id='LC4785'><span class="cm">     *</span></div><div class='line' id='LC4786'><span class="cm">     * Use this method to set any property of the entity.</span></div><div class='line' id='LC4787'><span class="cm">     *</span></div><div class='line' id='LC4788'><span class="cm">     * @example</span></div><div class='line' id='LC4789'><span class="cm">     * ~~~</span></div><div class='line' id='LC4790'><span class="cm">     * this.attr({key: &quot;value&quot;, prop: 5});</span></div><div class='line' id='LC4791'><span class="cm">     * this.key; //value</span></div><div class='line' id='LC4792'><span class="cm">     * this.prop; //5</span></div><div class='line' id='LC4793'><span class="cm">     *</span></div><div class='line' id='LC4794'><span class="cm">     * this.attr(&quot;key&quot;, &quot;newvalue&quot;);</span></div><div class='line' id='LC4795'><span class="cm">     * this.key; //newvalue</span></div><div class='line' id='LC4796'><span class="cm">     * ~~~</span></div><div class='line' id='LC4797'><span class="cm">     */</span></div><div class='line' id='LC4798'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">attr</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if just the key, return the value</span></div><div class='line' id='LC4801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC4803'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4804'><br/></div><div class='line' id='LC4805'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//extend if object</span></div><div class='line' id='LC4806'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></div><div class='line' id='LC4807'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span> <span class="c1">//trigger change event</span></div><div class='line' id='LC4808'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4809'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4810'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if key value pair</span></div><div class='line' id='LC4811'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC4812'><br/></div><div class='line' id='LC4813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">change</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4814'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">change</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC4815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="nx">change</span><span class="p">);</span> <span class="c1">//trigger change event</span></div><div class='line' id='LC4816'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4817'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4818'><br/></div><div class='line' id='LC4819'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4820'><span class="cm">     * #.toArray</span></div><div class='line' id='LC4821'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4822'><span class="cm">     * @sign public this .toArray(void)</span></div><div class='line' id='LC4823'><span class="cm">     *</span></div><div class='line' id='LC4824'><span class="cm">     * This method will simply return the found entities as an array of ids.  To get an array of the actual entities, use `get()`.</span></div><div class='line' id='LC4825'><span class="cm">     * @see .get</span></div><div class='line' id='LC4826'><span class="cm">     */</span></div><div class='line' id='LC4827'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">toArray</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4828'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC4829'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4830'><br/></div><div class='line' id='LC4831'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4832'><span class="cm">    * #.timeout</span></div><div class='line' id='LC4833'><span class="cm">    * @comp Crafty Core</span></div><div class='line' id='LC4834'><span class="cm">    * @sign public this .timeout(Function callback, Number delay)</span></div><div class='line' id='LC4835'><span class="cm">    * @param callback - Method to execute after given amount of milliseconds</span></div><div class='line' id='LC4836'><span class="cm">    * @param delay - Amount of milliseconds to execute the method</span></div><div class='line' id='LC4837'><span class="cm">    *</span></div><div class='line' id='LC4838'><span class="cm">    * The delay method will execute a function after a given amount of time in milliseconds.</span></div><div class='line' id='LC4839'><span class="cm">    *</span></div><div class='line' id='LC4840'><span class="cm">    * Essentially a wrapper for `setTimeout`.</span></div><div class='line' id='LC4841'><span class="cm">    *</span></div><div class='line' id='LC4842'><span class="cm">    * @example</span></div><div class='line' id='LC4843'><span class="cm">    * Destroy itself after 100 milliseconds</span></div><div class='line' id='LC4844'><span class="cm">    * ~~~</span></div><div class='line' id='LC4845'><span class="cm">    * this.timeout(function() {</span></div><div class='line' id='LC4846'><span class="cm">         this.destroy();</span></div><div class='line' id='LC4847'><span class="cm">    * }, 100);</span></div><div class='line' id='LC4848'><span class="cm">    * ~~~</span></div><div class='line' id='LC4849'><span class="cm">    */</span></div><div class='line' id='LC4850'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">timeout</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4852'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4854'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">);</span></div><div class='line' id='LC4855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="nx">duration</span><span class="p">);</span></div><div class='line' id='LC4856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4857'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4858'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4859'><br/></div><div class='line' id='LC4860'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4861'><span class="cm">     * #.bind</span></div><div class='line' id='LC4862'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4863'><span class="cm">     * @sign public this .bind(String eventName, Function callback)</span></div><div class='line' id='LC4864'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC4865'><span class="cm">     * @param callback - Method to execute when the event is triggered</span></div><div class='line' id='LC4866'><span class="cm">     * Attach the current entity (or entities) to listen for an event.</span></div><div class='line' id='LC4867'><span class="cm">     *</span></div><div class='line' id='LC4868'><span class="cm">     * Callback will be invoked when an event with the event name passed</span></div><div class='line' id='LC4869'><span class="cm">     * is triggered. Depending on the event, some data may be passed</span></div><div class='line' id='LC4870'><span class="cm">     * via an argument to the callback function.</span></div><div class='line' id='LC4871'><span class="cm">     *</span></div><div class='line' id='LC4872'><span class="cm">     * The first argument is the event name (can be anything) whilst the</span></div><div class='line' id='LC4873'><span class="cm">     * second argument is the callback. If the event has data, the</span></div><div class='line' id='LC4874'><span class="cm">     * callback should have an argument.</span></div><div class='line' id='LC4875'><span class="cm">     *</span></div><div class='line' id='LC4876'><span class="cm">     * Events are arbitrary and provide communication between components.</span></div><div class='line' id='LC4877'><span class="cm">     * You can trigger or bind an event even if it doesn&#39;t exist yet.</span></div><div class='line' id='LC4878'><span class="cm">     *</span></div><div class='line' id='LC4879'><span class="cm">     * Unlike DOM events, Crafty events are exectued synchronously.</span></div><div class='line' id='LC4880'><span class="cm">     *</span></div><div class='line' id='LC4881'><span class="cm">     * @example</span></div><div class='line' id='LC4882'><span class="cm">     * ~~~</span></div><div class='line' id='LC4883'><span class="cm">     * this.attr(&quot;triggers&quot;, 0); //set a trigger count</span></div><div class='line' id='LC4884'><span class="cm">     * this.bind(&quot;myevent&quot;, function() {</span></div><div class='line' id='LC4885'><span class="cm">     *     this.triggers++; //whenever myevent is triggered, increment</span></div><div class='line' id='LC4886'><span class="cm">     * });</span></div><div class='line' id='LC4887'><span class="cm">     * this.bind(&quot;EnterFrame&quot;, function() {</span></div><div class='line' id='LC4888'><span class="cm">     *     this.trigger(&quot;myevent&quot;); //trigger myevent on every frame</span></div><div class='line' id='LC4889'><span class="cm">     * });</span></div><div class='line' id='LC4890'><span class="cm">     * ~~~</span></div><div class='line' id='LC4891'><span class="cm">     *</span></div><div class='line' id='LC4892'><span class="cm">     * @see .trigger, .unbind</span></div><div class='line' id='LC4893'><span class="cm">     */</span></div><div class='line' id='LC4894'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4895'><br/></div><div class='line' id='LC4896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// (To learn how the handlers object works, see inline comment at Crafty.bind)</span></div><div class='line' id='LC4897'><br/></div><div class='line' id='LC4898'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//optimization for 1 entity</span></div><div class='line' id='LC4899'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">])</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span></div><div class='line' id='LC4902'><br/></div><div class='line' id='LC4903'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">//init handler array for entity</span></div><div class='line' id='LC4904'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span> <span class="c1">//add current callback</span></div><div class='line' id='LC4905'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4906'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4907'><br/></div><div class='line' id='LC4908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//init event collection</span></div><div class='line' id='LC4910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">])</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC4911'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span></div><div class='line' id='LC4912'><br/></div><div class='line' id='LC4913'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">//init handler array for entity</span></div><div class='line' id='LC4914'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span> <span class="c1">//add current callback</span></div><div class='line' id='LC4915'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4916'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4917'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4918'><br/></div><div class='line' id='LC4919'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4920'><span class="cm">     * #.uniqueBind</span></div><div class='line' id='LC4921'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4922'><span class="cm">     * @sign public Number .uniqueBind(String eventName, Function callback)</span></div><div class='line' id='LC4923'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC4924'><span class="cm">     * @param callback - Method to execute upon event triggered</span></div><div class='line' id='LC4925'><span class="cm">     * @returns ID of the current callback used to unbind</span></div><div class='line' id='LC4926'><span class="cm">     *</span></div><div class='line' id='LC4927'><span class="cm">     * Works like Crafty.bind, but prevents a callback from being bound multiple times.</span></div><div class='line' id='LC4928'><span class="cm">     *</span></div><div class='line' id='LC4929'><span class="cm">     * @see .bind</span></div><div class='line' id='LC4930'><span class="cm">     */</span></div><div class='line' id='LC4931'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">uniqueBind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4932'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC4933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC4934'><br/></div><div class='line' id='LC4935'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4936'><br/></div><div class='line' id='LC4937'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4938'><span class="cm">     * #.one</span></div><div class='line' id='LC4939'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4940'><span class="cm">     * @sign public Number one(String eventName, Function callback)</span></div><div class='line' id='LC4941'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC4942'><span class="cm">     * @param callback - Method to execute upon event triggered</span></div><div class='line' id='LC4943'><span class="cm">     * @returns ID of the current callback used to unbind</span></div><div class='line' id='LC4944'><span class="cm">     *</span></div><div class='line' id='LC4945'><span class="cm">     * Works like Crafty.bind, but will be unbound once the event triggers.</span></div><div class='line' id='LC4946'><span class="cm">     *</span></div><div class='line' id='LC4947'><span class="cm">     * @see .bind</span></div><div class='line' id='LC4948'><span class="cm">     */</span></div><div class='line' id='LC4949'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">one</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oneHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4952'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC4953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">oneHandler</span><span class="p">);</span></div><div class='line' id='LC4954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC4955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">oneHandler</span><span class="p">);</span></div><div class='line' id='LC4956'><br/></div><div class='line' id='LC4957'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4958'><br/></div><div class='line' id='LC4959'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC4960'><span class="cm">     * #.unbind</span></div><div class='line' id='LC4961'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC4962'><span class="cm">     * @sign public this .unbind(String eventName[, Function callback])</span></div><div class='line' id='LC4963'><span class="cm">     * @param eventName - Name of the event to unbind</span></div><div class='line' id='LC4964'><span class="cm">     * @param callback - Function to unbind</span></div><div class='line' id='LC4965'><span class="cm">     * Removes binding with an event from current entity.</span></div><div class='line' id='LC4966'><span class="cm">     *</span></div><div class='line' id='LC4967'><span class="cm">     * Passing an event name will remove all events bound to</span></div><div class='line' id='LC4968'><span class="cm">     * that event. Passing a reference to the callback will</span></div><div class='line' id='LC4969'><span class="cm">     * unbind only that callback.</span></div><div class='line' id='LC4970'><span class="cm">     * @see .bind, .trigger</span></div><div class='line' id='LC4971'><span class="cm">     */</span></div><div class='line' id='LC4972'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unbind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// (To learn how the handlers object works, see inline comment at Crafty.bind)</span></div><div class='line' id='LC4974'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC4975'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">hdl</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">],</span></div><div class='line' id='LC4976'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC4977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">,</span> <span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC4978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if no events, cancel</span></div><div class='line' id='LC4979'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">hdl</span> <span class="o">&amp;&amp;</span> <span class="nx">hdl</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">hdl</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC4980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4981'><br/></div><div class='line' id='LC4982'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if no function, delete all</span></div><div class='line' id='LC4983'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4984'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">hdl</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></div><div class='line' id='LC4985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//look for a match if the function is passed</span></div><div class='line' id='LC4988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">hdl</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></div><div class='line' id='LC4990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC4991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">current</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC4992'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4993'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC4994'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC4995'><br/></div><div class='line' id='LC4996'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC4997'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC4998'><br/></div><div class='line' id='LC4999'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5000'><span class="cm">     * #.trigger</span></div><div class='line' id='LC5001'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5002'><span class="cm">     * @sign public this .trigger(String eventName[, Object data])</span></div><div class='line' id='LC5003'><span class="cm">     * @param eventName - Event to trigger</span></div><div class='line' id='LC5004'><span class="cm">     * @param data - Arbitrary data that will be passed into every callback as an argument</span></div><div class='line' id='LC5005'><span class="cm">     * Trigger an event with arbitrary data. Will invoke all callbacks with</span></div><div class='line' id='LC5006'><span class="cm">     * the context (value of `this`) of the current entity object.</span></div><div class='line' id='LC5007'><span class="cm">     *</span></div><div class='line' id='LC5008'><span class="cm">     * *Note: This will only execute callbacks within the current entity, no other entity.*</span></div><div class='line' id='LC5009'><span class="cm">     *</span></div><div class='line' id='LC5010'><span class="cm">     * The first argument is the event name to trigger and the optional</span></div><div class='line' id='LC5011'><span class="cm">     * second argument is the arbitrary event data. This can be absolutely anything.</span></div><div class='line' id='LC5012'><span class="cm">     *</span></div><div class='line' id='LC5013'><span class="cm">     * Unlike DOM events, Crafty events are exectued synchronously.</span></div><div class='line' id='LC5014'><span class="cm">     */</span></div><div class='line' id='LC5015'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// (To learn how the handlers object works, see inline comment at Crafty.bind)</span></div><div class='line' id='LC5017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//find the handlers assigned to the event and entity</span></div><div class='line' id='LC5019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span></div><div class='line' id='LC5020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span></div><div class='line' id='LC5021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC5022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC5025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC5026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC5028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5033'><br/></div><div class='line' id='LC5034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//find the handlers assigned to the event and entity</span></div><div class='line' id='LC5036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span></div><div class='line' id='LC5037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span></div><div class='line' id='LC5038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC5039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC5042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC5043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC5045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5050'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5051'><br/></div><div class='line' id='LC5052'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5053'><span class="cm">     * #.each</span></div><div class='line' id='LC5054'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5055'><span class="cm">     * @sign public this .each(Function method)</span></div><div class='line' id='LC5056'><span class="cm">     * @param method - Method to call on each iteration</span></div><div class='line' id='LC5057'><span class="cm">     * Iterates over found entities, calling a function for every entity.</span></div><div class='line' id='LC5058'><span class="cm">     *</span></div><div class='line' id='LC5059'><span class="cm">     * The function will be called for every entity and will pass the index</span></div><div class='line' id='LC5060'><span class="cm">     * in the iteration as an argument. The context (value of `this`) of the</span></div><div class='line' id='LC5061'><span class="cm">     * function will be the current entity in the iteration.</span></div><div class='line' id='LC5062'><span class="cm">     *</span></div><div class='line' id='LC5063'><span class="cm">     * @example</span></div><div class='line' id='LC5064'><span class="cm">     * Destroy every second 2D entity</span></div><div class='line' id='LC5065'><span class="cm">     * ~~~</span></div><div class='line' id='LC5066'><span class="cm">     * Crafty(&quot;2D&quot;).each(function(i) {</span></div><div class='line' id='LC5067'><span class="cm">     *     if(i % 2 === 0) {</span></div><div class='line' id='LC5068'><span class="cm">     *         this.destroy();</span></div><div class='line' id='LC5069'><span class="cm">     *     }</span></div><div class='line' id='LC5070'><span class="cm">     * });</span></div><div class='line' id='LC5071'><span class="cm">     * ~~~</span></div><div class='line' id='LC5072'><span class="cm">     */</span></div><div class='line' id='LC5073'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">each</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC5075'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC5076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//skip if not exists</span></div><div class='line' id='LC5078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC5079'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]],</span> <span class="nx">i</span><span class="p">);</span></div><div class='line' id='LC5080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5082'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5083'><br/></div><div class='line' id='LC5084'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5085'><span class="cm">     * #.get</span></div><div class='line' id='LC5086'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5087'><span class="cm">     * @sign public Array .get()</span></div><div class='line' id='LC5088'><span class="cm">     * @returns An array of entities corresponding to the active selector</span></div><div class='line' id='LC5089'><span class="cm">     * </span></div><div class='line' id='LC5090'><span class="cm">     * @sign public Entity .get(Number index)</span></div><div class='line' id='LC5091'><span class="cm">     * @returns an entity belonging to the current selection</span></div><div class='line' id='LC5092'><span class="cm">     * @param index - The index of the entity to return.  If negative, counts back from the end of the array.</span></div><div class='line' id='LC5093'><span class="cm">     * </span></div><div class='line' id='LC5094'><span class="cm">     *</span></div><div class='line' id='LC5095'><span class="cm">     * @example</span></div><div class='line' id='LC5096'><span class="cm">     * Get an array containing every &quot;2D&quot; entity</span></div><div class='line' id='LC5097'><span class="cm">     * ~~~</span></div><div class='line' id='LC5098'><span class="cm">     * var arr = Crafty(&quot;2D&quot;).get()</span></div><div class='line' id='LC5099'><span class="cm">     * ~~~</span></div><div class='line' id='LC5100'><span class="cm">     * Get the first entity matching the selector</span></div><div class='line' id='LC5101'><span class="cm">     * ~~~</span></div><div class='line' id='LC5102'><span class="cm">     * // equivalent to Crafty(&quot;2D&quot;).get()[0], but doesn&#39;t create a new array</span></div><div class='line' id='LC5103'><span class="cm">     * var e = Crafty(&quot;2D&quot;).get(0)</span></div><div class='line' id='LC5104'><span class="cm">     * ~~~</span></div><div class='line' id='LC5105'><span class="cm">     * Get the last &quot;2D&quot; entity matching the selector</span></div><div class='line' id='LC5106'><span class="cm">     * ~~~</span></div><div class='line' id='LC5107'><span class="cm">     * var e = Crafty(&quot;2D&quot;).get(-1)</span></div><div class='line' id='LC5108'><span class="cm">     * ~~~</span></div><div class='line' id='LC5109'><span class="cm">     * </span></div><div class='line' id='LC5110'><span class="cm">     */</span></div><div class='line' id='LC5111'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC5113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">index</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="nx">l</span> <span class="o">||</span> <span class="nx">index</span><span class="o">+</span><span class="nx">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC5115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span></div><div class='line' id='LC5116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">index</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC5117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">]];</span></div><div class='line' id='LC5118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC5119'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="o">+</span><span class="nx">l</span><span class="p">]];</span></div><div class='line' id='LC5120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC5122'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//skip if not exists</span></div><div class='line' id='LC5124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC5125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="p">);</span></div><div class='line' id='LC5126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">result</span><span class="p">;</span></div><div class='line' id='LC5128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5129'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5130'><br/></div><div class='line' id='LC5131'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5132'><span class="cm">     * #.clone</span></div><div class='line' id='LC5133'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5134'><span class="cm">     * @sign public Entity .clone(void)</span></div><div class='line' id='LC5135'><span class="cm">     * @returns Cloned entity of the current entity</span></div><div class='line' id='LC5136'><span class="cm">     *</span></div><div class='line' id='LC5137'><span class="cm">     * Method will create another entity with the exact same</span></div><div class='line' id='LC5138'><span class="cm">     * properties, components and methods as the current entity.</span></div><div class='line' id='LC5139'><span class="cm">     */</span></div><div class='line' id='LC5140'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clone</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">comps</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">,</span></div><div class='line' id='LC5142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span><span class="p">,</span></div><div class='line' id='LC5143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prop</span><span class="p">,</span></div><div class='line' id='LC5144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clone</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">();</span></div><div class='line' id='LC5145'><br/></div><div class='line' id='LC5146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">comp</span> <span class="k">in</span> <span class="nx">comps</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clone</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">comp</span><span class="p">);</span></div><div class='line' id='LC5148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">prop</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">prop</span> <span class="o">!=</span> <span class="s2">&quot;_global&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">prop</span> <span class="o">!=</span> <span class="s2">&quot;_changed&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5151'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clone</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span></div><div class='line' id='LC5152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5154'><br/></div><div class='line' id='LC5155'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">clone</span><span class="p">;</span></div><div class='line' id='LC5156'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5157'><br/></div><div class='line' id='LC5158'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5159'><span class="cm">     * #.setter</span></div><div class='line' id='LC5160'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5161'><span class="cm">     * @sign public this .setter(String property, Function callback)</span></div><div class='line' id='LC5162'><span class="cm">     * @param property - Property to watch for modification</span></div><div class='line' id='LC5163'><span class="cm">     * @param callback - Method to execute if the property is modified</span></div><div class='line' id='LC5164'><span class="cm">     * Will watch a property waiting for modification and will then invoke the</span></div><div class='line' id='LC5165'><span class="cm">     * given callback when attempting to modify.</span></div><div class='line' id='LC5166'><span class="cm">     *</span></div><div class='line' id='LC5167'><span class="cm">     */</span></div><div class='line' id='LC5168'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">setter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC5171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC5173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="nx">callback</span><span class="p">,</span></div><div class='line' id='LC5174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC5175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5178'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5179'><br/></div><div class='line' id='LC5180'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5181'><span class="cm">     * #.destroy</span></div><div class='line' id='LC5182'><span class="cm">     * @comp Crafty Core</span></div><div class='line' id='LC5183'><span class="cm">     * @sign public this .destroy(void)</span></div><div class='line' id='LC5184'><span class="cm">     * Will remove all event listeners and delete all properties as well as removing from the stage</span></div><div class='line' id='LC5185'><span class="cm">     */</span></div><div class='line' id='LC5186'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//remove all event handlers, delete from entities</span></div><div class='line' id='LC5188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">comp</span><span class="p">;</span></div><div class='line' id='LC5190'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">);</span></div><div class='line' id='LC5191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">compName</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">__c</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">compName</span><span class="p">];</span></div><div class='line' id='LC5193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">comp</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;remove&quot;</span> <span class="k">in</span> <span class="nx">comp</span><span class="p">)</span></div><div class='line' id='LC5194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">comp</span><span class="p">.</span><span class="nx">remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></div><div class='line' id='LC5195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">handlers</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5197'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC5198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">entities</span><span class="p">[</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span></div><div class='line' id='LC5200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5201'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5202'><span class="p">};</span></div><div class='line' id='LC5203'><br/></div><div class='line' id='LC5204'><span class="c1">//give the init instances the Crafty prototype</span></div><div class='line' id='LC5205'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span></div><div class='line' id='LC5206'><br/></div><div class='line' id='LC5207'><br/></div><div class='line' id='LC5208'><span class="cm">/**@</span></div><div class='line' id='LC5209'><span class="cm"> * #Crafty.extend</span></div><div class='line' id='LC5210'><span class="cm"> * @category Core</span></div><div class='line' id='LC5211'><span class="cm"> * Used to extend the Crafty namespace.</span></div><div class='line' id='LC5212'><span class="cm"> *</span></div><div class='line' id='LC5213'><span class="cm"> */</span></div><div class='line' id='LC5214'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5215'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span></div><div class='line' id='LC5216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">key</span><span class="p">;</span></div><div class='line' id='LC5217'><br/></div><div class='line' id='LC5218'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//don&#39;t bother with nulls</span></div><div class='line' id='LC5219'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="k">return</span> <span class="nx">target</span><span class="p">;</span></div><div class='line' id='LC5220'><br/></div><div class='line' id='LC5221'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">//handle circular reference</span></div><div class='line' id='LC5223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC5224'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5225'><br/></div><div class='line' id='LC5226'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">target</span><span class="p">;</span></div><div class='line' id='LC5227'><span class="p">};</span></div><div class='line' id='LC5228'><br/></div><div class='line' id='LC5229'><br/></div><div class='line' id='LC5230'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC5231'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5232'><span class="cm">     * #Crafty.init</span></div><div class='line' id='LC5233'><span class="cm">     * @category Core</span></div><div class='line' id='LC5234'><span class="cm">     * @trigger Load - Just after the viewport is initialised. Before the EnterFrame loops is started</span></div><div class='line' id='LC5235'><span class="cm">     * @sign public this Crafty.init([Number width, Number height, String stage_elem])</span></div><div class='line' id='LC5236'><span class="cm">     * @sign public this Crafty.init([Number width, Number height, HTMLElement stage_elem])</span></div><div class='line' id='LC5237'><span class="cm">     * @param Number width - Width of the stage</span></div><div class='line' id='LC5238'><span class="cm">     * @param Number height - Height of the stage</span></div><div class='line' id='LC5239'><span class="cm">     * @param String or HTMLElement stage_elem - the element to use for the stage</span></div><div class='line' id='LC5240'><span class="cm">     *</span></div><div class='line' id='LC5241'><span class="cm">     * Sets the element to use as the stage, creating it if necessary.  By default a div with id &#39;cr-stage&#39; is used, but if the &#39;stage_elem&#39; argument is provided that will be used instead.  (see `Crafty.viewport.init`)</span></div><div class='line' id='LC5242'><span class="cm">     *</span></div><div class='line' id='LC5243'><span class="cm">     * Starts the `EnterFrame` interval. This will call the `EnterFrame` event for every frame.</span></div><div class='line' id='LC5244'><span class="cm">     *</span></div><div class='line' id='LC5245'><span class="cm">     * Can pass width and height values for the stage otherwise will default to window size (see `Crafty.DOM.window`).</span></div><div class='line' id='LC5246'><span class="cm">     *</span></div><div class='line' id='LC5247'><span class="cm">     * All `Load` events will be executed.</span></div><div class='line' id='LC5248'><span class="cm">     *</span></div><div class='line' id='LC5249'><span class="cm">     * Uses `requestAnimationFrame` to sync the drawing with the browser but will default to `setInterval` if the browser does not support it.</span></div><div class='line' id='LC5250'><span class="cm">     * @see Crafty.stop,  Crafty.viewport</span></div><div class='line' id='LC5251'><span class="cm">     */</span></div><div class='line' id='LC5252'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">stage_elem</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">stage_elem</span><span class="p">);</span></div><div class='line' id='LC5254'><br/></div><div class='line' id='LC5255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//call all arbitrary functions attached to onload</span></div><div class='line' id='LC5256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">);</span></div><div class='line' id='LC5257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC5258'><br/></div><div class='line' id='LC5259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5260'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5261'><br/></div><div class='line' id='LC5262'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5263'><span class="cm">     * #Crafty.getVersion</span></div><div class='line' id='LC5264'><span class="cm">     * @category Core</span></div><div class='line' id='LC5265'><span class="cm">     * @sign public String Crafty.getVersion()</span></div><div class='line' id='LC5266'><span class="cm">     * @returns Current version of Crafty as a string</span></div><div class='line' id='LC5267'><span class="cm">     *</span></div><div class='line' id='LC5268'><span class="cm">     * Return current version of crafty</span></div><div class='line' id='LC5269'><span class="cm">     *</span></div><div class='line' id='LC5270'><span class="cm">     * @example</span></div><div class='line' id='LC5271'><span class="cm">     * ~~~</span></div><div class='line' id='LC5272'><span class="cm">     * Crafty.getVersion(); //&#39;0.5.2&#39;</span></div><div class='line' id='LC5273'><span class="cm">     * ~~~</span></div><div class='line' id='LC5274'><span class="cm">     */</span></div><div class='line' id='LC5275'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">getVersion</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">version</span><span class="p">;</span></div><div class='line' id='LC5277'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5278'><br/></div><div class='line' id='LC5279'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5280'><span class="cm">     * #Crafty.stop</span></div><div class='line' id='LC5281'><span class="cm">     * @category Core</span></div><div class='line' id='LC5282'><span class="cm">     * @trigger CraftyStop - when the game is stopped</span></div><div class='line' id='LC5283'><span class="cm">     * @sign public this Crafty.stop([bool clearState])</span></div><div class='line' id='LC5284'><span class="cm">     * @param clearState - if true the stage and all game state is cleared.</span></div><div class='line' id='LC5285'><span class="cm">     *</span></div><div class='line' id='LC5286'><span class="cm">     * Stops the EnterFrame interval and removes the stage element.</span></div><div class='line' id='LC5287'><span class="cm">     *</span></div><div class='line' id='LC5288'><span class="cm">     * To restart, use `Crafty.init()`.</span></div><div class='line' id='LC5289'><span class="cm">     * @see Crafty.init</span></div><div class='line' id='LC5290'><span class="cm">     */</span></div><div class='line' id='LC5291'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">clearState</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC5293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">clearState</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span></div><div class='line' id='LC5295'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span> <span class="o">&amp;&amp;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">newCrStage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span></div><div class='line' id='LC5297'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">newCrStage</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></div><div class='line' id='LC5298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">newCrStage</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">);</span></div><div class='line' id='LC5299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5300'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">initState</span><span class="p">();</span></div><div class='line' id='LC5301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5302'><br/></div><div class='line' id='LC5303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CraftyStop&quot;</span><span class="p">);</span></div><div class='line' id='LC5304'><br/></div><div class='line' id='LC5305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5306'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5307'><br/></div><div class='line' id='LC5308'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5309'><span class="cm">     * #Crafty.pause</span></div><div class='line' id='LC5310'><span class="cm">     * @category Core</span></div><div class='line' id='LC5311'><span class="cm">     * @trigger Pause - when the game is paused</span></div><div class='line' id='LC5312'><span class="cm">     * @trigger Unpause - when the game is unpaused</span></div><div class='line' id='LC5313'><span class="cm">     * @sign public this Crafty.pause(void)</span></div><div class='line' id='LC5314'><span class="cm">     *</span></div><div class='line' id='LC5315'><span class="cm">     * Pauses the game by stopping the EnterFrame event from firing. If the game is already paused it is unpaused.</span></div><div class='line' id='LC5316'><span class="cm">     * You can pass a boolean parameter if you want to pause or unpause mo matter what the current state is.</span></div><div class='line' id='LC5317'><span class="cm">     * Modern browsers pauses the game when the page is not visible to the user. If you want the Pause event</span></div><div class='line' id='LC5318'><span class="cm">     * to be triggered when that happens you can enable autoPause in `Crafty.settings`.</span></div><div class='line' id='LC5319'><span class="cm">     *</span></div><div class='line' id='LC5320'><span class="cm">     * @example</span></div><div class='line' id='LC5321'><span class="cm">     * Have an entity pause the game when it is clicked.</span></div><div class='line' id='LC5322'><span class="cm">     * ~~~</span></div><div class='line' id='LC5323'><span class="cm">     * button.bind(&quot;click&quot;, function() {</span></div><div class='line' id='LC5324'><span class="cm">     *     Crafty.pause();</span></div><div class='line' id='LC5325'><span class="cm">     * });</span></div><div class='line' id='LC5326'><span class="cm">     * ~~~</span></div><div class='line' id='LC5327'><span class="cm">     */</span></div><div class='line' id='LC5328'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toggle</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">toggle</span> <span class="o">:</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_paused</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Pause&#39;</span><span class="p">);</span></div><div class='line' id='LC5331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_paused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC5332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC5334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC5335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">keydown</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC5336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;Unpause&#39;</span><span class="p">);</span></div><div class='line' id='LC5338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_paused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC5339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC5341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC5342'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5343'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5344'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5345'><br/></div><div class='line' id='LC5346'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5347'><span class="cm">     * #Crafty.isPaused</span></div><div class='line' id='LC5348'><span class="cm">     * @category Core</span></div><div class='line' id='LC5349'><span class="cm">     * @sign public this Crafty.isPaused()</span></div><div class='line' id='LC5350'><span class="cm">     *</span></div><div class='line' id='LC5351'><span class="cm">     * Check whether the game is already paused or not.</span></div><div class='line' id='LC5352'><span class="cm">     *</span></div><div class='line' id='LC5353'><span class="cm">     * @example</span></div><div class='line' id='LC5354'><span class="cm">     * ~~~</span></div><div class='line' id='LC5355'><span class="cm">     * Crafty.isPaused();</span></div><div class='line' id='LC5356'><span class="cm">     * ~~~</span></div><div class='line' id='LC5357'><span class="cm">     */</span></div><div class='line' id='LC5358'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">isPaused</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_paused</span><span class="p">;</span></div><div class='line' id='LC5360'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5361'><br/></div><div class='line' id='LC5362'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5363'><span class="cm">     * #Crafty.timer</span></div><div class='line' id='LC5364'><span class="cm">     * @category Game Loop</span></div><div class='line' id='LC5365'><span class="cm">     * Handles game ticks</span></div><div class='line' id='LC5366'><span class="cm">     */</span></div><div class='line' id='LC5367'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">timer</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*</span></div><div class='line' id='LC5369'><span class="cm">         * `window.requestAnimationFrame` or its variants is called for animation.</span></div><div class='line' id='LC5370'><span class="cm">         * `.requestID` keeps a record of the return value previous `window.requestAnimationFrame` call.</span></div><div class='line' id='LC5371'><span class="cm">         * This is an internal variable. Used to stop frame.</span></div><div class='line' id='LC5372'><span class="cm">         */</span></div><div class='line' id='LC5373'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tick</span><span class="p">,</span> <span class="nx">requestID</span><span class="p">;</span></div><div class='line' id='LC5374'><br/></div><div class='line' id='LC5375'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Internal variables used to control the game loop.  Use Crafty.timer.steptype() to set these.</span></div><div class='line' id='LC5376'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span></div><div class='line' id='LC5377'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxFramesPerStep</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span></div><div class='line' id='LC5378'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxTimestep</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span></div><div class='line' id='LC5379'><br/></div><div class='line' id='LC5380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// variables used by the game loop to track state</span></div><div class='line' id='LC5381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">endTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC5382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">timeSlip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC5383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gameTime</span><span class="p">;</span></div><div class='line' id='LC5384'><br/></div><div class='line' id='LC5385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Controls the target rate of fixed mode loop.  Set these with the Crafty.timer.FPS function</span></div><div class='line' id='LC5386'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">FPS</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span></div><div class='line' id='LC5387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">milliSecPerFrame</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">FPS</span><span class="p">;</span></div><div class='line' id='LC5388'><br/></div><div class='line' id='LC5389'><br/></div><div class='line' id='LC5390'><br/></div><div class='line' id='LC5391'><br/></div><div class='line' id='LC5392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC5393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// When first called, set the  gametime one frame before now!</span></div><div class='line' id='LC5395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">gameTime</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC5396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gameTime</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">())</span> <span class="o">-</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC5397'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">onFrame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">webkitRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">mozRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">oRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">msRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC5403'><br/></div><div class='line' id='LC5404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">onFrame</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5405'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5406'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">step</span><span class="p">();</span></div><div class='line' id='LC5407'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">requestID</span> <span class="o">=</span> <span class="nx">onFrame</span><span class="p">(</span><span class="nx">tick</span><span class="p">);</span></div><div class='line' id='LC5408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(requestID + &#39;, &#39; + frame)</span></div><div class='line' id='LC5409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC5410'><br/></div><div class='line' id='LC5411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tick</span><span class="p">();</span></div><div class='line' id='LC5412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tick</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">step</span><span class="p">();</span></div><div class='line' id='LC5415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">FPS</span><span class="p">);</span></div><div class='line' id='LC5416'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5418'><br/></div><div class='line' id='LC5419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5420'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CraftyStopTimer&quot;</span><span class="p">);</span></div><div class='line' id='LC5421'><br/></div><div class='line' id='LC5422'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">tick</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">tick</span><span class="p">);</span></div><div class='line' id='LC5423'><br/></div><div class='line' id='LC5424'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">onFrame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">cancelRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5425'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">webkitCancelRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">mozCancelRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5427'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">oCancelRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">msCancelRequestAnimationFrame</span> <span class="o">||</span></div><div class='line' id='LC5429'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC5430'><br/></div><div class='line' id='LC5431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">onFrame</span><span class="p">)</span> <span class="nx">onFrame</span><span class="p">(</span><span class="nx">requestID</span><span class="p">);</span></div><div class='line' id='LC5432'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tick</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC5433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5434'><br/></div><div class='line' id='LC5435'><br/></div><div class='line' id='LC5436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5437'><span class="cm">             * #Crafty.timer.steptype</span></div><div class='line' id='LC5438'><span class="cm">             * @comp Crafty.timer</span></div><div class='line' id='LC5439'><span class="cm">             * @sign public void Crafty.timer.steptype(mode [, maxTimeStep])</span></div><div class='line' id='LC5440'><span class="cm">             * Can be called to set the type of timestep the game loop uses</span></div><div class='line' id='LC5441'><span class="cm">             * @param mode - the type of time loop.  Allowed values are &quot;fixed&quot;, &quot;semifixed&quot;, and &quot;variable&quot;.  Crafty defaults to &quot;fixed&quot;.</span></div><div class='line' id='LC5442'><span class="cm">             * @param mode - For &quot;fixed&quot;, sets the max number of frames per step.   For &quot;variable&quot; and &quot;semifixed&quot;, sets the maximum time step allowed.</span></div><div class='line' id='LC5443'><span class="cm">             *</span></div><div class='line' id='LC5444'><span class="cm">             * * In &quot;fixed&quot; mode, each frame is sent the same value of `dt`, and to achieve the target game speed, mulitiple frame events are triggered before each render.</span></div><div class='line' id='LC5445'><span class="cm">             * * In &quot;variable&quot; mode, there is only one frame triggered per render.  This recieves a value of `dt` equal to the actual elapsed time since the last frame.</span></div><div class='line' id='LC5446'><span class="cm">             * * In &quot;semifixed&quot; mode, multiple frames per render are processed, and the total time since the last frame is divided evenly between them.</span></div><div class='line' id='LC5447'><span class="cm">             *</span></div><div class='line' id='LC5448'><span class="cm">             */</span></div><div class='line' id='LC5449'><br/></div><div class='line' id='LC5450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">steptype</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">newmode</span><span class="p">,</span> <span class="nx">option</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">newmode</span> <span class="o">===</span> <span class="s2">&quot;variable&quot;</span> <span class="o">||</span> <span class="nx">newmode</span> <span class="o">===</span> <span class="s2">&quot;semifixed&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mode</span> <span class="o">=</span> <span class="nx">newmode</span><span class="p">;</span></div><div class='line' id='LC5453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span></div><div class='line' id='LC5454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxTimestep</span> <span class="o">=</span> <span class="nx">option</span><span class="p">;</span></div><div class='line' id='LC5455'><br/></div><div class='line' id='LC5456'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">newmode</span> <span class="o">===</span> <span class="s2">&quot;fixed&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mode</span> <span class="o">=</span> <span class="s2">&quot;fixed&quot;</span><span class="p">;</span></div><div class='line' id='LC5458'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">option</span><span class="p">)</span></div><div class='line' id='LC5459'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxFramesPerStep</span> <span class="o">=</span> <span class="nx">option</span><span class="p">;</span></div><div class='line' id='LC5460'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5461'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="s2">&quot;Invalid step type specified&quot;</span><span class="p">;</span></div><div class='line' id='LC5462'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5463'><br/></div><div class='line' id='LC5464'><br/></div><div class='line' id='LC5465'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5466'><br/></div><div class='line' id='LC5467'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5468'><span class="cm">             * #Crafty.timer.step</span></div><div class='line' id='LC5469'><span class="cm">             * @comp Crafty.timer</span></div><div class='line' id='LC5470'><span class="cm">             * @sign public void Crafty.timer.step()</span></div><div class='line' id='LC5471'><span class="cm">             * @trigger EnterFrame - Triggered on each frame.  Passes the frame number, and the amount of time since the last frame.  If the time is greater than maxTimestep, that will be used instead.  (The default value of maxTimestep is 50 ms.) - { frame: Number, dt:Number }</span></div><div class='line' id='LC5472'><span class="cm">             * @trigger RenderScene - Triggered every time a scene should be rendered</span></div><div class='line' id='LC5473'><span class="cm">             * @trigger MeasureWaitTime - Triggered at the beginning of each step after the first.  Passes the time the game loop waited between steps. - Number</span></div><div class='line' id='LC5474'><span class="cm">             * @trigger MeasureFrameTime - Triggered after each step.  Passes the time it took to advance one frame. - Number</span></div><div class='line' id='LC5475'><span class="cm">             * @trigger MeasureRenderTime - Triggered after each render. Passes the time it took to render the scene - Number</span></div><div class='line' id='LC5476'><span class="cm">             * Advances the game by triggering `EnterFrame` and `RenderScene`</span></div><div class='line' id='LC5477'><span class="cm">             */</span></div><div class='line' id='LC5478'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">step</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">drawTimeStart</span><span class="p">,</span> <span class="nx">dt</span><span class="p">,</span> <span class="nx">lastFrameTime</span><span class="p">,</span> <span class="nx">loops</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC5480'><br/></div><div class='line' id='LC5481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC5482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">endTime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC5483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MeasureWaitTime&quot;</span><span class="p">,</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">endTime</span><span class="p">);</span></div><div class='line' id='LC5484'><br/></div><div class='line' id='LC5485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If we&#39;re currently ahead of the current time, we need to wait until we&#39;re not!</span></div><div class='line' id='LC5486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">gameTime</span> <span class="o">+</span> <span class="nx">timeSlip</span> <span class="o">&gt;=</span> <span class="nx">currentTime</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">endTime</span> <span class="o">=</span> <span class="nx">currentTime</span><span class="p">;</span></div><div class='line' id='LC5488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC5489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5490'><br/></div><div class='line' id='LC5491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">netTimeStep</span> <span class="o">=</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="p">(</span><span class="nx">gameTime</span> <span class="o">+</span> <span class="nx">timeSlip</span><span class="p">);</span></div><div class='line' id='LC5492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We try to keep up with the target FPS by processing multiple frames per render</span></div><div class='line' id='LC5493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If we&#39;re hopelessly behind, stop trying to catch up.</span></div><div class='line' id='LC5494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">netTimeStep</span> <span class="o">&gt;</span> <span class="nx">milliSecPerFrame</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gameTime = currentTime - milliSecPerFrame;</span></div><div class='line' id='LC5496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">timeSlip</span> <span class="o">+=</span> <span class="nx">netTimeStep</span> <span class="o">-</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC5497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">netTimeStep</span> <span class="o">=</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC5498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5499'><br/></div><div class='line' id='LC5500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Set up how time is incremented</span></div><div class='line' id='LC5501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="s2">&quot;fixed&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loops</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">netTimeStep</span> <span class="o">/</span> <span class="nx">milliSecPerFrame</span><span class="p">);</span></div><div class='line' id='LC5503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// maxFramesPerStep adjusts how willing we are to delay drawing in order to keep at the target FPS</span></div><div class='line' id='LC5504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loops</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">loops</span><span class="p">,</span> <span class="nx">maxFramesPerStep</span><span class="p">);</span></div><div class='line' id='LC5505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span> <span class="o">=</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC5506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loops</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC5508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span> <span class="o">=</span> <span class="nx">netTimeStep</span><span class="p">;</span></div><div class='line' id='LC5509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// maxTimestep is the maximum time to be processed in a frame.  (Large dt =&gt; unstable physics)</span></div><div class='line' id='LC5510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">dt</span><span class="p">,</span> <span class="nx">maxTimestep</span><span class="p">);</span></div><div class='line' id='LC5511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="s2">&quot;semifixed&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loops</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">netTimeStep</span> <span class="o">/</span> <span class="nx">maxTimestep</span><span class="p">);</span></div><div class='line' id='LC5513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span> <span class="o">=</span> <span class="nx">netTimeStep</span> <span class="o">/</span> <span class="nx">loops</span><span class="p">;</span></div><div class='line' id='LC5514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5515'><br/></div><div class='line' id='LC5516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Process frames, incrementing the game clock with each frame.</span></div><div class='line' id='LC5517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// dt is determined by the mode</span></div><div class='line' id='LC5518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">loops</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastFrameTime</span> <span class="o">=</span> <span class="nx">currentTime</span><span class="p">;</span></div><div class='line' id='LC5520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Everything that changes over time hooks into this event</span></div><div class='line' id='LC5521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC5522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">frame</span><span class="o">:</span> <span class="nx">frame</span><span class="o">++</span><span class="p">,</span></div><div class='line' id='LC5523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span><span class="o">:</span> <span class="nx">dt</span><span class="p">,</span></div><div class='line' id='LC5524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gameTime</span><span class="o">:</span> <span class="nx">gameTime</span></div><div class='line' id='LC5525'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gameTime</span> <span class="o">+=</span> <span class="nx">dt</span><span class="p">;</span></div><div class='line' id='LC5527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC5528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MeasureFrameTime&quot;</span><span class="p">,</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">lastFrameTime</span><span class="p">);</span></div><div class='line' id='LC5529'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5530'><br/></div><div class='line' id='LC5531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//If any frames were processed, render the results</span></div><div class='line' id='LC5532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">loops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5533'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawTimeStart</span> <span class="o">=</span> <span class="nx">currentTime</span><span class="p">;</span></div><div class='line' id='LC5534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">);</span></div><div class='line' id='LC5535'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Post-render cleanup opportunity</span></div><div class='line' id='LC5536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;PostRender&quot;</span><span class="p">);</span></div><div class='line' id='LC5537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC5538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;MeasureRenderTime&quot;</span><span class="p">,</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">drawTimeStart</span><span class="p">);</span></div><div class='line' id='LC5539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5540'><br/></div><div class='line' id='LC5541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">endTime</span> <span class="o">=</span> <span class="nx">currentTime</span><span class="p">;</span></div><div class='line' id='LC5542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5544'><span class="cm">             * #Crafty.timer.FPS</span></div><div class='line' id='LC5545'><span class="cm">             * @comp Crafty.timer</span></div><div class='line' id='LC5546'><span class="cm">             * @sign public void Crafty.timer.FPS()</span></div><div class='line' id='LC5547'><span class="cm">             * Returns the target frames per second. This is not an actual frame rate.</span></div><div class='line' id='LC5548'><span class="cm">             * @sign public void Crafty.timer.FPS(Number value)</span></div><div class='line' id='LC5549'><span class="cm">             * @param value - the target rate</span></div><div class='line' id='LC5550'><span class="cm">             * Sets the target frames per second. This is not an actual frame rate.</span></div><div class='line' id='LC5551'><span class="cm">             * The default rate is 50.</span></div><div class='line' id='LC5552'><span class="cm">             */</span></div><div class='line' id='LC5553'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">FPS</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5554'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC5555'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">FPS</span><span class="p">;</span></div><div class='line' id='LC5556'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC5557'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">FPS</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC5558'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">milliSecPerFrame</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="nx">FPS</span><span class="p">;</span></div><div class='line' id='LC5559'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5560'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5561'><br/></div><div class='line' id='LC5562'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5563'><span class="cm">             * #Crafty.timer.simulateFrames</span></div><div class='line' id='LC5564'><span class="cm">             * @comp Crafty.timer</span></div><div class='line' id='LC5565'><span class="cm">             * @sign public this Crafty.timer.simulateFrames(Number frames[, Number timestep])</span></div><div class='line' id='LC5566'><span class="cm">             * Advances the game state by a number of frames and draws the resulting stage at the end. Useful for tests and debugging.</span></div><div class='line' id='LC5567'><span class="cm">             * @param frames - number of frames to simulate</span></div><div class='line' id='LC5568'><span class="cm">             * @param timestep - the duration to pass each frame.  Defaults to milliSecPerFrame (20 ms) if not specified.</span></div><div class='line' id='LC5569'><span class="cm">             */</span></div><div class='line' id='LC5570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">simulateFrames</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frames</span><span class="p">,</span> <span class="nx">timestep</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">timestep</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC5572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">timestep</span> <span class="o">=</span> <span class="nx">milliSecPerFrame</span><span class="p">;</span></div><div class='line' id='LC5573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="nx">frames</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC5575'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">frame</span><span class="o">:</span> <span class="nx">frame</span><span class="o">++</span><span class="p">,</span></div><div class='line' id='LC5576'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dt</span><span class="o">:</span> <span class="nx">timestep</span></div><div class='line' id='LC5577'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5578'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">);</span></div><div class='line' id='LC5580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5581'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC5582'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC5583'><br/></div><div class='line' id='LC5584'><br/></div><div class='line' id='LC5585'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5586'><span class="cm">     * #Crafty.e</span></div><div class='line' id='LC5587'><span class="cm">     * @category Core</span></div><div class='line' id='LC5588'><span class="cm">     * @trigger NewEntity - When the entity is created and all components are added - { id:Number }</span></div><div class='line' id='LC5589'><span class="cm">     * @sign public Entity Crafty.e(String componentList)</span></div><div class='line' id='LC5590'><span class="cm">     * @param componentList - List of components to assign to new entity</span></div><div class='line' id='LC5591'><span class="cm">     * @sign public Entity Crafty.e(String component1[, .., String componentN])</span></div><div class='line' id='LC5592'><span class="cm">     * @param component# - Component to add</span></div><div class='line' id='LC5593'><span class="cm">     *</span></div><div class='line' id='LC5594'><span class="cm">     * Creates an entity. Any arguments will be applied in the same</span></div><div class='line' id='LC5595'><span class="cm">     * way `.addComponent()` is applied as a quick way to add components.</span></div><div class='line' id='LC5596'><span class="cm">     *</span></div><div class='line' id='LC5597'><span class="cm">     * Any component added will augment the functionality of</span></div><div class='line' id='LC5598'><span class="cm">     * the created entity by assigning the properties and methods from the component to the entity.</span></div><div class='line' id='LC5599'><span class="cm">     *</span></div><div class='line' id='LC5600'><span class="cm">     * @example</span></div><div class='line' id='LC5601'><span class="cm">     * ~~~</span></div><div class='line' id='LC5602'><span class="cm">     * var myEntity = Crafty.e(&quot;2D, DOM, Color&quot;);</span></div><div class='line' id='LC5603'><span class="cm">     * ~~~</span></div><div class='line' id='LC5604'><span class="cm">     *</span></div><div class='line' id='LC5605'><span class="cm">     * @see Crafty.c</span></div><div class='line' id='LC5606'><span class="cm">     */</span></div><div class='line' id='LC5607'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5608'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">UID</span><span class="p">(),</span></div><div class='line' id='LC5609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">craft</span><span class="p">;</span></div><div class='line' id='LC5610'><br/></div><div class='line' id='LC5611'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entities</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">//register the space</span></div><div class='line' id='LC5612'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entities</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">craft</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span></div><div class='line' id='LC5613'><br/></div><div class='line' id='LC5614'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5615'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">craft</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">craft</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span></div><div class='line' id='LC5616'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5617'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">craft</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="s1">&#39;Entity #&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span> <span class="c1">//set default entity human readable name</span></div><div class='line' id='LC5618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">craft</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">);</span> <span class="c1">//every entity automatically assumes obj</span></div><div class='line' id='LC5619'><br/></div><div class='line' id='LC5620'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NewEntity&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC5621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span><span class="o">:</span> <span class="nx">id</span></div><div class='line' id='LC5622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5623'><br/></div><div class='line' id='LC5624'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">craft</span><span class="p">;</span></div><div class='line' id='LC5625'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5626'><br/></div><div class='line' id='LC5627'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5628'><span class="cm">     * #Crafty.c</span></div><div class='line' id='LC5629'><span class="cm">     * @category Core</span></div><div class='line' id='LC5630'><span class="cm">     * @sign public void Crafty.c(String name, Object component)</span></div><div class='line' id='LC5631'><span class="cm">     * @param name - Name of the component</span></div><div class='line' id='LC5632'><span class="cm">     * @param component - Object with the component&#39;s properties and methods</span></div><div class='line' id='LC5633'><span class="cm">     * Creates a component where the first argument is the ID and the second</span></div><div class='line' id='LC5634'><span class="cm">     * is the object that will be inherited by entities.</span></div><div class='line' id='LC5635'><span class="cm">     *</span></div><div class='line' id='LC5636'><span class="cm">     * A couple of methods are treated specially. They are invoked in partiular contexts, and (in those contexts) cannot be overridden by other components.</span></div><div class='line' id='LC5637'><span class="cm">     *</span></div><div class='line' id='LC5638'><span class="cm">     * - `init` will be called when the component is added to an entity</span></div><div class='line' id='LC5639'><span class="cm">     * - `remove` will be called just before a component is removed, or before an entity is destroyed. It is passed a single boolean parameter that is `true` if the entity is being destroyed.</span></div><div class='line' id='LC5640'><span class="cm">     *</span></div><div class='line' id='LC5641'><span class="cm">     * In addition to these hardcoded special methods, there are some conventions for writing components.</span></div><div class='line' id='LC5642'><span class="cm">     *</span></div><div class='line' id='LC5643'><span class="cm">     * - Properties or methods that start with an underscore are considered private.</span></div><div class='line' id='LC5644'><span class="cm">     * - A method with the same name as the component is considered to be a constructor</span></div><div class='line' id='LC5645'><span class="cm">     * and is generally used when you need to pass configuration data to the component on a per entity basis.</span></div><div class='line' id='LC5646'><span class="cm">     *</span></div><div class='line' id='LC5647'><span class="cm">     * @example</span></div><div class='line' id='LC5648'><span class="cm">     * ~~~</span></div><div class='line' id='LC5649'><span class="cm">     * Crafty.c(&quot;Annoying&quot;, {</span></div><div class='line' id='LC5650'><span class="cm">     *     _message: &quot;HiHi&quot;,</span></div><div class='line' id='LC5651'><span class="cm">     *     init: function() {</span></div><div class='line' id='LC5652'><span class="cm">     *         this.bind(&quot;EnterFrame&quot;, function() { alert(this.message); });</span></div><div class='line' id='LC5653'><span class="cm">     *     },</span></div><div class='line' id='LC5654'><span class="cm">     *     annoying: function(message) { this.message = message; }</span></div><div class='line' id='LC5655'><span class="cm">     * });</span></div><div class='line' id='LC5656'><span class="cm">     *</span></div><div class='line' id='LC5657'><span class="cm">     * Crafty.e(&quot;Annoying&quot;).annoying(&quot;I&#39;m an orange...&quot;);</span></div><div class='line' id='LC5658'><span class="cm">     * ~~~</span></div><div class='line' id='LC5659'><span class="cm">     *</span></div><div class='line' id='LC5660'><span class="cm">     *</span></div><div class='line' id='LC5661'><span class="cm">     * WARNING:</span></div><div class='line' id='LC5662'><span class="cm">     *</span></div><div class='line' id='LC5663'><span class="cm">     * in the example above the field _message is local to the entity. That is, if you create many entities with the Annoying component they can all have different values for _message. That is because it is a simple value, and simple values are copied by value. If however the field had been an object or array, the value would have been shared by all entities with the component because complex types are copied by reference in javascript. This is probably not what you want and the following example demonstrates how to work around it:</span></div><div class='line' id='LC5664'><span class="cm">     *</span></div><div class='line' id='LC5665'><span class="cm">     * ~~~</span></div><div class='line' id='LC5666'><span class="cm">     * Crafty.c(&quot;MyComponent&quot;, {</span></div><div class='line' id='LC5667'><span class="cm">     *     _iAmShared: { a: 3, b: 4 },</span></div><div class='line' id='LC5668'><span class="cm">     *     init: function() {</span></div><div class='line' id='LC5669'><span class="cm">     *         this._iAmNotShared = { a: 3, b: 4 };</span></div><div class='line' id='LC5670'><span class="cm">     *     },</span></div><div class='line' id='LC5671'><span class="cm">     * });</span></div><div class='line' id='LC5672'><span class="cm">     * ~~~</span></div><div class='line' id='LC5673'><span class="cm">     *</span></div><div class='line' id='LC5674'><span class="cm">     * @see Crafty.e</span></div><div class='line' id='LC5675'><span class="cm">     */</span></div><div class='line' id='LC5676'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">compName</span><span class="p">,</span> <span class="nx">component</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">components</span><span class="p">[</span><span class="nx">compName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">component</span><span class="p">;</span></div><div class='line' id='LC5678'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5679'><br/></div><div class='line' id='LC5680'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5681'><span class="cm">     * #Crafty.trigger</span></div><div class='line' id='LC5682'><span class="cm">     * @category Core, Events</span></div><div class='line' id='LC5683'><span class="cm">     * @sign public void Crafty.trigger(String eventName, * data)</span></div><div class='line' id='LC5684'><span class="cm">     * @param eventName - Name of the event to trigger</span></div><div class='line' id='LC5685'><span class="cm">     * @param data - Arbitrary data to pass into the callback as an argument</span></div><div class='line' id='LC5686'><span class="cm">     *</span></div><div class='line' id='LC5687'><span class="cm">     * This method will trigger every single callback attached to the event name. This means</span></div><div class='line' id='LC5688'><span class="cm">     * every global event and every entity that has a callback.</span></div><div class='line' id='LC5689'><span class="cm">     *</span></div><div class='line' id='LC5690'><span class="cm">     * @see Crafty.bind</span></div><div class='line' id='LC5691'><span class="cm">     */</span></div><div class='line' id='LC5692'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">trigger</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5693'><br/></div><div class='line' id='LC5694'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// (To learn how the handlers object works, see inline comment at Crafty.bind)</span></div><div class='line' id='LC5695'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">hdl</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">],</span></div><div class='line' id='LC5696'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">,</span> <span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC5697'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over every object bound</span></div><div class='line' id='LC5698'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">h</span> <span class="k">in</span> <span class="nx">hdl</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5699'><br/></div><div class='line' id='LC5700'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Check whether h needs to be processed</span></div><div class='line' id='LC5701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hdl</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">h</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC5702'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">hdl</span><span class="p">[</span><span class="nx">h</span><span class="p">];</span></div><div class='line' id='LC5703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callbacks</span> <span class="o">||</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC5704'><br/></div><div class='line' id='LC5705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if an entity, call with that context; else the global context</span></div><div class='line' id='LC5706'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">entities</span><span class="p">[</span><span class="nx">h</span><span class="p">])</span></div><div class='line' id='LC5707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">(</span><span class="o">+</span><span class="nx">h</span><span class="p">);</span></div><div class='line' id='LC5708'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC5709'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">;</span></div><div class='line' id='LC5710'><br/></div><div class='line' id='LC5711'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over every handler within object</span></div><div class='line' id='LC5712'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5713'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Remove a callback if it has been deleted</span></div><div class='line' id='LC5714'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5715'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC5716'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC5717'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span></div><div class='line' id='LC5718'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC5719'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5720'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5721'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5722'><br/></div><div class='line' id='LC5723'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5724'><span class="cm">     * #Crafty.bind</span></div><div class='line' id='LC5725'><span class="cm">     * @category Core, Events</span></div><div class='line' id='LC5726'><span class="cm">     * @sign public Number bind(String eventName, Function callback)</span></div><div class='line' id='LC5727'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC5728'><span class="cm">     * @param callback - Method to execute upon event triggered</span></div><div class='line' id='LC5729'><span class="cm">     * @returns callback function which can be used for unbind</span></div><div class='line' id='LC5730'><span class="cm">     *</span></div><div class='line' id='LC5731'><span class="cm">     * Binds to a global event. Method will be executed when `Crafty.trigger` is used</span></div><div class='line' id='LC5732'><span class="cm">     * with the event name.</span></div><div class='line' id='LC5733'><span class="cm">     *</span></div><div class='line' id='LC5734'><span class="cm">     * @see Crafty.trigger, Crafty.unbind</span></div><div class='line' id='LC5735'><span class="cm">     */</span></div><div class='line' id='LC5736'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5737'><br/></div><div class='line' id='LC5738'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Background: The structure of the global object &quot;handlers&quot;</span></div><div class='line' id='LC5739'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ---------------------------------------------------------</span></div><div class='line' id='LC5740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Here is an example of what &quot;handlers&quot; can look like:</span></div><div class='line' id='LC5741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// handlers ===</span></div><div class='line' id='LC5742'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//    { Move:  {5:[fnA], 6:[fnB, fnC], global:[fnD]},</span></div><div class='line' id='LC5743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//     Change: {6:[fnE]}</span></div><div class='line' id='LC5744'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//    }</span></div><div class='line' id='LC5745'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// In this example, when the &#39;Move&#39; event is triggered on entity #6 (e.g.</span></div><div class='line' id='LC5746'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// entity6.trigger(&#39;Move&#39;)), it causes the execution of fnB() and fnC(). When</span></div><div class='line' id='LC5747'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// the Move event is triggered globally (i.e. Crafty.trigger(&#39;Move&#39;)), it</span></div><div class='line' id='LC5748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// will execute fnA, fnB, fnC, fnD.</span></div><div class='line' id='LC5749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//</span></div><div class='line' id='LC5750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// In this example, &quot;this&quot; is bound to entity #6 whenever fnB() is executed, and</span></div><div class='line' id='LC5751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// &quot;this&quot; is bound to Crafty whenever fnD() is executed.</span></div><div class='line' id='LC5752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//</span></div><div class='line' id='LC5753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// In other words, the structure of &quot;handlers&quot; is:</span></div><div class='line' id='LC5754'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//</span></div><div class='line' id='LC5755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// handlers[event][entityID or &#39;global&#39;] === (Array of callback functions)</span></div><div class='line' id='LC5756'><br/></div><div class='line' id='LC5757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">])</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC5758'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">hdl</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span></div><div class='line' id='LC5759'><br/></div><div class='line' id='LC5760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span><span class="p">)</span> <span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC5761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC5762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">callback</span><span class="p">;</span></div><div class='line' id='LC5763'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5764'><br/></div><div class='line' id='LC5765'><br/></div><div class='line' id='LC5766'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5767'><span class="cm">     * #Crafty.uniqueBind</span></div><div class='line' id='LC5768'><span class="cm">     * @category Core, Events</span></div><div class='line' id='LC5769'><span class="cm">     * @sign public Number uniqueBind(String eventName, Function callback)</span></div><div class='line' id='LC5770'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC5771'><span class="cm">     * @param callback - Method to execute upon event triggered</span></div><div class='line' id='LC5772'><span class="cm">     * @returns callback function which can be used for unbind</span></div><div class='line' id='LC5773'><span class="cm">     *</span></div><div class='line' id='LC5774'><span class="cm">     * Works like Crafty.bind, but prevents a callback from being bound multiple times.</span></div><div class='line' id='LC5775'><span class="cm">     *</span></div><div class='line' id='LC5776'><span class="cm">     * @see Crafty.bind</span></div><div class='line' id='LC5777'><span class="cm">     */</span></div><div class='line' id='LC5778'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">uniqueBind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5779'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC5780'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC5781'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5782'><br/></div><div class='line' id='LC5783'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5784'><span class="cm">     * #Crafty.one</span></div><div class='line' id='LC5785'><span class="cm">     * @category Core, Events</span></div><div class='line' id='LC5786'><span class="cm">     * @sign public Number one(String eventName, Function callback)</span></div><div class='line' id='LC5787'><span class="cm">     * @param eventName - Name of the event to bind to</span></div><div class='line' id='LC5788'><span class="cm">     * @param callback - Method to execute upon event triggered</span></div><div class='line' id='LC5789'><span class="cm">     * @returns callback function which can be used for unbind</span></div><div class='line' id='LC5790'><span class="cm">     *</span></div><div class='line' id='LC5791'><span class="cm">     * Works like Crafty.bind, but will be unbound once the event triggers.</span></div><div class='line' id='LC5792'><span class="cm">     *</span></div><div class='line' id='LC5793'><span class="cm">     * @see Crafty.bind</span></div><div class='line' id='LC5794'><span class="cm">     */</span></div><div class='line' id='LC5795'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">one</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC5797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oneHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC5799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">oneHandler</span><span class="p">);</span></div><div class='line' id='LC5800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC5801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">oneHandler</span><span class="p">);</span></div><div class='line' id='LC5802'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5803'><br/></div><div class='line' id='LC5804'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5805'><span class="cm">     * #Crafty.unbind</span></div><div class='line' id='LC5806'><span class="cm">     * @category Core, Events</span></div><div class='line' id='LC5807'><span class="cm">     * @sign public Boolean Crafty.unbind(String eventName, Function callback)</span></div><div class='line' id='LC5808'><span class="cm">     * @param eventName - Name of the event to unbind</span></div><div class='line' id='LC5809'><span class="cm">     * @param callback - Function to unbind</span></div><div class='line' id='LC5810'><span class="cm">     * @sign public Boolean Crafty.unbind(String eventName, Number callbackID)</span></div><div class='line' id='LC5811'><span class="cm">     * @param callbackID - ID of the callback</span></div><div class='line' id='LC5812'><span class="cm">     * @returns True or false depending on if a callback was unbound</span></div><div class='line' id='LC5813'><span class="cm">     * Unbind any event from any entity or global event.</span></div><div class='line' id='LC5814'><span class="cm">     * @example</span></div><div class='line' id='LC5815'><span class="cm">     * ~~~</span></div><div class='line' id='LC5816'><span class="cm">     *    var play_gameover_sound = function () {...};</span></div><div class='line' id='LC5817'><span class="cm">     *    Crafty.bind(&#39;GameOver&#39;, play_gameover_sound);</span></div><div class='line' id='LC5818'><span class="cm">     *    ...</span></div><div class='line' id='LC5819'><span class="cm">     *    Crafty.unbind(&#39;GameOver&#39;, play_gameover_sound);</span></div><div class='line' id='LC5820'><span class="cm">     * ~~~</span></div><div class='line' id='LC5821'><span class="cm">     *</span></div><div class='line' id='LC5822'><span class="cm">     * The first line defines a callback function. The second line binds that</span></div><div class='line' id='LC5823'><span class="cm">     * function so that `Crafty.trigger(&#39;GameOver&#39;)` causes that function to</span></div><div class='line' id='LC5824'><span class="cm">     * run. The third line unbinds that function.</span></div><div class='line' id='LC5825'><span class="cm">     *</span></div><div class='line' id='LC5826'><span class="cm">     * ~~~</span></div><div class='line' id='LC5827'><span class="cm">     *    Crafty.unbind(&#39;GameOver&#39;);</span></div><div class='line' id='LC5828'><span class="cm">     * ~~~</span></div><div class='line' id='LC5829'><span class="cm">     *</span></div><div class='line' id='LC5830'><span class="cm">     * This unbinds ALL global callbacks for the event &#39;GameOver&#39;. That</span></div><div class='line' id='LC5831'><span class="cm">     * includes all callbacks attached by `Crafty.bind(&#39;GameOver&#39;, ...)`, but</span></div><div class='line' id='LC5832'><span class="cm">     * none of the callbacks attached by `some_entity.bind(&#39;GameOver&#39;, ...)`.</span></div><div class='line' id='LC5833'><span class="cm">     */</span></div><div class='line' id='LC5834'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unbind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// (To learn how the handlers object works, see inline comment at Crafty.bind)</span></div><div class='line' id='LC5836'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">hdl</span> <span class="o">=</span> <span class="nx">handlers</span><span class="p">[</span><span class="nx">event</span><span class="p">],</span></div><div class='line' id='LC5837'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">global_callbacks</span><span class="p">,</span> <span class="nx">found_match</span><span class="p">;</span></div><div class='line' id='LC5838'><br/></div><div class='line' id='LC5839'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">hdl</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5840'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC5841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5842'><br/></div><div class='line' id='LC5843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If no callback was supplied, delete everything</span></div><div class='line' id='LC5844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span><span class="p">;</span></div><div class='line' id='LC5846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC5847'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5848'><br/></div><div class='line' id='LC5849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// loop over the globally-attached events</span></div><div class='line' id='LC5850'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">global_callbacks</span> <span class="o">=</span> <span class="nx">hdl</span><span class="p">.</span><span class="nx">global</span><span class="p">;</span></div><div class='line' id='LC5851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">found_match</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC5852'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">global_callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">global_callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5854'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">found_match</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC5855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">global_callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC5856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5857'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5858'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">found_match</span><span class="p">;</span></div><div class='line' id='LC5859'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5860'><br/></div><div class='line' id='LC5861'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5862'><span class="cm">     * #Crafty.frame</span></div><div class='line' id='LC5863'><span class="cm">     * @category Core</span></div><div class='line' id='LC5864'><span class="cm">     * @sign public Number Crafty.frame(void)</span></div><div class='line' id='LC5865'><span class="cm">     * Returns the current frame number</span></div><div class='line' id='LC5866'><span class="cm">     */</span></div><div class='line' id='LC5867'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">frame</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5868'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">frame</span><span class="p">;</span></div><div class='line' id='LC5869'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5870'><br/></div><div class='line' id='LC5871'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">components</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">components</span><span class="p">;</span></div><div class='line' id='LC5873'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5874'><br/></div><div class='line' id='LC5875'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">isComp</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">comp</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">comp</span> <span class="k">in</span> <span class="nx">components</span><span class="p">;</span></div><div class='line' id='LC5877'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5878'><br/></div><div class='line' id='LC5879'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debug</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// access internal variables - handlers or entities</span></div><div class='line' id='LC5881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="s1">&#39;handlers&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">handlers</span><span class="p">;</span></div><div class='line' id='LC5883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">entities</span><span class="p">;</span></div><div class='line' id='LC5885'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5886'><br/></div><div class='line' id='LC5887'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5888'><span class="cm">     * #Crafty.settings</span></div><div class='line' id='LC5889'><span class="cm">     * @category Core</span></div><div class='line' id='LC5890'><span class="cm">     * Modify the inner workings of Crafty through the settings.</span></div><div class='line' id='LC5891'><span class="cm">     */</span></div><div class='line' id='LC5892'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">settings</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="p">{},</span></div><div class='line' id='LC5894'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC5895'><br/></div><div class='line' id='LC5896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC5897'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5898'><span class="cm">             * #Crafty.settings.register</span></div><div class='line' id='LC5899'><span class="cm">             * @comp Crafty.settings</span></div><div class='line' id='LC5900'><span class="cm">             * @sign public void Crafty.settings.register(String settingName, Function callback)</span></div><div class='line' id='LC5901'><span class="cm">             * @param settingName - Name of the setting</span></div><div class='line' id='LC5902'><span class="cm">             * @param callback - Function to execute when use modifies setting</span></div><div class='line' id='LC5903'><span class="cm">             *</span></div><div class='line' id='LC5904'><span class="cm">             * Use this to register custom settings. Callback will be executed when `Crafty.settings.modify` is used.</span></div><div class='line' id='LC5905'><span class="cm">             *</span></div><div class='line' id='LC5906'><span class="cm">             * @see Crafty.settings.modify</span></div><div class='line' id='LC5907'><span class="cm">             */</span></div><div class='line' id='LC5908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">register</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">setting</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span></div><div class='line' id='LC5910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5911'><br/></div><div class='line' id='LC5912'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5913'><span class="cm">             * #Crafty.settings.modify</span></div><div class='line' id='LC5914'><span class="cm">             * @comp Crafty.settings</span></div><div class='line' id='LC5915'><span class="cm">             * @sign public void Crafty.settings.modify(String settingName, * value)</span></div><div class='line' id='LC5916'><span class="cm">             * @param settingName - Name of the setting</span></div><div class='line' id='LC5917'><span class="cm">             * @param value - Value to set the setting to</span></div><div class='line' id='LC5918'><span class="cm">             *</span></div><div class='line' id='LC5919'><span class="cm">             * Modify settings through this method.</span></div><div class='line' id='LC5920'><span class="cm">             *</span></div><div class='line' id='LC5921'><span class="cm">             * @see Crafty.settings.register, Crafty.settings.get</span></div><div class='line' id='LC5922'><span class="cm">             */</span></div><div class='line' id='LC5923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">modify</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">setting</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callbacks</span><span class="p">[</span><span class="nx">setting</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC5925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callbacks</span><span class="p">[</span><span class="nx">setting</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">states</span><span class="p">[</span><span class="nx">setting</span><span class="p">],</span> <span class="nx">value</span><span class="p">);</span></div><div class='line' id='LC5926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">states</span><span class="p">[</span><span class="nx">setting</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC5927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC5928'><br/></div><div class='line' id='LC5929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC5930'><span class="cm">             * #Crafty.settings.get</span></div><div class='line' id='LC5931'><span class="cm">             * @comp Crafty.settings</span></div><div class='line' id='LC5932'><span class="cm">             * @sign public * Crafty.settings.get(String settingName)</span></div><div class='line' id='LC5933'><span class="cm">             * @param settingName - Name of the setting</span></div><div class='line' id='LC5934'><span class="cm">             * @returns Current value of the setting</span></div><div class='line' id='LC5935'><span class="cm">             *</span></div><div class='line' id='LC5936'><span class="cm">             * Returns the current value of the setting.</span></div><div class='line' id='LC5937'><span class="cm">             *</span></div><div class='line' id='LC5938'><span class="cm">             * @see Crafty.settings.register, Crafty.settings.get</span></div><div class='line' id='LC5939'><span class="cm">             */</span></div><div class='line' id='LC5940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">setting</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">states</span><span class="p">[</span><span class="nx">setting</span><span class="p">];</span></div><div class='line' id='LC5942'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC5944'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC5945'><br/></div><div class='line' id='LC5946'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clone</span><span class="o">:</span> <span class="nx">clone</span></div><div class='line' id='LC5947'><span class="p">});</span></div><div class='line' id='LC5948'><br/></div><div class='line' id='LC5949'><span class="cm">/**</span></div><div class='line' id='LC5950'><span class="cm"> * Return a unique ID</span></div><div class='line' id='LC5951'><span class="cm"> */</span></div><div class='line' id='LC5952'><br/></div><div class='line' id='LC5953'><span class="kd">function</span> <span class="nx">UID</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5954'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">GUID</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC5955'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if GUID is not unique</span></div><div class='line' id='LC5956'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">entities</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">UID</span><span class="p">();</span> <span class="c1">//recurse until it is unique</span></div><div class='line' id='LC5958'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC5959'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">id</span><span class="p">;</span></div><div class='line' id='LC5960'><span class="p">}</span></div><div class='line' id='LC5961'><br/></div><div class='line' id='LC5962'><span class="cm">/**@</span></div><div class='line' id='LC5963'><span class="cm"> * #Crafty.clone</span></div><div class='line' id='LC5964'><span class="cm"> * @category Core</span></div><div class='line' id='LC5965'><span class="cm"> * @sign public Object .clone(Object obj)</span></div><div class='line' id='LC5966'><span class="cm"> * @param obj - an object</span></div><div class='line' id='LC5967'><span class="cm"> *</span></div><div class='line' id='LC5968'><span class="cm"> * Deep copy (a.k.a clone) of an object.</span></div><div class='line' id='LC5969'><span class="cm"> */</span></div><div class='line' id='LC5970'><br/></div><div class='line' id='LC5971'><span class="kd">function</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC5972'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span></div><div class='line' id='LC5973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC5974'><br/></div><div class='line' id='LC5975'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">();</span> <span class="c1">// changed</span></div><div class='line' id='LC5976'><br/></div><div class='line' id='LC5977'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span></div><div class='line' id='LC5978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">temp</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span></div><div class='line' id='LC5979'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">temp</span><span class="p">;</span></div><div class='line' id='LC5980'><span class="p">}</span></div><div class='line' id='LC5981'><br/></div><div class='line' id='LC5982'><span class="c1">// export Crafty</span></div><div class='line' id='LC5983'><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// AMD</span></div><div class='line' id='LC5984'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">define</span><span class="p">(</span><span class="s1">&#39;crafty&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC5985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Crafty</span><span class="p">;</span></div><div class='line' id='LC5986'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC5987'><span class="p">}</span></div><div class='line' id='LC5988'><br/></div><div class='line' id='LC5989'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">;</span></div><div class='line' id='LC5990'><br/></div><div class='line' id='LC5991'><span class="nb">window</span><span class="p">.</span><span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">;</span></div><div class='line' id='LC5992'><br/></div><div class='line' id='LC5993'><br/></div><div class='line' id='LC5994'><span class="p">},{</span><span class="s2">&quot;./version&quot;</span><span class="o">:</span><span class="mi">28</span><span class="p">}],</span><span class="mi">10</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC5995'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC5996'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC5997'><br/></div><div class='line' id='LC5998'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC5999'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6000'><span class="cm">     * #Crafty.device</span></div><div class='line' id='LC6001'><span class="cm">     * @category Misc</span></div><div class='line' id='LC6002'><span class="cm">     */</span></div><div class='line' id='LC6003'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">device</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC6004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_deviceOrientationCallback</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC6005'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_deviceMotionCallback</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC6006'><br/></div><div class='line' id='LC6007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC6008'><span class="cm">         * The HTML5 DeviceOrientation event returns three pieces of data:</span></div><div class='line' id='LC6009'><span class="cm">         *  * alpha the direction the device is facing according to the compass</span></div><div class='line' id='LC6010'><span class="cm">         *  * beta the angle in degrees the device is tilted front-to-back</span></div><div class='line' id='LC6011'><span class="cm">         *  * gamma the angle in degrees the device is tilted left-to-right.</span></div><div class='line' id='LC6012'><span class="cm">         *  * The angles values increase as you tilt the device to the right or towards you.</span></div><div class='line' id='LC6013'><span class="cm">         *</span></div><div class='line' id='LC6014'><span class="cm">         * Since Firefox uses the MozOrientationEvent which returns similar data but</span></div><div class='line' id='LC6015'><span class="cm">         * using different parameters and a different measurement system, we want to</span></div><div class='line' id='LC6016'><span class="cm">         * normalize that before we pass it to our _deviceOrientationCallback function.</span></div><div class='line' id='LC6017'><span class="cm">         *</span></div><div class='line' id='LC6018'><span class="cm">         * @param eventData HTML5 DeviceOrientation event</span></div><div class='line' id='LC6019'><span class="cm">         */</span></div><div class='line' id='LC6020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_normalizeDeviceOrientation</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">eventData</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">data</span><span class="p">;</span></div><div class='line' id='LC6022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">DeviceOrientationEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC6024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// gamma is the left-to-right tilt in degrees, where right is positive</span></div><div class='line' id='LC6025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltLR&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">gamma</span><span class="p">,</span></div><div class='line' id='LC6026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// beta is the front-to-back tilt in degrees, where front is positive</span></div><div class='line' id='LC6027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltFB&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">beta</span><span class="p">,</span></div><div class='line' id='LC6028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// alpha is the compass direction the device is facing in degrees</span></div><div class='line' id='LC6029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;dir&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">alpha</span><span class="p">,</span></div><div class='line' id='LC6030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// deviceorientation does not provide this data</span></div><div class='line' id='LC6031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;motUD&#39;</span><span class="o">:</span> <span class="kc">null</span></div><div class='line' id='LC6032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">OrientationEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC6035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// x is the left-to-right tilt from -1 to +1, so we need to convert to degrees</span></div><div class='line' id='LC6036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltLR&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC6037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// y is the front-to-back tilt from -1 to +1, so we need to convert to degrees</span></div><div class='line' id='LC6038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We also need to invert the value so tilting the device towards us (forward)</span></div><div class='line' id='LC6039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// results in a positive value.</span></div><div class='line' id='LC6040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltFB&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC6041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// MozOrientation does not provide this data</span></div><div class='line' id='LC6042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;dir&#39;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC6043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// z is the vertical acceleration of the device</span></div><div class='line' id='LC6044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;motUD&#39;</span><span class="o">:</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">z</span></div><div class='line' id='LC6045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6047'><br/></div><div class='line' id='LC6048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">_deviceOrientationCallback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC6049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6050'><br/></div><div class='line' id='LC6051'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC6052'><span class="cm">         * @param eventData HTML5 DeviceMotion event</span></div><div class='line' id='LC6053'><span class="cm">         */</span></div><div class='line' id='LC6054'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_normalizeDeviceMotion</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">eventData</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6055'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">acceleration</span> <span class="o">=</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">accelerationIncludingGravity</span><span class="p">,</span></div><div class='line' id='LC6056'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">facingUp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="o">+</span><span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6057'><br/></div><div class='line' id='LC6058'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC6059'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Grab the acceleration including gravity from the results</span></div><div class='line' id='LC6060'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;acceleration&#39;</span><span class="o">:</span> <span class="nx">acceleration</span><span class="p">,</span></div><div class='line' id='LC6061'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;rawAcceleration&#39;</span><span class="o">:</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span></div><div class='line' id='LC6062'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Z is the acceleration in the Z axis, and if the device is facing up or down</span></div><div class='line' id='LC6063'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;facingUp&#39;</span><span class="o">:</span> <span class="nx">facingUp</span><span class="p">,</span></div><div class='line' id='LC6064'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Convert the value from acceleration to degrees acceleration.x|y is the</span></div><div class='line' id='LC6065'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// acceleration according to gravity, we&#39;ll assume we&#39;re on Earth and divide</span></div><div class='line' id='LC6066'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// by 9.81 (earth gravity) to get a percentage value, and then multiply that</span></div><div class='line' id='LC6067'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// by 90 to convert to degrees.</span></div><div class='line' id='LC6068'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltLR&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(((</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mf">9.81</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">90</span><span class="p">),</span></div><div class='line' id='LC6069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;tiltFB&#39;</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(((</span><span class="nx">acceleration</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mf">9.81</span><span class="p">)</span> <span class="o">/</span> <span class="mf">9.81</span><span class="p">)</span> <span class="o">*</span> <span class="mi">90</span> <span class="o">*</span> <span class="nx">facingUp</span><span class="p">)</span></div><div class='line' id='LC6070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6071'><br/></div><div class='line' id='LC6072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">_deviceMotionCallback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC6073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6074'><br/></div><div class='line' id='LC6075'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6076'><span class="cm">         * #Crafty.device.deviceOrientation</span></div><div class='line' id='LC6077'><span class="cm">         * @comp Crafty.device</span></div><div class='line' id='LC6078'><span class="cm">         * @sign public Crafty.device.deviceOrientation(Function callback)</span></div><div class='line' id='LC6079'><span class="cm">         * @param callback - Callback method executed once as soon as device orientation is change</span></div><div class='line' id='LC6080'><span class="cm">         *</span></div><div class='line' id='LC6081'><span class="cm">         * Do something with normalized device orientation data:</span></div><div class='line' id='LC6082'><span class="cm">         * ~~~</span></div><div class='line' id='LC6083'><span class="cm">         * {</span></div><div class='line' id='LC6084'><span class="cm">         *   &#39;tiltLR&#39;    :   &#39;gamma the angle in degrees the device is tilted left-to-right.&#39;,</span></div><div class='line' id='LC6085'><span class="cm">         *   &#39;tiltFB&#39;    :   &#39;beta the angle in degrees the device is tilted front-to-back&#39;,</span></div><div class='line' id='LC6086'><span class="cm">         *   &#39;dir&#39;       :   &#39;alpha the direction the device is facing according to the compass&#39;,</span></div><div class='line' id='LC6087'><span class="cm">         *   &#39;motUD&#39;     :   &#39;The angles values increase as you tilt the device to the right or towards you.&#39;</span></div><div class='line' id='LC6088'><span class="cm">         * }</span></div><div class='line' id='LC6089'><span class="cm">         * ~~~</span></div><div class='line' id='LC6090'><span class="cm">         *</span></div><div class='line' id='LC6091'><span class="cm">         * @example</span></div><div class='line' id='LC6092'><span class="cm">         * ~~~</span></div><div class='line' id='LC6093'><span class="cm">         * // Get DeviceOrientation event normalized data.</span></div><div class='line' id='LC6094'><span class="cm">         * Crafty.device.deviceOrientation(function(data){</span></div><div class='line' id='LC6095'><span class="cm">         *     console.log(&#39;data.tiltLR : &#39;+Math.round(data.tiltLR)+&#39;, data.tiltFB : &#39;+Math.round(data.tiltFB)+&#39;, data.dir : &#39;+Math.round(data.dir)+&#39;, data.motUD : &#39;+data.motUD+&#39;&#39;);</span></div><div class='line' id='LC6096'><span class="cm">         * });</span></div><div class='line' id='LC6097'><span class="cm">         * ~~~</span></div><div class='line' id='LC6098'><span class="cm">         *</span></div><div class='line' id='LC6099'><span class="cm">         * See browser support at http://caniuse.com/#search=device orientation.</span></div><div class='line' id='LC6100'><span class="cm">         */</span></div><div class='line' id='LC6101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deviceOrientation</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_deviceOrientationCallback</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span></div><div class='line' id='LC6103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">deviceorientation</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">DeviceOrientationEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Listen for the deviceorientation event and handle DeviceOrientationEvent object</span></div><div class='line' id='LC6106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;deviceorientation&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeDeviceOrientation</span><span class="p">);</span></div><div class='line' id='LC6107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">OrientationEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Listen for the MozOrientation event and handle OrientationData object</span></div><div class='line' id='LC6109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;MozOrientation&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeDeviceOrientation</span><span class="p">);</span></div><div class='line' id='LC6110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6113'><br/></div><div class='line' id='LC6114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6115'><span class="cm">         * #Crafty.device.deviceMotion</span></div><div class='line' id='LC6116'><span class="cm">         * @comp Crafty.device</span></div><div class='line' id='LC6117'><span class="cm">         * @sign public Crafty.device.deviceMotion(Function callback)</span></div><div class='line' id='LC6118'><span class="cm">         * @param callback - Callback method executed once as soon as device motion is change</span></div><div class='line' id='LC6119'><span class="cm">         *</span></div><div class='line' id='LC6120'><span class="cm">         * Do something with normalized device motion data:</span></div><div class='line' id='LC6121'><span class="cm">         * ~~~</span></div><div class='line' id='LC6122'><span class="cm">         * {</span></div><div class='line' id='LC6123'><span class="cm">         *     &#39;acceleration&#39; : &#39; Grab the acceleration including gravity from the results&#39;,</span></div><div class='line' id='LC6124'><span class="cm">         *     &#39;rawAcceleration&#39; : &#39;Display the raw acceleration data&#39;,</span></div><div class='line' id='LC6125'><span class="cm">         *     &#39;facingUp&#39; : &#39;Z is the acceleration in the Z axis, and if the device is facing up or down&#39;,</span></div><div class='line' id='LC6126'><span class="cm">         *     &#39;tiltLR&#39; : &#39;Convert the value from acceleration to degrees. acceleration.x is the acceleration according to gravity, we&#39;ll assume we&#39;re on Earth and divide by 9.81 (earth gravity) to get a percentage value, and then multiply that by 90 to convert to degrees.&#39;,</span></div><div class='line' id='LC6127'><span class="cm">         *     &#39;tiltFB&#39; : &#39;Convert the value from acceleration to degrees.&#39;</span></div><div class='line' id='LC6128'><span class="cm">         * }</span></div><div class='line' id='LC6129'><span class="cm">         * ~~~</span></div><div class='line' id='LC6130'><span class="cm">         *</span></div><div class='line' id='LC6131'><span class="cm">         * @example</span></div><div class='line' id='LC6132'><span class="cm">         * ~~~</span></div><div class='line' id='LC6133'><span class="cm">         * // Get DeviceMotion event normalized data.</span></div><div class='line' id='LC6134'><span class="cm">         * Crafty.device.deviceMotion(function(data){</span></div><div class='line' id='LC6135'><span class="cm">         *     console.log(&#39;data.moAccel : &#39;+data.rawAcceleration+&#39;, data.moCalcTiltLR : &#39;+Math.round(data.tiltLR)+&#39;, data.moCalcTiltFB : &#39;+Math.round(data.tiltFB)+&#39;&#39;);</span></div><div class='line' id='LC6136'><span class="cm">         * });</span></div><div class='line' id='LC6137'><span class="cm">         * ~~~</span></div><div class='line' id='LC6138'><span class="cm">         *</span></div><div class='line' id='LC6139'><span class="cm">         * See browser support at http://caniuse.com/#search=motion.</span></div><div class='line' id='LC6140'><span class="cm">         */</span></div><div class='line' id='LC6141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deviceMotion</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_deviceMotionCallback</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span></div><div class='line' id='LC6143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">devicemotion</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">DeviceMotionEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Listen for the devicemotion event and handle DeviceMotionEvent object</span></div><div class='line' id='LC6146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;devicemotion&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeDeviceMotion</span><span class="p">);</span></div><div class='line' id='LC6147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6150'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6151'><span class="p">});</span></div><div class='line' id='LC6152'><br/></div><div class='line' id='LC6153'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">11</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC6154'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC6155'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC6156'><br/></div><div class='line' id='LC6157'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC6158'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6159'><span class="cm">     * #Crafty.diamondIso</span></div><div class='line' id='LC6160'><span class="cm">     * @category 2D</span></div><div class='line' id='LC6161'><span class="cm">     * Place entities in a 45deg diamond isometric fashion. It is similar to isometric but has another grid locations</span></div><div class='line' id='LC6162'><span class="cm">     */</span></div><div class='line' id='LC6163'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">diamondIso</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC6164'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_tile</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC6165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6166'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6167'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">r</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC6168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_map</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC6170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC6174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6175'><br/></div><div class='line' id='LC6176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_origin</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC6177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC6179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6181'><span class="cm">         * #Crafty.diamondIso.init</span></div><div class='line' id='LC6182'><span class="cm">         * @comp Crafty.diamondIso</span></div><div class='line' id='LC6183'><span class="cm">         * @sign public this Crafty.diamondIso.init(Number tileWidth,Number tileHeight,Number mapWidth,Number mapHeight)</span></div><div class='line' id='LC6184'><span class="cm">         * @param tileWidth - The size of base tile width in Pixel</span></div><div class='line' id='LC6185'><span class="cm">         * @param tileHeight - The size of base tile height in Pixel</span></div><div class='line' id='LC6186'><span class="cm">         * @param mapWidth - The width of whole map in Tiles</span></div><div class='line' id='LC6187'><span class="cm">         * @param mapHeight - The height of whole map in Tiles</span></div><div class='line' id='LC6188'><span class="cm">         *</span></div><div class='line' id='LC6189'><span class="cm">         * Method used to initialize the size of the isometric placement.</span></div><div class='line' id='LC6190'><span class="cm">         * Recommended to use a size alues in the power of `2` (128, 64 or 32).</span></div><div class='line' id='LC6191'><span class="cm">         * This makes it easy to calculate positions and implement zooming.</span></div><div class='line' id='LC6192'><span class="cm">         *</span></div><div class='line' id='LC6193'><span class="cm">         * @example</span></div><div class='line' id='LC6194'><span class="cm">         * ~~~</span></div><div class='line' id='LC6195'><span class="cm">         * var iso = Crafty.diamondIso.init(64,128,20,20);</span></div><div class='line' id='LC6196'><span class="cm">         * ~~~</span></div><div class='line' id='LC6197'><span class="cm">         *</span></div><div class='line' id='LC6198'><span class="cm">         * @see Crafty.diamondIso.place</span></div><div class='line' id='LC6199'><span class="cm">         */</span></div><div class='line' id='LC6200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tw</span><span class="p">,</span> <span class="nx">th</span><span class="p">,</span> <span class="nx">mw</span><span class="p">,</span> <span class="nx">mh</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tw</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span></div><div class='line' id='LC6202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">th</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tw</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC6203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC6204'><br/></div><div class='line' id='LC6205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_map</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">mw</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span></div><div class='line' id='LC6206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_map</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">mh</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">mw</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span></div><div class='line' id='LC6207'><br/></div><div class='line' id='LC6208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_map</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC6209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6212'><span class="cm">         * #Crafty.diamondIso.place</span></div><div class='line' id='LC6213'><span class="cm">         * @comp Crafty.diamondIso</span></div><div class='line' id='LC6214'><span class="cm">         * @sign public this Crafty.diamondIso.place(Entity tile,Number x, Number y, Number layer)</span></div><div class='line' id='LC6215'><span class="cm">         * @param x - The `x` position to place the tile</span></div><div class='line' id='LC6216'><span class="cm">         * @param y - The `y` position to place the tile</span></div><div class='line' id='LC6217'><span class="cm">         * @param layer - The `z` position to place the tile (calculated by y position * layer)</span></div><div class='line' id='LC6218'><span class="cm">         * @param tile - The entity that should be position in the isometric fashion</span></div><div class='line' id='LC6219'><span class="cm">         *</span></div><div class='line' id='LC6220'><span class="cm">         * Use this method to place an entity in an isometric grid.</span></div><div class='line' id='LC6221'><span class="cm">         *</span></div><div class='line' id='LC6222'><span class="cm">         * @example</span></div><div class='line' id='LC6223'><span class="cm">         * ~~~</span></div><div class='line' id='LC6224'><span class="cm">         * var iso = Crafty.diamondIso.init(64,128,20,20);</span></div><div class='line' id='LC6225'><span class="cm">         * isos.place(Crafty.e(&#39;2D, DOM, Color&#39;).color(&#39;red&#39;).attr({w:128, h:128}),1,1,2);</span></div><div class='line' id='LC6226'><span class="cm">         * ~~~</span></div><div class='line' id='LC6227'><span class="cm">         *</span></div><div class='line' id='LC6228'><span class="cm">         * @see Crafty.diamondIso.size</span></div><div class='line' id='LC6229'><span class="cm">         */</span></div><div class='line' id='LC6230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">place</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">layer</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos2px</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC6232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">layer</span><span class="p">)</span> <span class="nx">layer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">marginX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginX</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC6237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginY</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC6238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6239'><br/></div><div class='line' id='LC6240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nx">marginX</span><span class="p">);</span></div><div class='line' id='LC6241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">marginY</span><span class="p">)</span> <span class="o">-</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC6242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">*</span> <span class="nx">layer</span><span class="p">;</span></div><div class='line' id='LC6243'><br/></div><div class='line' id='LC6244'><br/></div><div class='line' id='LC6245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">centerAt</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos2px</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC6248'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC6249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC6250'><br/></div><div class='line' id='LC6251'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">area</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">offset</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">offset</span><span class="p">)</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//calculate the corners</span></div><div class='line' id='LC6255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vp</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">rect</span><span class="p">(),</span></div><div class='line' id='LC6256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="nx">vp</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC6257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">vp</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC6258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span> <span class="o">=</span> <span class="nx">vp</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span></div><div class='line' id='LC6259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span> <span class="o">=</span> <span class="nx">vp</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC6260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ow</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC6261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oh</span> <span class="o">=</span> <span class="nx">offset</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC6262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">-=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">ow</span><span class="p">);</span></div><div class='line' id='LC6263'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">-=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">oh</span><span class="p">);</span></div><div class='line' id='LC6264'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span> <span class="o">+=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">ow</span><span class="p">);</span></div><div class='line' id='LC6265'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span> <span class="o">+=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">oh</span><span class="p">);</span></div><div class='line' id='LC6266'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*  Crafty.viewport.x = -x;</span></div><div class='line' id='LC6267'><span class="cm">            Crafty.viewport.y = -y;</span></div><div class='line' id='LC6268'><span class="cm">            Crafty.viewport.width = w;</span></div><div class='line' id='LC6269'><span class="cm">            Crafty.viewport.height = h;   */</span></div><div class='line' id='LC6270'><br/></div><div class='line' id='LC6271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC6272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">yl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">h</span><span class="p">);</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">yl</span><span class="p">;</span> <span class="nx">y</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">xl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">w</span><span class="p">);</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">xl</span><span class="p">;</span> <span class="nx">x</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6274'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">px2pos</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC6275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">grid</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="o">~~</span><span class="nx">row</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">~~</span><span class="nx">row</span><span class="p">.</span><span class="nx">y</span><span class="p">]);</span></div><div class='line' id='LC6276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6277'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">grid</span><span class="p">;</span></div><div class='line' id='LC6279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos2px</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC6282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">left</span><span class="o">:</span> <span class="p">((</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span></div><div class='line' id='LC6283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">top</span><span class="o">:</span> <span class="p">((</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div><div class='line' id='LC6284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6286'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">px2pos</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6287'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">left</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span></div><div class='line' id='LC6288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC6289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="p">((</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span><span class="p">),</span></div><div class='line' id='LC6290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="p">((</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span></div><div class='line' id='LC6291'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6293'><br/></div><div class='line' id='LC6294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">polygon</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6295'><br/></div><div class='line' id='LC6296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;Collision&quot;</span><span class="p">);</span></div><div class='line' id='LC6297'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">marginX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6299'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6300'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginX</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC6301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">marginY</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__margin</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC6302'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[</span></div><div class='line' id='LC6304'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">[</span><span class="nx">marginX</span> <span class="o">-</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">marginY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span></div><div class='line' id='LC6305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">[</span><span class="nx">marginX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">marginY</span> <span class="o">-</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC6306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">[</span><span class="nx">marginX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">marginY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span></div><div class='line' id='LC6307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">[</span><span class="nx">marginX</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">marginY</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span><span class="p">]</span></div><div class='line' id='LC6308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">];</span></div><div class='line' id='LC6309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">poly</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">polygon</span><span class="p">(</span><span class="nx">points</span><span class="p">);</span></div><div class='line' id='LC6310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">poly</span><span class="p">;</span></div><div class='line' id='LC6311'><br/></div><div class='line' id='LC6312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6313'><br/></div><div class='line' id='LC6314'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6315'><span class="p">});</span></div><div class='line' id='LC6316'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">12</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC6317'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC6318'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC6319'><br/></div><div class='line' id='LC6320'><span class="cm">/**@</span></div><div class='line' id='LC6321'><span class="cm"> * #Color</span></div><div class='line' id='LC6322'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC6323'><span class="cm"> * Draw a solid color for the entity</span></div><div class='line' id='LC6324'><span class="cm"> */</span></div><div class='line' id='LC6325'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC6326'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_color</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div><div class='line' id='LC6327'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC6328'><br/></div><div class='line' id='LC6329'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;DOM&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">;</span></div><div class='line' id='LC6333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">lineHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;canvas&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">)</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">;</span></div><div class='line' id='LC6336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC6339'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6340'><br/></div><div class='line' id='LC6341'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6342'><span class="cm">     * #.color</span></div><div class='line' id='LC6343'><span class="cm">     * @comp Color</span></div><div class='line' id='LC6344'><span class="cm">     * @trigger Invalidate - when the color changes</span></div><div class='line' id='LC6345'><span class="cm">     * @sign public this .color(String color)</span></div><div class='line' id='LC6346'><span class="cm">     * @sign public String .color()</span></div><div class='line' id='LC6347'><span class="cm">     * @param color - Color of the rectangle</span></div><div class='line' id='LC6348'><span class="cm">     * Will create a rectangle of solid color for the entity, or return the color if no argument is given.</span></div><div class='line' id='LC6349'><span class="cm">     *</span></div><div class='line' id='LC6350'><span class="cm">     * The argument must be a color readable depending on which browser you</span></div><div class='line' id='LC6351'><span class="cm">     * choose to support.</span></div><div class='line' id='LC6352'><span class="cm">     *</span></div><div class='line' id='LC6353'><span class="cm">     * @example</span></div><div class='line' id='LC6354'><span class="cm">     * ```</span></div><div class='line' id='LC6355'><span class="cm">     * Crafty.e(&quot;2D, DOM, Color&quot;)</span></div><div class='line' id='LC6356'><span class="cm">     *    .color(&quot;#969696&quot;);</span></div><div class='line' id='LC6357'><span class="cm">     * ```</span></div><div class='line' id='LC6358'><span class="cm">     */</span></div><div class='line' id='LC6359'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">color</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6360'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">color</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_color</span><span class="p">;</span></div><div class='line' id='LC6361'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span></div><div class='line' id='LC6362'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC6363'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6364'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6365'><span class="p">});</span></div><div class='line' id='LC6366'><br/></div><div class='line' id='LC6367'><span class="cm">/**@</span></div><div class='line' id='LC6368'><span class="cm"> * #Tint</span></div><div class='line' id='LC6369'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC6370'><span class="cm"> * Similar to Color by adding an overlay of semi-transparent color.</span></div><div class='line' id='LC6371'><span class="cm"> *</span></div><div class='line' id='LC6372'><span class="cm"> * *Note: Currently only works for Canvas*</span></div><div class='line' id='LC6373'><span class="cm"> */</span></div><div class='line' id='LC6374'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Tint&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC6375'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_color</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC6376'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_strength</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span></div><div class='line' id='LC6377'><br/></div><div class='line' id='LC6378'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6379'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">d</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC6381'><br/></div><div class='line' id='LC6382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_color</span> <span class="o">||</span> <span class="s2">&quot;rgba(0,0,0, 0)&quot;</span><span class="p">;</span></div><div class='line' id='LC6383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6384'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6385'><br/></div><div class='line' id='LC6386'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;Tint&quot;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">);</span></div><div class='line' id='LC6388'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC6389'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6390'><br/></div><div class='line' id='LC6391'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6392'><span class="cm">     * #.tint</span></div><div class='line' id='LC6393'><span class="cm">     * @comp Tint</span></div><div class='line' id='LC6394'><span class="cm">     * @trigger Invalidate - when the tint is applied</span></div><div class='line' id='LC6395'><span class="cm">     * @sign public this .tint(String color, Number strength)</span></div><div class='line' id='LC6396'><span class="cm">     * @param color - The color in hexadecimal</span></div><div class='line' id='LC6397'><span class="cm">     * @param strength - Level of opacity</span></div><div class='line' id='LC6398'><span class="cm">     *</span></div><div class='line' id='LC6399'><span class="cm">     * Modify the color and level opacity to give a tint on the entity.</span></div><div class='line' id='LC6400'><span class="cm">     *</span></div><div class='line' id='LC6401'><span class="cm">     * @example</span></div><div class='line' id='LC6402'><span class="cm">     * ~~~</span></div><div class='line' id='LC6403'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Tint&quot;)</span></div><div class='line' id='LC6404'><span class="cm">     *    .tint(&quot;#969696&quot;, 0.3);</span></div><div class='line' id='LC6405'><span class="cm">     * ~~~</span></div><div class='line' id='LC6406'><span class="cm">     */</span></div><div class='line' id='LC6407'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tint</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">strength</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_strength</span> <span class="o">=</span> <span class="nx">strength</span><span class="p">;</span></div><div class='line' id='LC6409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_color</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_strength</span><span class="p">);</span></div><div class='line' id='LC6410'><br/></div><div class='line' id='LC6411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC6412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6413'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6414'><span class="p">});</span></div><div class='line' id='LC6415'><br/></div><div class='line' id='LC6416'><span class="cm">/**@</span></div><div class='line' id='LC6417'><span class="cm"> * #Image</span></div><div class='line' id='LC6418'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC6419'><span class="cm"> * Draw an image with or without repeating (tiling).</span></div><div class='line' id='LC6420'><span class="cm"> */</span></div><div class='line' id='LC6421'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC6422'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_repeat</span><span class="o">:</span> <span class="s2">&quot;repeat&quot;</span><span class="p">,</span></div><div class='line' id='LC6423'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC6424'><br/></div><div class='line' id='LC6425'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6427'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;canvas&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//skip if no image</span></div><div class='line' id='LC6429'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ready</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_pattern</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6430'><br/></div><div class='line' id='LC6431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span></div><div class='line' id='LC6432'><br/></div><div class='line' id='LC6433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pattern</span><span class="p">;</span></div><div class='line' id='LC6434'><br/></div><div class='line' id='LC6435'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span></div><div class='line' id='LC6436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC6437'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span></div><div class='line' id='LC6439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;DOM&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6440'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__image</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundImage</span> <span class="o">=</span> <span class="s2">&quot;url(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__image</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span></div><div class='line' id='LC6442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundRepeat</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_repeat</span><span class="p">;</span></div><div class='line' id='LC6443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6446'><br/></div><div class='line' id='LC6447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;Image&quot;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">);</span></div><div class='line' id='LC6449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC6450'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6451'><br/></div><div class='line' id='LC6452'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6453'><span class="cm">     * #.image</span></div><div class='line' id='LC6454'><span class="cm">     * @comp Image</span></div><div class='line' id='LC6455'><span class="cm">     * @trigger Invalidate - when the image is loaded</span></div><div class='line' id='LC6456'><span class="cm">     * @sign public this .image(String url[, String repeat])</span></div><div class='line' id='LC6457'><span class="cm">     * @param url - URL of the image</span></div><div class='line' id='LC6458'><span class="cm">     * @param repeat - If the image should be repeated to fill the entity.</span></div><div class='line' id='LC6459'><span class="cm">     *</span></div><div class='line' id='LC6460'><span class="cm">     * Draw specified image. Repeat follows CSS syntax (`&quot;no-repeat&quot;, &quot;repeat&quot;, &quot;repeat-x&quot;, &quot;repeat-y&quot;`);</span></div><div class='line' id='LC6461'><span class="cm">     *</span></div><div class='line' id='LC6462'><span class="cm">     * *Note: Default repeat is `no-repeat` which is different to standard DOM (which is `repeat`)*</span></div><div class='line' id='LC6463'><span class="cm">     *</span></div><div class='line' id='LC6464'><span class="cm">     * If the width and height are `0` and repeat is set to `no-repeat` the width and</span></div><div class='line' id='LC6465'><span class="cm">     * height will automatically assume that of the image. This is an</span></div><div class='line' id='LC6466'><span class="cm">     * easy way to create an image without needing sprites.</span></div><div class='line' id='LC6467'><span class="cm">     *</span></div><div class='line' id='LC6468'><span class="cm">     * @example</span></div><div class='line' id='LC6469'><span class="cm">     * Will default to no-repeat. Entity width and height will be set to the images width and height</span></div><div class='line' id='LC6470'><span class="cm">     * ~~~</span></div><div class='line' id='LC6471'><span class="cm">     * var ent = Crafty.e(&quot;2D, DOM, Image&quot;).image(&quot;myimage.png&quot;);</span></div><div class='line' id='LC6472'><span class="cm">     * ~~~</span></div><div class='line' id='LC6473'><span class="cm">     * Create a repeating background.</span></div><div class='line' id='LC6474'><span class="cm">     * ~~~</span></div><div class='line' id='LC6475'><span class="cm">     * var bg = Crafty.e(&quot;2D, DOM, Image&quot;)</span></div><div class='line' id='LC6476'><span class="cm">     *              .attr({w: Crafty.viewport.width, h: Crafty.viewport.height})</span></div><div class='line' id='LC6477'><span class="cm">     *              .image(&quot;bg.png&quot;, &quot;repeat&quot;);</span></div><div class='line' id='LC6478'><span class="cm">     * ~~~</span></div><div class='line' id='LC6479'><span class="cm">     *</span></div><div class='line' id='LC6480'><span class="cm">     * @see Crafty.sprite</span></div><div class='line' id='LC6481'><span class="cm">     */</span></div><div class='line' id='LC6482'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">image</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__image</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span></div><div class='line' id='LC6484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_repeat</span> <span class="o">=</span> <span class="nx">repeat</span> <span class="o">||</span> <span class="s2">&quot;no-repeat&quot;</span><span class="p">;</span></div><div class='line' id='LC6485'><br/></div><div class='line' id='LC6486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">img</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span></div><div class='line' id='LC6487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span></div><div class='line' id='LC6489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">);</span></div><div class='line' id='LC6490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span></div><div class='line' id='LC6491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6492'><br/></div><div class='line' id='LC6493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;Canvas&quot;</span><span class="p">))</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_pattern</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">createPattern</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">img</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_repeat</span><span class="p">);</span></div><div class='line' id='LC6495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC6496'><br/></div><div class='line' id='LC6497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_repeat</span> <span class="o">===</span> <span class="s2">&quot;no-repeat&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC6499'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC6500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6501'><br/></div><div class='line' id='LC6502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">self</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC6503'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6504'><br/></div><div class='line' id='LC6505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC6507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC6508'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;Canvas&quot;</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">_pattern</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">createPattern</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_repeat</span><span class="p">);</span></div><div class='line' id='LC6509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_repeat</span> <span class="o">===</span> <span class="s2">&quot;no-repeat&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC6511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC6512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6514'><br/></div><div class='line' id='LC6515'><br/></div><div class='line' id='LC6516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC6517'><br/></div><div class='line' id='LC6518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC6519'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6520'><span class="p">});</span></div><div class='line' id='LC6521'><br/></div><div class='line' id='LC6522'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC6523'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6524'><span class="cm">     * #Crafty.toRGB</span></div><div class='line' id='LC6525'><span class="cm">     * @category Graphics</span></div><div class='line' id='LC6526'><span class="cm">     * @sign public String Crafty.scene(String hex[, Number alpha])</span></div><div class='line' id='LC6527'><span class="cm">     * @param hex - a 6 character hex number string representing RGB color</span></div><div class='line' id='LC6528'><span class="cm">     * @param alpha - The alpha value.</span></div><div class='line' id='LC6529'><span class="cm">     *</span></div><div class='line' id='LC6530'><span class="cm">     * Get a rgb string or rgba string (if `alpha` presents).</span></div><div class='line' id='LC6531'><span class="cm">     *</span></div><div class='line' id='LC6532'><span class="cm">     * @example</span></div><div class='line' id='LC6533'><span class="cm">     * ~~~</span></div><div class='line' id='LC6534'><span class="cm">     * Crafty.toRGB(&quot;ffffff&quot;); // rgb(255,255,255)</span></div><div class='line' id='LC6535'><span class="cm">     * Crafty.toRGB(&quot;#ffffff&quot;); // rgb(255,255,255)</span></div><div class='line' id='LC6536'><span class="cm">     * Crafty.toRGB(&quot;ffffff&quot;, .5); // rgba(255,255,255,0.5)</span></div><div class='line' id='LC6537'><span class="cm">     * ~~~</span></div><div class='line' id='LC6538'><span class="cm">     *</span></div><div class='line' id='LC6539'><span class="cm">     * @see Text.textColor</span></div><div class='line' id='LC6540'><span class="cm">     */</span></div><div class='line' id='LC6541'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">toRGB</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hex</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hex</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nx">hex</span><span class="p">;</span></div><div class='line' id='LC6543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6544'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span><span class="p">;</span></div><div class='line' id='LC6545'><br/></div><div class='line' id='LC6546'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span></div><div class='line' id='LC6547'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span></div><div class='line' id='LC6548'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span></div><div class='line' id='LC6549'><br/></div><div class='line' id='LC6550'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">result</span> <span class="o">=</span> <span class="nx">alpha</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="s1">&#39;rgb(&#39;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">:</span> <span class="s1">&#39;rgba(&#39;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">alpha</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span></div><div class='line' id='LC6551'><br/></div><div class='line' id='LC6552'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">result</span><span class="p">;</span></div><div class='line' id='LC6553'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6554'><span class="p">});</span></div><div class='line' id='LC6555'><br/></div><div class='line' id='LC6556'><span class="cm">/**@</span></div><div class='line' id='LC6557'><span class="cm"> * #Crafty.DrawManager</span></div><div class='line' id='LC6558'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC6559'><span class="cm"> * @sign Crafty.DrawManager</span></div><div class='line' id='LC6560'><span class="cm"> *</span></div><div class='line' id='LC6561'><span class="cm"> * An internal object manage objects to be drawn and implement</span></div><div class='line' id='LC6562'><span class="cm"> * the best method of drawing in both DOM and canvas</span></div><div class='line' id='LC6563'><span class="cm"> */</span></div><div class='line' id='LC6564'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6565'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** Helper function to sort by globalZ */</span></div><div class='line' id='LC6566'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">zsort</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_globalZ</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_globalZ</span><span class="p">;</span></div><div class='line' id='LC6568'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6569'><br/></div><div class='line' id='LC6570'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** array of dirty rects on screen */</span></div><div class='line' id='LC6571'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">dirty_rects</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">changed_objs</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** array of DOMs needed updating */</span></div><div class='line' id='LC6574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dom</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6575'><br/></div><div class='line' id='LC6576'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC6577'><br/></div><div class='line' id='LC6578'><br/></div><div class='line' id='LC6579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** recManager: an object for managing dirty rectangles. */</span></div><div class='line' id='LC6580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC6581'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** Finds smallest rectangles that overlaps a and b, merges them into target */</span></div><div class='line' id='LC6582'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">merge</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6583'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">target</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC6584'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC6585'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Doing it in this order means we can use either a or b as the target, with no conflict</span></div><div class='line' id='LC6586'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_h</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6587'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_w</span><span class="p">);</span></div><div class='line' id='LC6588'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_x</span><span class="p">);</span></div><div class='line' id='LC6589'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC6590'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_w</span> <span class="o">-=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC6591'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">_h</span> <span class="o">-=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC6592'><br/></div><div class='line' id='LC6593'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">target</span><span class="p">;</span></div><div class='line' id='LC6594'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6595'><br/></div><div class='line' id='LC6596'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** cleans up current dirty state, stores stale state for future passes */</span></div><div class='line' id='LC6597'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC6599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">changed_objs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">changed_objs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC6601'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC6602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC6603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC6604'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC6605'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC6606'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC6607'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC6608'><br/></div><div class='line' id='LC6609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC6610'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6611'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">changed_objs</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6612'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6613'><br/></div><div class='line' id='LC6614'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6615'><br/></div><div class='line' id='LC6616'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** Takes the current and previous position of an object, and pushes the dirty regions onto the stack</span></div><div class='line' id='LC6617'><span class="cm">             *  If the entity has only moved/changed a little bit, the regions are squashed together */</span></div><div class='line' id='LC6618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">createDirty</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6619'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC6620'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//If overlap, merge stale and current position together, then return</span></div><div class='line' id='LC6622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Otherwise just push stale rectangle</span></div><div class='line' id='LC6623'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rectManager</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">,</span> <span class="nx">rect</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC6624'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">);</span></div><div class='line' id='LC6625'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">);</span></div><div class='line' id='LC6626'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6627'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC6628'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">staleRect</span><span class="p">);</span></div><div class='line' id='LC6629'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6631'><br/></div><div class='line' id='LC6632'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// We use the intermediate &quot;currentRect&quot; so it can be modified without messing with obj</span></div><div class='line' id='LC6633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC6634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC6635'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC6636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC6637'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">currentRect</span><span class="p">);</span></div><div class='line' id='LC6638'><br/></div><div class='line' id='LC6639'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6640'><br/></div><div class='line' id='LC6641'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/** Checks whether two rectangles overlap */</span></div><div class='line' id='LC6642'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">overlap</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6643'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC6644'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6645'><br/></div><div class='line' id='LC6646'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6647'><br/></div><div class='line' id='LC6648'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;InvalidateViewport&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6649'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC6650'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC6651'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;PostRender&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6652'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC6653'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC6654'><br/></div><div class='line' id='LC6655'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC6656'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6657'><span class="cm">         * #Crafty.DrawManager.total2D</span></div><div class='line' id='LC6658'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6659'><span class="cm">         *</span></div><div class='line' id='LC6660'><span class="cm">         * Total number of the entities that have the `2D` component.</span></div><div class='line' id='LC6661'><span class="cm">         */</span></div><div class='line' id='LC6662'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">total2D</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC6663'><br/></div><div class='line' id='LC6664'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6665'><span class="cm">         * #Crafty.DrawManager.onScreen</span></div><div class='line' id='LC6666'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6667'><span class="cm">         * @sign public Crafty.DrawManager.onScreen(Object rect)</span></div><div class='line' id='LC6668'><span class="cm">         * @param rect - A rectangle with field {_x: x_val, _y: y_val, _w: w_val, _h: h_val}</span></div><div class='line' id='LC6669'><span class="cm">         *</span></div><div class='line' id='LC6670'><span class="cm">         * Test if a rectangle is completely in viewport</span></div><div class='line' id='LC6671'><span class="cm">         */</span></div><div class='line' id='LC6672'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onScreen</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6673'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC6674'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&lt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">&amp;&amp;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&lt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC6675'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6676'><br/></div><div class='line' id='LC6677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6678'><span class="cm">         * #Crafty.DrawManager.mergeSet</span></div><div class='line' id='LC6679'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6680'><span class="cm">         * @sign public Object Crafty.DrawManager.mergeSet(Object set)</span></div><div class='line' id='LC6681'><span class="cm">         * @param set - an array of rectangular regions</span></div><div class='line' id='LC6682'><span class="cm">         *</span></div><div class='line' id='LC6683'><span class="cm">         * Merge any consecutive, overlapping rects into each other.</span></div><div class='line' id='LC6684'><span class="cm">         * Its an optimization for the redraw regions.</span></div><div class='line' id='LC6685'><span class="cm">         *</span></div><div class='line' id='LC6686'><span class="cm">         * The order of set isn&#39;t strictly meaningful,</span></div><div class='line' id='LC6687'><span class="cm">         * but overlapping objects will often cause each other to change,</span></div><div class='line' id='LC6688'><span class="cm">         * and so might be consecutive.</span></div><div class='line' id='LC6689'><span class="cm">         */</span></div><div class='line' id='LC6690'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mergeSet</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6691'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6692'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6693'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If current and next overlap, merge them together into the first, removing the second</span></div><div class='line' id='LC6694'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Then skip the index backwards to compare the previous pair.</span></div><div class='line' id='LC6695'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Otherwise skip forward</span></div><div class='line' id='LC6696'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rectManager</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">set</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span></div><div class='line' id='LC6697'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">set</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC6698'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC6699'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">i</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC6700'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span></div><div class='line' id='LC6701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC6702'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6703'><br/></div><div class='line' id='LC6704'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">set</span><span class="p">;</span></div><div class='line' id='LC6705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6706'><br/></div><div class='line' id='LC6707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6708'><span class="cm">         * #Crafty.DrawManager.addCanvas</span></div><div class='line' id='LC6709'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6710'><span class="cm">         * @sign public Crafty.DrawManager.addCanvas(ent)</span></div><div class='line' id='LC6711'><span class="cm">         * @param ent - The entity to add</span></div><div class='line' id='LC6712'><span class="cm">         *</span></div><div class='line' id='LC6713'><span class="cm">         * Add an entity to the list of Canvas objects to draw</span></div><div class='line' id='LC6714'><span class="cm">         */</span></div><div class='line' id='LC6715'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addCanvas</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">addCanvas</span><span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6716'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">changed_objs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ent</span><span class="p">);</span></div><div class='line' id='LC6717'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6718'><br/></div><div class='line' id='LC6719'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6720'><span class="cm">         * #Crafty.DrawManager.addDom</span></div><div class='line' id='LC6721'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6722'><span class="cm">         * @sign public Crafty.DrawManager.addDom(ent)</span></div><div class='line' id='LC6723'><span class="cm">         * @param ent - The entity to add</span></div><div class='line' id='LC6724'><span class="cm">         *</span></div><div class='line' id='LC6725'><span class="cm">         * Add an entity to the list of DOM object to draw</span></div><div class='line' id='LC6726'><span class="cm">         */</span></div><div class='line' id='LC6727'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addDom</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">addDom</span><span class="p">(</span><span class="nx">ent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dom</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ent</span><span class="p">);</span></div><div class='line' id='LC6729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6730'><br/></div><div class='line' id='LC6731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6732'><span class="cm">         * #Crafty.DrawManager.debug</span></div><div class='line' id='LC6733'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6734'><span class="cm">         * @sign public Crafty.DrawManager.debug()</span></div><div class='line' id='LC6735'><span class="cm">         */</span></div><div class='line' id='LC6736'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">debug</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6737'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">changed_objs</span><span class="p">,</span> <span class="nx">dom</span><span class="p">);</span></div><div class='line' id='LC6738'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6739'><br/></div><div class='line' id='LC6740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6741'><span class="cm">         * #Crafty.DrawManager.drawAll</span></div><div class='line' id='LC6742'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6743'><span class="cm">         * @sign public Crafty.DrawManager.drawAll([Object rect])</span></div><div class='line' id='LC6744'><span class="cm">         * @param rect - a rectangular region {_x: x_val, _y: y_val, _w: w_val, _h: h_val}</span></div><div class='line' id='LC6745'><span class="cm">         *</span></div><div class='line' id='LC6746'><span class="cm">         * - If rect is omitted, redraw within the viewport</span></div><div class='line' id='LC6747'><span class="cm">         * - If rect is provided, redraw within the rect</span></div><div class='line' id='LC6748'><span class="cm">         */</span></div><div class='line' id='LC6749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawAll</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">rect</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">rect</span><span class="p">();</span></div><div class='line' id='LC6751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rect</span><span class="p">),</span></div><div class='line' id='LC6752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC6754'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span></div><div class='line' id='LC6755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC6756'><br/></div><div class='line' id='LC6757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6758'><br/></div><div class='line' id='LC6759'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//sort the objects by the global Z</span></div><div class='line' id='LC6760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">zsort</span><span class="p">);</span></div><div class='line' id='LC6761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC6763'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">_visible</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">.</span><span class="nx">__c</span><span class="p">.</span><span class="nx">Canvas</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6764'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span></div><div class='line' id='LC6765'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC6766'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6767'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6769'><br/></div><div class='line' id='LC6770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6771'><span class="cm">         * #Crafty.DrawManager.boundingRect</span></div><div class='line' id='LC6772'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6773'><span class="cm">         * @sign public Crafty.DrawManager.boundingRect(set)</span></div><div class='line' id='LC6774'><span class="cm">         * @param set - Undocumented</span></div><div class='line' id='LC6775'><span class="cm">         *</span></div><div class='line' id='LC6776'><span class="cm">         * - Calculate the common bounding rect of multiple canvas entities.</span></div><div class='line' id='LC6777'><span class="cm">         * - Returns coords</span></div><div class='line' id='LC6778'><span class="cm">         */</span></div><div class='line' id='LC6779'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">boundingRect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6780'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">set</span> <span class="o">||</span> <span class="o">!</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6781'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">newset</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6782'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC6783'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC6784'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">,</span> <span class="nx">master</span> <span class="o">=</span> <span class="nx">set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC6785'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span><span class="p">;</span></div><div class='line' id='LC6786'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">master</span> <span class="o">=</span> <span class="p">[</span><span class="nx">master</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">master</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">master</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">master</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">master</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">master</span><span class="p">.</span><span class="nx">_h</span><span class="p">];</span></div><div class='line' id='LC6787'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6788'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC6789'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="nx">current</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_h</span><span class="p">];</span></div><div class='line' id='LC6790'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">master</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="nx">master</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC6791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">master</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="nx">master</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC6792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">master</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="nx">master</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC6793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">master</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="nx">master</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span></div><div class='line' id='LC6794'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC6795'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="nx">master</span><span class="p">;</span></div><div class='line' id='LC6797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">master</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC6798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC6799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></div><div class='line' id='LC6800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_w</span><span class="o">:</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC6801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_h</span><span class="o">:</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="nx">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div><div class='line' id='LC6802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6803'><br/></div><div class='line' id='LC6804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">master</span><span class="p">;</span></div><div class='line' id='LC6805'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6806'><br/></div><div class='line' id='LC6807'><br/></div><div class='line' id='LC6808'><br/></div><div class='line' id='LC6809'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6810'><span class="cm">         * #Crafty.DrawManager.renderCanvas</span></div><div class='line' id='LC6811'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6812'><span class="cm">         * @sign public Crafty.DrawManager.renderCanvas()</span></div><div class='line' id='LC6813'><span class="cm">         *</span></div><div class='line' id='LC6814'><span class="cm">         * - Triggered by the &quot;RenderScene&quot; event</span></div><div class='line' id='LC6815'><span class="cm">         * - If the number of rects is over 60% of the total number of objects</span></div><div class='line' id='LC6816'><span class="cm">         *	do the naive method redrawing `Crafty.DrawManager.drawAll`</span></div><div class='line' id='LC6817'><span class="cm">         * - Otherwise, clear the dirty regions, and redraw entities overlapping the dirty regions.</span></div><div class='line' id='LC6818'><span class="cm">         *</span></div><div class='line' id='LC6819'><span class="cm">         * @see Canvas.draw</span></div><div class='line' id='LC6820'><span class="cm">         */</span></div><div class='line' id='LC6821'><br/></div><div class='line' id='LC6822'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">renderCanvas</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6823'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">changed_objs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC6824'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">l</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">dirtyViewport</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6825'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6826'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6827'><br/></div><div class='line' id='LC6828'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6829'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span></div><div class='line' id='LC6830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">ent</span><span class="p">,</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span></div><div class='line' id='LC6831'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DM</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">;</span></div><div class='line' id='LC6832'><br/></div><div class='line' id='LC6833'><br/></div><div class='line' id='LC6834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dirtyViewport</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span></div><div class='line' id='LC6836'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_x</span><span class="o">*</span><span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">,</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_y</span><span class="o">*</span><span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span><span class="p">);</span></div><div class='line' id='LC6837'><br/></div><div class='line' id='LC6838'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6839'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if the amount of changed objects is over 60% of the total objects</span></div><div class='line' id='LC6840'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//do the naive method redrawing</span></div><div class='line' id='LC6841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// TODO: I&#39;m not sure this condition really makes that much sense!</span></div><div class='line' id='LC6842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">l</span> <span class="o">/</span> <span class="nx">DM</span><span class="p">.</span><span class="nx">total2D</span> <span class="o">&gt;</span> <span class="mf">0.6</span> <span class="o">||</span> <span class="nx">dirtyViewport</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">DM</span><span class="p">.</span><span class="nx">drawAll</span><span class="p">();</span></div><div class='line' id='LC6844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span><span class="p">.</span><span class="nx">clean</span><span class="p">();</span></div><div class='line' id='LC6845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6847'><br/></div><div class='line' id='LC6848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculate dirty_rects from all changed objects, then merge some overlapping regions together</span></div><div class='line' id='LC6849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6850'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span><span class="p">.</span><span class="nx">createDirty</span><span class="p">(</span><span class="nx">changed_objs</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC6851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6852'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dirty_rects</span> <span class="o">=</span> <span class="nx">DM</span><span class="p">.</span><span class="nx">mergeSet</span><span class="p">(</span><span class="nx">dirty_rects</span><span class="p">);</span></div><div class='line' id='LC6853'><br/></div><div class='line' id='LC6854'><br/></div><div class='line' id='LC6855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC6856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">dupes</span> <span class="o">=</span> <span class="p">[],</span></div><div class='line' id='LC6857'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">objs</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC6858'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// For each dirty rectangle, find entities near it, and draw the overlapping ones</span></div><div class='line' id='LC6859'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//loop over every dirty rect</span></div><div class='line' id='LC6860'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">dirty_rects</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC6861'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dupes</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6862'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">objs</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6863'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">rect</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC6864'><br/></div><div class='line' id='LC6865'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Find the smallest rectangle with integer coordinates that encloses rect</span></div><div class='line' id='LC6866'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">;</span></div><div class='line' id='LC6867'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">;</span></div><div class='line' id='LC6868'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6869'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6870'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">-=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC6871'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">-=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC6872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">===</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="o">|</span><span class="mi">0</span><span class="p">))</span> <span class="o">?</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">:</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6873'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">===</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="o">|</span><span class="mi">0</span><span class="p">))</span> <span class="o">?</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">:</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="o">|</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC6874'><br/></div><div class='line' id='LC6875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//search for ents under dirty rect</span></div><div class='line' id='LC6876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC6877'><br/></div><div class='line' id='LC6878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//clear the rect from the main canvas</span></div><div class='line' id='LC6879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6880'><br/></div><div class='line' id='LC6881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Then clip drawing region to dirty rectangle</span></div><div class='line' id='LC6882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span></div><div class='line' id='LC6883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span></div><div class='line' id='LC6884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6885'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">();</span></div><div class='line' id='LC6886'><br/></div><div class='line' id='LC6887'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Loop over found objects removing dupes and adding visible canvas objects to array</span></div><div class='line' id='LC6888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6889'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC6890'><br/></div><div class='line' id='LC6891'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dupes</span><span class="p">[</span><span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">_visible</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">__c</span><span class="p">.</span><span class="nx">Canvas</span><span class="p">)</span></div><div class='line' id='LC6892'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC6893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dupes</span><span class="p">[</span><span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC6894'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">objs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC6895'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6896'><br/></div><div class='line' id='LC6897'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Sort objects by z level</span></div><div class='line' id='LC6898'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">objs</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">zsort</span><span class="p">);</span></div><div class='line' id='LC6899'><br/></div><div class='line' id='LC6900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Then draw each object in that order</span></div><div class='line' id='LC6901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">objs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6902'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">objs</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span></div><div class='line' id='LC6903'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">area</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC6904'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">rectManager</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">area</span><span class="p">,</span> <span class="nx">rect</span><span class="p">))</span></div><div class='line' id='LC6905'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span></div><div class='line' id='LC6906'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC6907'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6908'><br/></div><div class='line' id='LC6909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Close rectangle clipping</span></div><div class='line' id='LC6910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span></div><div class='line' id='LC6911'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span></div><div class='line' id='LC6912'><br/></div><div class='line' id='LC6913'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6914'><br/></div><div class='line' id='LC6915'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Draw dirty rectangles for debugging, if that flag is set</span></div><div class='line' id='LC6916'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">debugDirty</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6917'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span></div><div class='line' id='LC6918'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">dirty_rects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">dirty_rects</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC6920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC6921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Clean up lists etc</span></div><div class='line' id='LC6924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rectManager</span><span class="p">.</span><span class="nx">clean</span><span class="p">();</span></div><div class='line' id='LC6925'><br/></div><div class='line' id='LC6926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC6927'><br/></div><div class='line' id='LC6928'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6929'><span class="cm">         * #Crafty.DrawManager.renderDOM</span></div><div class='line' id='LC6930'><span class="cm">         * @comp Crafty.DrawManager</span></div><div class='line' id='LC6931'><span class="cm">         * @sign public Crafty.DrawManager.renderDOM()</span></div><div class='line' id='LC6932'><span class="cm">         *</span></div><div class='line' id='LC6933'><span class="cm">         * When &quot;RenderScene&quot; is triggered, draws all DOM entities that have been flagged</span></div><div class='line' id='LC6934'><span class="cm">         *</span></div><div class='line' id='LC6935'><span class="cm">         * @see DOM.draw</span></div><div class='line' id='LC6936'><span class="cm">         */</span></div><div class='line' id='LC6937'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">renderDOM</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC6938'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Adjust the viewport</span></div><div class='line' id='LC6939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dirtyViewport</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span></div><div class='line' id='LC6941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">view</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span></div><div class='line' id='LC6942'><br/></div><div class='line' id='LC6943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scale(&quot;</span> <span class="o">+</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span></div><div class='line' id='LC6944'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC6945'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">view</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC6946'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span></div><div class='line' id='LC6947'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6948'><br/></div><div class='line' id='LC6949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if no objects have been changed, stop</span></div><div class='line' id='LC6950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dom</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC6951'><br/></div><div class='line' id='LC6952'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC6953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">k</span> <span class="o">=</span> <span class="nx">dom</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC6954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over all DOM elements needing updating</span></div><div class='line' id='LC6955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">k</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC6956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dom</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">draw</span><span class="p">().</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC6957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6958'><br/></div><div class='line' id='LC6959'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//reset DOM array</span></div><div class='line' id='LC6960'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dom</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC6961'><br/></div><div class='line' id='LC6962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC6963'><br/></div><div class='line' id='LC6964'><br/></div><div class='line' id='LC6965'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC6966'><span class="p">})();</span></div><div class='line' id='LC6967'><br/></div><div class='line' id='LC6968'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC6969'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC6970'><span class="cm">     * #Crafty.pixelart</span></div><div class='line' id='LC6971'><span class="cm">     * @category Graphics</span></div><div class='line' id='LC6972'><span class="cm">     * @sign public void Crafty.pixelart(Boolean enabled)</span></div><div class='line' id='LC6973'><span class="cm">     *</span></div><div class='line' id='LC6974'><span class="cm">     * Sets the image smoothing for drawing images (for both DOM and Canvas).</span></div><div class='line' id='LC6975'><span class="cm">     * Setting this to true disables smoothing for images, which is the preferred</span></div><div class='line' id='LC6976'><span class="cm">     * way for drawing pixel art. Defaults to false.</span></div><div class='line' id='LC6977'><span class="cm">     *</span></div><div class='line' id='LC6978'><span class="cm">     * This feature is experimental and you should be careful with cross-browser compatibility. </span></div><div class='line' id='LC6979'><span class="cm">     * The best way to disable image smoothing is to use the Canvas render method and the Sprite component for drawing your entities.</span></div><div class='line' id='LC6980'><span class="cm">     *</span></div><div class='line' id='LC6981'><span class="cm">     * This method will have no effect for Canvas image smoothing if the canvas is not initialized yet.</span></div><div class='line' id='LC6982'><span class="cm">     *</span></div><div class='line' id='LC6983'><span class="cm">     * Note that Firefox_26 currently has a [bug](https://bugzilla.mozilla.org/show_bug.cgi?id=696630) </span></div><div class='line' id='LC6984'><span class="cm">     * which prevents disabling image smoothing for Canvas entities that use the Image component. Use the Sprite</span></div><div class='line' id='LC6985'><span class="cm">     * component instead.</span></div><div class='line' id='LC6986'><span class="cm">     * Note that Webkit (Chrome &amp; Safari) currently has a bug [link1](http://code.google.com/p/chromium/issues/detail?id=134040) </span></div><div class='line' id='LC6987'><span class="cm">     * [link2](http://code.google.com/p/chromium/issues/detail?id=106662) that prevents disabling image smoothing</span></div><div class='line' id='LC6988'><span class="cm">     * for DOM entities.</span></div><div class='line' id='LC6989'><span class="cm">     *</span></div><div class='line' id='LC6990'><span class="cm">     * @example</span></div><div class='line' id='LC6991'><span class="cm">     * This is the preferred way to draw pixel art with the best cross-browser compatibility.</span></div><div class='line' id='LC6992'><span class="cm">     * ~~~</span></div><div class='line' id='LC6993'><span class="cm">     * Crafty.canvas.init();</span></div><div class='line' id='LC6994'><span class="cm">     * Crafty.pixelart(true);</span></div><div class='line' id='LC6995'><span class="cm">     * </span></div><div class='line' id='LC6996'><span class="cm">     * Crafty.sprite(imgWidth, imgHeight, &quot;spriteMap.png&quot;, {sprite1:[0,0]});</span></div><div class='line' id='LC6997'><span class="cm">     * Crafty.e(&quot;2D, Canvas, sprite1&quot;);</span></div><div class='line' id='LC6998'><span class="cm">     * ~~~</span></div><div class='line' id='LC6999'><span class="cm">     */</span></div><div class='line' id='LC7000'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pixelart</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7001'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC7002'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7003'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">imageSmoothingEnabled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">;</span></div><div class='line' id='LC7004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">mozImageSmoothingEnabled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">;</span></div><div class='line' id='LC7005'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">webkitImageSmoothingEnabled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">;</span></div><div class='line' id='LC7006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">oImageSmoothingEnabled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">;</span></div><div class='line' id='LC7007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">msImageSmoothingEnabled</span> <span class="o">=</span> <span class="o">!</span><span class="nx">enabled</span><span class="p">;</span></div><div class='line' id='LC7008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7009'><br/></div><div class='line' id='LC7010'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span></div><div class='line' id='LC7011'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7012'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;optimizeSpeed&quot;</span><span class="p">;</span>   <span class="cm">/* legacy */</span></div><div class='line' id='LC7013'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;-moz-crisp-edges&quot;</span><span class="p">;</span>    <span class="cm">/* Firefox */</span></div><div class='line' id='LC7014'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;-o-crisp-edges&quot;</span><span class="p">;</span>  <span class="cm">/* Opera */</span></div><div class='line' id='LC7015'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;-webkit-optimize-contrast&quot;</span><span class="p">;</span>   <span class="cm">/* Webkit (Chrome &amp; Safari) */</span></div><div class='line' id='LC7016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;-ms-interpolation-mode&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;nearest-neighbor&quot;</span><span class="p">;</span>  <span class="cm">/* IE */</span></div><div class='line' id='LC7017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;optimize-contrast&quot;</span><span class="p">;</span>   <span class="cm">/* CSS3 proposed */</span></div><div class='line' id='LC7018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;pixelated&quot;</span><span class="p">;</span>   <span class="cm">/* CSS4 proposed */</span></div><div class='line' id='LC7019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;crisp-edges&quot;</span><span class="p">;</span> <span class="cm">/* CSS4 proposed */</span></div><div class='line' id='LC7020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC7021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;optimizeQuality&quot;</span><span class="p">;</span>   <span class="cm">/* legacy */</span></div><div class='line' id='LC7022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;-ms-interpolation-mode&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;bicubic&quot;</span><span class="p">;</span>   <span class="cm">/* IE */</span></div><div class='line' id='LC7023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">[</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">camelize</span><span class="p">(</span><span class="s2">&quot;image-rendering&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">;</span>   <span class="cm">/* CSS3 */</span></div><div class='line' id='LC7024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7025'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7026'><span class="p">});</span></div><div class='line' id='LC7027'><br/></div><div class='line' id='LC7028'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">13</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7029'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7030'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7031'><br/></div><div class='line' id='LC7032'><span class="cm">/**@</span></div><div class='line' id='LC7033'><span class="cm"> * #Crafty.support</span></div><div class='line' id='LC7034'><span class="cm"> * @category Misc, Core</span></div><div class='line' id='LC7035'><span class="cm"> * Determines feature support for what Crafty can do.</span></div><div class='line' id='LC7036'><span class="cm"> */</span></div><div class='line' id='LC7037'><span class="p">(</span><span class="kd">function</span> <span class="nx">testSupport</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7038'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">support</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span> <span class="o">=</span> <span class="p">{},</span></div><div class='line' id='LC7039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ua</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span></div><div class='line' id='LC7040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">match</span> <span class="o">=</span> <span class="sr">/(webkit)[ \/]([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span></div><div class='line' id='LC7041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sr">/(o)pera(?:.*version)?[ \/]([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span></div><div class='line' id='LC7042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sr">/(ms)ie ([\w.]+)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span></div><div class='line' id='LC7043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sr">/(moz)illa(?:.*? rv:([\w.]+))?/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span> <span class="o">||</span> <span class="p">[],</span></div><div class='line' id='LC7044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mobile</span> <span class="o">=</span> <span class="sr">/iPad|iPod|iPhone|Android|webOS|IEMobile/i</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">ua</span><span class="p">);</span></div><div class='line' id='LC7045'><br/></div><div class='line' id='LC7046'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7047'><span class="cm">     * #Crafty.mobile</span></div><div class='line' id='LC7048'><span class="cm">     * @comp Crafty.device</span></div><div class='line' id='LC7049'><span class="cm">     *</span></div><div class='line' id='LC7050'><span class="cm">     * Determines if Crafty is running on mobile device.</span></div><div class='line' id='LC7051'><span class="cm">     *</span></div><div class='line' id='LC7052'><span class="cm">     * If Crafty.mobile is equal true Crafty does some things under hood:</span></div><div class='line' id='LC7053'><span class="cm">     * ~~~</span></div><div class='line' id='LC7054'><span class="cm">     * - set viewport on max device width and height</span></div><div class='line' id='LC7055'><span class="cm">     * - set Crafty.stage.fullscreen on true</span></div><div class='line' id='LC7056'><span class="cm">     * - hide window scrollbars</span></div><div class='line' id='LC7057'><span class="cm">     * ~~~</span></div><div class='line' id='LC7058'><span class="cm">     *</span></div><div class='line' id='LC7059'><span class="cm">     * @see Crafty.viewport</span></div><div class='line' id='LC7060'><span class="cm">     */</span></div><div class='line' id='LC7061'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">mobile</span><span class="p">)</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mobile</span> <span class="o">=</span> <span class="nx">mobile</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC7062'><br/></div><div class='line' id='LC7063'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7064'><span class="cm">     * #Crafty.support.setter</span></div><div class='line' id='LC7065'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7066'><span class="cm">     * Is `__defineSetter__` supported?</span></div><div class='line' id='LC7067'><span class="cm">     */</span></div><div class='line' id='LC7068'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">setter</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__defineSetter__&#39;</span> <span class="k">in</span> <span class="k">this</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;__defineGetter__&#39;</span> <span class="k">in</span> <span class="k">this</span><span class="p">);</span></div><div class='line' id='LC7069'><br/></div><div class='line' id='LC7070'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7071'><span class="cm">     * #Crafty.support.defineProperty</span></div><div class='line' id='LC7072'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7073'><span class="cm">     * Is `Object.defineProperty` supported?</span></div><div class='line' id='LC7074'><span class="cm">     */</span></div><div class='line' id='LC7075'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;defineProperty&#39;</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC7077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">try</span> <span class="p">{</span></div><div class='line' id='LC7078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">({},</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{});</span></div><div class='line' id='LC7079'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC7081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7082'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC7083'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})();</span></div><div class='line' id='LC7084'><br/></div><div class='line' id='LC7085'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7086'><span class="cm">     * #Crafty.support.audio</span></div><div class='line' id='LC7087'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7088'><span class="cm">     * Is HTML5 `Audio` supported?</span></div><div class='line' id='LC7089'><span class="cm">     */</span></div><div class='line' id='LC7090'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">audio</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Audio&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">);</span></div><div class='line' id='LC7091'><br/></div><div class='line' id='LC7092'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7093'><span class="cm">     * #Crafty.support.prefix</span></div><div class='line' id='LC7094'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7095'><span class="cm">     * Returns the browser specific prefix (`Moz`, `O`, `ms`, `webkit`).</span></div><div class='line' id='LC7096'><span class="cm">     */</span></div><div class='line' id='LC7097'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></div><div class='line' id='LC7098'><br/></div><div class='line' id='LC7099'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//browser specific quirks</span></div><div class='line' id='LC7100'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">===</span> <span class="s2">&quot;moz&quot;</span><span class="p">)</span> <span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s2">&quot;Moz&quot;</span><span class="p">;</span></div><div class='line' id='LC7101'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">===</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span> <span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s2">&quot;O&quot;</span><span class="p">;</span></div><div class='line' id='LC7102'><br/></div><div class='line' id='LC7103'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC7104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7105'><span class="cm">         * #Crafty.support.versionName</span></div><div class='line' id='LC7106'><span class="cm">         * @comp Crafty.support</span></div><div class='line' id='LC7107'><span class="cm">         * Version of the browser</span></div><div class='line' id='LC7108'><span class="cm">         */</span></div><div class='line' id='LC7109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">versionName</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC7110'><br/></div><div class='line' id='LC7111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7112'><span class="cm">         * #Crafty.support.version</span></div><div class='line' id='LC7113'><span class="cm">         * @comp Crafty.support</span></div><div class='line' id='LC7114'><span class="cm">         * Version number of the browser as an Integer (first number)</span></div><div class='line' id='LC7115'><span class="cm">         */</span></div><div class='line' id='LC7116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC7117'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7118'><br/></div><div class='line' id='LC7119'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7120'><span class="cm">     * #Crafty.support.canvas</span></div><div class='line' id='LC7121'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7122'><span class="cm">     * Is the `canvas` element supported?</span></div><div class='line' id='LC7123'><span class="cm">     */</span></div><div class='line' id='LC7124'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;getContext&#39;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">));</span></div><div class='line' id='LC7125'><br/></div><div class='line' id='LC7126'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7127'><span class="cm">     * #Crafty.support.webgl</span></div><div class='line' id='LC7128'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7129'><span class="cm">     * Is WebGL supported on the canvas element?</span></div><div class='line' id='LC7130'><span class="cm">     */</span></div><div class='line' id='LC7131'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span><span class="p">;</span></div><div class='line' id='LC7133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">try</span> <span class="p">{</span></div><div class='line' id='LC7134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;experimental-webgl&quot;</span><span class="p">);</span></div><div class='line' id='LC7135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">viewportWidth</span> <span class="o">=</span> <span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC7136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">viewportHeight</span> <span class="o">=</span> <span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC7137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span></div><div class='line' id='LC7138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">gl</span><span class="p">;</span></div><div class='line' id='LC7139'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC7140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC7141'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7142'><br/></div><div class='line' id='LC7143'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7144'><span class="cm">     * #Crafty.support.css3dtransform</span></div><div class='line' id='LC7145'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7146'><span class="cm">     * Is css3Dtransform supported by browser.</span></div><div class='line' id='LC7147'><span class="cm">     */</span></div><div class='line' id='LC7148'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">css3dtransform</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">Perspective</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">[</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;Perspective&quot;</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">);</span></div><div class='line' id='LC7149'><br/></div><div class='line' id='LC7150'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7151'><span class="cm">     * #Crafty.support.deviceorientation</span></div><div class='line' id='LC7152'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7153'><span class="cm">     * Is deviceorientation event supported by browser.</span></div><div class='line' id='LC7154'><span class="cm">     */</span></div><div class='line' id='LC7155'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">deviceorientation</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DeviceOrientationEvent</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">OrientationEvent</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">);</span></div><div class='line' id='LC7156'><br/></div><div class='line' id='LC7157'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7158'><span class="cm">     * #Crafty.support.devicemotion</span></div><div class='line' id='LC7159'><span class="cm">     * @comp Crafty.support</span></div><div class='line' id='LC7160'><span class="cm">     * Is devicemotion event supported by browser.</span></div><div class='line' id='LC7161'><span class="cm">     */</span></div><div class='line' id='LC7162'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">support</span><span class="p">.</span><span class="nx">devicemotion</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DeviceMotionEvent</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">);</span></div><div class='line' id='LC7163'><br/></div><div class='line' id='LC7164'><span class="p">})();</span></div><div class='line' id='LC7165'><br/></div><div class='line' id='LC7166'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC7167'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_events</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC7168'><br/></div><div class='line' id='LC7169'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7170'><span class="cm">     * #Crafty.addEvent</span></div><div class='line' id='LC7171'><span class="cm">     * @category Events, Misc</span></div><div class='line' id='LC7172'><span class="cm">     * @sign public this Crafty.addEvent(Object ctx, HTMLElement obj, String event, Function callback)</span></div><div class='line' id='LC7173'><span class="cm">     * @param ctx - Context of the callback or the value of `this`</span></div><div class='line' id='LC7174'><span class="cm">     * @param obj - Element to add the DOM event to</span></div><div class='line' id='LC7175'><span class="cm">     * @param event - Event name to bind to</span></div><div class='line' id='LC7176'><span class="cm">     * @param callback - Method to execute when triggered</span></div><div class='line' id='LC7177'><span class="cm">     *</span></div><div class='line' id='LC7178'><span class="cm">     * Adds DOM level 3 events to elements. The arguments it accepts are the call</span></div><div class='line' id='LC7179'><span class="cm">     * context (the value of `this`), the DOM element to attach the event to,</span></div><div class='line' id='LC7180'><span class="cm">     * the event name (without `on` (`click` rather than `onclick`)) and</span></div><div class='line' id='LC7181'><span class="cm">     * finally the callback method.</span></div><div class='line' id='LC7182'><span class="cm">     *</span></div><div class='line' id='LC7183'><span class="cm">     * If no element is passed, the default element will be `window.document`.</span></div><div class='line' id='LC7184'><span class="cm">     *</span></div><div class='line' id='LC7185'><span class="cm">     * Callbacks are passed with event data.</span></div><div class='line' id='LC7186'><span class="cm">     *</span></div><div class='line' id='LC7187'><span class="cm">     * @example</span></div><div class='line' id='LC7188'><span class="cm">     * Will add a stage-wide MouseDown event listener to the player. Will log which button was pressed</span></div><div class='line' id='LC7189'><span class="cm">     * &amp; the (x,y) coordinates in viewport/world/game space.</span></div><div class='line' id='LC7190'><span class="cm">     * ~~~</span></div><div class='line' id='LC7191'><span class="cm">     * var player = Crafty.e(&quot;2D&quot;);</span></div><div class='line' id='LC7192'><span class="cm">     *     player.onMouseDown = function(e) {</span></div><div class='line' id='LC7193'><span class="cm">     *         console.log(e.mouseButton, e.realX, e.realY);</span></div><div class='line' id='LC7194'><span class="cm">     *     };</span></div><div class='line' id='LC7195'><span class="cm">     * Crafty.addEvent(player, Crafty.stage.elem, &quot;mousedown&quot;, player.onMouseDown);</span></div><div class='line' id='LC7196'><span class="cm">     * ~~~</span></div><div class='line' id='LC7197'><span class="cm">     * @see Crafty.removeEvent</span></div><div class='line' id='LC7198'><span class="cm">     */</span></div><div class='line' id='LC7199'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span></div><div class='line' id='LC7202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC7203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7205'><br/></div><div class='line' id='LC7206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//save anonymous function to be able to remove</span></div><div class='line' id='LC7207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">afn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span></div><div class='line' id='LC7209'><br/></div><div class='line' id='LC7210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC7212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC7215'><br/></div><div class='line' id='LC7216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">id</span> <span class="o">+</span> <span class="nx">obj</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">callback</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">id</span> <span class="o">+</span> <span class="nx">obj</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">callback</span><span class="p">]</span> <span class="o">=</span> <span class="nx">afn</span><span class="p">;</span></div><div class='line' id='LC7217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC7218'><br/></div><div class='line' id='LC7219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//IE</span></div><div class='line' id='LC7220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">afn</span><span class="p">);</span></div><div class='line' id='LC7221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//Everyone else</span></div><div class='line' id='LC7222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">afn</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC7223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7224'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7225'><br/></div><div class='line' id='LC7226'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7227'><span class="cm">     * #Crafty.removeEvent</span></div><div class='line' id='LC7228'><span class="cm">     * @category Events, Misc</span></div><div class='line' id='LC7229'><span class="cm">     * @sign public this Crafty.removeEvent(Object ctx, HTMLElement obj, String event, Function callback)</span></div><div class='line' id='LC7230'><span class="cm">     * @param ctx - Context of the callback or the value of `this`</span></div><div class='line' id='LC7231'><span class="cm">     * @param obj - Element the event is on</span></div><div class='line' id='LC7232'><span class="cm">     * @param event - Name of the event</span></div><div class='line' id='LC7233'><span class="cm">     * @param callback - Method executed when triggered</span></div><div class='line' id='LC7234'><span class="cm">     *</span></div><div class='line' id='LC7235'><span class="cm">     * Removes events attached by `Crafty.addEvent()`. All parameters must</span></div><div class='line' id='LC7236'><span class="cm">     * be the same that were used to attach the event including a reference</span></div><div class='line' id='LC7237'><span class="cm">     * to the callback method.</span></div><div class='line' id='LC7238'><span class="cm">     *</span></div><div class='line' id='LC7239'><span class="cm">     * @see Crafty.addEvent</span></div><div class='line' id='LC7240'><span class="cm">     */</span></div><div class='line' id='LC7241'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">removeEvent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">callback</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span></div><div class='line' id='LC7244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC7245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7247'><br/></div><div class='line' id='LC7248'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//retrieve anonymous function</span></div><div class='line' id='LC7249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div><div class='line' id='LC7250'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">afn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">id</span> <span class="o">+</span> <span class="nx">obj</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">callback</span><span class="p">];</span></div><div class='line' id='LC7251'><br/></div><div class='line' id='LC7252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">afn</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">afn</span><span class="p">);</span></div><div class='line' id='LC7255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">afn</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC7256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">id</span> <span class="o">+</span> <span class="nx">obj</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="nx">callback</span><span class="p">];</span></div><div class='line' id='LC7257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7258'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7259'><br/></div><div class='line' id='LC7260'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7261'><span class="cm">     * #Crafty.background</span></div><div class='line' id='LC7262'><span class="cm">     * @category Graphics, Stage</span></div><div class='line' id='LC7263'><span class="cm">     * @sign public void Crafty.background(String value)</span></div><div class='line' id='LC7264'><span class="cm">     * @param style - Modify the background with a color or image</span></div><div class='line' id='LC7265'><span class="cm">     *</span></div><div class='line' id='LC7266'><span class="cm">     * This method is a shortcut for adding a background</span></div><div class='line' id='LC7267'><span class="cm">     * style to the stage element, i.e.</span></div><div class='line' id='LC7268'><span class="cm">     * `Crafty.stage.elem.style.background = ...`</span></div><div class='line' id='LC7269'><span class="cm">     * </span></div><div class='line' id='LC7270'><span class="cm">     * For example, if you want the background to be white,</span></div><div class='line' id='LC7271'><span class="cm">     * with an image in the center, you might use:</span></div><div class='line' id='LC7272'><span class="cm">     * ~~~</span></div><div class='line' id='LC7273'><span class="cm">     * Crafty.background(&#39;#FFFFFF url(landscape.png) no-repeat center center&#39;);</span></div><div class='line' id='LC7274'><span class="cm">     * ~~~</span></div><div class='line' id='LC7275'><span class="cm">     *  </span></div><div class='line' id='LC7276'><span class="cm">     */</span></div><div class='line' id='LC7277'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">background</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="nx">style</span><span class="p">;</span></div><div class='line' id='LC7279'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7280'><span class="p">});</span></div><div class='line' id='LC7281'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">14</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7282'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7283'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7284'><br/></div><div class='line' id='LC7285'><span class="cm">/**@</span></div><div class='line' id='LC7286'><span class="cm"> * #HTML</span></div><div class='line' id='LC7287'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC7288'><span class="cm"> * Component allow for insertion of arbitrary HTML into an entity</span></div><div class='line' id='LC7289'><span class="cm"> */</span></div><div class='line' id='LC7290'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;HTML&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC7291'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">inner</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC7292'><br/></div><div class='line' id='LC7293'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s1">&#39;2D, DOM&#39;</span><span class="p">);</span></div><div class='line' id='LC7295'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7296'><br/></div><div class='line' id='LC7297'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7298'><span class="cm">     * #.replace</span></div><div class='line' id='LC7299'><span class="cm">     * @comp HTML</span></div><div class='line' id='LC7300'><span class="cm">     * @sign public this .replace(String html)</span></div><div class='line' id='LC7301'><span class="cm">     * @param html - arbitrary html</span></div><div class='line' id='LC7302'><span class="cm">     *</span></div><div class='line' id='LC7303'><span class="cm">     * This method will replace the content of this entity with the supplied html</span></div><div class='line' id='LC7304'><span class="cm">     *</span></div><div class='line' id='LC7305'><span class="cm">     * @example</span></div><div class='line' id='LC7306'><span class="cm">     * Create a link</span></div><div class='line' id='LC7307'><span class="cm">     * ~~~</span></div><div class='line' id='LC7308'><span class="cm">     * Crafty.e(&quot;HTML&quot;)</span></div><div class='line' id='LC7309'><span class="cm">     *    .attr({x:20, y:20, w:100, h:100})</span></div><div class='line' id='LC7310'><span class="cm">     *    .replace(&quot;&lt;a href=&#39;index.html&#39;&gt;Index&lt;/a&gt;&quot;);</span></div><div class='line' id='LC7311'><span class="cm">     * ~~~</span></div><div class='line' id='LC7312'><span class="cm">     */</span></div><div class='line' id='LC7313'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">replace</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">new_html</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">inner</span> <span class="o">=</span> <span class="nx">new_html</span><span class="p">;</span></div><div class='line' id='LC7315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">new_html</span><span class="p">;</span></div><div class='line' id='LC7316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7317'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7318'><br/></div><div class='line' id='LC7319'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7320'><span class="cm">     * #.append</span></div><div class='line' id='LC7321'><span class="cm">     * @comp HTML</span></div><div class='line' id='LC7322'><span class="cm">     * @sign public this .append(String html)</span></div><div class='line' id='LC7323'><span class="cm">     * @param html - arbitrary html</span></div><div class='line' id='LC7324'><span class="cm">     *</span></div><div class='line' id='LC7325'><span class="cm">     * This method will add the supplied html in the end of the entity</span></div><div class='line' id='LC7326'><span class="cm">     *</span></div><div class='line' id='LC7327'><span class="cm">     * @example</span></div><div class='line' id='LC7328'><span class="cm">     * Create a link</span></div><div class='line' id='LC7329'><span class="cm">     * ~~~</span></div><div class='line' id='LC7330'><span class="cm">     * Crafty.e(&quot;HTML&quot;)</span></div><div class='line' id='LC7331'><span class="cm">     *    .attr({x:20, y:20, w:100, h:100})</span></div><div class='line' id='LC7332'><span class="cm">     *    .append(&quot;&lt;a href=&#39;index.html&#39;&gt;Index&lt;/a&gt;&quot;);</span></div><div class='line' id='LC7333'><span class="cm">     * ~~~</span></div><div class='line' id='LC7334'><span class="cm">     */</span></div><div class='line' id='LC7335'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">append</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">new_html</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">inner</span> <span class="o">+=</span> <span class="nx">new_html</span><span class="p">;</span></div><div class='line' id='LC7337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">new_html</span><span class="p">;</span></div><div class='line' id='LC7338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7339'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7340'><br/></div><div class='line' id='LC7341'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7342'><span class="cm">     * #.prepend</span></div><div class='line' id='LC7343'><span class="cm">     * @comp HTML</span></div><div class='line' id='LC7344'><span class="cm">     * @sign public this .prepend(String html)</span></div><div class='line' id='LC7345'><span class="cm">     * @param html - arbitrary html</span></div><div class='line' id='LC7346'><span class="cm">     *</span></div><div class='line' id='LC7347'><span class="cm">     * This method will add the supplied html in the beginning of the entity</span></div><div class='line' id='LC7348'><span class="cm">     *</span></div><div class='line' id='LC7349'><span class="cm">     * @example</span></div><div class='line' id='LC7350'><span class="cm">     * Create a link</span></div><div class='line' id='LC7351'><span class="cm">     * ~~~</span></div><div class='line' id='LC7352'><span class="cm">     * Crafty.e(&quot;HTML&quot;)</span></div><div class='line' id='LC7353'><span class="cm">     *    .attr({x:20, y:20, w:100, h:100})</span></div><div class='line' id='LC7354'><span class="cm">     *    .prepend(&quot;&lt;a href=&#39;index.html&#39;&gt;Index&lt;/a&gt;&quot;);</span></div><div class='line' id='LC7355'><span class="cm">     * ~~~</span></div><div class='line' id='LC7356'><span class="cm">     */</span></div><div class='line' id='LC7357'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prepend</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">new_html</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7358'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">inner</span> <span class="o">=</span> <span class="nx">new_html</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">inner</span><span class="p">;</span></div><div class='line' id='LC7359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">new_html</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">inner</span><span class="p">;</span></div><div class='line' id='LC7360'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7361'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7362'><span class="p">});</span></div><div class='line' id='LC7363'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">15</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7364'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7365'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7366'><br/></div><div class='line' id='LC7367'><span class="cm">/**@</span></div><div class='line' id='LC7368'><span class="cm"> * #Crafty.import</span></div><div class='line' id='LC7369'><span class="cm"> * @sign public void Crafty.import(String url[, String scene])</span></div><div class='line' id='LC7370'><span class="cm"> * @param url - Path to the saved file</span></div><div class='line' id='LC7371'><span class="cm"> * @param scene - Name of the scene to load if saved multiple scenes</span></div><div class='line' id='LC7372'><span class="cm"> * @sign public void Crafty.import(Object sceneData)</span></div><div class='line' id='LC7373'><span class="cm"> * @param sceneData - Scene data generated from builder</span></div><div class='line' id='LC7374'><span class="cm"> * This method will load in scene data generated by the Crafty Builder.</span></div><div class='line' id='LC7375'><span class="cm"> *</span></div><div class='line' id='LC7376'><span class="cm"> * @example</span></div><div class='line' id='LC7377'><span class="cm"> * ~~~</span></div><div class='line' id='LC7378'><span class="cm"> * Crafty.import({</span></div><div class='line' id='LC7379'><span class="cm"> *	&#39;0&#39;: {props: value},</span></div><div class='line' id='LC7380'><span class="cm"> *	&#39;n&#39;: [</span></div><div class='line' id='LC7381'><span class="cm"> *		{c: &quot;comp, list&quot;, image: &#39;&#39;}</span></div><div class='line' id='LC7382'><span class="cm"> *	]</span></div><div class='line' id='LC7383'><span class="cm"> * });</span></div><div class='line' id='LC7384'><span class="cm"> * ~~~</span></div><div class='line' id='LC7385'><span class="cm"> */</span></div><div class='line' id='LC7386'><span class="nx">Crafty</span><span class="p">[</span><span class="s1">&#39;import&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">scene</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7387'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if its a string, load the script file</span></div><div class='line' id='LC7388'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">levelData</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7390'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scene</span><span class="p">)</span> <span class="nx">Crafty</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">levelData</span><span class="p">[</span><span class="nx">scene</span><span class="p">]);</span></div><div class='line' id='LC7391'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">Crafty</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">levelData</span><span class="p">);</span></div><div class='line' id='LC7392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC7393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">elem</span><span class="p">;</span></div><div class='line' id='LC7394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span></div><div class='line' id='LC7395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scene</span><span class="p">)</span> <span class="nx">Crafty</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">levelData</span><span class="p">[</span><span class="nx">scene</span><span class="p">]);</span></div><div class='line' id='LC7397'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">Crafty</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">levelData</span><span class="p">);</span></div><div class='line' id='LC7398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC7399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC7400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC7402'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7403'><br/></div><div class='line' id='LC7404'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7405'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span><span class="p">,</span> <span class="nx">current</span><span class="p">,</span> <span class="nx">ent</span><span class="p">;</span></div><div class='line' id='LC7406'><br/></div><div class='line' id='LC7407'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over new entities to create</span></div><div class='line' id='LC7408'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">n</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">n</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7410'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">n</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC7411'><br/></div><div class='line' id='LC7412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create entity with components</span></div><div class='line' id='LC7413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC7414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">current</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span> <span class="c1">//remove the components</span></div><div class='line' id='LC7415'><br/></div><div class='line' id='LC7416'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//apply the other properties</span></div><div class='line' id='LC7417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span></div><div class='line' id='LC7418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7419'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7420'><br/></div><div class='line' id='LC7421'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//loop over modified entities</span></div><div class='line' id='LC7422'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7423'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></div><div class='line' id='LC7424'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ent</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span></div><div class='line' id='LC7425'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7426'><span class="p">};</span></div><div class='line' id='LC7427'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">16</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7428'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7429'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7430'><br/></div><div class='line' id='LC7431'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC7432'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7433'><span class="cm">     * #Crafty.isometric</span></div><div class='line' id='LC7434'><span class="cm">     * @category 2D</span></div><div class='line' id='LC7435'><span class="cm">     * Place entities in a 45deg isometric fashion.</span></div><div class='line' id='LC7436'><span class="cm">     */</span></div><div class='line' id='LC7437'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">isometric</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_tile</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7440'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC7441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_elements</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC7443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_pos</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC7446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_z</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7449'><span class="cm">         * #Crafty.isometric.size</span></div><div class='line' id='LC7450'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7451'><span class="cm">         * @sign public this Crafty.isometric.size(Number tileSize)</span></div><div class='line' id='LC7452'><span class="cm">         * @param tileSize - The size of the tiles to place.</span></div><div class='line' id='LC7453'><span class="cm">         *</span></div><div class='line' id='LC7454'><span class="cm">         * Method used to initialize the size of the isometric placement.</span></div><div class='line' id='LC7455'><span class="cm">         * Recommended to use a size values in the power of `2` (128, 64 or 32).</span></div><div class='line' id='LC7456'><span class="cm">         * This makes it easy to calculate positions and implement zooming.</span></div><div class='line' id='LC7457'><span class="cm">         *</span></div><div class='line' id='LC7458'><span class="cm">         * @example</span></div><div class='line' id='LC7459'><span class="cm">         * ~~~</span></div><div class='line' id='LC7460'><span class="cm">         * var iso = Crafty.isometric.size(128);</span></div><div class='line' id='LC7461'><span class="cm">         * ~~~</span></div><div class='line' id='LC7462'><span class="cm">         *</span></div><div class='line' id='LC7463'><span class="cm">         * @see Crafty.isometric.place</span></div><div class='line' id='LC7464'><span class="cm">         */</span></div><div class='line' id='LC7465'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">size</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7466'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC7467'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">height</span> <span class="o">:</span> <span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//Setup width/2 if height isn&#39;t set</span></div><div class='line' id='LC7468'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7469'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7470'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7471'><span class="cm">         * #Crafty.isometric.place</span></div><div class='line' id='LC7472'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7473'><span class="cm">         * @sign public this Crafty.isometric.place(Number x, Number y, Number z, Entity tile)</span></div><div class='line' id='LC7474'><span class="cm">         * @param x - The `x` position to place the tile</span></div><div class='line' id='LC7475'><span class="cm">         * @param y - The `y` position to place the tile</span></div><div class='line' id='LC7476'><span class="cm">         * @param z - The `z` position or height to place the tile</span></div><div class='line' id='LC7477'><span class="cm">         * @param tile - The entity that should be position in the isometric fashion</span></div><div class='line' id='LC7478'><span class="cm">         *</span></div><div class='line' id='LC7479'><span class="cm">         * Use this method to place an entity in an isometric grid.</span></div><div class='line' id='LC7480'><span class="cm">         *</span></div><div class='line' id='LC7481'><span class="cm">         * @example</span></div><div class='line' id='LC7482'><span class="cm">         * ~~~</span></div><div class='line' id='LC7483'><span class="cm">         * var iso = Crafty.isometric.size(128);</span></div><div class='line' id='LC7484'><span class="cm">         * iso.place(2, 1, 0, Crafty.e(&#39;2D, DOM, Color&#39;).color(&#39;red&#39;).attr({w:128, h:128}));</span></div><div class='line' id='LC7485'><span class="cm">         * ~~~</span></div><div class='line' id='LC7486'><span class="cm">         *</span></div><div class='line' id='LC7487'><span class="cm">         * @see Crafty.isometric.size</span></div><div class='line' id='LC7488'><span class="cm">         */</span></div><div class='line' id='LC7489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">place</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos2px</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC7491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="nx">z</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></div><div class='line' id='LC7492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span></div><div class='line' id='LC7493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC7494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span></div><div class='line' id='LC7495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}).</span><span class="nx">z</span> <span class="o">+=</span> <span class="nx">z</span><span class="p">;</span></div><div class='line' id='LC7496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7499'><span class="cm">         * #Crafty.isometric.pos2px</span></div><div class='line' id='LC7500'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7501'><span class="cm">         * @sign public this Crafty.isometric.pos2px(Number x,Number y)</span></div><div class='line' id='LC7502'><span class="cm">         * @param x</span></div><div class='line' id='LC7503'><span class="cm">         * @param y</span></div><div class='line' id='LC7504'><span class="cm">         * @return Object {left Number,top Number}</span></div><div class='line' id='LC7505'><span class="cm">         *</span></div><div class='line' id='LC7506'><span class="cm">         * This method calculate the X and Y Coordinates to Pixel Positions</span></div><div class='line' id='LC7507'><span class="cm">         *</span></div><div class='line' id='LC7508'><span class="cm">         * @example</span></div><div class='line' id='LC7509'><span class="cm">         * ~~~</span></div><div class='line' id='LC7510'><span class="cm">         * var iso = Crafty.isometric.size(128,96);</span></div><div class='line' id='LC7511'><span class="cm">         * var position = iso.pos2px(100,100); //Object { left=12800, top=4800}</span></div><div class='line' id='LC7512'><span class="cm">         * ~~~</span></div><div class='line' id='LC7513'><span class="cm">         */</span></div><div class='line' id='LC7514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos2px</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC7516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">left</span><span class="o">:</span> <span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span></div><div class='line' id='LC7517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">top</span><span class="o">:</span> <span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span></div><div class='line' id='LC7518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC7519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7521'><span class="cm">         * #Crafty.isometric.px2pos</span></div><div class='line' id='LC7522'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7523'><span class="cm">         * @sign public this Crafty.isometric.px2pos(Number left,Number top)</span></div><div class='line' id='LC7524'><span class="cm">         * @param top</span></div><div class='line' id='LC7525'><span class="cm">         * @param left</span></div><div class='line' id='LC7526'><span class="cm">         * @return Object {x Number,y Number}</span></div><div class='line' id='LC7527'><span class="cm">         *</span></div><div class='line' id='LC7528'><span class="cm">         * This method calculate pixel top,left positions to x,y coordinates</span></div><div class='line' id='LC7529'><span class="cm">         *</span></div><div class='line' id='LC7530'><span class="cm">         * @example</span></div><div class='line' id='LC7531'><span class="cm">         * ~~~</span></div><div class='line' id='LC7532'><span class="cm">         * var iso = Crafty.isometric.size(128,96);</span></div><div class='line' id='LC7533'><span class="cm">         * var px = iso.pos2px(12800,4800);</span></div><div class='line' id='LC7534'><span class="cm">         * console.log(px); //Object { x=100, y=100}</span></div><div class='line' id='LC7535'><span class="cm">         * ~~~</span></div><div class='line' id='LC7536'><span class="cm">         */</span></div><div class='line' id='LC7537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">px2pos</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">left</span><span class="p">,</span> <span class="nx">top</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC7539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="o">-</span><span class="nx">left</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="p">(</span><span class="nx">top</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span></div><div class='line' id='LC7540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">top</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="mi">2</span></div><div class='line' id='LC7541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC7542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7544'><span class="cm">         * #Crafty.isometric.centerAt</span></div><div class='line' id='LC7545'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7546'><span class="cm">         * @sign public this Crafty.isometric.centerAt(Number x,Number y)</span></div><div class='line' id='LC7547'><span class="cm">         * @param top</span></div><div class='line' id='LC7548'><span class="cm">         * @param left</span></div><div class='line' id='LC7549'><span class="cm">         *</span></div><div class='line' id='LC7550'><span class="cm">         * This method center the Viewport at x/y location or gives the current centerpoint of the viewport</span></div><div class='line' id='LC7551'><span class="cm">         *</span></div><div class='line' id='LC7552'><span class="cm">         * @example</span></div><div class='line' id='LC7553'><span class="cm">         * ~~~</span></div><div class='line' id='LC7554'><span class="cm">         * var iso = Crafty.isometric.size(128,96).centerAt(10,10); //Viewport is now moved</span></div><div class='line' id='LC7555'><span class="cm">         * //After moving the viewport by another event you can get the new center point</span></div><div class='line' id='LC7556'><span class="cm">         * console.log(iso.centerAt());</span></div><div class='line' id='LC7557'><span class="cm">         * ~~~</span></div><div class='line' id='LC7558'><span class="cm">         */</span></div><div class='line' id='LC7559'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">centerAt</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7560'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">y</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7561'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos2px</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC7562'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC7563'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC7564'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC7565'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC7566'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC7567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">top</span><span class="o">:</span> <span class="o">-</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC7568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">_tile</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span></div><div class='line' id='LC7569'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC7570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7573'><span class="cm">         * #Crafty.isometric.area</span></div><div class='line' id='LC7574'><span class="cm">         * @comp Crafty.isometric</span></div><div class='line' id='LC7575'><span class="cm">         * @sign public this Crafty.isometric.area()</span></div><div class='line' id='LC7576'><span class="cm">         * @return Object {x:{start Number,end Number},y:{start Number,end Number}}</span></div><div class='line' id='LC7577'><span class="cm">         *</span></div><div class='line' id='LC7578'><span class="cm">         * This method get the Area surrounding by the centerpoint depends on viewport height and width</span></div><div class='line' id='LC7579'><span class="cm">         *</span></div><div class='line' id='LC7580'><span class="cm">         * @example</span></div><div class='line' id='LC7581'><span class="cm">         * ~~~</span></div><div class='line' id='LC7582'><span class="cm">         * var iso = Crafty.isometric.size(128,96).centerAt(10,10); //Viewport is now moved</span></div><div class='line' id='LC7583'><span class="cm">         * var area = iso.area(); //get the area</span></div><div class='line' id='LC7584'><span class="cm">         * for(var y = area.y.start;y &lt;= area.y.end;y++){</span></div><div class='line' id='LC7585'><span class="cm">         *   for(var x = area.x.start ;x &lt;= area.x.end;x++){</span></div><div class='line' id='LC7586'><span class="cm">         *       iso.place(x,y,0,Crafty.e(&quot;2D,DOM,gras&quot;)); //Display tiles in the Screen</span></div><div class='line' id='LC7587'><span class="cm">         *   }</span></div><div class='line' id='LC7588'><span class="cm">         * }</span></div><div class='line' id='LC7589'><span class="cm">         * ~~~</span></div><div class='line' id='LC7590'><span class="cm">         */</span></div><div class='line' id='LC7591'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">area</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7592'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Get the center Point in the viewport</span></div><div class='line' id='LC7593'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">center</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">centerAt</span><span class="p">();</span></div><div class='line' id='LC7594'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">px2pos</span><span class="p">(</span><span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></div><div class='line' id='LC7595'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">px2pos</span><span class="p">(</span><span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="nx">center</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></div><div class='line' id='LC7596'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC7597'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">start</span><span class="o">:</span> <span class="nx">start</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC7599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">end</span><span class="o">:</span> <span class="nx">end</span><span class="p">.</span><span class="nx">x</span></div><div class='line' id='LC7600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7601'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">start</span><span class="o">:</span> <span class="nx">start</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC7603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">end</span><span class="o">:</span> <span class="nx">end</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC7604'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7605'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC7606'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7607'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7608'><span class="p">});</span></div><div class='line' id='LC7609'><br/></div><div class='line' id='LC7610'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">17</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7611'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7612'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7613'><br/></div><div class='line' id='LC7614'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC7615'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7616'><span class="cm">     * #Crafty.keys</span></div><div class='line' id='LC7617'><span class="cm">     * @category Input</span></div><div class='line' id='LC7618'><span class="cm">     * Object of key names and the corresponding key code.</span></div><div class='line' id='LC7619'><span class="cm">     *</span></div><div class='line' id='LC7620'><span class="cm">     * ~~~</span></div><div class='line' id='LC7621'><span class="cm">     * BACKSPACE: 8,</span></div><div class='line' id='LC7622'><span class="cm">     * TAB: 9,</span></div><div class='line' id='LC7623'><span class="cm">     * ENTER: 13,</span></div><div class='line' id='LC7624'><span class="cm">     * PAUSE: 19,</span></div><div class='line' id='LC7625'><span class="cm">     * CAPS: 20,</span></div><div class='line' id='LC7626'><span class="cm">     * ESC: 27,</span></div><div class='line' id='LC7627'><span class="cm">     * SPACE: 32,</span></div><div class='line' id='LC7628'><span class="cm">     * PAGE_UP: 33,</span></div><div class='line' id='LC7629'><span class="cm">     * PAGE_DOWN: 34,</span></div><div class='line' id='LC7630'><span class="cm">     * END: 35,</span></div><div class='line' id='LC7631'><span class="cm">     * HOME: 36,</span></div><div class='line' id='LC7632'><span class="cm">     * LEFT_ARROW: 37,</span></div><div class='line' id='LC7633'><span class="cm">     * UP_ARROW: 38,</span></div><div class='line' id='LC7634'><span class="cm">     * RIGHT_ARROW: 39,</span></div><div class='line' id='LC7635'><span class="cm">     * DOWN_ARROW: 40,</span></div><div class='line' id='LC7636'><span class="cm">     * INSERT: 45,</span></div><div class='line' id='LC7637'><span class="cm">     * DELETE: 46,</span></div><div class='line' id='LC7638'><span class="cm">     * 0: 48,</span></div><div class='line' id='LC7639'><span class="cm">     * 1: 49,</span></div><div class='line' id='LC7640'><span class="cm">     * 2: 50,</span></div><div class='line' id='LC7641'><span class="cm">     * 3: 51,</span></div><div class='line' id='LC7642'><span class="cm">     * 4: 52,</span></div><div class='line' id='LC7643'><span class="cm">     * 5: 53,</span></div><div class='line' id='LC7644'><span class="cm">     * 6: 54,</span></div><div class='line' id='LC7645'><span class="cm">     * 7: 55,</span></div><div class='line' id='LC7646'><span class="cm">     * 8: 56,</span></div><div class='line' id='LC7647'><span class="cm">     * 9: 57,</span></div><div class='line' id='LC7648'><span class="cm">     * A: 65,</span></div><div class='line' id='LC7649'><span class="cm">     * B: 66,</span></div><div class='line' id='LC7650'><span class="cm">     * C: 67,</span></div><div class='line' id='LC7651'><span class="cm">     * D: 68,</span></div><div class='line' id='LC7652'><span class="cm">     * E: 69,</span></div><div class='line' id='LC7653'><span class="cm">     * F: 70,</span></div><div class='line' id='LC7654'><span class="cm">     * G: 71,</span></div><div class='line' id='LC7655'><span class="cm">     * H: 72,</span></div><div class='line' id='LC7656'><span class="cm">     * I: 73,</span></div><div class='line' id='LC7657'><span class="cm">     * J: 74,</span></div><div class='line' id='LC7658'><span class="cm">     * K: 75,</span></div><div class='line' id='LC7659'><span class="cm">     * L: 76,</span></div><div class='line' id='LC7660'><span class="cm">     * M: 77,</span></div><div class='line' id='LC7661'><span class="cm">     * N: 78,</span></div><div class='line' id='LC7662'><span class="cm">     * O: 79,</span></div><div class='line' id='LC7663'><span class="cm">     * P: 80,</span></div><div class='line' id='LC7664'><span class="cm">     * Q: 81,</span></div><div class='line' id='LC7665'><span class="cm">     * R: 82,</span></div><div class='line' id='LC7666'><span class="cm">     * S: 83,</span></div><div class='line' id='LC7667'><span class="cm">     * T: 84,</span></div><div class='line' id='LC7668'><span class="cm">     * U: 85,</span></div><div class='line' id='LC7669'><span class="cm">     * V: 86,</span></div><div class='line' id='LC7670'><span class="cm">     * W: 87,</span></div><div class='line' id='LC7671'><span class="cm">     * X: 88,</span></div><div class='line' id='LC7672'><span class="cm">     * Y: 89,</span></div><div class='line' id='LC7673'><span class="cm">     * Z: 90,</span></div><div class='line' id='LC7674'><span class="cm">     * NUMPAD_0: 96,</span></div><div class='line' id='LC7675'><span class="cm">     * NUMPAD_1: 97,</span></div><div class='line' id='LC7676'><span class="cm">     * NUMPAD_2: 98,</span></div><div class='line' id='LC7677'><span class="cm">     * NUMPAD_3: 99,</span></div><div class='line' id='LC7678'><span class="cm">     * NUMPAD_4: 100,</span></div><div class='line' id='LC7679'><span class="cm">     * NUMPAD_5: 101,</span></div><div class='line' id='LC7680'><span class="cm">     * NUMPAD_6: 102,</span></div><div class='line' id='LC7681'><span class="cm">     * NUMPAD_7: 103,</span></div><div class='line' id='LC7682'><span class="cm">     * NUMPAD_8: 104,</span></div><div class='line' id='LC7683'><span class="cm">     * NUMPAD_9: 105,</span></div><div class='line' id='LC7684'><span class="cm">     * MULTIPLY: 106,</span></div><div class='line' id='LC7685'><span class="cm">     * ADD: 107,</span></div><div class='line' id='LC7686'><span class="cm">     * SUBSTRACT: 109,</span></div><div class='line' id='LC7687'><span class="cm">     * DECIMAL: 110,</span></div><div class='line' id='LC7688'><span class="cm">     * DIVIDE: 111,</span></div><div class='line' id='LC7689'><span class="cm">     * F1: 112,</span></div><div class='line' id='LC7690'><span class="cm">     * F2: 113,</span></div><div class='line' id='LC7691'><span class="cm">     * F3: 114,</span></div><div class='line' id='LC7692'><span class="cm">     * F4: 115,</span></div><div class='line' id='LC7693'><span class="cm">     * F5: 116,</span></div><div class='line' id='LC7694'><span class="cm">     * F6: 117,</span></div><div class='line' id='LC7695'><span class="cm">     * F7: 118,</span></div><div class='line' id='LC7696'><span class="cm">     * F8: 119,</span></div><div class='line' id='LC7697'><span class="cm">     * F9: 120,</span></div><div class='line' id='LC7698'><span class="cm">     * F10: 121,</span></div><div class='line' id='LC7699'><span class="cm">     * F11: 122,</span></div><div class='line' id='LC7700'><span class="cm">     * F12: 123,</span></div><div class='line' id='LC7701'><span class="cm">     * SHIFT: 16,</span></div><div class='line' id='LC7702'><span class="cm">     * CTRL: 17,</span></div><div class='line' id='LC7703'><span class="cm">     * ALT: 18,</span></div><div class='line' id='LC7704'><span class="cm">     * PLUS: 187,</span></div><div class='line' id='LC7705'><span class="cm">     * COMMA: 188,</span></div><div class='line' id='LC7706'><span class="cm">     * MINUS: 189,</span></div><div class='line' id='LC7707'><span class="cm">     * PERIOD: 190,</span></div><div class='line' id='LC7708'><span class="cm">     * PULT_UP: 29460,</span></div><div class='line' id='LC7709'><span class="cm">     * PULT_DOWN: 29461,</span></div><div class='line' id='LC7710'><span class="cm">     * PULT_LEFT: 4,</span></div><div class='line' id='LC7711'><span class="cm">     * PULT_RIGHT&#39;: 5</span></div><div class='line' id='LC7712'><span class="cm">     * ~~~</span></div><div class='line' id='LC7713'><span class="cm">     */</span></div><div class='line' id='LC7714'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">keys</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7715'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;BACKSPACE&#39;</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span></div><div class='line' id='LC7716'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;TAB&#39;</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span></div><div class='line' id='LC7717'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;ENTER&#39;</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span></div><div class='line' id='LC7718'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PAUSE&#39;</span><span class="o">:</span> <span class="mi">19</span><span class="p">,</span></div><div class='line' id='LC7719'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;CAPS&#39;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span></div><div class='line' id='LC7720'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;ESC&#39;</span><span class="o">:</span> <span class="mi">27</span><span class="p">,</span></div><div class='line' id='LC7721'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;SPACE&#39;</span><span class="o">:</span> <span class="mi">32</span><span class="p">,</span></div><div class='line' id='LC7722'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PAGE_UP&#39;</span><span class="o">:</span> <span class="mi">33</span><span class="p">,</span></div><div class='line' id='LC7723'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PAGE_DOWN&#39;</span><span class="o">:</span> <span class="mi">34</span><span class="p">,</span></div><div class='line' id='LC7724'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;END&#39;</span><span class="o">:</span> <span class="mi">35</span><span class="p">,</span></div><div class='line' id='LC7725'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;HOME&#39;</span><span class="o">:</span> <span class="mi">36</span><span class="p">,</span></div><div class='line' id='LC7726'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;LEFT_ARROW&#39;</span><span class="o">:</span> <span class="mi">37</span><span class="p">,</span></div><div class='line' id='LC7727'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;UP_ARROW&#39;</span><span class="o">:</span> <span class="mi">38</span><span class="p">,</span></div><div class='line' id='LC7728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;RIGHT_ARROW&#39;</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span></div><div class='line' id='LC7729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;DOWN_ARROW&#39;</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span></div><div class='line' id='LC7730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;INSERT&#39;</span><span class="o">:</span> <span class="mi">45</span><span class="p">,</span></div><div class='line' id='LC7731'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;DELETE&#39;</span><span class="o">:</span> <span class="mi">46</span><span class="p">,</span></div><div class='line' id='LC7732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;0&#39;</span><span class="o">:</span> <span class="mi">48</span><span class="p">,</span></div><div class='line' id='LC7733'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;1&#39;</span><span class="o">:</span> <span class="mi">49</span><span class="p">,</span></div><div class='line' id='LC7734'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;2&#39;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span></div><div class='line' id='LC7735'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;3&#39;</span><span class="o">:</span> <span class="mi">51</span><span class="p">,</span></div><div class='line' id='LC7736'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;4&#39;</span><span class="o">:</span> <span class="mi">52</span><span class="p">,</span></div><div class='line' id='LC7737'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;5&#39;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span></div><div class='line' id='LC7738'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;6&#39;</span><span class="o">:</span> <span class="mi">54</span><span class="p">,</span></div><div class='line' id='LC7739'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;7&#39;</span><span class="o">:</span> <span class="mi">55</span><span class="p">,</span></div><div class='line' id='LC7740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;8&#39;</span><span class="o">:</span> <span class="mi">56</span><span class="p">,</span></div><div class='line' id='LC7741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;9&#39;</span><span class="o">:</span> <span class="mi">57</span><span class="p">,</span></div><div class='line' id='LC7742'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;A&#39;</span><span class="o">:</span> <span class="mi">65</span><span class="p">,</span></div><div class='line' id='LC7743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;B&#39;</span><span class="o">:</span> <span class="mi">66</span><span class="p">,</span></div><div class='line' id='LC7744'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;C&#39;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span></div><div class='line' id='LC7745'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;D&#39;</span><span class="o">:</span> <span class="mi">68</span><span class="p">,</span></div><div class='line' id='LC7746'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;E&#39;</span><span class="o">:</span> <span class="mi">69</span><span class="p">,</span></div><div class='line' id='LC7747'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F&#39;</span><span class="o">:</span> <span class="mi">70</span><span class="p">,</span></div><div class='line' id='LC7748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;G&#39;</span><span class="o">:</span> <span class="mi">71</span><span class="p">,</span></div><div class='line' id='LC7749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;H&#39;</span><span class="o">:</span> <span class="mi">72</span><span class="p">,</span></div><div class='line' id='LC7750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;I&#39;</span><span class="o">:</span> <span class="mi">73</span><span class="p">,</span></div><div class='line' id='LC7751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;J&#39;</span><span class="o">:</span> <span class="mi">74</span><span class="p">,</span></div><div class='line' id='LC7752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;K&#39;</span><span class="o">:</span> <span class="mi">75</span><span class="p">,</span></div><div class='line' id='LC7753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;L&#39;</span><span class="o">:</span> <span class="mi">76</span><span class="p">,</span></div><div class='line' id='LC7754'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;M&#39;</span><span class="o">:</span> <span class="mi">77</span><span class="p">,</span></div><div class='line' id='LC7755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;N&#39;</span><span class="o">:</span> <span class="mi">78</span><span class="p">,</span></div><div class='line' id='LC7756'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;O&#39;</span><span class="o">:</span> <span class="mi">79</span><span class="p">,</span></div><div class='line' id='LC7757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;P&#39;</span><span class="o">:</span> <span class="mi">80</span><span class="p">,</span></div><div class='line' id='LC7758'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;Q&#39;</span><span class="o">:</span> <span class="mi">81</span><span class="p">,</span></div><div class='line' id='LC7759'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;R&#39;</span><span class="o">:</span> <span class="mi">82</span><span class="p">,</span></div><div class='line' id='LC7760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;S&#39;</span><span class="o">:</span> <span class="mi">83</span><span class="p">,</span></div><div class='line' id='LC7761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;T&#39;</span><span class="o">:</span> <span class="mi">84</span><span class="p">,</span></div><div class='line' id='LC7762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;U&#39;</span><span class="o">:</span> <span class="mi">85</span><span class="p">,</span></div><div class='line' id='LC7763'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;V&#39;</span><span class="o">:</span> <span class="mi">86</span><span class="p">,</span></div><div class='line' id='LC7764'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;W&#39;</span><span class="o">:</span> <span class="mi">87</span><span class="p">,</span></div><div class='line' id='LC7765'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;X&#39;</span><span class="o">:</span> <span class="mi">88</span><span class="p">,</span></div><div class='line' id='LC7766'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;Y&#39;</span><span class="o">:</span> <span class="mi">89</span><span class="p">,</span></div><div class='line' id='LC7767'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;Z&#39;</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span></div><div class='line' id='LC7768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_0&#39;</span><span class="o">:</span> <span class="mi">96</span><span class="p">,</span></div><div class='line' id='LC7769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_1&#39;</span><span class="o">:</span> <span class="mi">97</span><span class="p">,</span></div><div class='line' id='LC7770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_2&#39;</span><span class="o">:</span> <span class="mi">98</span><span class="p">,</span></div><div class='line' id='LC7771'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_3&#39;</span><span class="o">:</span> <span class="mi">99</span><span class="p">,</span></div><div class='line' id='LC7772'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_4&#39;</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span></div><div class='line' id='LC7773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_5&#39;</span><span class="o">:</span> <span class="mi">101</span><span class="p">,</span></div><div class='line' id='LC7774'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_6&#39;</span><span class="o">:</span> <span class="mi">102</span><span class="p">,</span></div><div class='line' id='LC7775'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_7&#39;</span><span class="o">:</span> <span class="mi">103</span><span class="p">,</span></div><div class='line' id='LC7776'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_8&#39;</span><span class="o">:</span> <span class="mi">104</span><span class="p">,</span></div><div class='line' id='LC7777'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;NUMPAD_9&#39;</span><span class="o">:</span> <span class="mi">105</span><span class="p">,</span></div><div class='line' id='LC7778'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;MULTIPLY&#39;</span><span class="o">:</span> <span class="mi">106</span><span class="p">,</span></div><div class='line' id='LC7779'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;ADD&#39;</span><span class="o">:</span> <span class="mi">107</span><span class="p">,</span></div><div class='line' id='LC7780'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;SUBSTRACT&#39;</span><span class="o">:</span> <span class="mi">109</span><span class="p">,</span></div><div class='line' id='LC7781'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;DECIMAL&#39;</span><span class="o">:</span> <span class="mi">110</span><span class="p">,</span></div><div class='line' id='LC7782'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;DIVIDE&#39;</span><span class="o">:</span> <span class="mi">111</span><span class="p">,</span></div><div class='line' id='LC7783'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F1&#39;</span><span class="o">:</span> <span class="mi">112</span><span class="p">,</span></div><div class='line' id='LC7784'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F2&#39;</span><span class="o">:</span> <span class="mi">113</span><span class="p">,</span></div><div class='line' id='LC7785'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F3&#39;</span><span class="o">:</span> <span class="mi">114</span><span class="p">,</span></div><div class='line' id='LC7786'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F4&#39;</span><span class="o">:</span> <span class="mi">115</span><span class="p">,</span></div><div class='line' id='LC7787'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F5&#39;</span><span class="o">:</span> <span class="mi">116</span><span class="p">,</span></div><div class='line' id='LC7788'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F6&#39;</span><span class="o">:</span> <span class="mi">117</span><span class="p">,</span></div><div class='line' id='LC7789'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F7&#39;</span><span class="o">:</span> <span class="mi">118</span><span class="p">,</span></div><div class='line' id='LC7790'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F8&#39;</span><span class="o">:</span> <span class="mi">119</span><span class="p">,</span></div><div class='line' id='LC7791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F9&#39;</span><span class="o">:</span> <span class="mi">120</span><span class="p">,</span></div><div class='line' id='LC7792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F10&#39;</span><span class="o">:</span> <span class="mi">121</span><span class="p">,</span></div><div class='line' id='LC7793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F11&#39;</span><span class="o">:</span> <span class="mi">122</span><span class="p">,</span></div><div class='line' id='LC7794'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;F12&#39;</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span></div><div class='line' id='LC7795'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;SHIFT&#39;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class='line' id='LC7796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;CTRL&#39;</span><span class="o">:</span> <span class="mi">17</span><span class="p">,</span></div><div class='line' id='LC7797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;ALT&#39;</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span></div><div class='line' id='LC7798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PLUS&#39;</span><span class="o">:</span> <span class="mi">187</span><span class="p">,</span></div><div class='line' id='LC7799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;COMMA&#39;</span><span class="o">:</span> <span class="mi">188</span><span class="p">,</span></div><div class='line' id='LC7800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;MINUS&#39;</span><span class="o">:</span> <span class="mi">189</span><span class="p">,</span></div><div class='line' id='LC7801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PERIOD&#39;</span><span class="o">:</span> <span class="mi">190</span><span class="p">,</span></div><div class='line' id='LC7802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PULT_UP&#39;</span><span class="o">:</span> <span class="mi">29460</span><span class="p">,</span></div><div class='line' id='LC7803'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PULT_DOWN&#39;</span><span class="o">:</span> <span class="mi">29461</span><span class="p">,</span></div><div class='line' id='LC7804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PULT_LEFT&#39;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span></div><div class='line' id='LC7805'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;PULT_RIGHT&#39;</span><span class="o">:</span> <span class="mi">5</span></div><div class='line' id='LC7806'><br/></div><div class='line' id='LC7807'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7808'><br/></div><div class='line' id='LC7809'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7810'><span class="cm">     * #Crafty.mouseButtons</span></div><div class='line' id='LC7811'><span class="cm">     * @category Input</span></div><div class='line' id='LC7812'><span class="cm">     * An object mapping mouseButton names to the corresponding button ID.</span></div><div class='line' id='LC7813'><span class="cm">     * In all mouseEvents, we add the `e.mouseButton` property with a value normalized to match e.button of modern webkit browsers:</span></div><div class='line' id='LC7814'><span class="cm">     *</span></div><div class='line' id='LC7815'><span class="cm">     * ~~~</span></div><div class='line' id='LC7816'><span class="cm">     * LEFT: 0,</span></div><div class='line' id='LC7817'><span class="cm">     * MIDDLE: 1,</span></div><div class='line' id='LC7818'><span class="cm">     * RIGHT: 2</span></div><div class='line' id='LC7819'><span class="cm">     * ~~~</span></div><div class='line' id='LC7820'><span class="cm">     */</span></div><div class='line' id='LC7821'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mouseButtons</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC7822'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">LEFT</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7823'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">MIDDLE</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC7824'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">RIGHT</span><span class="o">:</span> <span class="mi">2</span></div><div class='line' id='LC7825'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7826'><span class="p">});</span></div><div class='line' id='LC7827'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">18</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC7828'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC7829'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC7830'><br/></div><div class='line' id='LC7831'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC7832'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7833'><span class="cm">     * #Crafty.assets</span></div><div class='line' id='LC7834'><span class="cm">     * @category Assets</span></div><div class='line' id='LC7835'><span class="cm">     * An object containing every asset used in the current Crafty game.</span></div><div class='line' id='LC7836'><span class="cm">     * The key is the URL and the value is the `Audio` or `Image` object.</span></div><div class='line' id='LC7837'><span class="cm">     *</span></div><div class='line' id='LC7838'><span class="cm">     * If loading an asset, check that it is in this object first to avoid loading twice.</span></div><div class='line' id='LC7839'><span class="cm">     *</span></div><div class='line' id='LC7840'><span class="cm">     * @example</span></div><div class='line' id='LC7841'><span class="cm">     * ~~~</span></div><div class='line' id='LC7842'><span class="cm">     * var isLoaded = !!Crafty.assets[&quot;images/sprite.png&quot;];</span></div><div class='line' id='LC7843'><span class="cm">     * ~~~</span></div><div class='line' id='LC7844'><span class="cm">     * @see Crafty.loader</span></div><div class='line' id='LC7845'><span class="cm">     */</span></div><div class='line' id='LC7846'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">assets</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC7847'><br/></div><div class='line' id='LC7848'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7849'><span class="cm">     * #Crafty.asset</span></div><div class='line' id='LC7850'><span class="cm">     * @category Assets</span></div><div class='line' id='LC7851'><span class="cm">     *</span></div><div class='line' id='LC7852'><span class="cm">     * @trigger NewAsset - After setting new asset - Object - key and value of new added asset.</span></div><div class='line' id='LC7853'><span class="cm">     * @sign public void Crafty.asset(String key, Object asset)</span></div><div class='line' id='LC7854'><span class="cm">     * @param key - asset url.</span></div><div class='line' id='LC7855'><span class="cm">     * @param asset - Audio` or `Image` object.</span></div><div class='line' id='LC7856'><span class="cm">     * Add new asset to assets object.</span></div><div class='line' id='LC7857'><span class="cm">     *</span></div><div class='line' id='LC7858'><span class="cm">     * @sign public void Crafty.asset(String key)</span></div><div class='line' id='LC7859'><span class="cm">     * @param key - asset url.</span></div><div class='line' id='LC7860'><span class="cm">     * Get asset from assets object.</span></div><div class='line' id='LC7861'><span class="cm">     *</span></div><div class='line' id='LC7862'><span class="cm">     * @example</span></div><div class='line' id='LC7863'><span class="cm">     * ~~~</span></div><div class='line' id='LC7864'><span class="cm">     * Crafty.asset(key, value);</span></div><div class='line' id='LC7865'><span class="cm">     * var asset = Crafty.asset(key); //object with key and value fields</span></div><div class='line' id='LC7866'><span class="cm">     * ~~~</span></div><div class='line' id='LC7867'><span class="cm">     *</span></div><div class='line' id='LC7868'><span class="cm">     * @see Crafty.assets</span></div><div class='line' id='LC7869'><span class="cm">     */</span></div><div class='line' id='LC7870'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">asset</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7871'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC7873'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7874'><br/></div><div class='line' id='LC7875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC7876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC7877'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NewAsset&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC7878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">key</span><span class="o">:</span> <span class="nx">key</span><span class="p">,</span></div><div class='line' id='LC7879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">value</span><span class="o">:</span> <span class="nx">value</span></div><div class='line' id='LC7880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC7881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC7882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7883'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC7884'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7885'><span class="cm">     * #Crafty.image_whitelist</span></div><div class='line' id='LC7886'><span class="cm">     * @category Assets</span></div><div class='line' id='LC7887'><span class="cm">     *</span></div><div class='line' id='LC7888'><span class="cm">     *</span></div><div class='line' id='LC7889'><span class="cm">     * A list of file extensions that can be loaded as images by Crafty.load</span></div><div class='line' id='LC7890'><span class="cm">     *</span></div><div class='line' id='LC7891'><span class="cm">     * @example</span></div><div class='line' id='LC7892'><span class="cm">     * ~~~</span></div><div class='line' id='LC7893'><span class="cm">     * Crafty.image_whitelist.push(&quot;tif&quot;)</span></div><div class='line' id='LC7894'><span class="cm">     * Crafty.load([&quot;images/sprite.tif&quot;, &quot;sounds/jump.mp3&quot;],</span></div><div class='line' id='LC7895'><span class="cm">     *     function() {</span></div><div class='line' id='LC7896'><span class="cm">     *         //when loaded</span></div><div class='line' id='LC7897'><span class="cm">     *         Crafty.scene(&quot;main&quot;); //go to main scene</span></div><div class='line' id='LC7898'><span class="cm">     *         Crafty.audio.play(&quot;jump.mp3&quot;); //Play the audio file</span></div><div class='line' id='LC7899'><span class="cm">     *     },</span></div><div class='line' id='LC7900'><span class="cm">     *</span></div><div class='line' id='LC7901'><span class="cm">     *     function(e) {</span></div><div class='line' id='LC7902'><span class="cm">     *       //progress</span></div><div class='line' id='LC7903'><span class="cm">     *     },</span></div><div class='line' id='LC7904'><span class="cm">     *</span></div><div class='line' id='LC7905'><span class="cm">     *     function(e) {</span></div><div class='line' id='LC7906'><span class="cm">     *       //uh oh, error loading</span></div><div class='line' id='LC7907'><span class="cm">     *     }</span></div><div class='line' id='LC7908'><span class="cm">     * );</span></div><div class='line' id='LC7909'><span class="cm">     * ~~~</span></div><div class='line' id='LC7910'><span class="cm">     *</span></div><div class='line' id='LC7911'><span class="cm">     * @see Crafty.asset</span></div><div class='line' id='LC7912'><span class="cm">     * @see Crafty.load</span></div><div class='line' id='LC7913'><span class="cm">     */</span></div><div class='line' id='LC7914'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">image_whitelist</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;gif&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">],</span></div><div class='line' id='LC7915'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC7916'><span class="cm">     * #Crafty.loader</span></div><div class='line' id='LC7917'><span class="cm">     * @category Assets</span></div><div class='line' id='LC7918'><span class="cm">     * @sign public void Crafty.load(Array assets, Function onLoad[, Function onProgress, Function onError])</span></div><div class='line' id='LC7919'><span class="cm">     * @param assets - Array of assets to load (accepts sounds and images)</span></div><div class='line' id='LC7920'><span class="cm">     * @param onLoad - Callback when the assets are loaded</span></div><div class='line' id='LC7921'><span class="cm">     * @param onProgress - Callback when an asset is loaded. Contains information about assets loaded</span></div><div class='line' id='LC7922'><span class="cm">     * @param onError - Callback when an asset fails to load</span></div><div class='line' id='LC7923'><span class="cm">     *</span></div><div class='line' id='LC7924'><span class="cm">     * Preloader for all assets. Takes an array of URLs and</span></div><div class='line' id='LC7925'><span class="cm">     * adds them to the `Crafty.assets` object.</span></div><div class='line' id='LC7926'><span class="cm">     *</span></div><div class='line' id='LC7927'><span class="cm">     * Files with suffixes in `image_whitelist` (case insensitive) will be loaded.</span></div><div class='line' id='LC7928'><span class="cm">     *</span></div><div class='line' id='LC7929'><span class="cm">     * If `Crafty.support.audio` is `true`, files with the following suffixes `mp3`, `wav`, `ogg` and `mp4` (case insensitive) can be loaded.</span></div><div class='line' id='LC7930'><span class="cm">     *</span></div><div class='line' id='LC7931'><span class="cm">     * The `onProgress` function will be passed on object with information about</span></div><div class='line' id='LC7932'><span class="cm">     * the progress including how many assets loaded, total of all the assets to</span></div><div class='line' id='LC7933'><span class="cm">     * load and a percentage of the progress.</span></div><div class='line' id='LC7934'><span class="cm">     * ~~~</span></div><div class='line' id='LC7935'><span class="cm">     * { loaded: j, total: total, percent: (j / total * 100) ,src:src})</span></div><div class='line' id='LC7936'><span class="cm">     * ~~~</span></div><div class='line' id='LC7937'><span class="cm">     *</span></div><div class='line' id='LC7938'><span class="cm">     * `onError` will be passed with the asset that couldn&#39;t load.</span></div><div class='line' id='LC7939'><span class="cm">     *</span></div><div class='line' id='LC7940'><span class="cm">     * When `onError` is not provided, the onLoad is loaded even some assets are not successfully loaded. Otherwise, onLoad will be called no matter whether there are errors or not.</span></div><div class='line' id='LC7941'><span class="cm">     *</span></div><div class='line' id='LC7942'><span class="cm">     * @example</span></div><div class='line' id='LC7943'><span class="cm">     * ~~~</span></div><div class='line' id='LC7944'><span class="cm">     * Crafty.load([&quot;images/sprite.png&quot;, &quot;sounds/jump.mp3&quot;],</span></div><div class='line' id='LC7945'><span class="cm">     *     function() {</span></div><div class='line' id='LC7946'><span class="cm">     *         //when loaded</span></div><div class='line' id='LC7947'><span class="cm">     *         Crafty.scene(&quot;main&quot;); //go to main scene</span></div><div class='line' id='LC7948'><span class="cm">     *         Crafty.audio.play(&quot;jump.mp3&quot;); //Play the audio file</span></div><div class='line' id='LC7949'><span class="cm">     *     },</span></div><div class='line' id='LC7950'><span class="cm">     *</span></div><div class='line' id='LC7951'><span class="cm">     *     function(e) {</span></div><div class='line' id='LC7952'><span class="cm">     *       //progress</span></div><div class='line' id='LC7953'><span class="cm">     *     },</span></div><div class='line' id='LC7954'><span class="cm">     *</span></div><div class='line' id='LC7955'><span class="cm">     *     function(e) {</span></div><div class='line' id='LC7956'><span class="cm">     *       //uh oh, error loading</span></div><div class='line' id='LC7957'><span class="cm">     *     }</span></div><div class='line' id='LC7958'><span class="cm">     * );</span></div><div class='line' id='LC7959'><span class="cm">     * ~~~</span></div><div class='line' id='LC7960'><span class="cm">     *</span></div><div class='line' id='LC7961'><span class="cm">     * @see Crafty.assets</span></div><div class='line' id='LC7962'><span class="cm">     * @see Crafty.image_whitelist</span></div><div class='line' id='LC7963'><span class="cm">     */</span></div><div class='line' id='LC7964'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">load</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">oncomplete</span><span class="p">,</span> <span class="nx">onprogress</span><span class="p">,</span> <span class="nx">onerror</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7965'><br/></div><div class='line' id='LC7966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC7968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">l</span><span class="p">,</span></div><div class='line' id='LC7969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC7970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC7971'><br/></div><div class='line' id='LC7972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Progress function</span></div><div class='line' id='LC7973'><br/></div><div class='line' id='LC7974'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">pro</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7975'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span></div><div class='line' id='LC7976'><br/></div><div class='line' id='LC7977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Remove events cause audio trigger this event more than once(depends on browser)</span></div><div class='line' id='LC7978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC7979'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;canplaythrough&#39;</span><span class="p">,</span> <span class="nx">pro</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC7980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7981'><br/></div><div class='line' id='LC7982'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">++</span><span class="nx">j</span><span class="p">;</span></div><div class='line' id='LC7983'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if progress callback, give information of assets loaded, total and percent</span></div><div class='line' id='LC7984'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">onprogress</span><span class="p">)</span></div><div class='line' id='LC7985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onprogress</span><span class="p">({</span></div><div class='line' id='LC7986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loaded</span><span class="o">:</span> <span class="nx">j</span><span class="p">,</span></div><div class='line' id='LC7987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">total</span><span class="o">:</span> <span class="nx">total</span><span class="p">,</span></div><div class='line' id='LC7988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">percent</span><span class="o">:</span> <span class="p">(</span><span class="nx">j</span> <span class="o">/</span> <span class="nx">total</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span></div><div class='line' id='LC7989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">src</span><span class="o">:</span> <span class="nx">src</span></div><div class='line' id='LC7990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC7991'><br/></div><div class='line' id='LC7992'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">===</span> <span class="nx">total</span> <span class="o">&amp;&amp;</span> <span class="nx">oncomplete</span><span class="p">)</span> <span class="nx">oncomplete</span><span class="p">();</span></div><div class='line' id='LC7993'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC7994'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Error function</span></div><div class='line' id='LC7995'><br/></div><div class='line' id='LC7996'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">err</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC7997'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span></div><div class='line' id='LC7998'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">onerror</span><span class="p">)</span></div><div class='line' id='LC7999'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onerror</span><span class="p">({</span></div><div class='line' id='LC8000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loaded</span><span class="o">:</span> <span class="nx">j</span><span class="p">,</span></div><div class='line' id='LC8001'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">total</span><span class="o">:</span> <span class="nx">total</span><span class="p">,</span></div><div class='line' id='LC8002'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">percent</span><span class="o">:</span> <span class="p">(</span><span class="nx">j</span> <span class="o">/</span> <span class="nx">total</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span></div><div class='line' id='LC8003'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">src</span><span class="o">:</span> <span class="nx">src</span></div><div class='line' id='LC8004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC8005'><br/></div><div class='line' id='LC8006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">j</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC8007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">===</span> <span class="nx">total</span> <span class="o">&amp;&amp;</span> <span class="nx">oncomplete</span><span class="p">)</span> <span class="nx">oncomplete</span><span class="p">();</span></div><div class='line' id='LC8008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8009'><br/></div><div class='line' id='LC8010'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8011'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC8012'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ext</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span></div><div class='line' id='LC8013'><br/></div><div class='line' id='LC8014'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC8015'><br/></div><div class='line' id='LC8016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC8017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Create a new asset if necessary, using the file name as an id</span></div><div class='line' id='LC8018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span></div><div class='line' id='LC8020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">current</span><span class="p">).</span><span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC8021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8022'><br/></div><div class='line' id='LC8023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//addEventListener is supported on IE9 , Audio as well</span></div><div class='line' id='LC8024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;canplaythrough&#39;</span><span class="p">,</span> <span class="nx">pro</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC8026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8027'><br/></div><div class='line' id='LC8028'><br/></div><div class='line' id='LC8029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">image_whitelist</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ext</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span></div><div class='line' id='LC8032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">current</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span></div><div class='line' id='LC8033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">pro</span><span class="p">;</span></div><div class='line' id='LC8035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">===</span> <span class="s1">&#39;webkit&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="c1">// workaround for webkit bug</span></div><div class='line' id='LC8037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span> <span class="c1">//setup src after onload function Opera/IE Bug</span></div><div class='line' id='LC8039'><br/></div><div class='line' id='LC8040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC8041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">total</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC8042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="p">;</span> <span class="c1">//skip if not applicable</span></div><div class='line' id='LC8043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span></div><div class='line' id='LC8045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8046'><br/></div><div class='line' id='LC8047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If we aren&#39;t trying to handle *any* of the files, that&#39;s as complete as it gets!</span></div><div class='line' id='LC8048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">total</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC8049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oncomplete</span><span class="p">();</span></div><div class='line' id='LC8050'><br/></div><div class='line' id='LC8051'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8052'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8053'><span class="cm">     * #Crafty.modules</span></div><div class='line' id='LC8054'><span class="cm">     * @category Assets</span></div><div class='line' id='LC8055'><span class="cm">     * @sign public void Crafty.modules([String repoLocation,] Object moduleMap[, Function onLoad])</span></div><div class='line' id='LC8056'><span class="cm">     * @param modules - Map of name:version pairs for modules to load</span></div><div class='line' id='LC8057'><span class="cm">     * @param onLoad - Callback when the modules are loaded</span></div><div class='line' id='LC8058'><span class="cm">     *</span></div><div class='line' id='LC8059'><span class="cm">     * Browse the selection of community modules on http://craftycomponents.com</span></div><div class='line' id='LC8060'><span class="cm">     *</span></div><div class='line' id='LC8061'><span class="cm">     * It is possible to create your own repository.</span></div><div class='line' id='LC8062'><span class="cm">     *</span></div><div class='line' id='LC8063'><span class="cm">     *</span></div><div class='line' id='LC8064'><span class="cm">     * @example</span></div><div class='line' id='LC8065'><span class="cm">     * ~~~</span></div><div class='line' id='LC8066'><span class="cm">     * // Loading from default repository</span></div><div class='line' id='LC8067'><span class="cm">     * Crafty.modules({ moveto: &#39;DEV&#39; }, function () {</span></div><div class='line' id='LC8068'><span class="cm">     *     //module is ready</span></div><div class='line' id='LC8069'><span class="cm">     *     Crafty.e(&quot;MoveTo, 2D, DOM&quot;);</span></div><div class='line' id='LC8070'><span class="cm">     * });</span></div><div class='line' id='LC8071'><span class="cm">     *</span></div><div class='line' id='LC8072'><span class="cm">     * // Loading from your own server</span></div><div class='line' id='LC8073'><span class="cm">     * Crafty.modules({ &#39;http://mydomain.com/js/mystuff.js&#39;: &#39;DEV&#39; }, function () {</span></div><div class='line' id='LC8074'><span class="cm">     *     //module is ready</span></div><div class='line' id='LC8075'><span class="cm">     *     Crafty.e(&quot;MoveTo, 2D, DOM&quot;);</span></div><div class='line' id='LC8076'><span class="cm">     * });</span></div><div class='line' id='LC8077'><span class="cm">     *</span></div><div class='line' id='LC8078'><span class="cm">     * // Loading from alternative repository</span></div><div class='line' id='LC8079'><span class="cm">     * Crafty.modules(&#39;http://cdn.crafty-modules.com&#39;, { moveto: &#39;DEV&#39; }, function () {</span></div><div class='line' id='LC8080'><span class="cm">     *     //module is ready</span></div><div class='line' id='LC8081'><span class="cm">     *     Crafty.e(&quot;MoveTo, 2D, DOM&quot;);</span></div><div class='line' id='LC8082'><span class="cm">     * });</span></div><div class='line' id='LC8083'><span class="cm">     *</span></div><div class='line' id='LC8084'><span class="cm">     * // Loading from the latest component website</span></div><div class='line' id='LC8085'><span class="cm">     * Crafty.modules(</span></div><div class='line' id='LC8086'><span class="cm">     *     &#39;http://cdn.craftycomponents.com&#39;</span></div><div class='line' id='LC8087'><span class="cm">     *     , { MoveTo: &#39;release&#39; }</span></div><div class='line' id='LC8088'><span class="cm">     *     , function () {</span></div><div class='line' id='LC8089'><span class="cm">     *     Crafty.e(&quot;2D, DOM, Color, MoveTo&quot;)</span></div><div class='line' id='LC8090'><span class="cm">     *       .attr({x: 0, y: 0, w: 50, h: 50})</span></div><div class='line' id='LC8091'><span class="cm">     *       .color(&quot;green&quot;);</span></div><div class='line' id='LC8092'><span class="cm">     *     });</span></div><div class='line' id='LC8093'><span class="cm">     * });</span></div><div class='line' id='LC8094'><span class="cm">     * ~~~</span></div><div class='line' id='LC8095'><span class="cm">     *</span></div><div class='line' id='LC8096'><span class="cm">     */</span></div><div class='line' id='LC8097'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">modules</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">modulesRepository</span><span class="p">,</span> <span class="nx">moduleMap</span><span class="p">,</span> <span class="nx">oncomplete</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8098'><br/></div><div class='line' id='LC8099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">modulesRepository</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oncomplete</span> <span class="o">=</span> <span class="nx">moduleMap</span><span class="p">;</span></div><div class='line' id='LC8101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">moduleMap</span> <span class="o">=</span> <span class="nx">modulesRepository</span><span class="p">;</span></div><div class='line' id='LC8102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">modulesRepository</span> <span class="o">=</span> <span class="s1">&#39;http://cdn.craftycomponents.com&#39;</span><span class="p">;</span></div><div class='line' id='LC8103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8104'><br/></div><div class='line' id='LC8105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*!</span></div><div class='line' id='LC8106'><span class="cm">         * $script.js Async loader &amp; dependency manager</span></div><div class='line' id='LC8107'><span class="cm">         * https://github.com/ded/script.js</span></div><div class='line' id='LC8108'><span class="cm">         * (c) Dustin Diaz, Jacob Thornton 2011</span></div><div class='line' id='LC8109'><span class="cm">         * License: MIT</span></div><div class='line' id='LC8110'><span class="cm">         */</span></div><div class='line' id='LC8111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">$script</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span></div><div class='line' id='LC8113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">,</span></div><div class='line' id='LC8114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">head</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC8115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">validBase</span> <span class="o">=</span> <span class="sr">/^https?:\/\//</span><span class="p">,</span></div><div class='line' id='LC8116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">old</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">$script</span><span class="p">,</span></div><div class='line' id='LC8117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">list</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">ids</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">delay</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">scriptpath</span><span class="p">,</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">s</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span></div><div class='line' id='LC8118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">f</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC8119'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">push</span> <span class="o">=</span> <span class="s1">&#39;push&#39;</span><span class="p">,</span></div><div class='line' id='LC8120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">domContentLoaded</span> <span class="o">=</span> <span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span></div><div class='line' id='LC8121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">readyState</span> <span class="o">=</span> <span class="s1">&#39;readyState&#39;</span><span class="p">,</span></div><div class='line' id='LC8122'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addEventListener</span> <span class="o">=</span> <span class="s1">&#39;addEventListener&#39;</span><span class="p">,</span></div><div class='line' id='LC8123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="s1">&#39;onreadystatechange&#39;</span><span class="p">;</span></div><div class='line' id='LC8124'><br/></div><div class='line' id='LC8125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">every</span><span class="p">(</span><span class="nx">ar</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">ar</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">j</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span></div><div class='line' id='LC8127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="k">return</span> <span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC8128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8129'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8130'><br/></div><div class='line' id='LC8131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">each</span><span class="p">(</span><span class="nx">ar</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">every</span><span class="p">(</span><span class="nx">ar</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="o">!</span><span class="nx">fn</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span></div><div class='line' id='LC8134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC8135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8136'><br/></div><div class='line' id='LC8137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">[</span><span class="nx">readyState</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">[</span><span class="nx">addEventListener</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC8138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">doc</span><span class="p">[</span><span class="nx">addEventListener</span><span class="p">](</span><span class="nx">domContentLoaded</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">doc</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">domContentLoaded</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">f</span><span class="p">);</span></div><div class='line' id='LC8140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">doc</span><span class="p">[</span><span class="nx">readyState</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;complete&#39;</span><span class="p">;</span></div><div class='line' id='LC8141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="nx">f</span><span class="p">);</span></div><div class='line' id='LC8142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">doc</span><span class="p">[</span><span class="nx">readyState</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;loading&#39;</span><span class="p">;</span></div><div class='line' id='LC8143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8144'><br/></div><div class='line' id='LC8145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">$script</span><span class="p">(</span><span class="nx">paths</span><span class="p">,</span> <span class="nx">idOrDone</span><span class="p">,</span> <span class="nx">optDone</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paths</span> <span class="o">=</span> <span class="nx">paths</span><span class="p">[</span><span class="nx">push</span><span class="p">]</span> <span class="o">?</span> <span class="nx">paths</span> <span class="o">:</span> <span class="p">[</span><span class="nx">paths</span><span class="p">];</span></div><div class='line' id='LC8147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">idOrDoneIsDone</span> <span class="o">=</span> <span class="nx">idOrDone</span> <span class="o">&amp;&amp;</span> <span class="nx">idOrDone</span><span class="p">.</span><span class="nx">call</span><span class="p">,</span></div><div class='line' id='LC8148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">done</span> <span class="o">=</span> <span class="nx">idOrDoneIsDone</span> <span class="o">?</span> <span class="nx">idOrDone</span> <span class="o">:</span> <span class="nx">optDone</span><span class="p">,</span></div><div class='line' id='LC8149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span> <span class="o">=</span> <span class="nx">idOrDoneIsDone</span> <span class="o">?</span> <span class="nx">paths</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">idOrDone</span><span class="p">,</span></div><div class='line' id='LC8150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">queue</span> <span class="o">=</span> <span class="nx">paths</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC8151'><br/></div><div class='line' id='LC8152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">loopFn</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">call</span> <span class="o">?</span> <span class="nx">item</span><span class="p">()</span> <span class="o">:</span> <span class="nx">list</span><span class="p">[</span><span class="nx">item</span><span class="p">];</span></div><div class='line' id='LC8154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8155'><br/></div><div class='line' id='LC8156'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8158'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">list</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8159'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span></div><div class='line' id='LC8160'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">done</span><span class="p">();</span></div><div class='line' id='LC8161'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">dset</span> <span class="k">in</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8162'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">every</span><span class="p">(</span><span class="nx">dset</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">),</span> <span class="nx">loopFn</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">each</span><span class="p">(</span><span class="nx">delay</span><span class="p">[</span><span class="nx">dset</span><span class="p">],</span> <span class="nx">loopFn</span><span class="p">))</span></div><div class='line' id='LC8163'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">delay</span><span class="p">[</span><span class="nx">dset</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC8164'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8166'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8167'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">each</span><span class="p">(</span><span class="nx">paths</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">path</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC8170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span></div><div class='line' id='LC8171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ids</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">();</span></div><div class='line' id='LC8173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scripts</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span></div><div class='line' id='LC8176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ids</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">create</span><span class="p">(</span><span class="o">!</span><span class="nx">validBase</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">scriptpath</span> <span class="o">?</span> <span class="nx">scriptpath</span> <span class="o">+</span> <span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span> <span class="o">:</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC8178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC8179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC8180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">$script</span><span class="p">;</span></div><div class='line' id='LC8181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8182'><br/></div><div class='line' id='LC8183'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">create</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8184'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">),</span></div><div class='line' id='LC8185'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loaded</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC8186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">el</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="nx">onreadystatechange</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">((</span><span class="nx">el</span><span class="p">[</span><span class="nx">readyState</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="sr">/^c|loade/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">el</span><span class="p">[</span><span class="nx">readyState</span><span class="p">])))</span> <span class="o">||</span> <span class="nx">loaded</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC8188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">el</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">el</span><span class="p">[</span><span class="nx">onreadystatechange</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC8189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">loaded</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8190'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scripts</span><span class="p">[</span><span class="nx">path</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC8191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">fn</span><span class="p">();</span></div><div class='line' id='LC8192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">el</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">el</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span></div><div class='line' id='LC8195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">head</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">head</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span></div><div class='line' id='LC8196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8197'><br/></div><div class='line' id='LC8198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="nx">create</span><span class="p">;</span></div><div class='line' id='LC8199'><br/></div><div class='line' id='LC8200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">.</span><span class="nx">order</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">(</span><span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">s</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span></div><div class='line' id='LC8203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">$script</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span></div><div class='line' id='LC8204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="nx">$script</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span></div><div class='line' id='LC8205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}());</span></div><div class='line' id='LC8206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8207'><br/></div><div class='line' id='LC8208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scriptpath</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span></div><div class='line' id='LC8210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This function is a tangled mess of conciseness, so suppress warnings here</span></div><div class='line' id='LC8212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/* jshint -W030 */</span></div><div class='line' id='LC8213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">deps</span><span class="p">,</span> <span class="nx">ready</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">deps</span> <span class="o">=</span> <span class="nx">deps</span><span class="p">[</span><span class="nx">push</span><span class="p">]</span> <span class="o">?</span> <span class="nx">deps</span> <span class="o">:</span> <span class="p">[</span><span class="nx">deps</span><span class="p">];</span></div><div class='line' id='LC8215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">missing</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC8216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">!</span><span class="nx">each</span><span class="p">(</span><span class="nx">deps</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dep</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">list</span><span class="p">[</span><span class="nx">dep</span><span class="p">]</span> <span class="o">||</span> <span class="nx">missing</span><span class="p">[</span><span class="nx">push</span><span class="p">](</span><span class="nx">dep</span><span class="p">);</span></div><div class='line' id='LC8218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="nx">every</span><span class="p">(</span><span class="nx">deps</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dep</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">list</span><span class="p">[</span><span class="nx">dep</span><span class="p">];</span></div><div class='line' id='LC8220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})</span> <span class="o">?</span></div><div class='line' id='LC8221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="p">()</span> <span class="o">:</span> <span class="o">!</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">delay</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span></div><div class='line' id='LC8223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">delay</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">push</span><span class="p">](</span><span class="nx">ready</span><span class="p">);</span></div><div class='line' id='LC8224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">req</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">(</span><span class="nx">missing</span><span class="p">);</span></div><div class='line' id='LC8225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}(</span><span class="nx">deps</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">));</span></div><div class='line' id='LC8226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">$script</span><span class="p">;</span></div><div class='line' id='LC8227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/* jshint +W030 */</span></div><div class='line' id='LC8229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">.</span><span class="nx">noConflict</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">win</span><span class="p">.</span><span class="nx">$script</span> <span class="o">=</span> <span class="nx">old</span><span class="p">;</span></div><div class='line' id='LC8231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8233'><br/></div><div class='line' id='LC8234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">$script</span><span class="p">;</span></div><div class='line' id='LC8235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})();</span></div><div class='line' id='LC8236'><br/></div><div class='line' id='LC8237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC8238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">validBase</span> <span class="o">=</span> <span class="sr">/^(https?|file):\/\//</span><span class="p">;</span></div><div class='line' id='LC8239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">moduleMap</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">validBase</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span></div><div class='line' id='LC8241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">modules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span></div><div class='line' id='LC8242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC8243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">modules</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">modulesRepository</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">moduleMap</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.js&#39;</span><span class="p">);</span></div><div class='line' id='LC8244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8245'><br/></div><div class='line' id='LC8246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">$script</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">oncomplete</span><span class="p">)</span> <span class="nx">oncomplete</span><span class="p">();</span></div><div class='line' id='LC8248'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC8249'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8250'><span class="p">});</span></div><div class='line' id='LC8251'><br/></div><div class='line' id='LC8252'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">19</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC8253'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC8254'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC8255'><br/></div><div class='line' id='LC8256'><span class="cm">/**@</span></div><div class='line' id='LC8257'><span class="cm"> * #Crafty.math</span></div><div class='line' id='LC8258'><span class="cm"> * @category 2D</span></div><div class='line' id='LC8259'><span class="cm"> * Static functions.</span></div><div class='line' id='LC8260'><span class="cm"> */</span></div><div class='line' id='LC8261'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC8262'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8263'><span class="cm">     * #Crafty.math.abs</span></div><div class='line' id='LC8264'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8265'><span class="cm">     * @sign public this Crafty.math.abs(Number n)</span></div><div class='line' id='LC8266'><span class="cm">     * @param n - Some value.</span></div><div class='line' id='LC8267'><span class="cm">     * @return Absolute value.</span></div><div class='line' id='LC8268'><span class="cm">     *</span></div><div class='line' id='LC8269'><span class="cm">     * Returns the absolute value.</span></div><div class='line' id='LC8270'><span class="cm">     */</span></div><div class='line' id='LC8271'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">abs</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="o">-</span><span class="nx">x</span> <span class="o">:</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8273'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8274'><br/></div><div class='line' id='LC8275'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8276'><span class="cm">     * #Crafty.math.amountOf</span></div><div class='line' id='LC8277'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8278'><span class="cm">     * @sign public Number Crafty.math.amountOf(Number checkValue, Number minValue, Number maxValue)</span></div><div class='line' id='LC8279'><span class="cm">     * @param checkValue - Value that should checked with minimum and maximum.</span></div><div class='line' id='LC8280'><span class="cm">     * @param minValue - Minimum value to check.</span></div><div class='line' id='LC8281'><span class="cm">     * @param maxValue - Maximum value to check.</span></div><div class='line' id='LC8282'><span class="cm">     * @return Amount of checkValue compared to minValue and maxValue.</span></div><div class='line' id='LC8283'><span class="cm">     *</span></div><div class='line' id='LC8284'><span class="cm">     * Returns the amount of how much a checkValue is more like minValue (=0)</span></div><div class='line' id='LC8285'><span class="cm">     * or more like maxValue (=1)</span></div><div class='line' id='LC8286'><span class="cm">     */</span></div><div class='line' id='LC8287'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">amountOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">checkValue</span><span class="p">,</span> <span class="nx">minValue</span><span class="p">,</span> <span class="nx">maxValue</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">minValue</span> <span class="o">&lt;</span> <span class="nx">maxValue</span><span class="p">)</span></div><div class='line' id='LC8289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">checkValue</span> <span class="o">-</span> <span class="nx">minValue</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">maxValue</span> <span class="o">-</span> <span class="nx">minValue</span><span class="p">);</span></div><div class='line' id='LC8290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC8291'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">checkValue</span> <span class="o">-</span> <span class="nx">maxValue</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">minValue</span> <span class="o">-</span> <span class="nx">maxValue</span><span class="p">);</span></div><div class='line' id='LC8292'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8293'><br/></div><div class='line' id='LC8294'><br/></div><div class='line' id='LC8295'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8296'><span class="cm">     * #Crafty.math.clamp</span></div><div class='line' id='LC8297'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8298'><span class="cm">     * @sign public Number Crafty.math.clamp(Number value, Number min, Number max)</span></div><div class='line' id='LC8299'><span class="cm">     * @param value - A value.</span></div><div class='line' id='LC8300'><span class="cm">     * @param max - Maximum that value can be.</span></div><div class='line' id='LC8301'><span class="cm">     * @param min - Minimum that value can be.</span></div><div class='line' id='LC8302'><span class="cm">     * @return The value between minimum and maximum.</span></div><div class='line' id='LC8303'><span class="cm">     *</span></div><div class='line' id='LC8304'><span class="cm">     * Restricts a value to be within a specified range.</span></div><div class='line' id='LC8305'><span class="cm">     */</span></div><div class='line' id='LC8306'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clamp</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">max</span><span class="p">)</span></div><div class='line' id='LC8308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">max</span><span class="p">;</span></div><div class='line' id='LC8309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="nx">min</span><span class="p">)</span></div><div class='line' id='LC8310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">min</span><span class="p">;</span></div><div class='line' id='LC8311'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC8312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC8313'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8314'><br/></div><div class='line' id='LC8315'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8316'><span class="cm">     * #Crafty.math.degToRad</span></div><div class='line' id='LC8317'><span class="cm">     * Converts angle from degree to radian.</span></div><div class='line' id='LC8318'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8319'><span class="cm">     * @param angleInDeg - The angle in degree.</span></div><div class='line' id='LC8320'><span class="cm">     * @return The angle in radian.</span></div><div class='line' id='LC8321'><span class="cm">     */</span></div><div class='line' id='LC8322'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">degToRad</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">angleInDeg</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8323'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">angleInDeg</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span></div><div class='line' id='LC8324'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8325'><br/></div><div class='line' id='LC8326'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8327'><span class="cm">     * #Crafty.math.distance</span></div><div class='line' id='LC8328'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8329'><span class="cm">     * @sign public Number Crafty.math.distance(Number x1, Number y1, Number x2, Number y2)</span></div><div class='line' id='LC8330'><span class="cm">     * @param x1 - First x coordinate.</span></div><div class='line' id='LC8331'><span class="cm">     * @param y1 - First y coordinate.</span></div><div class='line' id='LC8332'><span class="cm">     * @param x2 - Second x coordinate.</span></div><div class='line' id='LC8333'><span class="cm">     * @param y2 - Second y coordinate.</span></div><div class='line' id='LC8334'><span class="cm">     * @return The distance between the two points.</span></div><div class='line' id='LC8335'><span class="cm">     *</span></div><div class='line' id='LC8336'><span class="cm">     * Distance between two points.</span></div><div class='line' id='LC8337'><span class="cm">     */</span></div><div class='line' id='LC8338'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">distance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">squaredDistance</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">squaredDistance</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">);</span></div><div class='line' id='LC8340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">squaredDistance</span><span class="p">));</span></div><div class='line' id='LC8341'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8342'><br/></div><div class='line' id='LC8343'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8344'><span class="cm">     * #Crafty.math.lerp</span></div><div class='line' id='LC8345'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8346'><span class="cm">     * @sign public Number Crafty.math.lerp(Number value1, Number value2, Number amount)</span></div><div class='line' id='LC8347'><span class="cm">     * @param value1 - One value.</span></div><div class='line' id='LC8348'><span class="cm">     * @param value2 - Another value.</span></div><div class='line' id='LC8349'><span class="cm">     * @param amount - Amount of value2 to value1.</span></div><div class='line' id='LC8350'><span class="cm">     * @return Linear interpolated value.</span></div><div class='line' id='LC8351'><span class="cm">     *</span></div><div class='line' id='LC8352'><span class="cm">     * Linear interpolation. Passing amount with a value of 0 will cause value1 to be returned,</span></div><div class='line' id='LC8353'><span class="cm">     * a value of 1 will cause value2 to be returned.</span></div><div class='line' id='LC8354'><span class="cm">     */</span></div><div class='line' id='LC8355'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lerp</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value1</span><span class="p">,</span> <span class="nx">value2</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8356'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">value1</span> <span class="o">+</span> <span class="p">(</span><span class="nx">value2</span> <span class="o">-</span> <span class="nx">value1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">amount</span><span class="p">;</span></div><div class='line' id='LC8357'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8358'><br/></div><div class='line' id='LC8359'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8360'><span class="cm">     * #Crafty.math.negate</span></div><div class='line' id='LC8361'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8362'><span class="cm">     * @sign public Number Crafty.math.negate(Number percent)</span></div><div class='line' id='LC8363'><span class="cm">     * @param percent - If you pass 1 a -1 will be returned. If you pass 0 a 1 will be returned.</span></div><div class='line' id='LC8364'><span class="cm">     * @return 1 or -1.</span></div><div class='line' id='LC8365'><span class="cm">     *</span></div><div class='line' id='LC8366'><span class="cm">     * Returnes &quot;randomly&quot; -1.</span></div><div class='line' id='LC8367'><span class="cm">     */</span></div><div class='line' id='LC8368'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">negate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8369'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">percent</span><span class="p">)</span></div><div class='line' id='LC8370'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8371'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC8372'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8373'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8374'><br/></div><div class='line' id='LC8375'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8376'><span class="cm">     * #Crafty.math.radToDeg</span></div><div class='line' id='LC8377'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8378'><span class="cm">     * @sign public Number Crafty.math.radToDeg(Number angle)</span></div><div class='line' id='LC8379'><span class="cm">     * @param angleInRad - The angle in radian.</span></div><div class='line' id='LC8380'><span class="cm">     * @return The angle in degree.</span></div><div class='line' id='LC8381'><span class="cm">     *</span></div><div class='line' id='LC8382'><span class="cm">     * Converts angle from radian to degree.</span></div><div class='line' id='LC8383'><span class="cm">     */</span></div><div class='line' id='LC8384'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">radToDeg</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">angleInRad</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">angleInRad</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span></div><div class='line' id='LC8386'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8387'><br/></div><div class='line' id='LC8388'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8389'><span class="cm">     * #Crafty.math.randomElementOfArray</span></div><div class='line' id='LC8390'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8391'><span class="cm">     * @sign public Object Crafty.math.randomElementOfArray(Array array)</span></div><div class='line' id='LC8392'><span class="cm">     * @param array - A specific array.</span></div><div class='line' id='LC8393'><span class="cm">     * @return A random element of a specific array.</span></div><div class='line' id='LC8394'><span class="cm">     *</span></div><div class='line' id='LC8395'><span class="cm">     * Returns a random element of a specific array.</span></div><div class='line' id='LC8396'><span class="cm">     */</span></div><div class='line' id='LC8397'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">randomElementOfArray</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())];</span></div><div class='line' id='LC8399'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8400'><br/></div><div class='line' id='LC8401'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8402'><span class="cm">     * #Crafty.math.randomInt</span></div><div class='line' id='LC8403'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8404'><span class="cm">     * @sign public Number Crafty.math.randomInt(Number start, Number end)</span></div><div class='line' id='LC8405'><span class="cm">     * @param start - Smallest int value that can be returned.</span></div><div class='line' id='LC8406'><span class="cm">     * @param end - Biggest int value that can be returned.</span></div><div class='line' id='LC8407'><span class="cm">     * @return A random int.</span></div><div class='line' id='LC8408'><span class="cm">     *</span></div><div class='line' id='LC8409'><span class="cm">     * Returns a random int in within a specific range.</span></div><div class='line' id='LC8410'><span class="cm">     */</span></div><div class='line' id='LC8411'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">randomInt</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">start</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span></div><div class='line' id='LC8413'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8414'><br/></div><div class='line' id='LC8415'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8416'><span class="cm">     * #Crafty.math.randomNumber</span></div><div class='line' id='LC8417'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8418'><span class="cm">     * @sign public Number Crafty.math.randomInt(Number start, Number end)</span></div><div class='line' id='LC8419'><span class="cm">     * @param start - Smallest number value that can be returned.</span></div><div class='line' id='LC8420'><span class="cm">     * @param end - Biggest number value that can be returned.</span></div><div class='line' id='LC8421'><span class="cm">     * @return A random number.</span></div><div class='line' id='LC8422'><span class="cm">     *</span></div><div class='line' id='LC8423'><span class="cm">     * Returns a random number in within a specific range.</span></div><div class='line' id='LC8424'><span class="cm">     */</span></div><div class='line' id='LC8425'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">randomNumber</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">start</span> <span class="o">+</span> <span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span></div><div class='line' id='LC8427'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8428'><br/></div><div class='line' id='LC8429'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8430'><span class="cm">     * #Crafty.math.squaredDistance</span></div><div class='line' id='LC8431'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8432'><span class="cm">     * @sign public Number Crafty.math.squaredDistance(Number x1, Number y1, Number x2, Number y2)</span></div><div class='line' id='LC8433'><span class="cm">     * @param x1 - First x coordinate.</span></div><div class='line' id='LC8434'><span class="cm">     * @param y1 - First y coordinate.</span></div><div class='line' id='LC8435'><span class="cm">     * @param x2 - Second x coordinate.</span></div><div class='line' id='LC8436'><span class="cm">     * @param y2 - Second y coordinate.</span></div><div class='line' id='LC8437'><span class="cm">     * @return The squared distance between the two points.</span></div><div class='line' id='LC8438'><span class="cm">     *</span></div><div class='line' id='LC8439'><span class="cm">     * Squared distance between two points.</span></div><div class='line' id='LC8440'><span class="cm">     */</span></div><div class='line' id='LC8441'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">squaredDistance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">x1</span> <span class="o">-</span> <span class="nx">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x1</span> <span class="o">-</span> <span class="nx">x2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y2</span><span class="p">);</span></div><div class='line' id='LC8443'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC8444'><br/></div><div class='line' id='LC8445'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8446'><span class="cm">     * #Crafty.math.withinRange</span></div><div class='line' id='LC8447'><span class="cm">     * @comp Crafty.math</span></div><div class='line' id='LC8448'><span class="cm">     * @sign public Boolean Crafty.math.withinRange(Number value, Number min, Number max)</span></div><div class='line' id='LC8449'><span class="cm">     * @param value - The specific value.</span></div><div class='line' id='LC8450'><span class="cm">     * @param min - Minimum value.</span></div><div class='line' id='LC8451'><span class="cm">     * @param max - Maximum value.</span></div><div class='line' id='LC8452'><span class="cm">     * @return Returns true if value is within a specific range.</span></div><div class='line' id='LC8453'><span class="cm">     *</span></div><div class='line' id='LC8454'><span class="cm">     * Check if a value is within a specific range.</span></div><div class='line' id='LC8455'><span class="cm">     */</span></div><div class='line' id='LC8456'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">withinRange</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">min</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">max</span><span class="p">);</span></div><div class='line' id='LC8458'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC8459'><span class="p">};</span></div><div class='line' id='LC8460'><br/></div><div class='line' id='LC8461'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">Vector2D</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8462'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8463'><span class="cm">     * #Crafty.math.Vector2D</span></div><div class='line' id='LC8464'><span class="cm">     * @category 2D</span></div><div class='line' id='LC8465'><span class="cm">     * @class This is a general purpose 2D vector class</span></div><div class='line' id='LC8466'><span class="cm">     *</span></div><div class='line' id='LC8467'><span class="cm">     * Vector2D uses the following form:</span></div><div class='line' id='LC8468'><span class="cm">     * &lt;x, y&gt;</span></div><div class='line' id='LC8469'><span class="cm">     *</span></div><div class='line' id='LC8470'><span class="cm">     * @public</span></div><div class='line' id='LC8471'><span class="cm">     * @sign public {Vector2D} Vector2D();</span></div><div class='line' id='LC8472'><span class="cm">     * @sign public {Vector2D} Vector2D(Vector2D);</span></div><div class='line' id='LC8473'><span class="cm">     * @sign public {Vector2D} Vector2D(Number, Number);</span></div><div class='line' id='LC8474'><span class="cm">     * @param {Vector2D|Number=0} x</span></div><div class='line' id='LC8475'><span class="cm">     * @param {Number=0} y</span></div><div class='line' id='LC8476'><span class="cm">     */</span></div><div class='line' id='LC8477'><br/></div><div class='line' id='LC8478'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">Vector2D</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">Vector2D</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8480'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC8486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="s2">&quot;Unexpected number of arguments for Vector2D()&quot;</span><span class="p">;</span></div><div class='line' id='LC8487'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// class Vector2D</span></div><div class='line' id='LC8488'><br/></div><div class='line' id='LC8489'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8490'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8491'><br/></div><div class='line' id='LC8492'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8493'><span class="cm">     * #.add</span></div><div class='line' id='LC8494'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8495'><span class="cm">     *</span></div><div class='line' id='LC8496'><span class="cm">     * Adds the passed vector to this vector</span></div><div class='line' id='LC8497'><span class="cm">     *</span></div><div class='line' id='LC8498'><span class="cm">     * @public</span></div><div class='line' id='LC8499'><span class="cm">     * @sign public {Vector2D} add(Vector2D);</span></div><div class='line' id='LC8500'><span class="cm">     * @param {vector2D} vecRH</span></div><div class='line' id='LC8501'><span class="cm">     * @returns {Vector2D} this after adding</span></div><div class='line' id='LC8502'><span class="cm">     */</span></div><div class='line' id='LC8503'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8507'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// add</span></div><div class='line' id='LC8508'><br/></div><div class='line' id='LC8509'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8510'><span class="cm">     * #.angleBetween</span></div><div class='line' id='LC8511'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8512'><span class="cm">     *</span></div><div class='line' id='LC8513'><span class="cm">     * Calculates the angle between the passed vector and this vector, using &lt;0,0&gt; as the point of reference.</span></div><div class='line' id='LC8514'><span class="cm">     * Angles returned have the range (âÏ, Ï].</span></div><div class='line' id='LC8515'><span class="cm">     *</span></div><div class='line' id='LC8516'><span class="cm">     * @public</span></div><div class='line' id='LC8517'><span class="cm">     * @sign public {Number} angleBetween(Vector2D);</span></div><div class='line' id='LC8518'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8519'><span class="cm">     * @returns {Number} the angle between the two vectors in radians</span></div><div class='line' id='LC8520'><span class="cm">     */</span></div><div class='line' id='LC8521'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">angleBetween</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC8523'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// angleBetween</span></div><div class='line' id='LC8524'><br/></div><div class='line' id='LC8525'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8526'><span class="cm">     * #.angleTo</span></div><div class='line' id='LC8527'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8528'><span class="cm">     *</span></div><div class='line' id='LC8529'><span class="cm">     * Calculates the angle to the passed vector from this vector, using this vector as the point of reference.</span></div><div class='line' id='LC8530'><span class="cm">     *</span></div><div class='line' id='LC8531'><span class="cm">     * @public</span></div><div class='line' id='LC8532'><span class="cm">     * @sign public {Number} angleTo(Vector2D);</span></div><div class='line' id='LC8533'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8534'><span class="cm">     * @returns {Number} the angle to the passed vector in radians</span></div><div class='line' id='LC8535'><span class="cm">     */</span></div><div class='line' id='LC8536'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">angleTo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span></div><div class='line' id='LC8538'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8539'><br/></div><div class='line' id='LC8540'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8541'><span class="cm">     * #.clone</span></div><div class='line' id='LC8542'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8543'><span class="cm">     *</span></div><div class='line' id='LC8544'><span class="cm">     * Creates and exact, numeric copy of this vector</span></div><div class='line' id='LC8545'><span class="cm">     *</span></div><div class='line' id='LC8546'><span class="cm">     * @public</span></div><div class='line' id='LC8547'><span class="cm">     * @sign public {Vector2D} clone();</span></div><div class='line' id='LC8548'><span class="cm">     * @returns {Vector2D} the new vector</span></div><div class='line' id='LC8549'><span class="cm">     */</span></div><div class='line' id='LC8550'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clone</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8551'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Vector2D</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC8552'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// clone</span></div><div class='line' id='LC8553'><br/></div><div class='line' id='LC8554'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8555'><span class="cm">     * #.distance</span></div><div class='line' id='LC8556'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8557'><span class="cm">     *</span></div><div class='line' id='LC8558'><span class="cm">     * Calculates the distance from this vector to the passed vector.</span></div><div class='line' id='LC8559'><span class="cm">     *</span></div><div class='line' id='LC8560'><span class="cm">     * @public</span></div><div class='line' id='LC8561'><span class="cm">     * @sign public {Number} distance(Vector2D);</span></div><div class='line' id='LC8562'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8563'><span class="cm">     * @returns {Number} the distance between the two vectors</span></div><div class='line' id='LC8564'><span class="cm">     */</span></div><div class='line' id='LC8565'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">distance</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8566'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span></div><div class='line' id='LC8567'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// distance</span></div><div class='line' id='LC8568'><br/></div><div class='line' id='LC8569'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8570'><span class="cm">     * #.distanceSq</span></div><div class='line' id='LC8571'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8572'><span class="cm">     *</span></div><div class='line' id='LC8573'><span class="cm">     * Calculates the squared distance from this vector to the passed vector.</span></div><div class='line' id='LC8574'><span class="cm">     * This function avoids calculating the square root, thus being slightly faster than .distance( ).</span></div><div class='line' id='LC8575'><span class="cm">     *</span></div><div class='line' id='LC8576'><span class="cm">     * @public</span></div><div class='line' id='LC8577'><span class="cm">     * @sign public {Number} distanceSq(Vector2D);</span></div><div class='line' id='LC8578'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8579'><span class="cm">     * @returns {Number} the squared distance between the two vectors</span></div><div class='line' id='LC8580'><span class="cm">     * @see .distance</span></div><div class='line' id='LC8581'><span class="cm">     */</span></div><div class='line' id='LC8582'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">distanceSq</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8583'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC8584'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// distanceSq</span></div><div class='line' id='LC8585'><br/></div><div class='line' id='LC8586'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8587'><span class="cm">     * #.divide</span></div><div class='line' id='LC8588'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8589'><span class="cm">     *</span></div><div class='line' id='LC8590'><span class="cm">     * Divides this vector by the passed vector.</span></div><div class='line' id='LC8591'><span class="cm">     *</span></div><div class='line' id='LC8592'><span class="cm">     * @public</span></div><div class='line' id='LC8593'><span class="cm">     * @sign public {Vector2D} divide(Vector2D);</span></div><div class='line' id='LC8594'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8595'><span class="cm">     * @returns {Vector2D} this vector after dividing</span></div><div class='line' id='LC8596'><span class="cm">     */</span></div><div class='line' id='LC8597'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">divide</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">/=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8601'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// divide</span></div><div class='line' id='LC8602'><br/></div><div class='line' id='LC8603'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8604'><span class="cm">     * #.dotProduct</span></div><div class='line' id='LC8605'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8606'><span class="cm">     *</span></div><div class='line' id='LC8607'><span class="cm">     * Calculates the dot product of this and the passed vectors</span></div><div class='line' id='LC8608'><span class="cm">     *</span></div><div class='line' id='LC8609'><span class="cm">     * @public</span></div><div class='line' id='LC8610'><span class="cm">     * @sign public {Number} dotProduct(Vector2D);</span></div><div class='line' id='LC8611'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8612'><span class="cm">     * @returns {Number} the resultant dot product</span></div><div class='line' id='LC8613'><span class="cm">     */</span></div><div class='line' id='LC8614'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dotProduct</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8615'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8616'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// dotProduct</span></div><div class='line' id='LC8617'><br/></div><div class='line' id='LC8618'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8619'><span class="cm">     * #.equals</span></div><div class='line' id='LC8620'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8621'><span class="cm">     *</span></div><div class='line' id='LC8622'><span class="cm">     * Determines if this vector is numerically equivalent to the passed vector.</span></div><div class='line' id='LC8623'><span class="cm">     *</span></div><div class='line' id='LC8624'><span class="cm">     * @public</span></div><div class='line' id='LC8625'><span class="cm">     * @sign public {Boolean} equals(Vector2D);</span></div><div class='line' id='LC8626'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8627'><span class="cm">     * @returns {Boolean} true if the vectors are equivalent</span></div><div class='line' id='LC8628'><span class="cm">     */</span></div><div class='line' id='LC8629'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equals</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">vecRH</span> <span class="k">instanceof</span> <span class="nx">Vector2D</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC8631'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">==</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">==</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8632'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// equals</span></div><div class='line' id='LC8633'><br/></div><div class='line' id='LC8634'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8635'><span class="cm">     * #.getNormal</span></div><div class='line' id='LC8636'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8637'><span class="cm">     *</span></div><div class='line' id='LC8638'><span class="cm">     * Calculates a new right-handed normal vector for the line created by this and the passed vectors.</span></div><div class='line' id='LC8639'><span class="cm">     *</span></div><div class='line' id='LC8640'><span class="cm">     * @public</span></div><div class='line' id='LC8641'><span class="cm">     * @sign public {Vector2D} getNormal([Vector2D]);</span></div><div class='line' id='LC8642'><span class="cm">     * @param {Vector2D=&lt;0,0&gt;} [vecRH]</span></div><div class='line' id='LC8643'><span class="cm">     * @returns {Vector2D} the new normal vector</span></div><div class='line' id='LC8644'><span class="cm">     */</span></div><div class='line' id='LC8645'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNormal</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8646'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">vecRH</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC8647'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Vector2D</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// assume vecRH is &lt;0, 0&gt;</span></div><div class='line' id='LC8648'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Vector2D</span><span class="p">(</span><span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">).</span><span class="nx">normalize</span><span class="p">();</span></div><div class='line' id='LC8649'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// getNormal</span></div><div class='line' id='LC8650'><br/></div><div class='line' id='LC8651'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8652'><span class="cm">     * #.isZero</span></div><div class='line' id='LC8653'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8654'><span class="cm">     *</span></div><div class='line' id='LC8655'><span class="cm">     * Determines if this vector is equal to &lt;0,0&gt;</span></div><div class='line' id='LC8656'><span class="cm">     *</span></div><div class='line' id='LC8657'><span class="cm">     * @public</span></div><div class='line' id='LC8658'><span class="cm">     * @sign public {Boolean} isZero();</span></div><div class='line' id='LC8659'><span class="cm">     * @returns {Boolean} true if this vector is equal to &lt;0,0&gt;</span></div><div class='line' id='LC8660'><span class="cm">     */</span></div><div class='line' id='LC8661'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isZero</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8662'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8663'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// isZero</span></div><div class='line' id='LC8664'><br/></div><div class='line' id='LC8665'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8666'><span class="cm">     * #.magnitude</span></div><div class='line' id='LC8667'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8668'><span class="cm">     *</span></div><div class='line' id='LC8669'><span class="cm">     * Calculates the magnitude of this vector.</span></div><div class='line' id='LC8670'><span class="cm">     * Note: Function objects in JavaScript already have a &#39;length&#39; member, hence the use of magnitude instead.</span></div><div class='line' id='LC8671'><span class="cm">     *</span></div><div class='line' id='LC8672'><span class="cm">     * @public</span></div><div class='line' id='LC8673'><span class="cm">     * @sign public {Number} magnitude();</span></div><div class='line' id='LC8674'><span class="cm">     * @returns {Number} the magnitude of this vector</span></div><div class='line' id='LC8675'><span class="cm">     */</span></div><div class='line' id='LC8676'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">magnitude</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC8678'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// magnitude</span></div><div class='line' id='LC8679'><br/></div><div class='line' id='LC8680'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8681'><span class="cm">     * #.magnitudeSq</span></div><div class='line' id='LC8682'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8683'><span class="cm">     *</span></div><div class='line' id='LC8684'><span class="cm">     * Calculates the square of the magnitude of this vector.</span></div><div class='line' id='LC8685'><span class="cm">     * This function avoids calculating the square root, thus being slightly faster than .magnitude( ).</span></div><div class='line' id='LC8686'><span class="cm">     *</span></div><div class='line' id='LC8687'><span class="cm">     * @public</span></div><div class='line' id='LC8688'><span class="cm">     * @sign public {Number} magnitudeSq();</span></div><div class='line' id='LC8689'><span class="cm">     * @returns {Number} the square of the magnitude of this vector</span></div><div class='line' id='LC8690'><span class="cm">     * @see .magnitude</span></div><div class='line' id='LC8691'><span class="cm">     */</span></div><div class='line' id='LC8692'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">magnitudeSq</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8693'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8694'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// magnitudeSq</span></div><div class='line' id='LC8695'><br/></div><div class='line' id='LC8696'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8697'><span class="cm">     * #.multiply</span></div><div class='line' id='LC8698'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8699'><span class="cm">     *</span></div><div class='line' id='LC8700'><span class="cm">     * Multiplies this vector by the passed vector</span></div><div class='line' id='LC8701'><span class="cm">     *</span></div><div class='line' id='LC8702'><span class="cm">     * @public</span></div><div class='line' id='LC8703'><span class="cm">     * @sign public {Vector2D} multiply(Vector2D);</span></div><div class='line' id='LC8704'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8705'><span class="cm">     * @returns {Vector2D} this vector after multiplying</span></div><div class='line' id='LC8706'><span class="cm">     */</span></div><div class='line' id='LC8707'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">multiply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8708'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8709'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8710'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8711'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// multiply</span></div><div class='line' id='LC8712'><br/></div><div class='line' id='LC8713'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8714'><span class="cm">     * #.negate</span></div><div class='line' id='LC8715'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8716'><span class="cm">     *</span></div><div class='line' id='LC8717'><span class="cm">     * Negates this vector (ie. &lt;-x,-y&gt;)</span></div><div class='line' id='LC8718'><span class="cm">     *</span></div><div class='line' id='LC8719'><span class="cm">     * @public</span></div><div class='line' id='LC8720'><span class="cm">     * @sign public {Vector2D} negate();</span></div><div class='line' id='LC8721'><span class="cm">     * @returns {Vector2D} this vector after negation</span></div><div class='line' id='LC8722'><span class="cm">     */</span></div><div class='line' id='LC8723'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">negate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8724'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8725'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8726'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8727'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// negate</span></div><div class='line' id='LC8728'><br/></div><div class='line' id='LC8729'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8730'><span class="cm">     * #.normalize</span></div><div class='line' id='LC8731'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8732'><span class="cm">     *</span></div><div class='line' id='LC8733'><span class="cm">     * Normalizes this vector (scales the vector so that its new magnitude is 1)</span></div><div class='line' id='LC8734'><span class="cm">     * For vectors where magnitude is 0, &lt;1,0&gt; is returned.</span></div><div class='line' id='LC8735'><span class="cm">     *</span></div><div class='line' id='LC8736'><span class="cm">     * @public</span></div><div class='line' id='LC8737'><span class="cm">     * @sign public {Vector2D} normalize();</span></div><div class='line' id='LC8738'><span class="cm">     * @returns {Vector2D} this vector after normalization</span></div><div class='line' id='LC8739'><span class="cm">     */</span></div><div class='line' id='LC8740'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">normalize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">lng</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span></div><div class='line' id='LC8742'><br/></div><div class='line' id='LC8743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">lng</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8744'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// default due East</span></div><div class='line' id='LC8745'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8746'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8747'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC8748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">/=</span> <span class="nx">lng</span><span class="p">;</span></div><div class='line' id='LC8749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">/=</span> <span class="nx">lng</span><span class="p">;</span></div><div class='line' id='LC8750'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// else</span></div><div class='line' id='LC8751'><br/></div><div class='line' id='LC8752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8753'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// normalize</span></div><div class='line' id='LC8754'><br/></div><div class='line' id='LC8755'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8756'><span class="cm">     * #.scale</span></div><div class='line' id='LC8757'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8758'><span class="cm">     *</span></div><div class='line' id='LC8759'><span class="cm">     * Scales this vector by the passed amount(s)</span></div><div class='line' id='LC8760'><span class="cm">     * If scalarY is omitted, scalarX is used for both axes</span></div><div class='line' id='LC8761'><span class="cm">     *</span></div><div class='line' id='LC8762'><span class="cm">     * @public</span></div><div class='line' id='LC8763'><span class="cm">     * @sign public {Vector2D} scale(Number[, Number]);</span></div><div class='line' id='LC8764'><span class="cm">     * @param {Number} scalarX</span></div><div class='line' id='LC8765'><span class="cm">     * @param {Number} [scalarY]</span></div><div class='line' id='LC8766'><span class="cm">     * @returns {Vector2D} this after scaling</span></div><div class='line' id='LC8767'><span class="cm">     */</span></div><div class='line' id='LC8768'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scalarX</span><span class="p">,</span> <span class="nx">scalarY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scalarY</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC8770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scalarY</span> <span class="o">=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC8771'><br/></div><div class='line' id='LC8772'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC8773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC8774'><br/></div><div class='line' id='LC8775'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8776'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// scale</span></div><div class='line' id='LC8777'><br/></div><div class='line' id='LC8778'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8779'><span class="cm">     * #.scaleToMagnitude</span></div><div class='line' id='LC8780'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8781'><span class="cm">     *</span></div><div class='line' id='LC8782'><span class="cm">     * Scales this vector such that its new magnitude is equal to the passed value.</span></div><div class='line' id='LC8783'><span class="cm">     *</span></div><div class='line' id='LC8784'><span class="cm">     * @public</span></div><div class='line' id='LC8785'><span class="cm">     * @sign public {Vector2D} scaleToMagnitude(Number);</span></div><div class='line' id='LC8786'><span class="cm">     * @param {Number} mag</span></div><div class='line' id='LC8787'><span class="cm">     * @returns {Vector2D} this vector after scaling</span></div><div class='line' id='LC8788'><span class="cm">     */</span></div><div class='line' id='LC8789'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">scaleToMagnitude</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mag</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8790'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">mag</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">magnitude</span><span class="p">();</span></div><div class='line' id='LC8791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="nx">k</span><span class="p">;</span></div><div class='line' id='LC8792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="nx">k</span><span class="p">;</span></div><div class='line' id='LC8793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8794'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// scaleToMagnitude</span></div><div class='line' id='LC8795'><br/></div><div class='line' id='LC8796'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8797'><span class="cm">     * #.setValues</span></div><div class='line' id='LC8798'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8799'><span class="cm">     *</span></div><div class='line' id='LC8800'><span class="cm">     * Sets the values of this vector using a passed vector or pair of numbers.</span></div><div class='line' id='LC8801'><span class="cm">     *</span></div><div class='line' id='LC8802'><span class="cm">     * @public</span></div><div class='line' id='LC8803'><span class="cm">     * @sign public {Vector2D} setValues(Vector2D);</span></div><div class='line' id='LC8804'><span class="cm">     * @sign public {Vector2D} setValues(Number, Number);</span></div><div class='line' id='LC8805'><span class="cm">     * @param {Number|Vector2D} x</span></div><div class='line' id='LC8806'><span class="cm">     * @param {Number} y</span></div><div class='line' id='LC8807'><span class="cm">     * @returns {Vector2D} this vector after setting of values</span></div><div class='line' id='LC8808'><span class="cm">     */</span></div><div class='line' id='LC8809'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValues</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8810'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">Vector2D</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8811'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8812'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC8814'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8816'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// else</span></div><div class='line' id='LC8817'><br/></div><div class='line' id='LC8818'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8819'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// setValues</span></div><div class='line' id='LC8820'><br/></div><div class='line' id='LC8821'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8822'><span class="cm">     * #.subtract</span></div><div class='line' id='LC8823'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8824'><span class="cm">     *</span></div><div class='line' id='LC8825'><span class="cm">     * Subtracts the passed vector from this vector.</span></div><div class='line' id='LC8826'><span class="cm">     *</span></div><div class='line' id='LC8827'><span class="cm">     * @public</span></div><div class='line' id='LC8828'><span class="cm">     * @sign public {Vector2D} subtract(Vector2D);</span></div><div class='line' id='LC8829'><span class="cm">     * @param {Vector2D} vecRH</span></div><div class='line' id='LC8830'><span class="cm">     * @returns {vector2D} this vector after subtracting</span></div><div class='line' id='LC8831'><span class="cm">     */</span></div><div class='line' id='LC8832'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">subtract</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8833'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC8835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8836'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// subtract</span></div><div class='line' id='LC8837'><br/></div><div class='line' id='LC8838'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8839'><span class="cm">     * #.toString</span></div><div class='line' id='LC8840'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8841'><span class="cm">     *</span></div><div class='line' id='LC8842'><span class="cm">     * Returns a string representation of this vector.</span></div><div class='line' id='LC8843'><span class="cm">     *</span></div><div class='line' id='LC8844'><span class="cm">     * @public</span></div><div class='line' id='LC8845'><span class="cm">     * @sign public {String} toString();</span></div><div class='line' id='LC8846'><span class="cm">     * @returns {String}</span></div><div class='line' id='LC8847'><span class="cm">     */</span></div><div class='line' id='LC8848'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="s2">&quot;Vector2D(&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span></div><div class='line' id='LC8850'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// toString</span></div><div class='line' id='LC8851'><br/></div><div class='line' id='LC8852'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8853'><span class="cm">     * #.translate</span></div><div class='line' id='LC8854'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8855'><span class="cm">     *</span></div><div class='line' id='LC8856'><span class="cm">     * Translates (moves) this vector by the passed amounts.</span></div><div class='line' id='LC8857'><span class="cm">     * If dy is omitted, dx is used for both axes.</span></div><div class='line' id='LC8858'><span class="cm">     *</span></div><div class='line' id='LC8859'><span class="cm">     * @public</span></div><div class='line' id='LC8860'><span class="cm">     * @sign public {Vector2D} translate(Number[, Number]);</span></div><div class='line' id='LC8861'><span class="cm">     * @param {Number} dx</span></div><div class='line' id='LC8862'><span class="cm">     * @param {Number} [dy]</span></div><div class='line' id='LC8863'><span class="cm">     * @returns {Vector2D} this vector after translating</span></div><div class='line' id='LC8864'><span class="cm">     */</span></div><div class='line' id='LC8865'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">translate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8866'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dy</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC8867'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dy</span> <span class="o">=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC8868'><br/></div><div class='line' id='LC8869'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC8870'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC8871'><br/></div><div class='line' id='LC8872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC8873'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// translate</span></div><div class='line' id='LC8874'><br/></div><div class='line' id='LC8875'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8876'><span class="cm">     * #.tripleProduct</span></div><div class='line' id='LC8877'><span class="cm">     * @comp Crafty.math.Vector2D</span></div><div class='line' id='LC8878'><span class="cm">     *</span></div><div class='line' id='LC8879'><span class="cm">     * Calculates the triple product of three vectors.</span></div><div class='line' id='LC8880'><span class="cm">     * triple vector product = b(aâ¢c) - a(bâ¢c)</span></div><div class='line' id='LC8881'><span class="cm">     *</span></div><div class='line' id='LC8882'><span class="cm">     * @public</span></div><div class='line' id='LC8883'><span class="cm">     * @static</span></div><div class='line' id='LC8884'><span class="cm">     * @sign public {Vector2D} tripleProduct(Vector2D, Vector2D, Vector2D);</span></div><div class='line' id='LC8885'><span class="cm">     * @param {Vector2D} a</span></div><div class='line' id='LC8886'><span class="cm">     * @param {Vector2D} b</span></div><div class='line' id='LC8887'><span class="cm">     * @param {Vector2D} c</span></div><div class='line' id='LC8888'><span class="cm">     * @return {Vector2D} the triple product as a new vector</span></div><div class='line' id='LC8889'><span class="cm">     */</span></div><div class='line' id='LC8890'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Vector2D</span><span class="p">.</span><span class="nx">tripleProduct</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8891'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ac</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">dotProduct</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC8892'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">bc</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">dotProduct</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC8893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">Vector2D</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">ac</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">bc</span><span class="p">,</span> <span class="nx">b</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">ac</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">bc</span><span class="p">);</span></div><div class='line' id='LC8894'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC8895'><br/></div><div class='line' id='LC8896'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Vector2D</span><span class="p">;</span></div><div class='line' id='LC8897'><span class="p">})();</span></div><div class='line' id='LC8898'><br/></div><div class='line' id='LC8899'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">Matrix2D</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8900'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8901'><span class="cm">     * #Crafty.math.Matrix2D</span></div><div class='line' id='LC8902'><span class="cm">     * @category 2D</span></div><div class='line' id='LC8903'><span class="cm">     *</span></div><div class='line' id='LC8904'><span class="cm">     * @class This is a 2D Matrix2D class. It is 3x3 to allow for affine transformations in 2D space.</span></div><div class='line' id='LC8905'><span class="cm">     * The third row is always assumed to be [0, 0, 1].</span></div><div class='line' id='LC8906'><span class="cm">     *</span></div><div class='line' id='LC8907'><span class="cm">     * Matrix2D uses the following form, as per the whatwg.org specifications for canvas.transform():</span></div><div class='line' id='LC8908'><span class="cm">     * [a, c, e]</span></div><div class='line' id='LC8909'><span class="cm">     * [b, d, f]</span></div><div class='line' id='LC8910'><span class="cm">     * [0, 0, 1]</span></div><div class='line' id='LC8911'><span class="cm">     *</span></div><div class='line' id='LC8912'><span class="cm">     * @public</span></div><div class='line' id='LC8913'><span class="cm">     * @sign public {Matrix2D} new Matrix2D();</span></div><div class='line' id='LC8914'><span class="cm">     * @sign public {Matrix2D} new Matrix2D(Matrix2D);</span></div><div class='line' id='LC8915'><span class="cm">     * @sign public {Matrix2D} new Matrix2D(Number, Number, Number, Number, Number, Number);</span></div><div class='line' id='LC8916'><span class="cm">     * @param {Matrix2D|Number=1} a</span></div><div class='line' id='LC8917'><span class="cm">     * @param {Number=0} b</span></div><div class='line' id='LC8918'><span class="cm">     * @param {Number=0} c</span></div><div class='line' id='LC8919'><span class="cm">     * @param {Number=1} d</span></div><div class='line' id='LC8920'><span class="cm">     * @param {Number=0} e</span></div><div class='line' id='LC8921'><span class="cm">     * @param {Number=0} f</span></div><div class='line' id='LC8922'><span class="cm">     */</span></div><div class='line' id='LC8923'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="k">instanceof</span> <span class="nx">Matrix2D</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC8926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC8927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC8928'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC8929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC8930'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC8931'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8932'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC8933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC8934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC8935'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC8936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC8937'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC8938'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC8939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="s2">&quot;Unexpected number of arguments for Matrix2D()&quot;</span><span class="p">;</span></div><div class='line' id='LC8940'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// class Matrix2D</span></div><div class='line' id='LC8941'><br/></div><div class='line' id='LC8942'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8943'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8944'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8945'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC8946'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8947'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC8948'><br/></div><div class='line' id='LC8949'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8950'><span class="cm">     * #.apply</span></div><div class='line' id='LC8951'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC8952'><span class="cm">     *</span></div><div class='line' id='LC8953'><span class="cm">     * Applies the matrix transformations to the passed object</span></div><div class='line' id='LC8954'><span class="cm">     *</span></div><div class='line' id='LC8955'><span class="cm">     * @public</span></div><div class='line' id='LC8956'><span class="cm">     * @sign public {Vector2D} apply(Vector2D);</span></div><div class='line' id='LC8957'><span class="cm">     * @param {Vector2D} vecRH - vector to be transformed</span></div><div class='line' id='LC8958'><span class="cm">     * @returns {Vector2D} the passed vector object after transforming</span></div><div class='line' id='LC8959'><span class="cm">     */</span></div><div class='line' id='LC8960'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vecRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC8961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// I&#39;m not sure of the best way for this function to be implemented. Ideally</span></div><div class='line' id='LC8962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// support for other objects (rectangles, polygons, etc) should be easily</span></div><div class='line' id='LC8963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// addable in the future. Maybe a function (apply) is not the best way to do</span></div><div class='line' id='LC8964'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// this...?</span></div><div class='line' id='LC8965'><br/></div><div class='line' id='LC8966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tmpX</span> <span class="o">=</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC8967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vecRH</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">tmpX</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC8968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">tmpX</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="nx">vecRH</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC8969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// no need to homogenize since the third row is always [0, 0, 1]</span></div><div class='line' id='LC8970'><br/></div><div class='line' id='LC8971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">vecRH</span><span class="p">;</span></div><div class='line' id='LC8972'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// apply</span></div><div class='line' id='LC8973'><br/></div><div class='line' id='LC8974'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8975'><span class="cm">     * #.clone</span></div><div class='line' id='LC8976'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC8977'><span class="cm">     *</span></div><div class='line' id='LC8978'><span class="cm">     * Creates an exact, numeric copy of the current matrix</span></div><div class='line' id='LC8979'><span class="cm">     *</span></div><div class='line' id='LC8980'><span class="cm">     * @public</span></div><div class='line' id='LC8981'><span class="cm">     * @sign public {Matrix2D} clone();</span></div><div class='line' id='LC8982'><span class="cm">     * @returns {Matrix2D}</span></div><div class='line' id='LC8983'><span class="cm">     */</span></div><div class='line' id='LC8984'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clone</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC8985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">new</span> <span class="nx">Matrix2D</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC8986'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// clone</span></div><div class='line' id='LC8987'><br/></div><div class='line' id='LC8988'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC8989'><span class="cm">     * #.combine</span></div><div class='line' id='LC8990'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC8991'><span class="cm">     *</span></div><div class='line' id='LC8992'><span class="cm">     * Multiplies this matrix with another, overriding the values of this matrix.</span></div><div class='line' id='LC8993'><span class="cm">     * The passed matrix is assumed to be on the right-hand side.</span></div><div class='line' id='LC8994'><span class="cm">     *</span></div><div class='line' id='LC8995'><span class="cm">     * @public</span></div><div class='line' id='LC8996'><span class="cm">     * @sign public {Matrix2D} combine(Matrix2D);</span></div><div class='line' id='LC8997'><span class="cm">     * @param {Matrix2D} mtrxRH</span></div><div class='line' id='LC8998'><span class="cm">     * @returns {Matrix2D} this matrix after combination</span></div><div class='line' id='LC8999'><span class="cm">     */</span></div><div class='line' id='LC9000'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">combine</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mtrxRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9001'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC9002'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9003'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9005'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC9008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">c</span> <span class="o">+</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC9009'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">tmp</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">*</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">d</span> <span class="o">+</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9010'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9011'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// combine</span></div><div class='line' id='LC9012'><br/></div><div class='line' id='LC9013'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9014'><span class="cm">     * #.equals</span></div><div class='line' id='LC9015'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9016'><span class="cm">     *</span></div><div class='line' id='LC9017'><span class="cm">     * Checks for the numeric equality of this matrix versus another.</span></div><div class='line' id='LC9018'><span class="cm">     *</span></div><div class='line' id='LC9019'><span class="cm">     * @public</span></div><div class='line' id='LC9020'><span class="cm">     * @sign public {Boolean} equals(Matrix2D);</span></div><div class='line' id='LC9021'><span class="cm">     * @param {Matrix2D} mtrxRH</span></div><div class='line' id='LC9022'><span class="cm">     * @returns {Boolean} true if the two matrices are numerically equal</span></div><div class='line' id='LC9023'><span class="cm">     */</span></div><div class='line' id='LC9024'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">equals</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mtrxRH</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">mtrxRH</span> <span class="k">instanceof</span> <span class="nx">Matrix2D</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC9026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">c</span> <span class="o">&amp;&amp;</span></div><div class='line' id='LC9027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">d</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">==</span> <span class="nx">mtrxRH</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9028'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// equals</span></div><div class='line' id='LC9029'><br/></div><div class='line' id='LC9030'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9031'><span class="cm">     * #.determinant</span></div><div class='line' id='LC9032'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9033'><span class="cm">     *</span></div><div class='line' id='LC9034'><span class="cm">     * Calculates the determinant of this matrix</span></div><div class='line' id='LC9035'><span class="cm">     *</span></div><div class='line' id='LC9036'><span class="cm">     * @public</span></div><div class='line' id='LC9037'><span class="cm">     * @sign public {Number} determinant();</span></div><div class='line' id='LC9038'><span class="cm">     * @returns {Number} det(this matrix)</span></div><div class='line' id='LC9039'><span class="cm">     */</span></div><div class='line' id='LC9040'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">determinant</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9042'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// determinant</span></div><div class='line' id='LC9043'><br/></div><div class='line' id='LC9044'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9045'><span class="cm">     * #.invert</span></div><div class='line' id='LC9046'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9047'><span class="cm">     *</span></div><div class='line' id='LC9048'><span class="cm">     * Inverts this matrix if possible</span></div><div class='line' id='LC9049'><span class="cm">     *</span></div><div class='line' id='LC9050'><span class="cm">     * @public</span></div><div class='line' id='LC9051'><span class="cm">     * @sign public {Matrix2D} invert();</span></div><div class='line' id='LC9052'><span class="cm">     * @returns {Matrix2D} this inverted matrix or the original matrix on failure</span></div><div class='line' id='LC9053'><span class="cm">     * @see .isInvertible</span></div><div class='line' id='LC9054'><span class="cm">     */</span></div><div class='line' id='LC9055'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">invert</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9056'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">det</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">determinant</span><span class="p">();</span></div><div class='line' id='LC9057'><br/></div><div class='line' id='LC9058'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// matrix is invertible if its determinant is non-zero</span></div><div class='line' id='LC9059'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">det</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9060'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC9061'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span></div><div class='line' id='LC9062'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">b</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span></div><div class='line' id='LC9063'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span></div><div class='line' id='LC9064'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">d</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">,</span></div><div class='line' id='LC9065'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span><span class="p">,</span></div><div class='line' id='LC9066'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">f</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span></div><div class='line' id='LC9067'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9068'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">old</span><span class="p">.</span><span class="nx">d</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="o">-</span><span class="nx">old</span><span class="p">.</span><span class="nx">b</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="o">-</span><span class="nx">old</span><span class="p">.</span><span class="nx">c</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">old</span><span class="p">.</span><span class="nx">a</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="p">(</span><span class="nx">old</span><span class="p">.</span><span class="nx">c</span> <span class="o">*</span> <span class="nx">old</span><span class="p">.</span><span class="nx">f</span> <span class="o">-</span> <span class="nx">old</span><span class="p">.</span><span class="nx">e</span> <span class="o">*</span> <span class="nx">old</span><span class="p">.</span><span class="nx">d</span><span class="p">)</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">old</span><span class="p">.</span><span class="nx">e</span> <span class="o">*</span> <span class="nx">old</span><span class="p">.</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">old</span><span class="p">.</span><span class="nx">a</span> <span class="o">*</span> <span class="nx">old</span><span class="p">.</span><span class="nx">f</span><span class="p">)</span> <span class="o">/</span> <span class="nx">det</span><span class="p">;</span></div><div class='line' id='LC9074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// if</span></div><div class='line' id='LC9075'><br/></div><div class='line' id='LC9076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9077'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// invert</span></div><div class='line' id='LC9078'><br/></div><div class='line' id='LC9079'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9080'><span class="cm">     * #.isIdentity</span></div><div class='line' id='LC9081'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9082'><span class="cm">     *</span></div><div class='line' id='LC9083'><span class="cm">     * Returns true if this matrix is the identity matrix</span></div><div class='line' id='LC9084'><span class="cm">     *</span></div><div class='line' id='LC9085'><span class="cm">     * @public</span></div><div class='line' id='LC9086'><span class="cm">     * @sign public {Boolean} isIdentity();</span></div><div class='line' id='LC9087'><span class="cm">     * @returns {Boolean}</span></div><div class='line' id='LC9088'><span class="cm">     */</span></div><div class='line' id='LC9089'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isIdentity</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9091'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// isIdentity</span></div><div class='line' id='LC9092'><br/></div><div class='line' id='LC9093'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9094'><span class="cm">     * #.isInvertible</span></div><div class='line' id='LC9095'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9096'><span class="cm">     *</span></div><div class='line' id='LC9097'><span class="cm">     * Determines is this matrix is invertible.</span></div><div class='line' id='LC9098'><span class="cm">     *</span></div><div class='line' id='LC9099'><span class="cm">     * @public</span></div><div class='line' id='LC9100'><span class="cm">     * @sign public {Boolean} isInvertible();</span></div><div class='line' id='LC9101'><span class="cm">     * @returns {Boolean} true if this matrix is invertible</span></div><div class='line' id='LC9102'><span class="cm">     * @see .invert</span></div><div class='line' id='LC9103'><span class="cm">     */</span></div><div class='line' id='LC9104'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isInvertible</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">determinant</span><span class="p">()</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9106'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// isInvertible</span></div><div class='line' id='LC9107'><br/></div><div class='line' id='LC9108'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9109'><span class="cm">     * #.preRotate</span></div><div class='line' id='LC9110'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9111'><span class="cm">     *</span></div><div class='line' id='LC9112'><span class="cm">     * Applies a counter-clockwise pre-rotation to this matrix</span></div><div class='line' id='LC9113'><span class="cm">     *</span></div><div class='line' id='LC9114'><span class="cm">     * @public</span></div><div class='line' id='LC9115'><span class="cm">     * @sign public {Matrix2D} preRotate(Number);</span></div><div class='line' id='LC9116'><span class="cm">     * @param {number} rads - angle to rotate in radians</span></div><div class='line' id='LC9117'><span class="cm">     * @returns {Matrix2D} this matrix after pre-rotation</span></div><div class='line' id='LC9118'><span class="cm">     */</span></div><div class='line' id='LC9119'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preRotate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rads</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">nCos</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rads</span><span class="p">);</span></div><div class='line' id='LC9121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">nSin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rads</span><span class="p">);</span></div><div class='line' id='LC9122'><br/></div><div class='line' id='LC9123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC9124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">-</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">+</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">-</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">+</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9129'><br/></div><div class='line' id='LC9130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9131'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// preRotate</span></div><div class='line' id='LC9132'><br/></div><div class='line' id='LC9133'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9134'><span class="cm">     * #.preScale</span></div><div class='line' id='LC9135'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9136'><span class="cm">     *</span></div><div class='line' id='LC9137'><span class="cm">     * Applies a pre-scaling to this matrix</span></div><div class='line' id='LC9138'><span class="cm">     *</span></div><div class='line' id='LC9139'><span class="cm">     * @public</span></div><div class='line' id='LC9140'><span class="cm">     * @sign public {Matrix2D} preScale(Number[, Number]);</span></div><div class='line' id='LC9141'><span class="cm">     * @param {Number} scalarX</span></div><div class='line' id='LC9142'><span class="cm">     * @param {Number} [scalarY] scalarX is used if scalarY is undefined</span></div><div class='line' id='LC9143'><span class="cm">     * @returns {Matrix2D} this after pre-scaling</span></div><div class='line' id='LC9144'><span class="cm">     */</span></div><div class='line' id='LC9145'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preScale</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scalarX</span><span class="p">,</span> <span class="nx">scalarY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scalarY</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC9147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scalarY</span> <span class="o">=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9148'><br/></div><div class='line' id='LC9149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC9151'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC9153'><br/></div><div class='line' id='LC9154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9155'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// preScale</span></div><div class='line' id='LC9156'><br/></div><div class='line' id='LC9157'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9158'><span class="cm">     * #.preTranslate</span></div><div class='line' id='LC9159'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9160'><span class="cm">     *</span></div><div class='line' id='LC9161'><span class="cm">     * Applies a pre-translation to this matrix</span></div><div class='line' id='LC9162'><span class="cm">     *</span></div><div class='line' id='LC9163'><span class="cm">     * @public</span></div><div class='line' id='LC9164'><span class="cm">     * @sign public {Matrix2D} preTranslate(Vector2D);</span></div><div class='line' id='LC9165'><span class="cm">     * @sign public {Matrix2D} preTranslate(Number, Number);</span></div><div class='line' id='LC9166'><span class="cm">     * @param {Number|Vector2D} dx</span></div><div class='line' id='LC9167'><span class="cm">     * @param {Number} dy</span></div><div class='line' id='LC9168'><span class="cm">     * @returns {Matrix2D} this matrix after pre-translation</span></div><div class='line' id='LC9169'><span class="cm">     */</span></div><div class='line' id='LC9170'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preTranslate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">dx</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC9173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC9174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// else</span></div><div class='line' id='LC9178'><br/></div><div class='line' id='LC9179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9180'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// preTranslate</span></div><div class='line' id='LC9181'><br/></div><div class='line' id='LC9182'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9183'><span class="cm">     * #.rotate</span></div><div class='line' id='LC9184'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9185'><span class="cm">     *</span></div><div class='line' id='LC9186'><span class="cm">     * Applies a counter-clockwise post-rotation to this matrix</span></div><div class='line' id='LC9187'><span class="cm">     *</span></div><div class='line' id='LC9188'><span class="cm">     * @public</span></div><div class='line' id='LC9189'><span class="cm">     * @sign public {Matrix2D} rotate(Number);</span></div><div class='line' id='LC9190'><span class="cm">     * @param {Number} rads - angle to rotate in radians</span></div><div class='line' id='LC9191'><span class="cm">     * @returns {Matrix2D} this matrix after rotation</span></div><div class='line' id='LC9192'><span class="cm">     */</span></div><div class='line' id='LC9193'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">rotate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rads</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">nCos</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">rads</span><span class="p">);</span></div><div class='line' id='LC9195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">nSin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">rads</span><span class="p">);</span></div><div class='line' id='LC9196'><br/></div><div class='line' id='LC9197'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC9198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">-</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">+</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">-</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">+</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tmp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC9204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">-</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">nSin</span> <span class="o">*</span> <span class="nx">tmp</span> <span class="o">+</span> <span class="nx">nCos</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9206'><br/></div><div class='line' id='LC9207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9208'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// rotate</span></div><div class='line' id='LC9209'><br/></div><div class='line' id='LC9210'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9211'><span class="cm">     * #.scale</span></div><div class='line' id='LC9212'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9213'><span class="cm">     *</span></div><div class='line' id='LC9214'><span class="cm">     * Applies a post-scaling to this matrix</span></div><div class='line' id='LC9215'><span class="cm">     *</span></div><div class='line' id='LC9216'><span class="cm">     * @public</span></div><div class='line' id='LC9217'><span class="cm">     * @sign public {Matrix2D} scale(Number[, Number]);</span></div><div class='line' id='LC9218'><span class="cm">     * @param {Number} scalarX</span></div><div class='line' id='LC9219'><span class="cm">     * @param {Number} [scalarY] scalarX is used if scalarY is undefined</span></div><div class='line' id='LC9220'><span class="cm">     * @returns {Matrix2D} this after post-scaling</span></div><div class='line' id='LC9221'><span class="cm">     */</span></div><div class='line' id='LC9222'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scalarX</span><span class="p">,</span> <span class="nx">scalarY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">scalarY</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC9224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scalarY</span> <span class="o">=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9225'><br/></div><div class='line' id='LC9226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC9228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC9230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">*=</span> <span class="nx">scalarX</span><span class="p">;</span></div><div class='line' id='LC9231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">*=</span> <span class="nx">scalarY</span><span class="p">;</span></div><div class='line' id='LC9232'><br/></div><div class='line' id='LC9233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9234'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// scale</span></div><div class='line' id='LC9235'><br/></div><div class='line' id='LC9236'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9237'><span class="cm">     * #.setValues</span></div><div class='line' id='LC9238'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9239'><span class="cm">     *</span></div><div class='line' id='LC9240'><span class="cm">     * Sets the values of this matrix</span></div><div class='line' id='LC9241'><span class="cm">     *</span></div><div class='line' id='LC9242'><span class="cm">     * @public</span></div><div class='line' id='LC9243'><span class="cm">     * @sign public {Matrix2D} setValues(Matrix2D);</span></div><div class='line' id='LC9244'><span class="cm">     * @sign public {Matrix2D} setValues(Number, Number, Number, Number, Number, Number);</span></div><div class='line' id='LC9245'><span class="cm">     * @param {Matrix2D|Number} a</span></div><div class='line' id='LC9246'><span class="cm">     * @param {Number} b</span></div><div class='line' id='LC9247'><span class="cm">     * @param {Number} c</span></div><div class='line' id='LC9248'><span class="cm">     * @param {Number} d</span></div><div class='line' id='LC9249'><span class="cm">     * @param {Number} e</span></div><div class='line' id='LC9250'><span class="cm">     * @param {Number} f</span></div><div class='line' id='LC9251'><span class="cm">     * @returns {Matrix2D} this matrix containing the new values</span></div><div class='line' id='LC9252'><span class="cm">     */</span></div><div class='line' id='LC9253'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValues</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="k">instanceof</span> <span class="nx">Matrix2D</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC9256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC9260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC9263'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC9264'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC9265'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span></div><div class='line' id='LC9266'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span></div><div class='line' id='LC9267'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span></div><div class='line' id='LC9268'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// else</span></div><div class='line' id='LC9269'><br/></div><div class='line' id='LC9270'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9271'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// setValues</span></div><div class='line' id='LC9272'><br/></div><div class='line' id='LC9273'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9274'><span class="cm">     * #.toString</span></div><div class='line' id='LC9275'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9276'><span class="cm">     *</span></div><div class='line' id='LC9277'><span class="cm">     * Returns the string representation of this matrix.</span></div><div class='line' id='LC9278'><span class="cm">     *</span></div><div class='line' id='LC9279'><span class="cm">     * @public</span></div><div class='line' id='LC9280'><span class="cm">     * @sign public {String} toString();</span></div><div class='line' id='LC9281'><span class="cm">     * @returns {String}</span></div><div class='line' id='LC9282'><span class="cm">     */</span></div><div class='line' id='LC9283'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="s2">&quot;Matrix2D([&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">+</span></div><div class='line' id='LC9285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;] [&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+</span> <span class="s2">&quot;] [0, 0, 1])&quot;</span><span class="p">;</span></div><div class='line' id='LC9286'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// toString</span></div><div class='line' id='LC9287'><br/></div><div class='line' id='LC9288'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9289'><span class="cm">     * #.translate</span></div><div class='line' id='LC9290'><span class="cm">     * @comp Crafty.math.Matrix2D</span></div><div class='line' id='LC9291'><span class="cm">     *</span></div><div class='line' id='LC9292'><span class="cm">     * Applies a post-translation to this matrix</span></div><div class='line' id='LC9293'><span class="cm">     *</span></div><div class='line' id='LC9294'><span class="cm">     * @public</span></div><div class='line' id='LC9295'><span class="cm">     * @sign public {Matrix2D} translate(Vector2D);</span></div><div class='line' id='LC9296'><span class="cm">     * @sign public {Matrix2D} translate(Number, Number);</span></div><div class='line' id='LC9297'><span class="cm">     * @param {Number|Vector2D} dx</span></div><div class='line' id='LC9298'><span class="cm">     * @param {Number} dy</span></div><div class='line' id='LC9299'><span class="cm">     * @returns {Matrix2D} this matrix after post-translation</span></div><div class='line' id='LC9300'><span class="cm">     */</span></div><div class='line' id='LC9301'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Matrix2D</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">translate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9302'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">dx</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9303'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">*</span> <span class="nx">dx</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">*</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC9304'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">dx</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC9305'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">e</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">c</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">f</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">d</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="c1">// else</span></div><div class='line' id='LC9309'><br/></div><div class='line' id='LC9310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9311'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span> <span class="c1">// translate</span></div><div class='line' id='LC9312'><br/></div><div class='line' id='LC9313'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">Matrix2D</span><span class="p">;</span></div><div class='line' id='LC9314'><span class="p">})();</span></div><div class='line' id='LC9315'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">20</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC9316'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC9317'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC9318'><br/></div><div class='line' id='LC9319'><span class="cm">/**@</span></div><div class='line' id='LC9320'><span class="cm"> * #Particles</span></div><div class='line' id='LC9321'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC9322'><span class="cm"> * @trigger ParticleEnd - when the particle animation has finished</span></div><div class='line' id='LC9323'><span class="cm"> * Based on Parcycle by Mr. Speaker, licensed under the MIT, Ported by Leo Koppelkamm</span></div><div class='line' id='LC9324'><span class="cm"> * **This is canvas only &amp; won&#39;t do anything if the browser doesn&#39;t support it!**</span></div><div class='line' id='LC9325'><span class="cm"> * To see how this works take a look in https://github.com/craftyjs/Crafty/blob/master/src/particles.js</span></div><div class='line' id='LC9326'><span class="cm"> */</span></div><div class='line' id='LC9327'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Particles&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC9328'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//We need to clone it</span></div><div class='line' id='LC9330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">);</span></div><div class='line' id='LC9331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">parentEntity</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9332'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9333'><br/></div><div class='line' id='LC9334'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9335'><span class="cm">     * #.particles</span></div><div class='line' id='LC9336'><span class="cm">     * @comp Particles</span></div><div class='line' id='LC9337'><span class="cm">     * @sign public this .particles(Object options)</span></div><div class='line' id='LC9338'><span class="cm">     * @param options - Map of options that specify the behavior and look of the particles.</span></div><div class='line' id='LC9339'><span class="cm">     *</span></div><div class='line' id='LC9340'><span class="cm">     * @example</span></div><div class='line' id='LC9341'><span class="cm">     * ~~~</span></div><div class='line' id='LC9342'><span class="cm">     * var options = {</span></div><div class='line' id='LC9343'><span class="cm">     *	maxParticles: 150,</span></div><div class='line' id='LC9344'><span class="cm">     *	size: 18,</span></div><div class='line' id='LC9345'><span class="cm">     *	sizeRandom: 4,</span></div><div class='line' id='LC9346'><span class="cm">     *	speed: 1,</span></div><div class='line' id='LC9347'><span class="cm">     *	speedRandom: 1.2,</span></div><div class='line' id='LC9348'><span class="cm">     *	// Lifespan in frames</span></div><div class='line' id='LC9349'><span class="cm">     *	lifeSpan: 29,</span></div><div class='line' id='LC9350'><span class="cm">     *	lifeSpanRandom: 7,</span></div><div class='line' id='LC9351'><span class="cm">     *	// Angle is calculated clockwise: 12pm is 0deg, 3pm is 90deg etc.</span></div><div class='line' id='LC9352'><span class="cm">     *	angle: 65,</span></div><div class='line' id='LC9353'><span class="cm">     *	angleRandom: 34,</span></div><div class='line' id='LC9354'><span class="cm">     *	startColour: [255, 131, 0, 1],</span></div><div class='line' id='LC9355'><span class="cm">     *	startColourRandom: [48, 50, 45, 0],</span></div><div class='line' id='LC9356'><span class="cm">     *	endColour: [245, 35, 0, 0],</span></div><div class='line' id='LC9357'><span class="cm">     *	endColourRandom: [60, 60, 60, 0],</span></div><div class='line' id='LC9358'><span class="cm">     *	// Only applies when fastMode is off, specifies how sharp the gradients are drawn</span></div><div class='line' id='LC9359'><span class="cm">     *	sharpness: 20,</span></div><div class='line' id='LC9360'><span class="cm">     *	sharpnessRandom: 10,</span></div><div class='line' id='LC9361'><span class="cm">     *	// Random spread from origin</span></div><div class='line' id='LC9362'><span class="cm">     *	spread: 10,</span></div><div class='line' id='LC9363'><span class="cm">     *	// How many frames should this last</span></div><div class='line' id='LC9364'><span class="cm">     *	duration: -1,</span></div><div class='line' id='LC9365'><span class="cm">     *	// Will draw squares instead of circle gradients</span></div><div class='line' id='LC9366'><span class="cm">     *	fastMode: false,</span></div><div class='line' id='LC9367'><span class="cm">     *	gravity: { x: 0, y: 0.1 },</span></div><div class='line' id='LC9368'><span class="cm">     *	// sensible values are 0-3</span></div><div class='line' id='LC9369'><span class="cm">     *	jitter: 0</span></div><div class='line' id='LC9370'><span class="cm">     * }</span></div><div class='line' id='LC9371'><span class="cm">     *</span></div><div class='line' id='LC9372'><span class="cm">     * Crafty.e(&quot;2D,Canvas,Particles&quot;).particles(options);</span></div><div class='line' id='LC9373'><span class="cm">     * ~~~</span></div><div class='line' id='LC9374'><span class="cm">     */</span></div><div class='line' id='LC9375'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particles</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9376'><br/></div><div class='line' id='LC9377'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">canvas</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">deactivateParticles</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9378'><br/></div><div class='line' id='LC9379'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//If we drew on the main canvas, we&#39;d have to redraw</span></div><div class='line' id='LC9380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//potentially huge sections of the screen every frame</span></div><div class='line' id='LC9381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//So we create a separate canvas, where we only have to redraw</span></div><div class='line' id='LC9382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//the changed particles.</span></div><div class='line' id='LC9383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">relativeX</span><span class="p">,</span> <span class="nx">relativeY</span><span class="p">,</span> <span class="nx">bounding</span><span class="p">;</span></div><div class='line' id='LC9384'><br/></div><div class='line' id='LC9385'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span></div><div class='line' id='LC9386'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC9387'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC9388'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span></div><div class='line' id='LC9389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC9390'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC9391'><br/></div><div class='line' id='LC9392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC9393'><br/></div><div class='line' id='LC9394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span></div><div class='line' id='LC9395'><br/></div><div class='line' id='LC9396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span></div><div class='line' id='LC9397'><br/></div><div class='line' id='LC9398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Clean up the DOM when this component is removed</span></div><div class='line' id='LC9399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;Remove&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC9401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;particles&quot;</span><span class="p">)</span></div><div class='line' id='LC9403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC9404'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC9405'><br/></div><div class='line' id='LC9406'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">relativeX</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9407'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">relativeY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">relativeX</span><span class="p">,</span> <span class="nx">relativeY</span><span class="p">);</span></div><div class='line' id='LC9409'><br/></div><div class='line' id='LC9410'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oldViewport</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC9411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC9412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC9413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9414'><br/></div><div class='line' id='LC9415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;EnterFrame&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9416'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">relativeX</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">relativeY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">viewportDelta</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC9419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">oldViewport</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC9420'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">oldViewport</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC9421'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9422'><br/></div><div class='line' id='LC9423'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oldViewport</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC9424'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC9425'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC9426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9427'><br/></div><div class='line' id='LC9428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">relativeX</span><span class="p">,</span> <span class="nx">relativeY</span><span class="p">);</span></div><div class='line' id='LC9429'><br/></div><div class='line' id='LC9430'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Selective clearing</span></div><div class='line' id='LC9431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">boundingRect</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9432'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bounding</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DrawManager</span><span class="p">.</span><span class="nx">boundingRect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">register</span><span class="p">);</span></div><div class='line' id='LC9433'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">bounding</span><span class="p">)</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">bounding</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">bounding</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">bounding</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="nx">bounding</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC9434'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9435'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class='line' id='LC9436'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9437'><br/></div><div class='line' id='LC9438'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//This updates all particle colors &amp; positions</span></div><div class='line' id='LC9439'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span></div><div class='line' id='LC9440'><br/></div><div class='line' id='LC9441'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//This renders the updated particles</span></div><div class='line' id='LC9442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_Particles</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span></div><div class='line' id='LC9443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC9444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC9445'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9446'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_Particles</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC9447'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">presets</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC9448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxParticles</span><span class="o">:</span> <span class="mi">150</span><span class="p">,</span></div><div class='line' id='LC9449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">size</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span></div><div class='line' id='LC9450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sizeRandom</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span></div><div class='line' id='LC9451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">speed</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC9452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">speedRandom</span><span class="o">:</span> <span class="mf">1.2</span><span class="p">,</span></div><div class='line' id='LC9453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Lifespan in frames</span></div><div class='line' id='LC9454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lifeSpan</span><span class="o">:</span> <span class="mi">29</span><span class="p">,</span></div><div class='line' id='LC9455'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lifeSpanRandom</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span></div><div class='line' id='LC9456'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Angle is calculated clockwise: 12pm is 0deg, 3pm is 90deg etc.</span></div><div class='line' id='LC9457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">angle</span><span class="o">:</span> <span class="mi">65</span><span class="p">,</span></div><div class='line' id='LC9458'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">angleRandom</span><span class="o">:</span> <span class="mi">34</span><span class="p">,</span></div><div class='line' id='LC9459'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startColour</span><span class="o">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span></div><div class='line' id='LC9460'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startColourRandom</span><span class="o">:</span> <span class="p">[</span><span class="mi">48</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC9461'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">endColour</span><span class="o">:</span> <span class="p">[</span><span class="mi">245</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC9462'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">endColourRandom</span><span class="o">:</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC9463'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Only applies when fastMode is off, specifies how sharp the gradients are drawn</span></div><div class='line' id='LC9464'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sharpness</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span></div><div class='line' id='LC9465'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sharpnessRandom</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span></div><div class='line' id='LC9466'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Random spread from origin</span></div><div class='line' id='LC9467'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">spread</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span></div><div class='line' id='LC9468'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// How many frames should this last</span></div><div class='line' id='LC9469'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">duration</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC9470'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Will draw squares instead of circle gradients</span></div><div class='line' id='LC9471'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">fastMode</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC9472'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gravity</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC9473'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9474'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mf">0.1</span></div><div class='line' id='LC9475'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9476'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// sensible values are 0-3</span></div><div class='line' id='LC9477'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">jitter</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9478'><br/></div><div class='line' id='LC9479'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Don&#39;t modify the following</span></div><div class='line' id='LC9480'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particles</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC9481'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">active</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC9482'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particleCount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elapsedFrames</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">emissionRate</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">emitCounter</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particleIndex</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC9487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9488'><br/></div><div class='line' id='LC9489'><br/></div><div class='line' id='LC9490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC9492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC9493'><br/></div><div class='line' id='LC9494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Create current config by merging given options and presets.</span></div><div class='line' id='LC9495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">presets</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9496'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC9497'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">presets</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC9498'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9499'><br/></div><div class='line' id='LC9500'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">emissionRate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxParticles</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">lifeSpan</span><span class="p">;</span></div><div class='line' id='LC9501'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">positionRandom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">spread</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">spread</span><span class="p">);</span></div><div class='line' id='LC9502'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9503'><br/></div><div class='line' id='LC9504'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">addParticle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9505'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxParticles</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9506'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC9507'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9508'><br/></div><div class='line' id='LC9509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Take the next particle out of the particle pool we have created and initialize it</span></div><div class='line' id='LC9510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">particle</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">particle</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">);</span></div><div class='line' id='LC9511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">initParticle</span><span class="p">(</span><span class="nx">particle</span><span class="p">);</span></div><div class='line' id='LC9512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particles</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">particle</span><span class="p">;</span></div><div class='line' id='LC9513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Increment the particle count</span></div><div class='line' id='LC9514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC9515'><br/></div><div class='line' id='LC9516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC9517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">RANDM1TO1</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC9520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">initParticle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">particle</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">positionRandom</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">positionRandom</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9524'><br/></div><div class='line' id='LC9525'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">newAngle</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">angle</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">angleRandom</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">())</span> <span class="o">*</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">);</span> <span class="c1">// convert to radians</span></div><div class='line' id='LC9526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">newAngle</span><span class="p">),</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">newAngle</span><span class="p">));</span> <span class="c1">// Could move to lookup for speed</span></div><div class='line' id='LC9527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vectorSpeed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">speed</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">speedRandom</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">direction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">vector</span><span class="p">,</span> <span class="nx">vectorSpeed</span><span class="p">);</span></div><div class='line' id='LC9529'><br/></div><div class='line' id='LC9530'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">sizeRandom</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">~~</span><span class="nx">particle</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC9532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">timeToLive</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">lifeSpan</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">lifeSpanRandom</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9533'><br/></div><div class='line' id='LC9534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">sharpnessRandom</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9535'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">=</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">?</span> <span class="mi">100</span> <span class="o">:</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span><span class="p">;</span></div><div class='line' id='LC9536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// internal circle gradient size - affects the sharpness of the radial gradient</span></div><div class='line' id='LC9537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">sizeSmall</span> <span class="o">=</span> <span class="o">~~</span> <span class="p">((</span><span class="nx">particle</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span> <span class="o">*</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">sharpness</span><span class="p">);</span> <span class="c1">//(size/2/100)</span></div><div class='line' id='LC9538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="p">[</span></div><div class='line' id='LC9539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">startColour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">startColourRandom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">startColour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">startColourRandom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">startColour</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">startColourRandom</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">startColour</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">startColourRandom</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">()</span></div><div class='line' id='LC9543'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">];</span></div><div class='line' id='LC9544'><br/></div><div class='line' id='LC9545'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="p">[</span></div><div class='line' id='LC9546'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">endColour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">endColourRandom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9547'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">endColour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">endColourRandom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9548'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">endColour</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">endColourRandom</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">(),</span></div><div class='line' id='LC9549'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">endColour</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">endColourRandom</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">()</span></div><div class='line' id='LC9550'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">];</span></div><div class='line' id='LC9551'><br/></div><div class='line' id='LC9552'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">colour</span> <span class="o">=</span> <span class="nx">start</span><span class="p">;</span></div><div class='line' id='LC9553'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">;</span></div><div class='line' id='LC9554'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">;</span></div><div class='line' id='LC9555'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">end</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">;</span></div><div class='line' id='LC9556'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">end</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="nx">start</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">;</span></div><div class='line' id='LC9557'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9558'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9559'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">emissionRate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9560'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">emissionRate</span><span class="p">;</span></div><div class='line' id='LC9561'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">emitCounter</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC9562'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxParticles</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">emitCounter</span> <span class="o">&gt;</span> <span class="nx">rate</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9563'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">addParticle</span><span class="p">();</span></div><div class='line' id='LC9564'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">emitCounter</span> <span class="o">-=</span> <span class="nx">rate</span><span class="p">;</span></div><div class='line' id='LC9565'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9566'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">elapsedFrames</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC9567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">elapsedFrames</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC9569'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9570'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9571'><br/></div><div class='line' id='LC9572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC9574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">draw</span><span class="p">;</span></div><div class='line' id='LC9575'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9576'><br/></div><div class='line' id='LC9577'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">currentParticle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">particles</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span><span class="p">];</span></div><div class='line' id='LC9578'><br/></div><div class='line' id='LC9579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If the current particle is alive then update it</span></div><div class='line' id='LC9580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">timeToLive</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9581'><br/></div><div class='line' id='LC9582'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculate the new direction based on gravity</span></div><div class='line' id='LC9583'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">direction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">direction</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">gravity</span><span class="p">);</span></div><div class='line' id='LC9584'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">direction</span><span class="p">);</span></div><div class='line' id='LC9585'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewportDelta</span><span class="p">);</span></div><div class='line' id='LC9586'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">jitter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9587'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">jitter</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9588'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">jitter</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">RANDM1TO1</span><span class="p">();</span></div><div class='line' id='LC9589'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9590'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">timeToLive</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC9591'><br/></div><div class='line' id='LC9592'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Update colours</span></div><div class='line' id='LC9593'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC9594'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">colour</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC9595'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">colour</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC9596'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">colour</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">deltaColour</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span></div><div class='line' id='LC9597'><br/></div><div class='line' id='LC9598'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculate the rgba string to draw.</span></div><div class='line' id='LC9599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC9600'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;rgba(&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">r</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">~~</span><span class="nx">r</span><span class="p">));</span></div><div class='line' id='LC9601'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">g</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">g</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">~~</span><span class="nx">g</span><span class="p">);</span></div><div class='line' id='LC9602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="mi">255</span> <span class="o">?</span> <span class="mi">255</span> <span class="o">:</span> <span class="nx">b</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">~~</span><span class="nx">b</span><span class="p">);</span></div><div class='line' id='LC9603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span></div><div class='line' id='LC9604'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">drawColour</span> <span class="o">=</span> <span class="nx">draw</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span></div><div class='line' id='LC9605'><br/></div><div class='line' id='LC9606'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">fastMode</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9607'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0)&quot;</span><span class="p">;</span></div><div class='line' id='LC9608'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">currentParticle</span><span class="p">.</span><span class="nx">drawColourEnd</span> <span class="o">=</span> <span class="nx">draw</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span></div><div class='line' id='LC9609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9610'><br/></div><div class='line' id='LC9611'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC9612'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9613'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Replace particle with the last active</span></div><div class='line' id='LC9614'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9615'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particles</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">particleIndex</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">particles</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC9616'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9617'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC9618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9619'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC9620'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="o">~~</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="o">~~</span><span class="nx">currentParticle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9622'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC9623'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">currentParticle</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC9624'><br/></div><div class='line' id='LC9625'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">register</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">rect</span><span class="p">);</span></div><div class='line' id='LC9626'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9627'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9628'><br/></div><div class='line' id='LC9629'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9630'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC9631'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">elapsedFrames</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9632'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">emitCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">parentEntity</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ParticleEnd&quot;</span><span class="p">);</span></div><div class='line' id='LC9634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9635'><br/></div><div class='line' id='LC9636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9637'><br/></div><div class='line' id='LC9638'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">particleCount</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9639'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">particle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">particles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC9640'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC9641'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">halfSize</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC9642'><br/></div><div class='line' id='LC9643'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">size</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9644'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Particle is outside</span></div><div class='line' id='LC9645'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC9646'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9647'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="o">~~</span><span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9648'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="o">~~</span><span class="nx">particle</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9649'><br/></div><div class='line' id='LC9650'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fastMode</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9651'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">drawColour</span><span class="p">;</span></div><div class='line' id='LC9652'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9653'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">radgrad</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createRadialGradient</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">halfSize</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">halfSize</span><span class="p">,</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">sizeSmall</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">halfSize</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">halfSize</span><span class="p">,</span> <span class="nx">halfSize</span><span class="p">);</span></div><div class='line' id='LC9654'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">drawColour</span><span class="p">);</span></div><div class='line' id='LC9655'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//0.9 to avoid visible boxing</span></div><div class='line' id='LC9656'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">radgrad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="nx">particle</span><span class="p">.</span><span class="nx">drawColourEnd</span><span class="p">);</span></div><div class='line' id='LC9657'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">radgrad</span><span class="p">;</span></div><div class='line' id='LC9658'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9659'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC9660'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9661'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9662'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">particle</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vectorHelpers</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9663'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC9664'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">direction</span> <span class="o">=</span> <span class="nx">vectorHelpers</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC9665'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9666'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">sizeSmall</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9667'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">timeToLive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9668'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">colour</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC9669'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">drawColour</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC9670'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">deltaColour</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC9671'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">sharpness</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC9672'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9673'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vectorHelpers</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC9674'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9675'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="p">{</span></div><div class='line' id='LC9676'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;x&quot;</span><span class="o">:</span> <span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC9677'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;y&quot;</span><span class="o">:</span> <span class="nx">y</span></div><div class='line' id='LC9678'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9679'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9680'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">multiply</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vector</span><span class="p">,</span> <span class="nx">scaleFactor</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9681'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vector</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="nx">scaleFactor</span><span class="p">;</span></div><div class='line' id='LC9682'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vector</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="nx">scaleFactor</span><span class="p">;</span></div><div class='line' id='LC9683'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">vector</span><span class="p">;</span></div><div class='line' id='LC9684'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9685'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vector1</span><span class="p">,</span> <span class="nx">vector2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9686'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vector1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">vector2</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC9687'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">vector1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">vector2</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC9688'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">vector1</span><span class="p">;</span></div><div class='line' id='LC9689'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9690'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9691'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9692'><span class="p">});</span></div><div class='line' id='LC9693'><br/></div><div class='line' id='LC9694'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">21</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC9695'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC9696'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC9697'><br/></div><div class='line' id='LC9698'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC9699'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_scenes</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC9700'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_current</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC9701'><br/></div><div class='line' id='LC9702'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9703'><span class="cm">     * #Crafty.scene</span></div><div class='line' id='LC9704'><span class="cm">     * @category Scenes, Stage</span></div><div class='line' id='LC9705'><span class="cm">     * @trigger SceneChange - just before a new scene is initialized - { oldScene:String, newScene:String }</span></div><div class='line' id='LC9706'><span class="cm">     * @trigger SceneDestroy - just before the current scene is destroyed - { newScene:String  }</span></div><div class='line' id='LC9707'><span class="cm">     *</span></div><div class='line' id='LC9708'><span class="cm">     * @sign public void Crafty.scene(String sceneName, Function init[, Function uninit])</span></div><div class='line' id='LC9709'><span class="cm">     * @param sceneName - Name of the scene to add</span></div><div class='line' id='LC9710'><span class="cm">     * @param init - Function to execute when scene is played</span></div><div class='line' id='LC9711'><span class="cm">     * @param uninit - Function to execute before next scene is played, after entities with `2D` are destroyed</span></div><div class='line' id='LC9712'><span class="cm">     * This is equivalent to calling `Crafty.defineScene`.</span></div><div class='line' id='LC9713'><span class="cm">     *</span></div><div class='line' id='LC9714'><span class="cm">     * @sign public void Crafty.scene(String sceneName[, Data])</span></div><div class='line' id='LC9715'><span class="cm">     * @param sceneName - Name of scene to play</span></div><div class='line' id='LC9716'><span class="cm">     * @param Data - The init function of the scene will be called with this data as its parameter.  Can be of any type other than a function.</span></div><div class='line' id='LC9717'><span class="cm">     * This is equivalent to calling `Crafty.enterScene`.</span></div><div class='line' id='LC9718'><span class="cm">     *</span></div><div class='line' id='LC9719'><span class="cm">     * Method to create scenes on the stage. Pass an ID and function to register a scene.</span></div><div class='line' id='LC9720'><span class="cm">     *</span></div><div class='line' id='LC9721'><span class="cm">     * To play a scene, just pass the ID. When a scene is played, all</span></div><div class='line' id='LC9722'><span class="cm">     * previously-created entities with the `2D` component are destroyed. The</span></div><div class='line' id='LC9723'><span class="cm">     * viewport is also reset.</span></div><div class='line' id='LC9724'><span class="cm">     *</span></div><div class='line' id='LC9725'><span class="cm">     * You can optionally specify an arugment that will be passed to the scene&#39;s init function.</span></div><div class='line' id='LC9726'><span class="cm">     *</span></div><div class='line' id='LC9727'><span class="cm">     * If you want some entities to persist over scenes (as in, not be destroyed)</span></div><div class='line' id='LC9728'><span class="cm">     * simply add the component `Persist`.</span></div><div class='line' id='LC9729'><span class="cm">     *</span></div><div class='line' id='LC9730'><span class="cm">     * @example</span></div><div class='line' id='LC9731'><span class="cm">     * ~~~</span></div><div class='line' id='LC9732'><span class="cm">     * Crafty.defineScene(&quot;loading&quot;, function() {</span></div><div class='line' id='LC9733'><span class="cm">     *     Crafty.background(&quot;#000&quot;);</span></div><div class='line' id='LC9734'><span class="cm">     *     Crafty.e(&quot;2D, DOM, Text&quot;)</span></div><div class='line' id='LC9735'><span class="cm">     *           .attr({ w: 100, h: 20, x: 150, y: 120 })</span></div><div class='line' id='LC9736'><span class="cm">     *           .text(&quot;Loading&quot;)</span></div><div class='line' id='LC9737'><span class="cm">     *           .css({ &quot;text-align&quot;: &quot;center&quot;})</span></div><div class='line' id='LC9738'><span class="cm">     *           .textColor(&quot;#FFFFFF&quot;);</span></div><div class='line' id='LC9739'><span class="cm">     * });</span></div><div class='line' id='LC9740'><span class="cm">     *</span></div><div class='line' id='LC9741'><span class="cm">     * Crafty.defineScene(&quot;UFO_dance&quot;,</span></div><div class='line' id='LC9742'><span class="cm">     *              function() {Crafty.background(&quot;#444&quot;); Crafty.e(&quot;UFO&quot;);},</span></div><div class='line' id='LC9743'><span class="cm">     *              function() {...send message to server...});</span></div><div class='line' id='LC9744'><span class="cm">     *</span></div><div class='line' id='LC9745'><span class="cm">     * // An example of an init function which accepts arguments, in this case an object.</span></div><div class='line' id='LC9746'><span class="cm">     * Crafty.defineScene(&quot;square&quot;, function(attributes) {</span></div><div class='line' id='LC9747'><span class="cm">     *     Crafty.background(&quot;#000&quot;);</span></div><div class='line' id='LC9748'><span class="cm">     *     Crafty.e(&quot;2D, DOM, Color&quot;)</span></div><div class='line' id='LC9749'><span class="cm">     *           .attr(attributes)</span></div><div class='line' id='LC9750'><span class="cm">     *           .color(&quot;red&quot;);</span></div><div class='line' id='LC9751'><span class="cm">     * </span></div><div class='line' id='LC9752'><span class="cm">     * });</span></div><div class='line' id='LC9753'><span class="cm">     *</span></div><div class='line' id='LC9754'><span class="cm">     * ~~~</span></div><div class='line' id='LC9755'><span class="cm">     * This defines (but does not play) two scenes as discussed below.</span></div><div class='line' id='LC9756'><span class="cm">     * ~~~</span></div><div class='line' id='LC9757'><span class="cm">     * Crafty.enterScene(&quot;loading&quot;);</span></div><div class='line' id='LC9758'><span class="cm">     * ~~~</span></div><div class='line' id='LC9759'><span class="cm">     * This command will clear the stage by destroying all `2D` entities (except</span></div><div class='line' id='LC9760'><span class="cm">     * those with the `Persist` component). Then it will set the background to</span></div><div class='line' id='LC9761'><span class="cm">     * black and display the text &quot;Loading&quot;.</span></div><div class='line' id='LC9762'><span class="cm">     * ~~~</span></div><div class='line' id='LC9763'><span class="cm">     * Crafty.enterScene(&quot;UFO_dance&quot;);</span></div><div class='line' id='LC9764'><span class="cm">     * ~~~</span></div><div class='line' id='LC9765'><span class="cm">     * This command will clear the stage by destroying all `2D` entities (except</span></div><div class='line' id='LC9766'><span class="cm">     * those with the `Persist` component). Then it will set the background to</span></div><div class='line' id='LC9767'><span class="cm">     * gray and create a UFO entity. Finally, the next time the game encounters</span></div><div class='line' id='LC9768'><span class="cm">     * another command of the form `Crafty.scene(scene_name)` (if ever), then the</span></div><div class='line' id='LC9769'><span class="cm">     * game will send a message to the server.</span></div><div class='line' id='LC9770'><span class="cm">     * ~~~</span></div><div class='line' id='LC9771'><span class="cm">     * Crafty.enterScene(&quot;square&quot;, {x:10, y:10, w:20, h:20});</span></div><div class='line' id='LC9772'><span class="cm">     * ~~~</span></div><div class='line' id='LC9773'><span class="cm">     * This will clear the stage, set the background black, and create a red square with the specified position and dimensions.</span></div><div class='line' id='LC9774'><span class="cm">     * ~~~</span></div><div class='line' id='LC9775'><span class="cm">     */</span></div><div class='line' id='LC9776'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scene</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">intro</span><span class="p">,</span> <span class="nx">outro</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9777'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If there&#39;s one argument, or the second argument isn&#39;t a function, play the scene</span></div><div class='line' id='LC9778'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9779'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">enterScene</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span></div><div class='line' id='LC9780'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC9781'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9782'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Otherwise, this is a call to create a scene</span></div><div class='line' id='LC9783'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">defineScene</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">intro</span><span class="p">,</span> <span class="nx">outro</span><span class="p">);</span></div><div class='line' id='LC9784'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9785'><br/></div><div class='line' id='LC9786'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/* </span></div><div class='line' id='LC9787'><span class="cm">     * #Crafty.defineScene</span></div><div class='line' id='LC9788'><span class="cm">     * @category Scenes, Stage</span></div><div class='line' id='LC9789'><span class="cm">     *</span></div><div class='line' id='LC9790'><span class="cm">     * @sign public void Crafty.enterScene(String name[, Data])</span></div><div class='line' id='LC9791'><span class="cm">     * @param name - Name of the scene to run.</span></div><div class='line' id='LC9792'><span class="cm">     * @param Data - The init function of the scene will be called with this data as its parameter.  Can be of any type other than a function.</span></div><div class='line' id='LC9793'><span class="cm">     *</span></div><div class='line' id='LC9794'><span class="cm">     * @see Crafty.enterScene</span></div><div class='line' id='LC9795'><span class="cm">     * @see Crafty.scene</span></div><div class='line' id='LC9796'><span class="cm">     */</span></div><div class='line' id='LC9797'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">defineScene</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="nx">uninit</span><span class="p">){</span></div><div class='line' id='LC9798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">init</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span></div><div class='line' id='LC9799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Init function is the wrong type.&quot;</span><span class="p">);</span></div><div class='line' id='LC9800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC9801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">initialize</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span></div><div class='line' id='LC9802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">uninit</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9803'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">uninitialize</span> <span class="o">=</span> <span class="nx">uninit</span><span class="p">;</span></div><div class='line' id='LC9804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9805'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC9806'><br/></div><div class='line' id='LC9807'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9808'><br/></div><div class='line' id='LC9809'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/* </span></div><div class='line' id='LC9810'><span class="cm">     * #Crafty.enterScene</span></div><div class='line' id='LC9811'><span class="cm">     * @category Scenes, Stage</span></div><div class='line' id='LC9812'><span class="cm">     * @trigger SceneChange - just before a new scene is initialized - { oldScene:String, newScene:String }</span></div><div class='line' id='LC9813'><span class="cm">     * @trigger SceneDestroy - just before the current scene is destroyed - { newScene:String  }</span></div><div class='line' id='LC9814'><span class="cm">     *</span></div><div class='line' id='LC9815'><span class="cm">     * @sign public void Crafty.enterScene(String name[, Data])</span></div><div class='line' id='LC9816'><span class="cm">     * @param name - Name of the scene to run.</span></div><div class='line' id='LC9817'><span class="cm">     * @param Data - The init function of the scene will be called with this data as its parameter.  Can be of any type other than a function.</span></div><div class='line' id='LC9818'><span class="cm">     * </span></div><div class='line' id='LC9819'><span class="cm">     * @see Crafty.defineScene</span></div><div class='line' id='LC9820'><span class="cm">     * @see Crafty.scene</span></div><div class='line' id='LC9821'><span class="cm">     */</span></div><div class='line' id='LC9822'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">enterScene</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span></div><div class='line' id='LC9823'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span></div><div class='line' id='LC9824'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Scene data cannot be a function&quot;</span><span class="p">);</span></div><div class='line' id='LC9825'><br/></div><div class='line' id='LC9826'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// ---FYI---</span></div><div class='line' id='LC9827'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// this._current is the name (ID) of the scene in progress.</span></div><div class='line' id='LC9828'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// this._scenes is an object like the following:</span></div><div class='line' id='LC9829'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// {&#39;Opening scene&#39;: {&#39;initialize&#39;: fnA, &#39;uninitialize&#39;: fnB},</span></div><div class='line' id='LC9830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//  &#39;Another scene&#39;: {&#39;initialize&#39;: fnC, &#39;uninitialize&#39;: fnD}}</span></div><div class='line' id='LC9831'><br/></div><div class='line' id='LC9832'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;SceneDestroy&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC9833'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">newScene</span><span class="o">:</span> <span class="nx">name</span></div><div class='line' id='LC9834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC9835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span></div><div class='line' id='LC9836'><br/></div><div class='line' id='LC9837'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9838'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;Persist&quot;</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span></div><div class='line' id='LC9839'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC9840'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// uninitialize previous scene</span></div><div class='line' id='LC9841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;uninitialize&#39;</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC9842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">].</span><span class="nx">uninitialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC9843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// initialize next scene</span></div><div class='line' id='LC9845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oldScene</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_current</span><span class="p">;</span></div><div class='line' id='LC9846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_current</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span></div><div class='line' id='LC9847'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;SceneChange&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC9848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oldScene</span><span class="o">:</span> <span class="nx">oldScene</span><span class="p">,</span></div><div class='line' id='LC9849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">newScene</span><span class="o">:</span> <span class="nx">name</span></div><div class='line' id='LC9850'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC9851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scenes</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></div><div class='line' id='LC9852'><br/></div><div class='line' id='LC9853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC9854'><br/></div><div class='line' id='LC9855'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9856'><span class="p">});</span></div><div class='line' id='LC9857'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">22</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC9858'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC9859'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC9860'><br/></div><div class='line' id='LC9861'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC9862'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9863'><span class="cm">     * #Crafty.audio</span></div><div class='line' id='LC9864'><span class="cm">     * @category Audio</span></div><div class='line' id='LC9865'><span class="cm">     *</span></div><div class='line' id='LC9866'><span class="cm">     * Add sound files and play them. Chooses best format for browser support.</span></div><div class='line' id='LC9867'><span class="cm">     * Due to the nature of HTML5 audio, three types of audio files will be</span></div><div class='line' id='LC9868'><span class="cm">     * required for cross-browser capabilities. These formats are MP3, Ogg and WAV.</span></div><div class='line' id='LC9869'><span class="cm">     * When sound was not muted on before pause, sound will be unmuted after unpause.</span></div><div class='line' id='LC9870'><span class="cm">     * When sound is muted Crafty.pause() does not have any effect on sound</span></div><div class='line' id='LC9871'><span class="cm">     *</span></div><div class='line' id='LC9872'><span class="cm">     * The maximum number of sounds that can be played simultaneously is defined by Crafty.audio.maxChannels.  The default value is 7.</span></div><div class='line' id='LC9873'><span class="cm">     */</span></div><div class='line' id='LC9874'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audio</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC9875'><br/></div><div class='line' id='LC9876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sounds</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC9877'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">supported</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC9878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">codecs</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// Chart from jPlayer</span></div><div class='line' id='LC9879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ogg</span><span class="o">:</span> <span class="s1">&#39;audio/ogg; codecs=&quot;vorbis&quot;&#39;</span><span class="p">,</span> <span class="c1">//OGG</span></div><div class='line' id='LC9880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">wav</span><span class="o">:</span> <span class="s1">&#39;audio/wav; codecs=&quot;1&quot;&#39;</span><span class="p">,</span> <span class="c1">// PCM</span></div><div class='line' id='LC9881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webma</span><span class="o">:</span> <span class="s1">&#39;audio/webm; codecs=&quot;vorbis&quot;&#39;</span><span class="p">,</span> <span class="c1">// WEBM</span></div><div class='line' id='LC9882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mp3</span><span class="o">:</span> <span class="s1">&#39;audio/mpeg; codecs=&quot;mp3&quot;&#39;</span><span class="p">,</span> <span class="c1">//MP3</span></div><div class='line' id='LC9883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">m4a</span><span class="o">:</span> <span class="s1">&#39;audio/mp4; codecs=&quot;mp4a.40.2&quot;&#39;</span> <span class="c1">// AAC / MP4</span></div><div class='line' id='LC9884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9885'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">volume</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//Global Volume</span></div><div class='line' id='LC9886'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">muted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC9887'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paused</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC9888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">playCheck</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC9889'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC9890'><span class="cm">         * Function to setup supported formats</span></div><div class='line' id='LC9891'><span class="cm">         **/</span></div><div class='line' id='LC9892'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_canPlay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">supported</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC9894'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Without support, no formats are supported</span></div><div class='line' id='LC9895'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span><span class="p">)</span></div><div class='line' id='LC9896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC9897'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">audio</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioElement</span><span class="p">(),</span></div><div class='line' id='LC9898'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">canplay</span><span class="p">;</span></div><div class='line' id='LC9899'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">codecs</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">canplay</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">canPlayType</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">codecs</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></div><div class='line' id='LC9901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">canplay</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">canplay</span> <span class="o">!==</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9902'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">supported</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC9903'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC9904'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">supported</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC9905'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9906'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC9907'><br/></div><div class='line' id='LC9908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9909'><br/></div><div class='line' id='LC9910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9911'><span class="cm">         * #Crafty.audio.supports</span></div><div class='line' id='LC9912'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC9913'><span class="cm">         * @sign public this Crafty.audio.supports(String extension)</span></div><div class='line' id='LC9914'><span class="cm">         * @param extension - A file extension to check audio support for</span></div><div class='line' id='LC9915'><span class="cm">         *</span></div><div class='line' id='LC9916'><span class="cm">         * Return true if the browser thinks it can play the given file type, otherwise false</span></div><div class='line' id='LC9917'><span class="cm">         */</span></div><div class='line' id='LC9918'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">supports</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">extension</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Build cache of supported formats, if necessary</span></div><div class='line' id='LC9920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">supported</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span></div><div class='line' id='LC9921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_canPlay</span><span class="p">();</span></div><div class='line' id='LC9922'><br/></div><div class='line' id='LC9923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">supported</span><span class="p">[</span><span class="nx">extension</span><span class="p">])</span></div><div class='line' id='LC9924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC9925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC9926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC9927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9928'><br/></div><div class='line' id='LC9929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC9930'><span class="cm">         * Function to get an Audio Element</span></div><div class='line' id='LC9931'><span class="cm">         **/</span></div><div class='line' id='LC9932'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audioElement</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC9933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//IE does not support Audio Object</span></div><div class='line' id='LC9934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">typeof</span> <span class="nx">Audio</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">Audio</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">);</span></div><div class='line' id='LC9935'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9936'><br/></div><div class='line' id='LC9937'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9938'><span class="cm">         * #Crafty.audio.create</span></div><div class='line' id='LC9939'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC9940'><span class="cm">         * @sign public this Crafty.audio.create(String id, String url)</span></div><div class='line' id='LC9941'><span class="cm">         * @param id - A string to refer to sounds</span></div><div class='line' id='LC9942'><span class="cm">         * @param url - A string pointing to the sound file</span></div><div class='line' id='LC9943'><span class="cm">         *</span></div><div class='line' id='LC9944'><span class="cm">         * Creates an audio asset with the given id and resource.  `Crafty.audio.add` is a more flexible interface that allows cross-browser compatibility.</span></div><div class='line' id='LC9945'><span class="cm">         *</span></div><div class='line' id='LC9946'><span class="cm">         * If the sound file extension is not supported, returns false; otherwise, returns the audio asset.</span></div><div class='line' id='LC9947'><span class="cm">         */</span></div><div class='line' id='LC9948'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">create</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC9949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check extension, return if not supported</span></div><div class='line' id='LC9950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ext</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span></div><div class='line' id='LC9951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span></div><div class='line' id='LC9952'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC9953'><br/></div><div class='line' id='LC9954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//initiate the audio element</span></div><div class='line' id='LC9955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">audio</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioElement</span><span class="p">();</span></div><div class='line' id='LC9956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audio</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span></div><div class='line' id='LC9957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audio</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">;</span></div><div class='line' id='LC9958'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audio</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">volume</span><span class="p">;</span></div><div class='line' id='LC9959'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">audio</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span></div><div class='line' id='LC9960'><br/></div><div class='line' id='LC9961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create an asset and metadata for the audio element</span></div><div class='line' id='LC9962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">audio</span><span class="p">);</span></div><div class='line' id='LC9963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC9964'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="o">:</span> <span class="nx">audio</span><span class="p">,</span></div><div class='line' id='LC9965'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">played</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC9966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">volume</span><span class="o">:</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">volume</span></div><div class='line' id='LC9967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC9968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC9969'><br/></div><div class='line' id='LC9970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC9971'><br/></div><div class='line' id='LC9972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC9973'><span class="cm">         * #Crafty.audio.add</span></div><div class='line' id='LC9974'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC9975'><span class="cm">         * @sign public this Crafty.audio.add(String id, String url)</span></div><div class='line' id='LC9976'><span class="cm">         * @param id - A string to refer to sounds</span></div><div class='line' id='LC9977'><span class="cm">         * @param url - A string pointing to the sound file</span></div><div class='line' id='LC9978'><span class="cm">         * @sign public this Crafty.audio.add(String id, Array urls)</span></div><div class='line' id='LC9979'><span class="cm">         * @param urls - Array of urls pointing to different format of the same sound, selecting the first that is playable</span></div><div class='line' id='LC9980'><span class="cm">         * @sign public this Crafty.audio.add(Object map)</span></div><div class='line' id='LC9981'><span class="cm">         * @param map - key-value pairs where the key is the `id` and the value is either a `url` or `urls`</span></div><div class='line' id='LC9982'><span class="cm">         *</span></div><div class='line' id='LC9983'><span class="cm">         * Loads a sound to be played. Due to the nature of HTML5 audio,</span></div><div class='line' id='LC9984'><span class="cm">         * three types of audio files will be required for cross-browser capabilities.</span></div><div class='line' id='LC9985'><span class="cm">         * These formats are MP3, Ogg and WAV.</span></div><div class='line' id='LC9986'><span class="cm">         *</span></div><div class='line' id='LC9987'><span class="cm">         * Passing an array of URLs will determine which format the browser can play and select it over any other.</span></div><div class='line' id='LC9988'><span class="cm">         *</span></div><div class='line' id='LC9989'><span class="cm">         * Accepts an object where the key is the audio name and</span></div><div class='line' id='LC9990'><span class="cm">         * either a URL or an Array of URLs (to determine which type to use).</span></div><div class='line' id='LC9991'><span class="cm">         *</span></div><div class='line' id='LC9992'><span class="cm">         * The ID you use will be how you refer to that sound when using `Crafty.audio.play`.</span></div><div class='line' id='LC9993'><span class="cm">         *</span></div><div class='line' id='LC9994'><span class="cm">         * @example</span></div><div class='line' id='LC9995'><span class="cm">         * ~~~</span></div><div class='line' id='LC9996'><span class="cm">         * //adding audio from an object</span></div><div class='line' id='LC9997'><span class="cm">         * Crafty.audio.add({</span></div><div class='line' id='LC9998'><span class="cm">         * shoot: [&quot;sounds/shoot.wav&quot;,</span></div><div class='line' id='LC9999'><span class="cm">         * &quot;sounds/shoot.mp3&quot;,</span></div><div class='line' id='LC10000'><span class="cm">         * &quot;sounds/shoot.ogg&quot;],</span></div><div class='line' id='LC10001'><span class="cm">         *</span></div><div class='line' id='LC10002'><span class="cm">         * coin: &quot;sounds/coin.mp3&quot;</span></div><div class='line' id='LC10003'><span class="cm">         * });</span></div><div class='line' id='LC10004'><span class="cm">         *</span></div><div class='line' id='LC10005'><span class="cm">         * //adding a single sound</span></div><div class='line' id='LC10006'><span class="cm">         * Crafty.audio.add(&quot;walk&quot;, [</span></div><div class='line' id='LC10007'><span class="cm">         * &quot;sounds/walk.mp3&quot;,</span></div><div class='line' id='LC10008'><span class="cm">         * &quot;sounds/walk.ogg&quot;,</span></div><div class='line' id='LC10009'><span class="cm">         * &quot;sounds/walk.wav&quot;</span></div><div class='line' id='LC10010'><span class="cm">         * ]);</span></div><div class='line' id='LC10011'><span class="cm">         *</span></div><div class='line' id='LC10012'><span class="cm">         * //only one format</span></div><div class='line' id='LC10013'><span class="cm">         * Crafty.audio.add(&quot;jump&quot;, &quot;sounds/jump.mp3&quot;);</span></div><div class='line' id='LC10014'><span class="cm">         * ~~~</span></div><div class='line' id='LC10015'><span class="cm">         */</span></div><div class='line' id='LC10016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span><span class="p">)</span></div><div class='line' id='LC10018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10019'><br/></div><div class='line' id='LC10020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">src</span><span class="p">;</span></div><div class='line' id='LC10021'><br/></div><div class='line' id='LC10022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">src</span> <span class="k">in</span> <span class="nx">id</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span></div><div class='line' id='LC10025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">id</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">src</span><span class="p">]))</span></div><div class='line' id='LC10026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC10027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">url</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span></div><div class='line' id='LC10033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10034'><br/></div><div class='line' id='LC10035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">url</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">src</span> <span class="k">in</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">[</span><span class="nx">src</span><span class="p">]))</span></div><div class='line' id='LC10038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC10039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10041'><br/></div><div class='line' id='LC10042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10045'><span class="cm">         * #Crafty.audio.play</span></div><div class='line' id='LC10046'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10047'><span class="cm">         * @sign public this Crafty.audio.play(String id)</span></div><div class='line' id='LC10048'><span class="cm">         * @sign public this Crafty.audio.play(String id, Number repeatCount)</span></div><div class='line' id='LC10049'><span class="cm">         * @sign public this Crafty.audio.play(String id, Number repeatCount, Number volume)</span></div><div class='line' id='LC10050'><span class="cm">         * @param id - A string to refer to sounds</span></div><div class='line' id='LC10051'><span class="cm">         * @param repeatCount - Repeat count for the file, where -1 stands for repeat forever.</span></div><div class='line' id='LC10052'><span class="cm">         * @param volume - volume can be a number between 0.0 and 1.0</span></div><div class='line' id='LC10053'><span class="cm">         * @returns The audio element used to play the sound.  Null if the call failed due to a lack of open channels.</span></div><div class='line' id='LC10054'><span class="cm">         *</span></div><div class='line' id='LC10055'><span class="cm">         * Will play a sound previously added by using the ID that was used in `Crafty.audio.add`.</span></div><div class='line' id='LC10056'><span class="cm">         * Has a default maximum of 5 channels so that the same sound can play simultaneously unless all of the channels are playing.</span></div><div class='line' id='LC10057'><br/></div><div class='line' id='LC10058'><span class="cm">         * *Note that the implementation of HTML5 Audio is buggy at best.*</span></div><div class='line' id='LC10059'><span class="cm">         *</span></div><div class='line' id='LC10060'><span class="cm">         * @example</span></div><div class='line' id='LC10061'><span class="cm">         * ~~~</span></div><div class='line' id='LC10062'><span class="cm">         * Crafty.audio.play(&quot;walk&quot;);</span></div><div class='line' id='LC10063'><span class="cm">         *</span></div><div class='line' id='LC10064'><span class="cm">         * //play and repeat forever</span></div><div class='line' id='LC10065'><span class="cm">         * Crafty.audio.play(&quot;backgroundMusic&quot;, -1);</span></div><div class='line' id='LC10066'><span class="cm">         * Crafty.audio.play(&quot;explosion&quot;,1,0.5); //play sound once with volume of 50%</span></div><div class='line' id='LC10067'><span class="cm">         * ~~~</span></div><div class='line' id='LC10068'><span class="cm">         */</span></div><div class='line' id='LC10069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">play</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">,</span> <span class="nx">volume</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">repeat</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span></div><div class='line' id='LC10071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC10073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOpenChannel</span><span class="p">();</span></div><div class='line' id='LC10074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span></div><div class='line' id='LC10075'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC10076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span></div><div class='line' id='LC10077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">=</span> <span class="nx">repeat</span><span class="p">;</span></div><div class='line' id='LC10078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">;</span></div><div class='line' id='LC10079'><br/></div><div class='line' id='LC10080'><br/></div><div class='line' id='LC10081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">volume</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">volume</span><span class="p">;</span></div><div class='line' id='LC10082'><br/></div><div class='line' id='LC10083'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">volume</span><span class="p">;</span></div><div class='line' id='LC10084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span></div><div class='line' id='LC10085'><br/></div><div class='line' id='LC10086'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">muted</span><span class="p">)</span></div><div class='line' id='LC10087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC10088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></div><div class='line' id='LC10089'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">s</span><span class="p">.</span><span class="nx">played</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC10090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">onEnd</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10091'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">played</span> <span class="o">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">||</span> <span class="nx">repeat</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10092'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentTime</span><span class="p">)</span></div><div class='line' id='LC10093'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC10094'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></div><div class='line' id='LC10095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">s</span><span class="p">.</span><span class="nx">played</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC10096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC10098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC10099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&quot;ended&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">onEnd</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></div><div class='line' id='LC10100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC10101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;SoundComplete&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC10102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">id</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">id</span></div><div class='line' id='LC10103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC10104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10105'><br/></div><div class='line' id='LC10106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC10107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">a</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;ended&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">onEnd</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span></div><div class='line' id='LC10108'><br/></div><div class='line' id='LC10109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">a</span><span class="p">;</span></div><div class='line' id='LC10110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10111'><br/></div><div class='line' id='LC10112'><br/></div><div class='line' id='LC10113'><br/></div><div class='line' id='LC10114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10115'><span class="cm">         * #Crafty.audio.setChannels</span></div><div class='line' id='LC10116'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10117'><span class="cm">         * @sign public this Crafty.audio.setChannels(Number n)</span></div><div class='line' id='LC10118'><span class="cm">         * @param n - The maximum number of channels</span></div><div class='line' id='LC10119'><span class="cm">         */</span></div><div class='line' id='LC10120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">maxChannels</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span></div><div class='line' id='LC10121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setChannels</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10122'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">maxChannels</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span></div><div class='line' id='LC10123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span></div><div class='line' id='LC10124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span></div><div class='line' id='LC10125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10126'><br/></div><div class='line' id='LC10127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">channels</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC10128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Finds an unused audio element, marks it as in use, and return it.</span></div><div class='line' id='LC10129'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">getOpenChannel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">chan</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*</span></div><div class='line' id='LC10133'><span class="cm">                   * Second test looks for stuff that&#39;s out of use,</span></div><div class='line' id='LC10134'><span class="cm">                   * but fallen foul of Chromium bug 280417</span></div><div class='line' id='LC10135'><span class="cm">                   */</span></div><div class='line' id='LC10136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">chan</span><span class="p">.</span><span class="nx">active</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span></div><div class='line' id='LC10137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">chan</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">ended</span> <span class="o">&amp;&amp;</span> <span class="nx">chan</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">chan</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">played</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">chan</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC10139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">chan</span><span class="p">;</span></div><div class='line' id='LC10140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If necessary, create a new element, unless we&#39;ve already reached the max limit</span></div><div class='line' id='LC10143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxChannels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC10145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">obj</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">audioElement</span><span class="p">(),</span></div><div class='line' id='LC10146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">active</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC10147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Checks that the channel is being used to play sound id</span></div><div class='line' id='LC10148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_is</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">active</span><span class="p">;</span></div><div class='line' id='LC10150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10151'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC10152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC10153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC10154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10155'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// In that case, return null</span></div><div class='line' id='LC10156'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC10157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10158'><br/></div><div class='line' id='LC10159'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10160'><span class="cm">         * #Crafty.audio.remove</span></div><div class='line' id='LC10161'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10162'><span class="cm">         * @sign public this Crafty.audio.remove([String id])</span></div><div class='line' id='LC10163'><span class="cm">         * @param id - A string to refer to sounds</span></div><div class='line' id='LC10164'><span class="cm">         *</span></div><div class='line' id='LC10165'><span class="cm">         * Will stop the sound and remove all references to the audio object allowing the browser to free the memory.</span></div><div class='line' id='LC10166'><span class="cm">         * If no id is given, all sounds will be removed.</span></div><div class='line' id='LC10167'><span class="cm">         *</span></div><div class='line' id='LC10168'><span class="cm">         * @example</span></div><div class='line' id='LC10169'><span class="cm">         * ~~~</span></div><div class='line' id='LC10170'><span class="cm">         * Crafty.audio.remove(&quot;walk&quot;);</span></div><div class='line' id='LC10171'><span class="cm">         * ~~~</span></div><div class='line' id='LC10172'><span class="cm">         */</span></div><div class='line' id='LC10173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span><span class="p">)</span></div><div class='line' id='LC10175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10176'><br/></div><div class='line' id='LC10177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">s</span><span class="p">;</span></div><div class='line' id='LC10178'><br/></div><div class='line' id='LC10179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">s</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span></div><div class='line' id='LC10183'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">src</span><span class="p">];</span></div><div class='line' id='LC10184'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC10185'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span></div><div class='line' id='LC10189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10190'><br/></div><div class='line' id='LC10191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">s</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC10192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span></div><div class='line' id='LC10193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">assets</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">src</span><span class="p">];</span></div><div class='line' id='LC10194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">delete</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span></div><div class='line' id='LC10195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10197'><span class="cm">         * #Crafty.audio.stop</span></div><div class='line' id='LC10198'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10199'><span class="cm">         * @sign public this Crafty.audio.stop([Number ID])</span></div><div class='line' id='LC10200'><span class="cm">         *</span></div><div class='line' id='LC10201'><span class="cm">         * Stops any playing sound. if id is not set, stop all sounds which are playing</span></div><div class='line' id='LC10202'><span class="cm">         *</span></div><div class='line' id='LC10203'><span class="cm">         * @example</span></div><div class='line' id='LC10204'><span class="cm">         * ~~~</span></div><div class='line' id='LC10205'><span class="cm">         * //all sounds stopped playing now</span></div><div class='line' id='LC10206'><span class="cm">         * Crafty.audio.stop();</span></div><div class='line' id='LC10207'><span class="cm">         *</span></div><div class='line' id='LC10208'><span class="cm">         * ~~~</span></div><div class='line' id='LC10209'><span class="cm">         */</span></div><div class='line' id='LC10210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span><span class="p">)</span></div><div class='line' id='LC10212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">active</span><span class="p">)</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">_is</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC10217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC10218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**</span></div><div class='line' id='LC10223'><span class="cm">         * #Crafty.audio._mute</span></div><div class='line' id='LC10224'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10225'><span class="cm">         * @sign public this Crafty.audio._mute([Boolean mute])</span></div><div class='line' id='LC10226'><span class="cm">         *</span></div><div class='line' id='LC10227'><span class="cm">         * Mute or unmute every Audio instance that is playing.</span></div><div class='line' id='LC10228'><span class="cm">         */</span></div><div class='line' id='LC10229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_mute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mute</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span><span class="p">)</span></div><div class='line' id='LC10231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC10233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">mute</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">volume</span><span class="p">;</span></div><div class='line' id='LC10236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">muted</span> <span class="o">=</span> <span class="nx">mute</span><span class="p">;</span></div><div class='line' id='LC10238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10240'><span class="cm">         * #Crafty.audio.toggleMute</span></div><div class='line' id='LC10241'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10242'><span class="cm">         * @sign public this Crafty.audio.toggleMute()</span></div><div class='line' id='LC10243'><span class="cm">         *</span></div><div class='line' id='LC10244'><span class="cm">         * Mute or unmute every Audio instance that is playing. Toggles between</span></div><div class='line' id='LC10245'><span class="cm">         * pausing or playing depending on the state.</span></div><div class='line' id='LC10246'><span class="cm">         *</span></div><div class='line' id='LC10247'><span class="cm">         * @example</span></div><div class='line' id='LC10248'><span class="cm">         * ~~~</span></div><div class='line' id='LC10249'><span class="cm">         * //toggle mute and unmute depending on current state</span></div><div class='line' id='LC10250'><span class="cm">         * Crafty.audio.toggleMute();</span></div><div class='line' id='LC10251'><span class="cm">         * ~~~</span></div><div class='line' id='LC10252'><span class="cm">         */</span></div><div class='line' id='LC10253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">toggleMute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">muted</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mute</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></div><div class='line' id='LC10256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mute</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC10258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10259'><br/></div><div class='line' id='LC10260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10262'><span class="cm">         * #Crafty.audio.mute</span></div><div class='line' id='LC10263'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10264'><span class="cm">         * @sign public this Crafty.audio.mute()</span></div><div class='line' id='LC10265'><span class="cm">         *</span></div><div class='line' id='LC10266'><span class="cm">         * Mute every Audio instance that is playing.</span></div><div class='line' id='LC10267'><span class="cm">         *</span></div><div class='line' id='LC10268'><span class="cm">         * @example</span></div><div class='line' id='LC10269'><span class="cm">         * ~~~</span></div><div class='line' id='LC10270'><span class="cm">         * Crafty.audio.mute();</span></div><div class='line' id='LC10271'><span class="cm">         * ~~~</span></div><div class='line' id='LC10272'><span class="cm">         */</span></div><div class='line' id='LC10273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10274'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mute</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></div><div class='line' id='LC10275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10277'><span class="cm">         * #Crafty.audio.unmute</span></div><div class='line' id='LC10278'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10279'><span class="cm">         * @sign public this Crafty.audio.unmute()</span></div><div class='line' id='LC10280'><span class="cm">         *</span></div><div class='line' id='LC10281'><span class="cm">         * Unmute every Audio instance that is playing.</span></div><div class='line' id='LC10282'><span class="cm">         *</span></div><div class='line' id='LC10283'><span class="cm">         * @example</span></div><div class='line' id='LC10284'><span class="cm">         * ~~~</span></div><div class='line' id='LC10285'><span class="cm">         * Crafty.audio.unmute();</span></div><div class='line' id='LC10286'><span class="cm">         * ~~~</span></div><div class='line' id='LC10287'><span class="cm">         */</span></div><div class='line' id='LC10288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unmute</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_mute</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC10290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10291'><br/></div><div class='line' id='LC10292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10293'><span class="cm">         * #Crafty.audio.pause</span></div><div class='line' id='LC10294'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10295'><span class="cm">         * @sign public this Crafty.audio.pause(string ID)</span></div><div class='line' id='LC10296'><span class="cm">         * @param {string} id - The id of the audio object to pause</span></div><div class='line' id='LC10297'><span class="cm">         *</span></div><div class='line' id='LC10298'><span class="cm">         * Pause the Audio instance specified by id param.</span></div><div class='line' id='LC10299'><span class="cm">         *</span></div><div class='line' id='LC10300'><span class="cm">         * @example</span></div><div class='line' id='LC10301'><span class="cm">         * ~~~</span></div><div class='line' id='LC10302'><span class="cm">         * Crafty.audio.pause(&#39;music&#39;);</span></div><div class='line' id='LC10303'><span class="cm">         * ~~~</span></div><div class='line' id='LC10304'><span class="cm">         *</span></div><div class='line' id='LC10305'><span class="cm">         */</span></div><div class='line' id='LC10306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span> <span class="o">||</span> <span class="o">!</span><span class="nx">id</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span></div><div class='line' id='LC10308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC10310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10311'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10312'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">_is</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span></div><div class='line' id='LC10313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC10314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10315'><br/></div><div class='line' id='LC10316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10317'><br/></div><div class='line' id='LC10318'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10319'><span class="cm">         * #Crafty.audio.unpause</span></div><div class='line' id='LC10320'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10321'><span class="cm">         * @sign public this Crafty.audio.unpause(string ID)</span></div><div class='line' id='LC10322'><span class="cm">         * @param {string} id - The id of the audio object to unpause</span></div><div class='line' id='LC10323'><span class="cm">         *</span></div><div class='line' id='LC10324'><span class="cm">         * Resume playing the Audio instance specified by id param.</span></div><div class='line' id='LC10325'><span class="cm">         *</span></div><div class='line' id='LC10326'><span class="cm">         * @example</span></div><div class='line' id='LC10327'><span class="cm">         * ~~~</span></div><div class='line' id='LC10328'><span class="cm">         * Crafty.audio.unpause(&#39;music&#39;);</span></div><div class='line' id='LC10329'><span class="cm">         * ~~~</span></div><div class='line' id='LC10330'><span class="cm">         *</span></div><div class='line' id='LC10331'><span class="cm">         */</span></div><div class='line' id='LC10332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unpause</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span> <span class="o">||</span> <span class="o">!</span><span class="nx">id</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span></div><div class='line' id='LC10334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC10336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">_is</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span></div><div class='line' id='LC10339'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></div><div class='line' id='LC10340'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10341'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10342'><br/></div><div class='line' id='LC10343'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10344'><span class="cm">         * #Crafty.audio.togglePause</span></div><div class='line' id='LC10345'><span class="cm">         * @comp Crafty.audio</span></div><div class='line' id='LC10346'><span class="cm">         * @sign public this Crafty.audio.togglePause(string ID)</span></div><div class='line' id='LC10347'><span class="cm">         * @param {string} id - The id of the audio object to pause/</span></div><div class='line' id='LC10348'><span class="cm">         *</span></div><div class='line' id='LC10349'><span class="cm">         * Toggle the pause status of the Audio instance specified by id param.</span></div><div class='line' id='LC10350'><span class="cm">         *</span></div><div class='line' id='LC10351'><span class="cm">         * @example</span></div><div class='line' id='LC10352'><span class="cm">         * ~~~</span></div><div class='line' id='LC10353'><span class="cm">         * Crafty.audio.togglePause(&#39;music&#39;);</span></div><div class='line' id='LC10354'><span class="cm">         * ~~~</span></div><div class='line' id='LC10355'><span class="cm">         *</span></div><div class='line' id='LC10356'><span class="cm">         */</span></div><div class='line' id='LC10357'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">togglePause</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10358'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">audio</span> <span class="o">||</span> <span class="o">!</span><span class="nx">id</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">sounds</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span></div><div class='line' id='LC10359'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10360'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC10361'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10362'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">channels</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC10363'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">_is</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC10364'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10365'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></div><div class='line' id='LC10366'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10367'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC10368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10369'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10370'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10371'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10372'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10373'><span class="p">});</span></div><div class='line' id='LC10374'><br/></div><div class='line' id='LC10375'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">23</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC10376'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC10377'>	<span class="nx">Animation</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./animation.js&#39;</span><span class="p">),</span></div><div class='line' id='LC10378'>	<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC10379'><br/></div><div class='line' id='LC10380'><span class="cm">/**@</span></div><div class='line' id='LC10381'><span class="cm">* #SpriteAnimation</span></div><div class='line' id='LC10382'><span class="cm">* @category Animation</span></div><div class='line' id='LC10383'><span class="cm">* @trigger StartAnimation - When an animation starts playing, or is resumed from the paused state - {Reel}</span></div><div class='line' id='LC10384'><span class="cm">* @trigger AnimationEnd - When the animation finishes - { Reel }</span></div><div class='line' id='LC10385'><span class="cm">* @trigger FrameChange - Each time the frame of the current reel changes - { Reel }</span></div><div class='line' id='LC10386'><span class="cm">* @trigger ReelChange - When the reel changes - { Reel }</span></div><div class='line' id='LC10387'><span class="cm">*</span></div><div class='line' id='LC10388'><span class="cm">* Used to animate sprites by treating a sprite map as a set of animation frames.</span></div><div class='line' id='LC10389'><span class="cm">* Must be applied to an entity that has a sprite-map component.</span></div><div class='line' id='LC10390'><span class="cm">*</span></div><div class='line' id='LC10391'><span class="cm">* To define an animation, see the `reel` method.  To play an animation, see the `animate` method.</span></div><div class='line' id='LC10392'><span class="cm">*</span></div><div class='line' id='LC10393'><span class="cm">* A reel is an object that contains the animation frames and current state for an animation.  The reel object has the following properties:</span></div><div class='line' id='LC10394'><span class="cm">* @param id: (String) - the name of the reel</span></div><div class='line' id='LC10395'><span class="cm">* @param frames: (Array) - A list of frames in the format [xpos, ypos]</span></div><div class='line' id='LC10396'><span class="cm">* @param currentFrame: (Number) - The index of the current frame</span></div><div class='line' id='LC10397'><span class="cm">* @param easing: (Crafty.easing object) - The object that handles the internal progress of the animation.</span></div><div class='line' id='LC10398'><span class="cm">* @param duration: (Number) - The duration in milliseconds.</span></div><div class='line' id='LC10399'><span class="cm">*</span></div><div class='line' id='LC10400'><span class="cm">* Many animation related events pass a reel object as data.  As typical with events, this should be treated as read only data that might be later altered by the entity.  If you wish to preserve the data, make a copy of it.</span></div><div class='line' id='LC10401'><span class="cm">*</span></div><div class='line' id='LC10402'><span class="cm">* @see crafty.sprite</span></div><div class='line' id='LC10403'><span class="cm">*/</span></div><div class='line' id='LC10404'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;SpriteAnimation&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC10405'>	<span class="cm">/*</span></div><div class='line' id='LC10406'><span class="cm">	*</span></div><div class='line' id='LC10407'><span class="cm">	* A map in which the keys are the names assigned to animations defined using</span></div><div class='line' id='LC10408'><span class="cm">	* the component (also known as reelIDs), and the values are objects describing</span></div><div class='line' id='LC10409'><span class="cm">	* the animation and its state.</span></div><div class='line' id='LC10410'><span class="cm">	*/</span></div><div class='line' id='LC10411'>	<span class="nx">_reels</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC10412'><br/></div><div class='line' id='LC10413'>	<span class="cm">/*</span></div><div class='line' id='LC10414'><span class="cm">	* The reelID of the currently active reel (which is one of the elements in `this._reels`).</span></div><div class='line' id='LC10415'><span class="cm">	* This value is `null` if no reel is active. Some of the component&#39;s actions can be invoked</span></div><div class='line' id='LC10416'><span class="cm">	* without specifying a reel, in which case they will work on the active reel.</span></div><div class='line' id='LC10417'><span class="cm">	*/</span></div><div class='line' id='LC10418'>	<span class="nx">_currentReelId</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC10419'><br/></div><div class='line' id='LC10420'>	<span class="cm">/*</span></div><div class='line' id='LC10421'><span class="cm">	* The currently active reel.</span></div><div class='line' id='LC10422'><span class="cm">	* This value is `null` if no reel is active.</span></div><div class='line' id='LC10423'><span class="cm">	*/</span></div><div class='line' id='LC10424'>	<span class="nx">_currentReel</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC10425'><br/></div><div class='line' id='LC10426'>	<span class="cm">/*</span></div><div class='line' id='LC10427'><span class="cm">	* Whether or not an animation is currently playing.</span></div><div class='line' id='LC10428'><span class="cm">	*/</span></div><div class='line' id='LC10429'>	<span class="nx">_isPlaying</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC10430'><br/></div><div class='line' id='LC10431'>	<span class="cm">/**@</span></div><div class='line' id='LC10432'><span class="cm">	* #.animationSpeed</span></div><div class='line' id='LC10433'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10434'><span class="cm">	*</span></div><div class='line' id='LC10435'><span class="cm">	* The playback rate of the animation.  This property defaults to 1.</span></div><div class='line' id='LC10436'><span class="cm">	*/</span></div><div class='line' id='LC10437'>	<span class="nx">animationSpeed</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC10438'><br/></div><div class='line' id='LC10439'><br/></div><div class='line' id='LC10440'>	<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10441'>		<span class="k">this</span><span class="p">.</span><span class="nx">_reels</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC10442'>	<span class="p">},</span></div><div class='line' id='LC10443'><br/></div><div class='line' id='LC10444'>	<span class="cm">/**@</span></div><div class='line' id='LC10445'><span class="cm">	* #.reel</span></div><div class='line' id='LC10446'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10447'><span class="cm">	* Used to define reels, to change the active reel, and to fetch the id of the active reel.</span></div><div class='line' id='LC10448'><span class="cm">	*</span></div><div class='line' id='LC10449'><span class="cm">	* @sign public this .reel(String reelId, Duration duration, Number fromX, Number fromY, Number frameCount)</span></div><div class='line' id='LC10450'><span class="cm">	* Defines a reel by starting and ending position on the sprite sheet.</span></div><div class='line' id='LC10451'><span class="cm">	* @param reelId - ID of the animation reel being created</span></div><div class='line' id='LC10452'><span class="cm">	* @param duration - The length of the animation in milliseconds.</span></div><div class='line' id='LC10453'><span class="cm">	* @param fromX - Starting `x` position on the sprite map (x&#39;s unit is the horizontal size of the sprite in the sprite map).</span></div><div class='line' id='LC10454'><span class="cm">	* @param fromY - `y` position on the sprite map (y&#39;s unit is the horizontal size of the sprite in the sprite map). Remains constant through the animation.</span></div><div class='line' id='LC10455'><span class="cm">	* @param frameCount - The number of sequential frames in the animation.  If negative, the animation will play backwards.</span></div><div class='line' id='LC10456'><span class="cm">	*</span></div><div class='line' id='LC10457'><span class="cm">	* @sign public this .reel(String reelId, Duration duration, Array frames)</span></div><div class='line' id='LC10458'><span class="cm">	* Defines a reel by an explicit list of frames</span></div><div class='line' id='LC10459'><span class="cm">	* @param reelId - ID of the animation reel being created</span></div><div class='line' id='LC10460'><span class="cm">	* @param duration - The length of the animation in milliseconds.</span></div><div class='line' id='LC10461'><span class="cm">	* @param frames - An array of arrays containing the `x` and `y` values of successive frames: [[x1,y1],[x2,y2],...] (the values are in the unit of the sprite map&#39;s width/height respectively).</span></div><div class='line' id='LC10462'><span class="cm">	*</span></div><div class='line' id='LC10463'><span class="cm">	* @sign public this .reel(String reelId)</span></div><div class='line' id='LC10464'><span class="cm">	* Switches to the specified reel.  The sprite will be updated to that reel&#39;s current frame</span></div><div class='line' id='LC10465'><span class="cm">	* @param reelID - the ID to switch to</span></div><div class='line' id='LC10466'><span class="cm">	*</span></div><div class='line' id='LC10467'><span class="cm">	* @sign public Reel .reel()</span></div><div class='line' id='LC10468'><span class="cm">	* @return The id of the current reel</span></div><div class='line' id='LC10469'><span class="cm">	*</span></div><div class='line' id='LC10470'><span class="cm">	*</span></div><div class='line' id='LC10471'><span class="cm">	* A method to handle animation reels.  Only works for sprites built with the Crafty.sprite methods.</span></div><div class='line' id='LC10472'><span class="cm">	* See the Tween component for animation of 2D properties.</span></div><div class='line' id='LC10473'><span class="cm">	*</span></div><div class='line' id='LC10474'><span class="cm">	* To setup an animation reel, pass the name of the reel (used to identify the reel later), and either an</span></div><div class='line' id='LC10475'><span class="cm">	* array of absolute sprite positions or the start x on the sprite map, the y on the sprite map and then the end x on the sprite map.</span></div><div class='line' id='LC10476'><span class="cm">	*</span></div><div class='line' id='LC10477'><span class="cm">	*</span></div><div class='line' id='LC10478'><span class="cm">	* @example</span></div><div class='line' id='LC10479'><span class="cm">	* ~~~</span></div><div class='line' id='LC10480'><span class="cm">	* // Define a sprite-map component</span></div><div class='line' id='LC10481'><span class="cm">	* Crafty.sprite(16, &quot;images/sprite.png&quot;, {</span></div><div class='line' id='LC10482'><span class="cm">	*     PlayerSprite: [0,0]</span></div><div class='line' id='LC10483'><span class="cm">	* });</span></div><div class='line' id='LC10484'><span class="cm">	*</span></div><div class='line' id='LC10485'><span class="cm">	* // Define an animation on the second row of the sprite map (fromY = 1)</span></div><div class='line' id='LC10486'><span class="cm">	* // from the left most sprite (fromX = 0) to the fourth sprite</span></div><div class='line' id='LC10487'><span class="cm">	* // on that row (frameCount = 4), with a duration of 1 second</span></div><div class='line' id='LC10488'><span class="cm">	* Crafty.e(&quot;2D, DOM, SpriteAnimation, PlayerSprite&quot;).reel(&#39;PlayerRunning&#39;, 1000, 0, 1, 4);</span></div><div class='line' id='LC10489'><span class="cm">	*</span></div><div class='line' id='LC10490'><span class="cm">	* // This is the same animation definition, but using the alternative method</span></div><div class='line' id='LC10491'><span class="cm">	* Crafty.e(&quot;2D, DOM, SpriteAnimation, PlayerSprite&quot;).reel(&#39;PlayerRunning&#39;, 1000, [[0, 1], [1, 1], [2, 1], [3, 1]]);</span></div><div class='line' id='LC10492'><span class="cm">	* ~~~</span></div><div class='line' id='LC10493'><span class="cm">	*/</span></div><div class='line' id='LC10494'>	<span class="nx">reel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">reelId</span><span class="p">,</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">fromX</span><span class="p">,</span> <span class="nx">fromY</span><span class="p">,</span> <span class="nx">frameCount</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10495'>		<span class="c1">// @sign public this .reel()</span></div><div class='line' id='LC10496'>		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC10497'>			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">;</span></div><div class='line' id='LC10498'><br/></div><div class='line' id='LC10499'>		<span class="c1">// @sign public this .reel(String reelID)</span></div><div class='line' id='LC10500'>		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">reelId</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">){</span></div><div class='line' id='LC10501'>			<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="nx">reelId</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC10502'>				<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;The specified reel &quot;</span> <span class="o">+</span> <span class="nx">reelId</span> <span class="o">+</span> <span class="s2">&quot; is undefined.&quot;</span><span class="p">);</span></div><div class='line' id='LC10503'>			<span class="k">this</span><span class="p">.</span><span class="nx">pauseAnimation</span><span class="p">();</span></div><div class='line' id='LC10504'>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span> <span class="o">!==</span> <span class="nx">reelId</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10505'>				<span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span> <span class="o">=</span> <span class="nx">reelId</span><span class="p">;</span></div><div class='line' id='LC10506'>				<span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="nx">reelId</span><span class="p">];</span></div><div class='line' id='LC10507'>				<span class="c1">// Change the visible sprite</span></div><div class='line' id='LC10508'>				<span class="k">this</span><span class="p">.</span><span class="nx">_updateSprite</span><span class="p">();</span></div><div class='line' id='LC10509'>				<span class="c1">// Trigger event</span></div><div class='line' id='LC10510'>				<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ReelChange&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">);</span></div><div class='line' id='LC10511'>			<span class="p">}</span></div><div class='line' id='LC10512'>			<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10513'>		<span class="p">}</span></div><div class='line' id='LC10514'><br/></div><div class='line' id='LC10515'><br/></div><div class='line' id='LC10516'>		<span class="kd">var</span> <span class="nx">reel</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span></div><div class='line' id='LC10517'><br/></div><div class='line' id='LC10518'>		<span class="nx">reel</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC10519'>			<span class="nx">id</span><span class="o">:</span> <span class="nx">reelId</span><span class="p">,</span></div><div class='line' id='LC10520'>			<span class="nx">frames</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC10521'>			<span class="nx">currentFrame</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC10522'>			<span class="nx">easing</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span><span class="p">(</span><span class="nx">duration</span><span class="p">),</span></div><div class='line' id='LC10523'>			<span class="nx">defaultLoops</span><span class="o">:</span> <span class="mi">1</span></div><div class='line' id='LC10524'>		<span class="p">};</span></div><div class='line' id='LC10525'><br/></div><div class='line' id='LC10526'>		<span class="nx">reel</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">reel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span></div><div class='line' id='LC10527'><br/></div><div class='line' id='LC10528'>		<span class="c1">// @sign public this .reel(String reelId, Number duration, Number fromX, Number fromY, Number frameDuration)</span></div><div class='line' id='LC10529'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fromX</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10530'>			<span class="nx">i</span> <span class="o">=</span> <span class="nx">fromX</span><span class="p">;</span></div><div class='line' id='LC10531'>			<span class="nx">y</span> <span class="o">=</span> <span class="nx">fromY</span><span class="p">;</span></div><div class='line' id='LC10532'>			<span class="k">if</span> <span class="p">(</span><span class="nx">frameCount</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10533'>				<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">fromX</span> <span class="o">+</span> <span class="nx">frameCount</span> <span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10534'>					<span class="nx">reel</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">i</span><span class="p">,</span> <span class="nx">y</span><span class="p">]);</span></div><div class='line' id='LC10535'>				<span class="p">}</span></div><div class='line' id='LC10536'>			<span class="p">}</span></div><div class='line' id='LC10537'>			<span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10538'>				<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="nx">fromX</span> <span class="o">+</span> <span class="nx">frameCount</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10539'>					<span class="nx">reel</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">i</span><span class="p">,</span> <span class="nx">y</span><span class="p">]);</span></div><div class='line' id='LC10540'>				<span class="p">}</span></div><div class='line' id='LC10541'>			<span class="p">}</span></div><div class='line' id='LC10542'>		<span class="p">}</span></div><div class='line' id='LC10543'>		<span class="c1">// @sign public this .reel(String reelId, Number duration, Array frames)</span></div><div class='line' id='LC10544'>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">fromX</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10545'>			<span class="nx">reel</span><span class="p">.</span><span class="nx">frames</span> <span class="o">=</span> <span class="nx">fromX</span><span class="p">;</span></div><div class='line' id='LC10546'>		<span class="p">}</span></div><div class='line' id='LC10547'>		<span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10548'>			<span class="k">throw</span> <span class="s2">&quot;Urecognized arguments. Please see the documentation for &#39;reel(...)&#39;.&quot;</span><span class="p">;</span></div><div class='line' id='LC10549'>		<span class="p">}</span></div><div class='line' id='LC10550'><br/></div><div class='line' id='LC10551'>		<span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="nx">reelId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">reel</span><span class="p">;</span></div><div class='line' id='LC10552'><br/></div><div class='line' id='LC10553'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10554'>	<span class="p">},</span></div><div class='line' id='LC10555'><br/></div><div class='line' id='LC10556'>	<span class="cm">/**@</span></div><div class='line' id='LC10557'><span class="cm">	* #.animate</span></div><div class='line' id='LC10558'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10559'><span class="cm">	* @sign public this .animate([String reelId] [, Number loopCount])</span></div><div class='line' id='LC10560'><span class="cm">	* @param reelId - ID of the animation reel to play.  Defaults to the current reel if none is specified.</span></div><div class='line' id='LC10561'><span class="cm">	* @param loopCount - Number of times to repeat the animation. Use -1 to repeat indefinitely.  Defaults to 1.</span></div><div class='line' id='LC10562'><span class="cm">	*</span></div><div class='line' id='LC10563'><span class="cm">	* Play one of the reels previously defined through `.reel(...)`. Simply pass the name of the reel. If you wish the</span></div><div class='line' id='LC10564'><span class="cm">	* animation to play multiple times in succession, pass in the amount of times as an additional parameter.</span></div><div class='line' id='LC10565'><span class="cm">	* To have the animation repeat indefinitely, pass in `-1`.</span></div><div class='line' id='LC10566'><span class="cm">	*</span></div><div class='line' id='LC10567'><span class="cm">	* If another animation is currently playing, it will be paused.</span></div><div class='line' id='LC10568'><span class="cm">	*</span></div><div class='line' id='LC10569'><span class="cm">	* This will always play an animation from the beginning.  If you wish to resume from the current state of a reel, use `resumeAnimation()`.</span></div><div class='line' id='LC10570'><span class="cm">	*</span></div><div class='line' id='LC10571'><span class="cm">	* Once an animation ends, it will remain at its last frame.</span></div><div class='line' id='LC10572'><span class="cm">	*</span></div><div class='line' id='LC10573'><span class="cm">	*</span></div><div class='line' id='LC10574'><span class="cm">	* @example</span></div><div class='line' id='LC10575'><span class="cm">	* ~~~</span></div><div class='line' id='LC10576'><span class="cm">	* // Define a sprite-map component</span></div><div class='line' id='LC10577'><span class="cm">	* Crafty.sprite(16, &quot;images/sprite.png&quot;, {</span></div><div class='line' id='LC10578'><span class="cm">	*     PlayerSprite: [0,0]</span></div><div class='line' id='LC10579'><span class="cm">	* });</span></div><div class='line' id='LC10580'><span class="cm">	*</span></div><div class='line' id='LC10581'><span class="cm">	* // Play the animation across 20 frames (so each sprite in the 4 sprite animation should be seen for 5 frames) and repeat indefinitely</span></div><div class='line' id='LC10582'><span class="cm">	* Crafty.e(&quot;2D, DOM, SpriteAnimation, PlayerSprite&quot;)</span></div><div class='line' id='LC10583'><span class="cm">	*     .reel(&#39;PlayerRunning&#39;, 20, 0, 0, 3) // setup animation</span></div><div class='line' id='LC10584'><span class="cm">	*     .animate(&#39;PlayerRunning&#39;, -1); // start animation</span></div><div class='line' id='LC10585'><span class="cm">	* ~~~</span></div><div class='line' id='LC10586'><span class="cm">	*/</span></div><div class='line' id='LC10587'>	<span class="nx">animate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reelId</span><span class="p">,</span> <span class="nx">loopCount</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10588'><br/></div><div class='line' id='LC10589'>		<span class="kd">var</span> <span class="nx">pos</span><span class="p">;</span></div><div class='line' id='LC10590'><br/></div><div class='line' id='LC10591'><br/></div><div class='line' id='LC10592'>		<span class="c1">// switch to the specified reel if necessary</span></div><div class='line' id='LC10593'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">reelId</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span></div><div class='line' id='LC10594'>			<span class="k">this</span><span class="p">.</span><span class="nx">reel</span><span class="p">(</span><span class="nx">reelId</span><span class="p">);</span></div><div class='line' id='LC10595'><br/></div><div class='line' id='LC10596'>		<span class="kd">var</span> <span class="nx">currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">;</span></div><div class='line' id='LC10597'><br/></div><div class='line' id='LC10598'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">currentReel</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">currentReel</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span></div><div class='line' id='LC10599'>			<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;No reel is specified, and there is no currently active reel.&quot;</span><span class="p">);</span></div><div class='line' id='LC10600'><br/></div><div class='line' id='LC10601'>		<span class="k">this</span><span class="p">.</span><span class="nx">pauseAnimation</span><span class="p">();</span> <span class="c1">// This will pause the current animation, if one is playing</span></div><div class='line' id='LC10602'><br/></div><div class='line' id='LC10603'>		<span class="c1">// Handle repeats; if loopCount is undefined and reelID is a number, calling with that signature</span></div><div class='line' id='LC10604'>		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">loopCount</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC10605'>			<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">reelId</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span></div><div class='line' id='LC10606'>				<span class="nx">loopCount</span> <span class="o">=</span> <span class="nx">reelId</span><span class="p">;</span></div><div class='line' id='LC10607'>			<span class="k">else</span></div><div class='line' id='LC10608'>				<span class="nx">loopCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC10609'><br/></div><div class='line' id='LC10610'>		<span class="c1">// set the animation to the beginning</span></div><div class='line' id='LC10611'>		<span class="nx">currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span></div><div class='line' id='LC10612'><br/></div><div class='line' id='LC10613'><br/></div><div class='line' id='LC10614'>		<span class="c1">// user provided loop count.</span></div><div class='line' id='LC10615'>		<span class="k">this</span><span class="p">.</span><span class="nx">loops</span><span class="p">(</span><span class="nx">loopCount</span><span class="p">);</span></div><div class='line' id='LC10616'><br/></div><div class='line' id='LC10617'>		<span class="c1">// trigger the necessary events and switch to the first frame</span></div><div class='line' id='LC10618'>		<span class="k">this</span><span class="p">.</span><span class="nx">_setFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC10619'><br/></div><div class='line' id='LC10620'>		<span class="c1">// Start the anim</span></div><div class='line' id='LC10621'>		<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_animationTick</span><span class="p">);</span></div><div class='line' id='LC10622'>		<span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC10623'><br/></div><div class='line' id='LC10624'>		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StartAnimation&quot;</span><span class="p">,</span> <span class="nx">currentReel</span><span class="p">);</span></div><div class='line' id='LC10625'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10626'>	<span class="p">},</span></div><div class='line' id='LC10627'><br/></div><div class='line' id='LC10628'>	<span class="cm">/**@</span></div><div class='line' id='LC10629'><span class="cm">	* #.resumeAnimation</span></div><div class='line' id='LC10630'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10631'><span class="cm">	* @sign public this .resumeAnimation()</span></div><div class='line' id='LC10632'><span class="cm">	*</span></div><div class='line' id='LC10633'><span class="cm">	* This will resume animation of the current reel from its current state.</span></div><div class='line' id='LC10634'><span class="cm">	* If a reel is already playing, or there is no current reel, there will be no effect.</span></div><div class='line' id='LC10635'><span class="cm">	*/</span></div><div class='line' id='LC10636'>	<span class="nx">resumeAnimation</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10637'>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span>  <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10638'>			<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_animationTick</span><span class="p">);</span></div><div class='line' id='LC10639'>			<span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC10640'>			<span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span></div><div class='line' id='LC10641'>			<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StartAnimation&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">);</span></div><div class='line' id='LC10642'>		<span class="p">}</span></div><div class='line' id='LC10643'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10644'>	<span class="p">},</span></div><div class='line' id='LC10645'><br/></div><div class='line' id='LC10646'>	<span class="cm">/**@</span></div><div class='line' id='LC10647'><span class="cm">	* #.pauseAnimation</span></div><div class='line' id='LC10648'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10649'><span class="cm">	* @sign public this .pauseAnimation(void)</span></div><div class='line' id='LC10650'><span class="cm">	*</span></div><div class='line' id='LC10651'><span class="cm">	* Pauses the currently playing animation, or does nothing if no animation is playing.</span></div><div class='line' id='LC10652'><span class="cm">	*/</span></div><div class='line' id='LC10653'>	<span class="nx">pauseAnimation</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10654'>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10655'>			<span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_animationTick</span><span class="p">);</span></div><div class='line' id='LC10656'>			<span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC10657'>			<span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">].</span><span class="nx">easing</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC10658'>		<span class="p">}</span></div><div class='line' id='LC10659'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10660'>	<span class="p">},</span></div><div class='line' id='LC10661'><br/></div><div class='line' id='LC10662'>	<span class="cm">/**@</span></div><div class='line' id='LC10663'><span class="cm">	* #.resetAnimation</span></div><div class='line' id='LC10664'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10665'><span class="cm">	* @sign public this .resetAnimation()</span></div><div class='line' id='LC10666'><span class="cm">	*</span></div><div class='line' id='LC10667'><span class="cm">	* Resets the current animation to its initial state.  Resets the number of loops to the last specified value, which defaults to 1.</span></div><div class='line' id='LC10668'><span class="cm">	*</span></div><div class='line' id='LC10669'><span class="cm">	* Neither pauses nor resumes the current animation.</span></div><div class='line' id='LC10670'><span class="cm">	*/</span></div><div class='line' id='LC10671'>	<span class="nx">resetAnimation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC10672'>		<span class="kd">var</span> <span class="nx">currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">;</span></div><div class='line' id='LC10673'>		<span class="k">if</span>  <span class="p">(</span><span class="nx">currentReel</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span></div><div class='line' id='LC10674'>			<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;No active reel to reset.&quot;</span><span class="p">);</span></div><div class='line' id='LC10675'>		<span class="k">this</span><span class="p">.</span><span class="nx">reelPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC10676'>		<span class="nx">currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">currentReel</span><span class="p">.</span><span class="nx">defaultLoops</span><span class="p">);</span></div><div class='line' id='LC10677'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10678'>&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC10679'><br/></div><div class='line' id='LC10680'><br/></div><div class='line' id='LC10681'>	<span class="cm">/**@</span></div><div class='line' id='LC10682'><span class="cm">	* #.loops</span></div><div class='line' id='LC10683'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10684'><span class="cm">	* @sign public this .loops(Number loopCount)</span></div><div class='line' id='LC10685'><span class="cm">	* @param loopCount - The number of times to play the animation</span></div><div class='line' id='LC10686'><span class="cm">	*</span></div><div class='line' id='LC10687'><span class="cm">	* Sets the number of times the animation will loop for.</span></div><div class='line' id='LC10688'><span class="cm">	* If called while an animation is in progress, the current state will be considered the first loop.</span></div><div class='line' id='LC10689'><span class="cm">	*</span></div><div class='line' id='LC10690'><span class="cm">	* @sign public Number .loops()</span></div><div class='line' id='LC10691'><span class="cm">	* @returns The number of loops left.  Returns 0 if no reel is active.</span></div><div class='line' id='LC10692'><span class="cm">	*/</span></div><div class='line' id='LC10693'>	<span class="nx">loops</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loopCount</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10694'>		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span></div><div class='line' id='LC10695'>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span></div><div class='line' id='LC10696'>				<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">loops</span><span class="p">;</span></div><div class='line' id='LC10697'>			<span class="k">else</span></div><div class='line' id='LC10698'>				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC10699'>		<span class="p">}</span></div><div class='line' id='LC10700'><br/></div><div class='line' id='LC10701'>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">){</span></div><div class='line' id='LC10702'>			<span class="k">if</span> <span class="p">(</span><span class="nx">loopCount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC10703'>				<span class="nx">loopCount</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span></div><div class='line' id='LC10704'>			<span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">loopCount</span><span class="p">);</span></div><div class='line' id='LC10705'>			<span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">defaultLoops</span> <span class="o">=</span> <span class="nx">loopCount</span><span class="p">;</span></div><div class='line' id='LC10706'>		<span class="p">}</span></div><div class='line' id='LC10707'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10708'><br/></div><div class='line' id='LC10709'>	<span class="p">},</span></div><div class='line' id='LC10710'><br/></div><div class='line' id='LC10711'>	<span class="cm">/**@</span></div><div class='line' id='LC10712'><span class="cm">	* #.reelPosition</span></div><div class='line' id='LC10713'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10714'><span class="cm">	*</span></div><div class='line' id='LC10715'><span class="cm">	* @sign public this .reelPosition(Integer position)</span></div><div class='line' id='LC10716'><span class="cm">	* Sets the position of the current reel by frame number.</span></div><div class='line' id='LC10717'><span class="cm">	* @param position - the frame to jump to.  This is zero-indexed.  A negative values counts back from the last frame.</span></div><div class='line' id='LC10718'><span class="cm">	*</span></div><div class='line' id='LC10719'><span class="cm">	* @sign public this .reelPosition(Number position)</span></div><div class='line' id='LC10720'><span class="cm">	* Sets the position of the current reel by percent progress.</span></div><div class='line' id='LC10721'><span class="cm">	* @param position - a non-integer number between 0 and 1</span></div><div class='line' id='LC10722'><span class="cm">	*</span></div><div class='line' id='LC10723'><span class="cm">	* @sign public this .reelPosition(String position)</span></div><div class='line' id='LC10724'><span class="cm">	* Jumps to the specified position.  The only currently accepted value is &quot;end&quot;, which will jump to the end of the reel.</span></div><div class='line' id='LC10725'><span class="cm">	*</span></div><div class='line' id='LC10726'><span class="cm">	* @sign public Number .reelPosition()</span></div><div class='line' id='LC10727'><span class="cm">	* @returns The current frame number</span></div><div class='line' id='LC10728'><span class="cm">	*</span></div><div class='line' id='LC10729'><span class="cm">	*/</span></div><div class='line' id='LC10730'>	<span class="nx">reelPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10731'>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span></div><div class='line' id='LC10732'>			<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;No active reel.&quot;</span><span class="p">);</span></div><div class='line' id='LC10733'><br/></div><div class='line' id='LC10734'>		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC10735'>			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">currentFrame</span><span class="p">;</span></div><div class='line' id='LC10736'><br/></div><div class='line' id='LC10737'>		<span class="kd">var</span> <span class="nx">progress</span><span class="p">,</span></div><div class='line' id='LC10738'>			<span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC10739'>		<span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">===</span> <span class="s2">&quot;end&quot;</span><span class="p">)</span></div><div class='line' id='LC10740'>			<span class="nx">position</span> <span class="o">=</span> <span class="nx">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC10741'><br/></div><div class='line' id='LC10742'>		<span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">position</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10743'>			<span class="nx">progress</span> <span class="o">=</span> <span class="nx">position</span><span class="p">;</span></div><div class='line' id='LC10744'>			<span class="nx">position</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">l</span> <span class="o">*</span> <span class="nx">progress</span><span class="p">);</span></div><div class='line' id='LC10745'>		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC10746'>			<span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">!==</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">position</span><span class="p">))</span></div><div class='line' id='LC10747'>				<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Position &quot;</span> <span class="o">+</span> <span class="nx">position</span> <span class="o">+</span> <span class="s2">&quot; is invalid.&quot;</span><span class="p">);</span></div><div class='line' id='LC10748'>			<span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span></div><div class='line' id='LC10749'>				<span class="nx">position</span> <span class="o">=</span> <span class="nx">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">position</span><span class="p">;</span></div><div class='line' id='LC10750'>			<span class="nx">progress</span> <span class="o">=</span> <span class="nx">position</span> <span class="o">/</span> <span class="nx">l</span><span class="p">;</span></div><div class='line' id='LC10751'>		<span class="p">}</span></div><div class='line' id='LC10752'>		<span class="c1">// cap to last frame</span></div><div class='line' id='LC10753'>		<span class="nx">position</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">l</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC10754'>		<span class="nx">position</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC10755'>		<span class="k">this</span><span class="p">.</span><span class="nx">_setProgress</span><span class="p">(</span><span class="nx">progress</span><span class="p">);</span></div><div class='line' id='LC10756'>		<span class="k">this</span><span class="p">.</span><span class="nx">_setFrame</span><span class="p">(</span><span class="nx">position</span><span class="p">);</span></div><div class='line' id='LC10757'><br/></div><div class='line' id='LC10758'>		<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10759'><br/></div><div class='line' id='LC10760'>	<span class="p">},</span></div><div class='line' id='LC10761'><br/></div><div class='line' id='LC10762'><br/></div><div class='line' id='LC10763'>	<span class="c1">// Bound to &quot;EnterFrame&quot;.  Progresses the animation by dt, changing the frame if necessary.</span></div><div class='line' id='LC10764'>	<span class="c1">// dt is multiplied by the animationSpeed property</span></div><div class='line' id='LC10765'>	<span class="nx">_animationTick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">frameData</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10766'>		<span class="kd">var</span> <span class="nx">currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">];</span></div><div class='line' id='LC10767'>		<span class="nx">currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="nx">frameData</span><span class="p">.</span><span class="nx">dt</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">animationSpeed</span><span class="p">);</span></div><div class='line' id='LC10768'>		<span class="kd">var</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nx">currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span></div><div class='line' id='LC10769'>		<span class="kd">var</span> <span class="nx">frameNumber</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">currentReel</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nx">progress</span><span class="p">),</span> <span class="nx">currentReel</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC10770'><br/></div><div class='line' id='LC10771'>		<span class="k">this</span><span class="p">.</span><span class="nx">_setFrame</span><span class="p">(</span><span class="nx">frameNumber</span><span class="p">);</span></div><div class='line' id='LC10772'><br/></div><div class='line' id='LC10773'>		<span class="k">if</span><span class="p">(</span><span class="nx">currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">complete</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span></div><div class='line' id='LC10774'>			<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;AnimationEnd&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">);</span></div><div class='line' id='LC10775'>			<span class="k">this</span><span class="p">.</span><span class="nx">pauseAnimation</span><span class="p">();</span></div><div class='line' id='LC10776'>		<span class="p">}</span></div><div class='line' id='LC10777'>	<span class="p">},</span></div><div class='line' id='LC10778'><br/></div><div class='line' id='LC10779'><br/></div><div class='line' id='LC10780'><br/></div><div class='line' id='LC10781'><br/></div><div class='line' id='LC10782'><br/></div><div class='line' id='LC10783'>	<span class="c1">// Set the current frame and update the displayed sprite</span></div><div class='line' id='LC10784'>	<span class="c1">// The actual progress for the animation must be set seperately.</span></div><div class='line' id='LC10785'>	<span class="nx">_setFrame</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">frameNumber</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10786'>		<span class="kd">var</span> <span class="nx">currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">;</span></div><div class='line' id='LC10787'>		<span class="k">if</span> <span class="p">(</span><span class="nx">frameNumber</span> <span class="o">===</span> <span class="nx">currentReel</span><span class="p">.</span><span class="nx">currentFrame</span><span class="p">)</span></div><div class='line' id='LC10788'>			<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC10789'>		<span class="nx">currentReel</span><span class="p">.</span><span class="nx">currentFrame</span> <span class="o">=</span> <span class="nx">frameNumber</span><span class="p">;</span></div><div class='line' id='LC10790'>		<span class="k">this</span><span class="p">.</span><span class="nx">_updateSprite</span><span class="p">();</span></div><div class='line' id='LC10791'>		<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;FrameChange&quot;</span><span class="p">,</span> <span class="nx">currentReel</span><span class="p">);</span></div><div class='line' id='LC10792'>	<span class="p">},</span></div><div class='line' id='LC10793'><br/></div><div class='line' id='LC10794'>	<span class="c1">// Update the displayed sprite.</span></div><div class='line' id='LC10795'>	<span class="nx">_updateSprite</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10796'>		<span class="kd">var</span> <span class="nx">currentReel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">;</span></div><div class='line' id='LC10797'>		<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">currentReel</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">currentReel</span><span class="p">.</span><span class="nx">currentFrame</span><span class="p">];</span></div><div class='line' id='LC10798'>		<span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="nx">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// .sprite will trigger redraw</span></div><div class='line' id='LC10799'><br/></div><div class='line' id='LC10800'>	<span class="p">},</span></div><div class='line' id='LC10801'><br/></div><div class='line' id='LC10802'><br/></div><div class='line' id='LC10803'>	<span class="c1">// Sets the internal state of the current reel&#39;s easing object</span></div><div class='line' id='LC10804'>	<span class="nx">_setProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span> <span class="nx">repeats</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10805'>		<span class="k">this</span><span class="p">.</span><span class="nx">_currentReel</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">setProgress</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span> <span class="nx">repeats</span><span class="p">);</span></div><div class='line' id='LC10806'><br/></div><div class='line' id='LC10807'>	<span class="p">},</span></div><div class='line' id='LC10808'><br/></div><div class='line' id='LC10809'><br/></div><div class='line' id='LC10810'>	<span class="cm">/**@</span></div><div class='line' id='LC10811'><span class="cm">	* #.isPlaying</span></div><div class='line' id='LC10812'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10813'><span class="cm">	* @sign public Boolean .isPlaying([String reelId])</span></div><div class='line' id='LC10814'><span class="cm">	* @param reelId - The reelId of the reel we wish to examine</span></div><div class='line' id='LC10815'><span class="cm">	* @returns The current animation state</span></div><div class='line' id='LC10816'><span class="cm">	*</span></div><div class='line' id='LC10817'><span class="cm">	* Determines if the specified animation is currently playing. If no reelId is specified,</span></div><div class='line' id='LC10818'><span class="cm">	* checks if any animation is playing.</span></div><div class='line' id='LC10819'><span class="cm">	*</span></div><div class='line' id='LC10820'><span class="cm">	* @example</span></div><div class='line' id='LC10821'><span class="cm">	* ~~~</span></div><div class='line' id='LC10822'><span class="cm">	* myEntity.isPlaying() // is any animation playing</span></div><div class='line' id='LC10823'><span class="cm">	* myEntity.isPlaying(&#39;PlayerRunning&#39;) // is the PlayerRunning animation playing</span></div><div class='line' id='LC10824'><span class="cm">	* ~~~</span></div><div class='line' id='LC10825'><span class="cm">	*/</span></div><div class='line' id='LC10826'>	<span class="nx">isPlaying</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">reelId</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10827'>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_isPlaying</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC10828'><br/></div><div class='line' id='LC10829'>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">reelId</span><span class="p">)</span> <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">;</span></div><div class='line' id='LC10830'>		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span> <span class="o">===</span> <span class="nx">reelId</span><span class="p">;</span></div><div class='line' id='LC10831'>	<span class="p">},</span></div><div class='line' id='LC10832'><br/></div><div class='line' id='LC10833'>	<span class="cm">/**@</span></div><div class='line' id='LC10834'><span class="cm">	* #.getReel</span></div><div class='line' id='LC10835'><span class="cm">	* @comp SpriteAnimation</span></div><div class='line' id='LC10836'><span class="cm">	* @sign public Reel .getReel()</span></div><div class='line' id='LC10837'><span class="cm">	* @returns The current reel, or null if there is no active reel</span></div><div class='line' id='LC10838'><span class="cm">	*</span></div><div class='line' id='LC10839'><span class="cm">	* @sign public Reel .getReel(reelId)</span></div><div class='line' id='LC10840'><span class="cm">	* @param reelId - The id of the reel to fetch.</span></div><div class='line' id='LC10841'><span class="cm">	* @returns The specified reel, or `undefined` if no such reel exists.</span></div><div class='line' id='LC10842'><span class="cm">	*</span></div><div class='line' id='LC10843'><span class="cm">	*/</span></div><div class='line' id='LC10844'>	<span class="nx">getReel</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">reelId</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10845'>		<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">){</span></div><div class='line' id='LC10846'>			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC10847'>			<span class="nx">reelId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_currentReelId</span><span class="p">;</span></div><div class='line' id='LC10848'>		<span class="p">}</span></div><div class='line' id='LC10849'><br/></div><div class='line' id='LC10850'>		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_reels</span><span class="p">[</span><span class="nx">reelId</span><span class="p">];</span></div><div class='line' id='LC10851'>	<span class="p">}</span></div><div class='line' id='LC10852'><span class="p">});</span></div><div class='line' id='LC10853'><br/></div><div class='line' id='LC10854'><span class="p">},{</span><span class="s2">&quot;./animation.js&quot;</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">24</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC10855'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC10856'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC10857'><br/></div><div class='line' id='LC10858'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC10859'><br/></div><div class='line' id='LC10860'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC10861'><span class="cm">     * #Crafty.sprite</span></div><div class='line' id='LC10862'><span class="cm">     * @category Graphics</span></div><div class='line' id='LC10863'><span class="cm">     * @sign public this Crafty.sprite([Number tile, [Number tileh]], String url, Object map[, Number paddingX[, Number paddingY[, Boolean paddingAroundBorder]]])</span></div><div class='line' id='LC10864'><span class="cm">     * @param tile - Tile size of the sprite map, defaults to 1</span></div><div class='line' id='LC10865'><span class="cm">     * @param tileh - Height of the tile; if provided, tile is interpreted as the width</span></div><div class='line' id='LC10866'><span class="cm">     * @param url - URL of the sprite image</span></div><div class='line' id='LC10867'><span class="cm">     * @param map - Object where the key is what becomes a new component and the value points to a position on the sprite map</span></div><div class='line' id='LC10868'><span class="cm">     * @param paddingX - Horizontal space in between tiles. Defaults to 0.</span></div><div class='line' id='LC10869'><span class="cm">     * @param paddingY - Vertical space in between tiles. Defaults to paddingX.</span></div><div class='line' id='LC10870'><span class="cm">     * @param paddingAroundBorder - If padding should be applied around the border of the sprite sheet. If enabled the first tile starts at (paddingX,paddingY) instead of (0,0). Defaults to false.</span></div><div class='line' id='LC10871'><span class="cm">     * Generates components based on positions in a sprite image to be applied to entities.</span></div><div class='line' id='LC10872'><span class="cm">     *</span></div><div class='line' id='LC10873'><span class="cm">     * Accepts a tile size, URL and map for the name of the sprite and its position.</span></div><div class='line' id='LC10874'><span class="cm">     *</span></div><div class='line' id='LC10875'><span class="cm">     * The position must be an array containing the position of the sprite where index `0`</span></div><div class='line' id='LC10876'><span class="cm">     * is the `x` position, `1` is the `y` position and optionally `2` is the width and `3`</span></div><div class='line' id='LC10877'><span class="cm">     * is the height. If the sprite map has padding, pass the values for the `x` padding</span></div><div class='line' id='LC10878'><span class="cm">     * or `y` padding. If they are the same, just add one value.</span></div><div class='line' id='LC10879'><span class="cm">     *</span></div><div class='line' id='LC10880'><span class="cm">     * If the sprite image has no consistent tile size, `1` or no argument need be</span></div><div class='line' id='LC10881'><span class="cm">     * passed for tile size.</span></div><div class='line' id='LC10882'><span class="cm">     *</span></div><div class='line' id='LC10883'><span class="cm">     * Entities that add the generated components are also given the `2D` component, and</span></div><div class='line' id='LC10884'><span class="cm">     * a component called `Sprite`.</span></div><div class='line' id='LC10885'><span class="cm">     *</span></div><div class='line' id='LC10886'><span class="cm">     * @example</span></div><div class='line' id='LC10887'><span class="cm">     * ~~~</span></div><div class='line' id='LC10888'><span class="cm">     * Crafty.sprite(&quot;imgs/spritemap6.png&quot;, {flower:[0,0,20,30]});</span></div><div class='line' id='LC10889'><span class="cm">     * var flower_entity = Crafty.e(&quot;2D, DOM, flower&quot;);</span></div><div class='line' id='LC10890'><span class="cm">     * ~~~</span></div><div class='line' id='LC10891'><span class="cm">     * The first line creates a component called `flower` associated with the sub-image of</span></div><div class='line' id='LC10892'><span class="cm">     * spritemap6.png with top-left corner (0,0), width 20 pixels, and height 30 pixels.</span></div><div class='line' id='LC10893'><span class="cm">     * The second line creates an entity with that image. (Note: The `2D` is not really</span></div><div class='line' id='LC10894'><span class="cm">     * necessary here, because adding the `flower` component automatically also adds the</span></div><div class='line' id='LC10895'><span class="cm">     * `2D` component.)</span></div><div class='line' id='LC10896'><span class="cm">     * ~~~</span></div><div class='line' id='LC10897'><span class="cm">     * Crafty.sprite(50, &quot;imgs/spritemap6.png&quot;, {flower:[0,0], grass:[0,1,3,1]});</span></div><div class='line' id='LC10898'><span class="cm">     * ~~~</span></div><div class='line' id='LC10899'><span class="cm">     * In this case, the `flower` component is pixels 0 &lt;= x &lt; 50, 0 &lt;= y &lt; 50, and the</span></div><div class='line' id='LC10900'><span class="cm">     * `grass` component is pixels 0 &lt;= x &lt; 150, 50 &lt;= y &lt; 100. (The `3` means grass has a</span></div><div class='line' id='LC10901'><span class="cm">     * width of 3 tiles, i.e. 150 pixels.)</span></div><div class='line' id='LC10902'><span class="cm">     * ~~~</span></div><div class='line' id='LC10903'><span class="cm">     * Crafty.sprite(50, 100, &quot;imgs/spritemap6.png&quot;, {flower:[0,0], grass:[0,1]}, 10);</span></div><div class='line' id='LC10904'><span class="cm">     * ~~~</span></div><div class='line' id='LC10905'><span class="cm">     * In this case, each tile is 50x100, and there is a spacing of 10 pixels between</span></div><div class='line' id='LC10906'><span class="cm">     * consecutive tiles. So `flower` is pixels 0 &lt;= x &lt; 50, 0 &lt;= y &lt; 100, and `grass` is</span></div><div class='line' id='LC10907'><span class="cm">     * pixels 0 &lt;= x &lt; 50, 110 &lt;= y &lt; 210.</span></div><div class='line' id='LC10908'><span class="cm">     *</span></div><div class='line' id='LC10909'><span class="cm">     * @see Sprite</span></div><div class='line' id='LC10910'><span class="cm">     */</span></div><div class='line' id='LC10911'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sprite</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tile</span><span class="p">,</span> <span class="nx">tileh</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">paddingX</span><span class="p">,</span> <span class="nx">paddingY</span><span class="p">,</span> <span class="nx">paddingAroundBorder</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10912'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">spriteName</span><span class="p">,</span> <span class="nx">temp</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">img</span><span class="p">;</span></div><div class='line' id='LC10913'><br/></div><div class='line' id='LC10914'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if no tile value, default to 1.</span></div><div class='line' id='LC10915'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//(if the first passed argument is a string, it must be the url.)</span></div><div class='line' id='LC10916'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">tile</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10917'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingY</span> <span class="o">=</span> <span class="nx">paddingX</span><span class="p">;</span></div><div class='line' id='LC10918'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingX</span> <span class="o">=</span> <span class="nx">map</span><span class="p">;</span></div><div class='line' id='LC10919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">map</span> <span class="o">=</span> <span class="nx">tileh</span><span class="p">;</span></div><div class='line' id='LC10920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">url</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">;</span></div><div class='line' id='LC10921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tile</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC10922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tileh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC10923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10924'><br/></div><div class='line' id='LC10925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">tileh</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingY</span> <span class="o">=</span> <span class="nx">paddingX</span><span class="p">;</span></div><div class='line' id='LC10927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingX</span> <span class="o">=</span> <span class="nx">map</span><span class="p">;</span></div><div class='line' id='LC10928'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">map</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span></div><div class='line' id='LC10929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">url</span> <span class="o">=</span> <span class="nx">tileh</span><span class="p">;</span></div><div class='line' id='LC10930'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">tileh</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">;</span></div><div class='line' id='LC10931'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10932'><br/></div><div class='line' id='LC10933'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if no paddingY, use paddingX</span></div><div class='line' id='LC10934'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">paddingY</span> <span class="o">&amp;&amp;</span> <span class="nx">paddingX</span><span class="p">)</span> <span class="nx">paddingY</span> <span class="o">=</span> <span class="nx">paddingX</span><span class="p">;</span></div><div class='line' id='LC10935'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingX</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">paddingX</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">//just incase</span></div><div class='line' id='LC10936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">paddingY</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">paddingY</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span></div><div class='line' id='LC10937'><br/></div><div class='line' id='LC10938'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">markSpritesReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC10940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC10941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC10942'><br/></div><div class='line' id='LC10943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">img</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span></div><div class='line' id='LC10944'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">img</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10945'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span></div><div class='line' id='LC10946'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span></div><div class='line' id='LC10947'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">asset</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">img</span><span class="p">);</span></div><div class='line' id='LC10948'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//all components with this img are now ready</span></div><div class='line' id='LC10950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">spriteName</span> <span class="k">in</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">(</span><span class="nx">spriteName</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="nx">markSpritesReady</span><span class="p">);</span></div><div class='line' id='LC10952'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC10954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10955'><br/></div><div class='line' id='LC10956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">sharedSpriteInit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC10957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D, Sprite&quot;</span><span class="p">);</span></div><div class='line' id='LC10958'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC10959'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__image</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span></div><div class='line' id='LC10960'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">3</span><span class="p">]];</span></div><div class='line' id='LC10961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__tile</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">;</span></div><div class='line' id='LC10962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__tileh</span> <span class="o">=</span> <span class="nx">tileh</span><span class="p">;</span></div><div class='line' id='LC10963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__padding</span> <span class="o">=</span> <span class="p">[</span><span class="nx">paddingX</span><span class="p">,</span> <span class="nx">paddingY</span><span class="p">];</span></div><div class='line' id='LC10964'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__padBorder</span> <span class="o">=</span> <span class="nx">paddingAroundBorder</span><span class="p">;</span></div><div class='line' id='LC10965'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span></div><div class='line' id='LC10966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC10967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">img</span> <span class="o">=</span> <span class="nx">img</span><span class="p">;</span></div><div class='line' id='LC10968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//draw now</span></div><div class='line' id='LC10969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">complete</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10970'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC10971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC10972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10973'><br/></div><div class='line' id='LC10974'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//set the width and height to the sprite size</span></div><div class='line' id='LC10975'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC10976'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span></div><div class='line' id='LC10977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC10978'><br/></div><div class='line' id='LC10979'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="nx">spriteName</span> <span class="k">in</span> <span class="nx">map</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC10980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">map</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">spriteName</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span></div><div class='line' id='LC10981'><br/></div><div class='line' id='LC10982'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">temp</span> <span class="o">=</span> <span class="nx">map</span><span class="p">[</span><span class="nx">spriteName</span><span class="p">];</span></div><div class='line' id='LC10983'><br/></div><div class='line' id='LC10984'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//generates sprite components for each tile in the map</span></div><div class='line' id='LC10985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="nx">spriteName</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC10986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC10987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__coord</span><span class="o">:</span> <span class="p">[</span><span class="nx">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">temp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">||</span> <span class="mi">1</span><span class="p">],</span></div><div class='line' id='LC10988'><br/></div><div class='line' id='LC10989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="nx">sharedSpriteInit</span></div><div class='line' id='LC10990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC10991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10992'><br/></div><div class='line' id='LC10993'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC10994'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC10995'><span class="p">});</span></div><div class='line' id='LC10996'><br/></div><div class='line' id='LC10997'><span class="cm">/**@</span></div><div class='line' id='LC10998'><span class="cm"> * #Sprite</span></div><div class='line' id='LC10999'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC11000'><span class="cm"> * @trigger Invalidate - when the sprites change</span></div><div class='line' id='LC11001'><span class="cm"> * Component for using tiles in a sprite map.</span></div><div class='line' id='LC11002'><span class="cm"> */</span></div><div class='line' id='LC11003'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Sprite&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC11004'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__image</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></div><div class='line' id='LC11005'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*</span></div><div class='line' id='LC11006'><span class="cm">     * #.__tile</span></div><div class='line' id='LC11007'><span class="cm">     * @comp Sprite</span></div><div class='line' id='LC11008'><span class="cm">     *</span></div><div class='line' id='LC11009'><span class="cm">     * Horizontal sprite tile size.</span></div><div class='line' id='LC11010'><span class="cm">     */</span></div><div class='line' id='LC11011'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__tile</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11012'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/*</span></div><div class='line' id='LC11013'><span class="cm">     * #.__tileh</span></div><div class='line' id='LC11014'><span class="cm">     * @comp Sprite</span></div><div class='line' id='LC11015'><span class="cm">     *</span></div><div class='line' id='LC11016'><span class="cm">     * Vertical sprite tile size.</span></div><div class='line' id='LC11017'><span class="cm">     */</span></div><div class='line' id='LC11018'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__tileh</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11019'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__padding</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC11020'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">__trim</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC11021'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">img</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC11022'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//ready is changed to true in Crafty.sprite</span></div><div class='line' id='LC11023'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC11024'><br/></div><div class='line' id='LC11025'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC11027'><br/></div><div class='line' id='LC11028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">co</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">co</span><span class="p">,</span></div><div class='line' id='LC11030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pos</span><span class="p">,</span></div><div class='line' id='LC11031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span></div><div class='line' id='LC11032'><br/></div><div class='line' id='LC11033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;canvas&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//draw the image on the canvas element</span></div><div class='line' id='LC11035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">,</span> <span class="c1">//image element</span></div><div class='line' id='LC11036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="c1">//x position on sprite</span></div><div class='line' id='LC11037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="c1">//y position on sprite</span></div><div class='line' id='LC11038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="c1">//width on sprite</span></div><div class='line' id='LC11039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">h</span><span class="p">,</span> <span class="c1">//height on sprite</span></div><div class='line' id='LC11040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="c1">//x position on canvas</span></div><div class='line' id='LC11041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="c1">//y position on canvas</span></div><div class='line' id='LC11042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="c1">//width on canvas</span></div><div class='line' id='LC11043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span> <span class="c1">//height on canvas</span></div><div class='line' id='LC11044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC11045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;DOM&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Get scale (ratio of entity dimensions to sprite&#39;s dimensions)</span></div><div class='line' id='LC11047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If needed, we will scale up the entire sprite sheet, and then modify the position accordingly</span></div><div class='line' id='LC11048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vscale</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">/</span> <span class="nx">co</span><span class="p">.</span><span class="nx">h</span><span class="p">,</span></div><div class='line' id='LC11049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">hscale</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">/</span> <span class="nx">co</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span></div><div class='line' id='LC11050'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span></div><div class='line' id='LC11051'><br/></div><div class='line' id='LC11052'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">+</span> <span class="s2">&quot; url(&#39;&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__image</span> <span class="o">+</span> <span class="s2">&quot;&#39;) no-repeat&quot;</span><span class="p">;</span></div><div class='line' id='LC11053'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">backgroundPosition</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">hscale</span> <span class="o">+</span> <span class="s2">&quot;px -&quot;</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">vscale</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC11054'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// style.backgroundSize must be set AFTER style.background!</span></div><div class='line' id='LC11055'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">vscale</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">hscale</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11056'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">backgroundSize</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">hscale</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">vscale</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC11057'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11058'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11059'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11060'><br/></div><div class='line' id='LC11061'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;RemoveComponent&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11062'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;Sprite&quot;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">);</span></div><div class='line' id='LC11063'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11064'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11065'><br/></div><div class='line' id='LC11066'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11067'><span class="cm">     * #.sprite</span></div><div class='line' id='LC11068'><span class="cm">     * @comp Sprite</span></div><div class='line' id='LC11069'><span class="cm">     * @sign public this .sprite(Number x, Number y[, Number w, Number h])</span></div><div class='line' id='LC11070'><span class="cm">     * @param x - X cell position</span></div><div class='line' id='LC11071'><span class="cm">     * @param y - Y cell position</span></div><div class='line' id='LC11072'><span class="cm">     * @param w - Width in cells. Optional.</span></div><div class='line' id='LC11073'><span class="cm">     * @param h - Height in cells. Optional.</span></div><div class='line' id='LC11074'><span class="cm">     *</span></div><div class='line' id='LC11075'><span class="cm">     * Uses a new location on the sprite map as its sprite. If w or h are ommitted, the width and height are not changed.</span></div><div class='line' id='LC11076'><span class="cm">     *</span></div><div class='line' id='LC11077'><span class="cm">     * Values should be in tiles or cells (not pixels).</span></div><div class='line' id='LC11078'><span class="cm">     *</span></div><div class='line' id='LC11079'><span class="cm">     * @example</span></div><div class='line' id='LC11080'><span class="cm">     * ~~~</span></div><div class='line' id='LC11081'><span class="cm">     * Crafty.e(&quot;2D, DOM, Sprite&quot;)</span></div><div class='line' id='LC11082'><span class="cm">     *   .sprite(0, 0, 2, 2);</span></div><div class='line' id='LC11083'><span class="cm">     * ~~~</span></div><div class='line' id='LC11084'><span class="cm">     */</span></div><div class='line' id='LC11085'><br/></div><div class='line' id='LC11086'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11087'><span class="cm">     * #.__coord</span></div><div class='line' id='LC11088'><span class="cm">     * @comp Sprite</span></div><div class='line' id='LC11089'><span class="cm">     *</span></div><div class='line' id='LC11090'><span class="cm">     * The coordinate of the slide within the sprite in the format of [x, y, w, h].</span></div><div class='line' id='LC11091'><span class="cm">     */</span></div><div class='line' id='LC11092'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sprite</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11093'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">||</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC11094'><br/></div><div class='line' id='LC11095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__tile</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__padding</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__padBorder</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">__padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC11096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__tileh</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__padding</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__padBorder</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">__padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span></div><div class='line' id='LC11097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span><span class="o">!==</span><span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span><span class="o">!==</span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="nx">w</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">__tile</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">__tile</span><span class="p">;</span></div><div class='line' id='LC11099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">||</span> <span class="nx">h</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">__tileh</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">__tileh</span><span class="p">;</span></div><div class='line' id='LC11100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11101'><br/></div><div class='line' id='LC11102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC11103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11104'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11105'><br/></div><div class='line' id='LC11106'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11107'><span class="cm">     * #.crop</span></div><div class='line' id='LC11108'><span class="cm">     * @comp Sprite</span></div><div class='line' id='LC11109'><span class="cm">     * @sign public this .crop(Number x, Number y, Number w, Number h)</span></div><div class='line' id='LC11110'><span class="cm">     * @param x - Offset x position</span></div><div class='line' id='LC11111'><span class="cm">     * @param y - Offset y position</span></div><div class='line' id='LC11112'><span class="cm">     * @param w - New width</span></div><div class='line' id='LC11113'><span class="cm">     * @param h - New height</span></div><div class='line' id='LC11114'><span class="cm">     *</span></div><div class='line' id='LC11115'><span class="cm">     * If the entity needs to be smaller than the tile size, use this method to crop it.</span></div><div class='line' id='LC11116'><span class="cm">     *</span></div><div class='line' id='LC11117'><span class="cm">     * The values should be in pixels rather than tiles.</span></div><div class='line' id='LC11118'><span class="cm">     *</span></div><div class='line' id='LC11119'><span class="cm">     * @example</span></div><div class='line' id='LC11120'><span class="cm">     * ~~~</span></div><div class='line' id='LC11121'><span class="cm">     * Crafty.e(&quot;2D, DOM, Sprite&quot;)</span></div><div class='line' id='LC11122'><span class="cm">     *   .crop(40, 40, 22, 23);</span></div><div class='line' id='LC11123'><span class="cm">     * ~~~</span></div><div class='line' id='LC11124'><span class="cm">     */</span></div><div class='line' id='LC11125'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">crop</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mbr</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">();</span></div><div class='line' id='LC11127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC11128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC11129'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC11130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC11131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__trim</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC11132'><br/></div><div class='line' id='LC11133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC11134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC11135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC11136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__coord</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC11137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC11138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC11139'><br/></div><div class='line' id='LC11140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">,</span> <span class="nx">old</span><span class="p">);</span></div><div class='line' id='LC11141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11142'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11143'><span class="p">});</span></div><div class='line' id='LC11144'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">25</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11145'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC11146'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC11147'><br/></div><div class='line' id='LC11148'><span class="cm">/**@</span></div><div class='line' id='LC11149'><span class="cm"> * #Storage</span></div><div class='line' id='LC11150'><span class="cm"> * @category Utilities</span></div><div class='line' id='LC11151'><span class="cm"> * Very simple way to get and set values, which will persist when the browser is closed also.</span></div><div class='line' id='LC11152'><span class="cm"> */</span></div><div class='line' id='LC11153'><span class="cm">/**@</span></div><div class='line' id='LC11154'><span class="cm"> * #.storage</span></div><div class='line' id='LC11155'><span class="cm"> * @comp Storage</span></div><div class='line' id='LC11156'><span class="cm"> * @sign .storage(String key)</span></div><div class='line' id='LC11157'><span class="cm"> * @param key - a key you would like to get from the storage. It will return null if the key does not exists.</span></div><div class='line' id='LC11158'><span class="cm"> * @sign .storage(String key, String value)</span></div><div class='line' id='LC11159'><span class="cm"> * @param key - the key you would like to save the data under.</span></div><div class='line' id='LC11160'><span class="cm"> * @param value - the value you would like to save.</span></div><div class='line' id='LC11161'><span class="cm"> * @sign .storage(String key, [Object value, Array value, Boolean value])</span></div><div class='line' id='LC11162'><span class="cm"> * @param key - the key you would like to save the data under.</span></div><div class='line' id='LC11163'><span class="cm"> * @param value - the value you would like to save, can be an Object or an Array.</span></div><div class='line' id='LC11164'><span class="cm"> *</span></div><div class='line' id='LC11165'><span class="cm"> * Storage function is very simple and can be used to either get or set values. </span></div><div class='line' id='LC11166'><span class="cm"> * You can store both booleans, strings, objects and arrays.</span></div><div class='line' id='LC11167'><span class="cm"> *</span></div><div class='line' id='LC11168'><span class="cm"> * Please note: You should not store data, while the game is playing, as it can cause the game to slow down. You should load data when you start the game, or when the user for an example click a &quot;Save gameprocess&quot; button.</span></div><div class='line' id='LC11169'><span class="cm"> *</span></div><div class='line' id='LC11170'><span class="cm"> * @example</span></div><div class='line' id='LC11171'><span class="cm"> * Get an already stored value</span></div><div class='line' id='LC11172'><span class="cm"> * ~~~</span></div><div class='line' id='LC11173'><span class="cm"> * var playername = Crafty.storage(&#39;playername&#39;);</span></div><div class='line' id='LC11174'><span class="cm"> * ~~~</span></div><div class='line' id='LC11175'><span class="cm"> *</span></div><div class='line' id='LC11176'><span class="cm"> * @example</span></div><div class='line' id='LC11177'><span class="cm"> * Save a value</span></div><div class='line' id='LC11178'><span class="cm"> * ~~~</span></div><div class='line' id='LC11179'><span class="cm"> * Crafty.storage(&#39;playername&#39;, &#39;Hero&#39;);</span></div><div class='line' id='LC11180'><span class="cm"> * ~~~</span></div><div class='line' id='LC11181'><span class="cm"> *</span></div><div class='line' id='LC11182'><span class="cm"> * @example</span></div><div class='line' id='LC11183'><span class="cm"> * Test to see if a value is already there.</span></div><div class='line' id='LC11184'><span class="cm"> * ~~~</span></div><div class='line' id='LC11185'><span class="cm"> * var heroname = Crafty.storage(&#39;name&#39;);</span></div><div class='line' id='LC11186'><span class="cm"> * if(!heroname){</span></div><div class='line' id='LC11187'><span class="cm"> *   // Maybe ask the player what their name is here</span></div><div class='line' id='LC11188'><span class="cm"> *   heroname = &#39;Guest&#39;;</span></div><div class='line' id='LC11189'><span class="cm"> * }</span></div><div class='line' id='LC11190'><span class="cm"> * // Do something with heroname</span></div><div class='line' id='LC11191'><span class="cm"> * ~~~</span></div><div class='line' id='LC11192'><span class="cm"> */</span></div><div class='line' id='LC11193'><br/></div><div class='line' id='LC11194'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">){</span></div><div class='line' id='LC11195'>&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">storage</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">,</span></div><div class='line' id='LC11196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC11197'><br/></div><div class='line' id='LC11198'>&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">storage</span><span class="p">){</span></div><div class='line' id='LC11199'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC11200'>&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11201'><br/></div><div class='line' id='LC11202'>&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11203'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">try</span> <span class="p">{</span></div><div class='line' id='LC11204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">));</span></div><div class='line' id='LC11205'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11206'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></div><div class='line' id='LC11208'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11209'>&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC11210'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_value</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span></div><div class='line' id='LC11212'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11213'><br/></div><div class='line' id='LC11214'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">_value</span><span class="p">);</span></div><div class='line' id='LC11215'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC11216'>&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11217'><br/></div><div class='line' id='LC11218'><span class="p">};</span></div><div class='line' id='LC11219'><span class="cm">/**@</span></div><div class='line' id='LC11220'><span class="cm"> * #.storage.remove</span></div><div class='line' id='LC11221'><span class="cm"> * @comp Storage</span></div><div class='line' id='LC11222'><span class="cm"> * @sign .storage.remove(String key)</span></div><div class='line' id='LC11223'><span class="cm"> * @param key - a key where you will like to delete the value of.</span></div><div class='line' id='LC11224'><span class="cm"> *</span></div><div class='line' id='LC11225'><span class="cm"> * Generally you do not need to remove values from localStorage, but if you do</span></div><div class='line' id='LC11226'><span class="cm"> * store large amount of text, or want to unset something you can do that with</span></div><div class='line' id='LC11227'><span class="cm"> * this function.</span></div><div class='line' id='LC11228'><span class="cm"> *</span></div><div class='line' id='LC11229'><span class="cm"> * @example</span></div><div class='line' id='LC11230'><span class="cm"> * Get an already stored value</span></div><div class='line' id='LC11231'><span class="cm"> * ~~~</span></div><div class='line' id='LC11232'><span class="cm"> * Crafty.storage.remove(&#39;playername&#39;);</span></div><div class='line' id='LC11233'><span class="cm"> * ~~~</span></div><div class='line' id='LC11234'><span class="cm"> *</span></div><div class='line' id='LC11235'><span class="cm"> */</span></div><div class='line' id='LC11236'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">){</span></div><div class='line' id='LC11237'>&nbsp;&nbsp;<span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span></div><div class='line' id='LC11238'><span class="p">};</span></div><div class='line' id='LC11239'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">26</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11240'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC11241'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC11242'><br/></div><div class='line' id='LC11243'><span class="cm">/**@</span></div><div class='line' id='LC11244'><span class="cm"> * #Text</span></div><div class='line' id='LC11245'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC11246'><span class="cm"> * @trigger Invalidate - when the text is changed</span></div><div class='line' id='LC11247'><span class="cm"> * @requires Canvas or DOM</span></div><div class='line' id='LC11248'><span class="cm"> * Component to make a text entity.</span></div><div class='line' id='LC11249'><span class="cm"> *</span></div><div class='line' id='LC11250'><span class="cm"> * By default, text will have the style &quot;10px sans-serif&quot;.</span></div><div class='line' id='LC11251'><span class="cm"> *</span></div><div class='line' id='LC11252'><span class="cm"> * Note 1: An entity with the text component is just text! If you want to write text</span></div><div class='line' id='LC11253'><span class="cm"> * inside an image, you need one entity for the text and another entity for the image.</span></div><div class='line' id='LC11254'><span class="cm"> * More tips for writing text inside an image: (1) Use the z-index (from 2D component)</span></div><div class='line' id='LC11255'><span class="cm"> * to ensure that the text is on top of the image, not the other way around; (2)</span></div><div class='line' id='LC11256'><span class="cm"> * use .attach() (from 2D component) to glue the text to the image so they move and</span></div><div class='line' id='LC11257'><span class="cm"> * rotate together.</span></div><div class='line' id='LC11258'><span class="cm"> *</span></div><div class='line' id='LC11259'><span class="cm"> * Note 2: For DOM (but not canvas) text entities, various font settings (like</span></div><div class='line' id='LC11260'><span class="cm"> * text-decoration and text-align) can be set using `.css()` (see DOM component). But</span></div><div class='line' id='LC11261'><span class="cm"> * you cannot use `.css()` to set the properties which are controlled by `.textFont()`</span></div><div class='line' id='LC11262'><span class="cm"> * or `.textColor()` -- the settings will be ignored.</span></div><div class='line' id='LC11263'><span class="cm"> *</span></div><div class='line' id='LC11264'><span class="cm"> * Note 3: If you use canvas text with glyphs that are taller than standard letters, portions of the glyphs might be cut off.</span></div><div class='line' id='LC11265'><span class="cm"> */</span></div><div class='line' id='LC11266'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Text&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC11267'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_text</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div><div class='line' id='LC11268'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">defaultSize</span><span class="o">:</span> <span class="s2">&quot;10px&quot;</span><span class="p">,</span></div><div class='line' id='LC11269'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">defaultFamily</span><span class="o">:</span> <span class="s2">&quot;sans-serif&quot;</span><span class="p">,</span></div><div class='line' id='LC11270'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">defaultVariant</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span></div><div class='line' id='LC11271'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">defaultLineHeight</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span></div><div class='line' id='LC11272'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ready</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC11273'><br/></div><div class='line' id='LC11274'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">requires</span><span class="p">(</span><span class="s2">&quot;2D&quot;</span><span class="p">);</span></div><div class='line' id='LC11276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC11277'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div><div class='line' id='LC11278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;weight&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div><div class='line' id='LC11279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;size&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultSize</span><span class="p">,</span></div><div class='line' id='LC11280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;lineHeight&quot;</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultLineHeight</span><span class="p">,</span></div><div class='line' id='LC11281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;family&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultFamily</span><span class="p">,</span></div><div class='line' id='LC11282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;variant&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultVariant</span></div><div class='line' id='LC11283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11284'><br/></div><div class='line' id='LC11285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11286'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">font</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fontString</span><span class="p">();</span></div><div class='line' id='LC11287'><br/></div><div class='line' id='LC11288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;DOM&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">,</span></div><div class='line' id='LC11290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span></div><div class='line' id='LC11291'><br/></div><div class='line' id='LC11292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textColor</span><span class="p">;</span></div><div class='line' id='LC11293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">style</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="nx">font</span><span class="p">;</span></div><div class='line' id='LC11294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_text</span><span class="p">;</span></div><div class='line' id='LC11295'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;canvas&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span></div><div class='line' id='LC11297'><br/></div><div class='line' id='LC11298'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span></div><div class='line' id='LC11299'><br/></div><div class='line' id='LC11300'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">textBaseline</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span><span class="p">;</span></div><div class='line' id='LC11301'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textColor</span> <span class="o">||</span> <span class="s2">&quot;rgb(0,0,0)&quot;</span><span class="p">;</span></div><div class='line' id='LC11302'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="nx">font</span><span class="p">;</span></div><div class='line' id='LC11303'><br/></div><div class='line' id='LC11304'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_text</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">);</span></div><div class='line' id='LC11305'><br/></div><div class='line' id='LC11306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span></div><div class='line' id='LC11307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11309'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11310'><br/></div><div class='line' id='LC11311'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// takes a CSS font-size string and gets the height of the resulting font in px</span></div><div class='line' id='LC11312'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_getFontHeight</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC11313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// regex for grabbing the first string of letters</span></div><div class='line' id='LC11314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="sr">/([a-zA-Z]+)\b/</span><span class="p">;</span></div><div class='line' id='LC11315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// From the CSS spec.  &quot;em&quot; and &quot;ex&quot; are undefined on a canvas.</span></div><div class='line' id='LC11316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">multipliers</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC11317'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;px&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC11318'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;pt&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span></div><div class='line' id='LC11319'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;pc&quot;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span></div><div class='line' id='LC11320'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;cm&quot;</span><span class="o">:</span> <span class="mi">96</span><span class="o">/</span><span class="mf">2.54</span><span class="p">,</span></div><div class='line' id='LC11321'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;mm&quot;</span><span class="o">:</span> <span class="mi">96</span><span class="o">/</span><span class="mf">25.4</span><span class="p">,</span></div><div class='line' id='LC11322'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;in&quot;</span><span class="o">:</span> <span class="mi">96</span><span class="p">,</span></div><div class='line' id='LC11323'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;em&quot;</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span></div><div class='line' id='LC11324'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;ex&quot;</span><span class="o">:</span> <span class="kc">undefined</span></div><div class='line' id='LC11325'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11326'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">font</span><span class="p">){</span></div><div class='line' id='LC11327'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">number</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">font</span><span class="p">);</span></div><div class='line' id='LC11328'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">font</span><span class="p">);</span></div><div class='line' id='LC11329'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">unit</span> <span class="o">=</span>  <span class="nx">match</span> <span class="o">?</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC11330'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">multipliers</span><span class="p">[</span><span class="nx">unit</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span></div><div class='line' id='LC11331'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">number</span> <span class="o">*</span> <span class="nx">multipliers</span><span class="p">[</span><span class="nx">unit</span><span class="p">]);</span></div><div class='line' id='LC11332'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC11333'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">number</span><span class="p">);</span></div><div class='line' id='LC11334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11335'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC11336'><br/></div><div class='line' id='LC11337'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11338'><span class="cm">     * #.text</span></div><div class='line' id='LC11339'><span class="cm">     * @comp Text</span></div><div class='line' id='LC11340'><span class="cm">     * @sign public this .text(String text)</span></div><div class='line' id='LC11341'><span class="cm">     * @sign public this .text(Function textgenerator)</span></div><div class='line' id='LC11342'><span class="cm">     * @param text - String of text that will be inserted into the DOM or Canvas element.</span></div><div class='line' id='LC11343'><span class="cm">     *</span></div><div class='line' id='LC11344'><span class="cm">     * This method will update the text inside the entity.</span></div><div class='line' id='LC11345'><span class="cm">     *</span></div><div class='line' id='LC11346'><span class="cm">     * If you need to reference attributes on the entity itself you can pass a function instead of a string.</span></div><div class='line' id='LC11347'><span class="cm">     *</span></div><div class='line' id='LC11348'><span class="cm">     * @example</span></div><div class='line' id='LC11349'><span class="cm">     * ~~~</span></div><div class='line' id='LC11350'><span class="cm">     * Crafty.e(&quot;2D, DOM, Text&quot;).attr({ x: 100, y: 100 }).text(&quot;Look at me!!&quot;);</span></div><div class='line' id='LC11351'><span class="cm">     *</span></div><div class='line' id='LC11352'><span class="cm">     * Crafty.e(&quot;2D, DOM, Text&quot;).attr({ x: 100, y: 100 })</span></div><div class='line' id='LC11353'><span class="cm">     *     .text(function () { return &quot;My position is &quot; + this._x });</span></div><div class='line' id='LC11354'><span class="cm">     *</span></div><div class='line' id='LC11355'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).attr({ x: 100, y: 100 }).text(&quot;Look at me!!&quot;);</span></div><div class='line' id='LC11356'><span class="cm">     *</span></div><div class='line' id='LC11357'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).attr({ x: 100, y: 100 })</span></div><div class='line' id='LC11358'><span class="cm">     *     .text(function () { return &quot;My position is &quot; + this._x });</span></div><div class='line' id='LC11359'><span class="cm">     * ~~~</span></div><div class='line' id='LC11360'><span class="cm">     */</span></div><div class='line' id='LC11361'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">text</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11362'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">text</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">text</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">))</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_text</span><span class="p">;</span></div><div class='line' id='LC11363'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span></div><div class='line' id='LC11364'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC11365'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC11366'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span></div><div class='line' id='LC11367'><br/></div><div class='line' id='LC11368'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;Canvas&quot;</span><span class="p">)</span> <span class="p">)</span></div><div class='line' id='LC11369'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_resizeForCanvas</span><span class="p">();</span></div><div class='line' id='LC11370'><br/></div><div class='line' id='LC11371'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC11372'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11373'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11374'><br/></div><div class='line' id='LC11375'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Calculates the height and width of text on the canvas</span></div><div class='line' id='LC11376'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Width is found by using the canvas measureText function</span></div><div class='line' id='LC11377'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Height is only estimated -- it calculates the font size in pixels, and sets the height to 110% of that.</span></div><div class='line' id='LC11378'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_resizeForCanvas</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC11379'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC11380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fontString</span><span class="p">();</span></div><div class='line' id='LC11381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">measureText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_text</span><span class="p">).</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC11382'><br/></div><div class='line' id='LC11383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">size</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultSize</span><span class="p">);</span></div><div class='line' id='LC11384'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getFontHeight</span><span class="p">(</span><span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC11385'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11386'><br/></div><div class='line' id='LC11387'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Returns the font string to use</span></div><div class='line' id='LC11388'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_fontString</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC11389'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">variant</span>  <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">weight</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">size</span>  <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">lineHeight</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">.</span><span class="nx">family</span><span class="p">;</span></div><div class='line' id='LC11390'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11391'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11392'><span class="cm">     * #.textColor</span></div><div class='line' id='LC11393'><span class="cm">     * @comp Text</span></div><div class='line' id='LC11394'><span class="cm">     * @sign public this .textColor(String color, Number strength)</span></div><div class='line' id='LC11395'><span class="cm">     * @param color - The color in hexadecimal</span></div><div class='line' id='LC11396'><span class="cm">     * @param strength - Level of opacity</span></div><div class='line' id='LC11397'><span class="cm">     *</span></div><div class='line' id='LC11398'><span class="cm">     * Modify the text color and level of opacity.</span></div><div class='line' id='LC11399'><span class="cm">     *</span></div><div class='line' id='LC11400'><span class="cm">     * @example</span></div><div class='line' id='LC11401'><span class="cm">     * ~~~</span></div><div class='line' id='LC11402'><span class="cm">     * Crafty.e(&quot;2D, DOM, Text&quot;).attr({ x: 100, y: 100 }).text(&quot;Look at me!!&quot;)</span></div><div class='line' id='LC11403'><span class="cm">     *   .textColor(&#39;#FF0000&#39;);</span></div><div class='line' id='LC11404'><span class="cm">     *</span></div><div class='line' id='LC11405'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).attr({ x: 100, y: 100 }).text(&#39;Look at me!!&#39;)</span></div><div class='line' id='LC11406'><span class="cm">     *   .textColor(&#39;#FF0000&#39;, 0.6);</span></div><div class='line' id='LC11407'><span class="cm">     * ~~~</span></div><div class='line' id='LC11408'><span class="cm">     * @see Crafty.toRGB</span></div><div class='line' id='LC11409'><span class="cm">     */</span></div><div class='line' id='LC11410'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">textColor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">strength</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11411'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_strength</span> <span class="o">=</span> <span class="nx">strength</span><span class="p">;</span></div><div class='line' id='LC11412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_textColor</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">toRGB</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_strength</span><span class="p">);</span></div><div class='line' id='LC11413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC11414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11415'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11416'><br/></div><div class='line' id='LC11417'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11418'><span class="cm">     * #.textFont</span></div><div class='line' id='LC11419'><span class="cm">     * @comp Text</span></div><div class='line' id='LC11420'><span class="cm">     * @triggers Invalidate</span></div><div class='line' id='LC11421'><span class="cm">     * @sign public this .textFont(String key, * value)</span></div><div class='line' id='LC11422'><span class="cm">     * @param key - Property of the entity to modify</span></div><div class='line' id='LC11423'><span class="cm">     * @param value - Value to set the property to</span></div><div class='line' id='LC11424'><span class="cm">     *</span></div><div class='line' id='LC11425'><span class="cm">     * @sign public this .textFont(Object map)</span></div><div class='line' id='LC11426'><span class="cm">     * @param map - Object where the key is the property to modify and the value as the property value</span></div><div class='line' id='LC11427'><span class="cm">     *</span></div><div class='line' id='LC11428'><span class="cm">     * Use this method to set font property of the text entity.  Possible values are: type, weight, size, family, lineHeight, and variant.</span></div><div class='line' id='LC11429'><span class="cm">     *</span></div><div class='line' id='LC11430'><span class="cm">     * When rendered by the canvas, lineHeight and variant will be ignored.</span></div><div class='line' id='LC11431'><span class="cm">     *</span></div><div class='line' id='LC11432'><span class="cm">     * @example</span></div><div class='line' id='LC11433'><span class="cm">     * ~~~</span></div><div class='line' id='LC11434'><span class="cm">     * Crafty.e(&quot;2D, DOM, Text&quot;).textFont({ type: &#39;italic&#39;, family: &#39;Arial&#39; });</span></div><div class='line' id='LC11435'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).textFont({ size: &#39;20px&#39;, weight: &#39;bold&#39; });</span></div><div class='line' id='LC11436'><span class="cm">     *</span></div><div class='line' id='LC11437'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).textFont(&quot;type&quot;, &quot;italic&quot;);</span></div><div class='line' id='LC11438'><span class="cm">     * Crafty.e(&quot;2D, Canvas, Text&quot;).textFont(&quot;type&quot;); // italic</span></div><div class='line' id='LC11439'><span class="cm">     * ~~~</span></div><div class='line' id='LC11440'><span class="cm">     */</span></div><div class='line' id='LC11441'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">textFont</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11442'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11443'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//if just the key, return the value</span></div><div class='line' id='LC11444'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11445'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span></div><div class='line' id='LC11446'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11447'><br/></div><div class='line' id='LC11448'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11449'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">propertyKey</span> <span class="k">in</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11450'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span><span class="p">(</span><span class="nx">propertyKey</span> <span class="o">==</span> <span class="s1">&#39;family&#39;</span><span class="p">){</span></div><div class='line' id='LC11451'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">[</span><span class="nx">propertyKey</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">[</span><span class="nx">propertyKey</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">;</span></div><div class='line' id='LC11452'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC11453'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">[</span><span class="nx">propertyKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span><span class="p">[</span><span class="nx">propertyKey</span><span class="p">];</span></div><div class='line' id='LC11454'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11455'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11456'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11457'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC11458'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_textFont</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span></div><div class='line' id='LC11459'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11460'><br/></div><div class='line' id='LC11461'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;Canvas&quot;</span><span class="p">)</span> <span class="p">)</span></div><div class='line' id='LC11462'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_resizeForCanvas</span><span class="p">();</span></div><div class='line' id='LC11463'><br/></div><div class='line' id='LC11464'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC11465'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11466'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11467'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11468'><span class="cm">     * #.unselectable</span></div><div class='line' id='LC11469'><span class="cm">     * @comp Text</span></div><div class='line' id='LC11470'><span class="cm">     * @triggers Invalidate</span></div><div class='line' id='LC11471'><span class="cm">     * @sign public this .unselectable()</span></div><div class='line' id='LC11472'><span class="cm">     *</span></div><div class='line' id='LC11473'><span class="cm">     * This method sets the text so that it cannot be selected (highlighted) by dragging.</span></div><div class='line' id='LC11474'><span class="cm">     * (Canvas text can never be highlighted, so this only matters for DOM text.)</span></div><div class='line' id='LC11475'><span class="cm">     * Works by changing the css property &quot;user-select&quot; and its variants.</span></div><div class='line' id='LC11476'><span class="cm">     *</span></div><div class='line' id='LC11477'><span class="cm">     * @example</span></div><div class='line' id='LC11478'><span class="cm">     * ~~~</span></div><div class='line' id='LC11479'><span class="cm">     * Crafty.e(&quot;2D, DOM, Text&quot;).text(&#39;This text cannot be highlighted!&#39;).unselectable();</span></div><div class='line' id='LC11480'><span class="cm">     * ~~~</span></div><div class='line' id='LC11481'><span class="cm">     */</span></div><div class='line' id='LC11482'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">unselectable</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11483'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// http://stackoverflow.com/questions/826782/css-rule-to-disable-text-selection-highlighting</span></div><div class='line' id='LC11484'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;DOM&quot;</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC11485'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span></div><div class='line' id='LC11486'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;-webkit-touch-callout&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span></div><div class='line' id='LC11487'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;-webkit-user-select&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span></div><div class='line' id='LC11488'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;-khtml-user-select&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span></div><div class='line' id='LC11489'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;-moz-user-select&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span></div><div class='line' id='LC11490'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;-ms-user-select&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span></div><div class='line' id='LC11491'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="s1">&#39;user-select&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span></div><div class='line' id='LC11492'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11493'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Invalidate&quot;</span><span class="p">);</span></div><div class='line' id='LC11494'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11495'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11496'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11497'><br/></div><div class='line' id='LC11498'><span class="p">});</span></div><div class='line' id='LC11499'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">27</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11500'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC11501'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC11502'><br/></div><div class='line' id='LC11503'><span class="cm">/**@</span></div><div class='line' id='LC11504'><span class="cm"> * #Delay</span></div><div class='line' id='LC11505'><span class="cm"> * @category Utilities</span></div><div class='line' id='LC11506'><span class="cm"> */</span></div><div class='line' id='LC11507'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;Delay&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC11508'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11509'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_delays</span> <span class="o">=</span> <span class="p">[];</span></div><div class='line' id='LC11510'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11511'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC11512'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></div><div class='line' id='LC11513'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11514'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span></div><div class='line' id='LC11515'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">delay</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pause</span> <span class="o">&lt;</span> <span class="nx">now</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11516'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC11517'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11518'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// reschedule item</span></div><div class='line' id='LC11519'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span></div><div class='line' id='LC11520'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC11521'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">pauseBuffer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC11522'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">repeat</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC11523'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11524'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// remove item from array</span></div><div class='line' id='LC11525'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC11526'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11527'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11528'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11529'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11530'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Pause&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11531'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC11532'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11533'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">pauseBuffer</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span></div><div class='line' id='LC11534'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11535'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11536'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Unpause&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11537'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span></div><div class='line' id='LC11538'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11539'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span></div><div class='line' id='LC11540'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">item</span><span class="p">.</span><span class="nx">pause</span> <span class="o">+=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pauseBuffer</span><span class="p">;</span></div><div class='line' id='LC11541'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11542'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11543'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11544'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11545'><span class="cm">     * #.delay</span></div><div class='line' id='LC11546'><span class="cm">     * @comp Delay</span></div><div class='line' id='LC11547'><span class="cm">     * @sign public this.delay(Function callback, Number delay)</span></div><div class='line' id='LC11548'><span class="cm">     * @param callback - Method to execute after given amount of milliseconds</span></div><div class='line' id='LC11549'><span class="cm">     * @param delay - Amount of milliseconds to execute the method</span></div><div class='line' id='LC11550'><span class="cm">     * @param repeat - How often to repeat the delayed function. A value of 0 triggers the delayed</span></div><div class='line' id='LC11551'><span class="cm">     * function exactly once. A value n &gt; 0 triggers the delayed function exactly n+1 times. A</span></div><div class='line' id='LC11552'><span class="cm">     * value of -1 triggers the delayed function indefinitely.</span></div><div class='line' id='LC11553'><span class="cm">     *</span></div><div class='line' id='LC11554'><span class="cm">     * The delay method will execute a function after a given amount of time in milliseconds.</span></div><div class='line' id='LC11555'><span class="cm">     *</span></div><div class='line' id='LC11556'><span class="cm">     * It is not a wrapper for `setTimeout`.</span></div><div class='line' id='LC11557'><span class="cm">     *</span></div><div class='line' id='LC11558'><span class="cm">     * If Crafty is paused, the delay is interrupted with the pause and then resume when unpaused</span></div><div class='line' id='LC11559'><span class="cm">     *</span></div><div class='line' id='LC11560'><span class="cm">     * If the entity is destroyed, the delay is also destroyed and will not have effect.</span></div><div class='line' id='LC11561'><span class="cm">     *</span></div><div class='line' id='LC11562'><span class="cm">     * @example</span></div><div class='line' id='LC11563'><span class="cm">     * ~~~</span></div><div class='line' id='LC11564'><span class="cm">     * console.log(&quot;start&quot;);</span></div><div class='line' id='LC11565'><span class="cm">     * Crafty.e(&quot;Delay&quot;).delay(function() {</span></div><div class='line' id='LC11566'><span class="cm">     *   console.log(&quot;100ms later&quot;);</span></div><div class='line' id='LC11567'><span class="cm">     * }, 100, 0);</span></div><div class='line' id='LC11568'><span class="cm">     * ~~~</span></div><div class='line' id='LC11569'><span class="cm">     */</span></div><div class='line' id='LC11570'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">delay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">delay</span><span class="p">,</span> <span class="nx">repeat</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11571'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_delays</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span></div><div class='line' id='LC11572'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">start</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">(),</span></div><div class='line' id='LC11573'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">func</span><span class="o">:</span> <span class="nx">func</span><span class="p">,</span></div><div class='line' id='LC11574'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">delay</span><span class="o">:</span> <span class="nx">delay</span><span class="p">,</span></div><div class='line' id='LC11575'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">repeat</span><span class="o">:</span> <span class="p">(</span><span class="nx">repeat</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="kc">Infinity</span> <span class="o">:</span> <span class="nx">repeat</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11576'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pauseBuffer</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11577'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pause</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC11578'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC11579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC11580'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11581'><span class="p">});</span></div><div class='line' id='LC11582'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">28</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11583'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&quot;0.6.2&quot;</span><span class="p">;</span></div><div class='line' id='LC11584'><span class="p">},{}],</span><span class="mi">29</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC11585'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC11586'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC11587'><br/></div><div class='line' id='LC11588'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC11589'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11590'><span class="cm">     * #Crafty.viewport</span></div><div class='line' id='LC11591'><span class="cm">     * @category Stage</span></div><div class='line' id='LC11592'><span class="cm">     * @trigger ViewportScroll - when the viewport&#39;s x or y coordinates change</span></div><div class='line' id='LC11593'><span class="cm">     * @trigger ViewportScale - when the viewport&#39;s scale changes</span></div><div class='line' id='LC11594'><span class="cm">     * @trigger ViewportResize - when the viewport&#39;s dimension&#39;s change</span></div><div class='line' id='LC11595'><span class="cm">     * @trigger InvalidateViewport - when the viewport changes</span></div><div class='line' id='LC11596'><span class="cm">     * @trigger StopCamera - when any camera animations should stop, such as at the start of a new animation.</span></div><div class='line' id='LC11597'><span class="cm">     * @trigger CameraAnimationDone - when a camera animation comes reaches completion</span></div><div class='line' id='LC11598'><span class="cm">     *</span></div><div class='line' id='LC11599'><span class="cm">     * Viewport is essentially a 2D camera looking at the stage. Can be moved or zoomed, which</span></div><div class='line' id='LC11600'><span class="cm">     * in turn will react just like a camera moving in that direction.</span></div><div class='line' id='LC11601'><span class="cm">     * </span></div><div class='line' id='LC11602'><span class="cm">     * Tip: At any given moment, the stuff that you can see is...</span></div><div class='line' id='LC11603'><span class="cm">     * </span></div><div class='line' id='LC11604'><span class="cm">     * `x` between `(-Crafty.viewport._x)` and `(-Crafty.viewport._x + (Crafty.viewport._width / Crafty.viewport._scale))`</span></div><div class='line' id='LC11605'><span class="cm">     * </span></div><div class='line' id='LC11606'><span class="cm">     * `y` between `(-Crafty.viewport._y)` and `(-Crafty.viewport._y + (Crafty.viewport._height / Crafty.viewport._scale))` </span></div><div class='line' id='LC11607'><span class="cm">     */</span></div><div class='line' id='LC11608'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">viewport</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC11609'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11610'><span class="cm">         * #Crafty.viewport.clampToEntities</span></div><div class='line' id='LC11611'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11612'><span class="cm">         *</span></div><div class='line' id='LC11613'><span class="cm">         * Decides if the viewport functions should clamp to game entities.</span></div><div class='line' id='LC11614'><span class="cm">         * When set to `true` functions such as Crafty.viewport.mouselook() will not allow you to move the</span></div><div class='line' id='LC11615'><span class="cm">         * viewport over areas of the game that has no entities.</span></div><div class='line' id='LC11616'><span class="cm">         * For development it can be useful to set this to false.</span></div><div class='line' id='LC11617'><span class="cm">         */</span></div><div class='line' id='LC11618'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">clampToEntities</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></div><div class='line' id='LC11619'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_width</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11620'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_height</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11621'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11622'><span class="cm">         * #Crafty.viewport.x</span></div><div class='line' id='LC11623'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11624'><span class="cm">         *</span></div><div class='line' id='LC11625'><span class="cm">         * Will move the stage and therefore every visible entity along the `x`</span></div><div class='line' id='LC11626'><span class="cm">         * axis in the opposite direction.</span></div><div class='line' id='LC11627'><span class="cm">         *</span></div><div class='line' id='LC11628'><span class="cm">         * When this value is set, it will shift the entire stage. This means that entity</span></div><div class='line' id='LC11629'><span class="cm">         * positions are not exactly where they are on screen. To get the exact position,</span></div><div class='line' id='LC11630'><span class="cm">         * simply add `Crafty.viewport.x` onto the entities `x` position.</span></div><div class='line' id='LC11631'><span class="cm">         */</span></div><div class='line' id='LC11632'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11634'><span class="cm">         * #Crafty.viewport.y</span></div><div class='line' id='LC11635'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11636'><span class="cm">         *</span></div><div class='line' id='LC11637'><span class="cm">         * Will move the stage and therefore every visible entity along the `y`</span></div><div class='line' id='LC11638'><span class="cm">         * axis in the opposite direction.</span></div><div class='line' id='LC11639'><span class="cm">         *</span></div><div class='line' id='LC11640'><span class="cm">         * When this value is set, it will shift the entire stage. This means that entity</span></div><div class='line' id='LC11641'><span class="cm">         * positions are not exactly where they are on screen. To get the exact position,</span></div><div class='line' id='LC11642'><span class="cm">         * simply add `Crafty.viewport.y` onto the entities `y` position.</span></div><div class='line' id='LC11643'><span class="cm">         */</span></div><div class='line' id='LC11644'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC11645'><br/></div><div class='line' id='LC11646'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11647'><span class="cm">         * #Crafty.viewport._scale</span></div><div class='line' id='LC11648'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11649'><span class="cm">         *</span></div><div class='line' id='LC11650'><span class="cm">         * This value is the current scale (zoom) of the viewport. When the value is bigger than 1, everything</span></div><div class='line' id='LC11651'><span class="cm">         * looks bigger (zoomed in). When the value is less than 1, everything looks smaller (zoomed out). This</span></div><div class='line' id='LC11652'><span class="cm">         * does not alter the size of the stage itself, just the magnification of what it shows.</span></div><div class='line' id='LC11653'><span class="cm">         * </span></div><div class='line' id='LC11654'><span class="cm">         * This is a read-only property: Do not set it directly. Instead, use `Crafty.viewport.scale(...)`</span></div><div class='line' id='LC11655'><span class="cm">         * or `Crafty.viewport.zoom(...)`</span></div><div class='line' id='LC11656'><span class="cm">         */</span></div><div class='line' id='LC11657'><br/></div><div class='line' id='LC11658'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_scale</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span></div><div class='line' id='LC11659'><br/></div><div class='line' id='LC11660'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11661'><span class="cm">         * #Crafty.viewport.bounds</span></div><div class='line' id='LC11662'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11663'><span class="cm">         *</span></div><div class='line' id='LC11664'><span class="cm">         * A rectangle which defines the bounds of the viewport.</span></div><div class='line' id='LC11665'><span class="cm">         * It should be an object with two properties, `max` and `min`,</span></div><div class='line' id='LC11666'><span class="cm">         * which are each an object with `x` and `y` properties.</span></div><div class='line' id='LC11667'><span class="cm">         *</span></div><div class='line' id='LC11668'><span class="cm">         * If this property is null, Crafty uses the bounding box of all the items</span></div><div class='line' id='LC11669'><span class="cm">         * on the stage.  This is the initial value.  (To prevent this behavior, set `Crafty.viewport.clampToEntities` to `false`)</span></div><div class='line' id='LC11670'><span class="cm">         *</span></div><div class='line' id='LC11671'><span class="cm">         * If you wish to bound the viewport along one axis but not the other, you can use `-Infinity` and `+Infinity` as bounds.</span></div><div class='line' id='LC11672'><span class="cm">         *</span></div><div class='line' id='LC11673'><span class="cm">         * @see Crafty.viewport.clampToEntities</span></div><div class='line' id='LC11674'><span class="cm">         *</span></div><div class='line' id='LC11675'><span class="cm">         * @example</span></div><div class='line' id='LC11676'><span class="cm">         * Set the bounds to a 500 by 500 square:</span></div><div class='line' id='LC11677'><span class="cm">         *</span></div><div class='line' id='LC11678'><span class="cm">         * ~~~</span></div><div class='line' id='LC11679'><span class="cm">         * Crafty.viewport.bounds = {min:{x:0, y:0}, max:{x:500, y:500}};</span></div><div class='line' id='LC11680'><span class="cm">         * ~~~</span></div><div class='line' id='LC11681'><span class="cm">         */</span></div><div class='line' id='LC11682'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bounds</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC11683'><br/></div><div class='line' id='LC11684'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11685'><span class="cm">         * #Crafty.viewport.scroll</span></div><div class='line' id='LC11686'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11687'><span class="cm">         * @sign Crafty.viewport.scroll(String axis, Number val)</span></div><div class='line' id='LC11688'><span class="cm">         * @param axis - &#39;x&#39; or &#39;y&#39;</span></div><div class='line' id='LC11689'><span class="cm">         * @param val - The new absolute position on the axis</span></div><div class='line' id='LC11690'><span class="cm">         *</span></div><div class='line' id='LC11691'><span class="cm">         * Will move the viewport to the position given on the specified axis</span></div><div class='line' id='LC11692'><span class="cm">         *</span></div><div class='line' id='LC11693'><span class="cm">         * @example</span></div><div class='line' id='LC11694'><span class="cm">         * Will move the camera 500 pixels right of its initial position, in effect</span></div><div class='line' id='LC11695'><span class="cm">         * shifting everything in the viewport 500 pixels to the left.</span></div><div class='line' id='LC11696'><span class="cm">         *</span></div><div class='line' id='LC11697'><span class="cm">         * ~~~</span></div><div class='line' id='LC11698'><span class="cm">         * Crafty.viewport.scroll(&#39;_x&#39;, 500);</span></div><div class='line' id='LC11699'><span class="cm">         * ~~~</span></div><div class='line' id='LC11700'><span class="cm">         */</span></div><div class='line' id='LC11701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scroll</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">axis</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11702'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">[</span><span class="nx">axis</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span></div><div class='line' id='LC11703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportScroll&quot;</span><span class="p">);</span></div><div class='line' id='LC11704'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;InvalidateViewport&quot;</span><span class="p">);</span></div><div class='line' id='LC11705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11706'><br/></div><div class='line' id='LC11707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect_object</span><span class="o">:</span> <span class="p">{</span> <span class="nx">_x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_w</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">_h</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span></div><div class='line' id='LC11708'><br/></div><div class='line' id='LC11709'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11710'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">rect_object</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC11711'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">rect_object</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC11712'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">rect_object</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_width</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC11713'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">rect_object</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_height</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC11714'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">rect_object</span><span class="p">;</span></div><div class='line' id='LC11715'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11716'><br/></div><div class='line' id='LC11717'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@ </span></div><div class='line' id='LC11718'><br/></div><div class='line' id='LC11719'><span class="cm">         * #Crafty.viewport.pan</span></div><div class='line' id='LC11720'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11721'><span class="cm">         * @sign public void Crafty.viewport.pan(String axis, Number v, Number time)</span></div><div class='line' id='LC11722'><span class="cm">         * @param String axis - &#39;x&#39; or &#39;y&#39;. The axis to move the camera on</span></div><div class='line' id='LC11723'><span class="cm">         * @param Number v - the distance to move the camera by</span></div><div class='line' id='LC11724'><span class="cm">         * @param Number time - The duration in ms for the entire camera movement</span></div><div class='line' id='LC11725'><span class="cm">         *</span></div><div class='line' id='LC11726'><span class="cm">         * Pans the camera a given number of pixels over the specified time</span></div><div class='line' id='LC11727'><span class="cm">         */</span></div><div class='line' id='LC11728'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pan</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11729'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">tweens</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">bound</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC11730'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">targetX</span><span class="p">,</span> <span class="nx">targetY</span><span class="p">,</span> <span class="nx">startingX</span><span class="p">,</span> <span class="nx">startingY</span><span class="p">,</span> <span class="nx">easing</span><span class="p">;</span></div><div class='line' id='LC11731'><br/></div><div class='line' id='LC11732'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">enterFrame</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11733'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">easing</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">dt</span><span class="p">);</span></div><div class='line' id='LC11734'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span></div><div class='line' id='LC11735'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">v</span><span class="p">)</span> <span class="o">*</span> <span class="nx">startingX</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">targetX</span><span class="p">;</span></div><div class='line' id='LC11736'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">v</span><span class="p">)</span> <span class="o">*</span> <span class="nx">startingY</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">*</span> <span class="nx">targetY</span><span class="p">;</span></div><div class='line' id='LC11737'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_clamp</span><span class="p">();</span></div><div class='line' id='LC11738'><br/></div><div class='line' id='LC11739'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">easing</span><span class="p">.</span><span class="nx">complete</span><span class="p">){</span></div><div class='line' id='LC11740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stopPan</span><span class="p">();</span></div><div class='line' id='LC11741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CameraAnimationDone&quot;</span><span class="p">);</span></div><div class='line' id='LC11742'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11744'><br/></div><div class='line' id='LC11745'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">stopPan</span><span class="p">(){</span></div><div class='line' id='LC11746'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="nx">enterFrame</span><span class="p">);</span></div><div class='line' id='LC11747'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11748'><br/></div><div class='line' id='LC11749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">,</span> <span class="nx">stopPan</span><span class="p">);</span></div><div class='line' id='LC11750'><br/></div><div class='line' id='LC11751'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11752'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Cancel any current camera control</span></div><div class='line' id='LC11753'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">);</span></div><div class='line' id='LC11754'><br/></div><div class='line' id='LC11755'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Handle request to reset</span></div><div class='line' id='LC11756'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">==</span> <span class="s1">&#39;reset&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11757'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11758'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11759'><br/></div><div class='line' id='LC11760'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startingX</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC11761'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startingY</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC11762'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">targetX</span> <span class="o">=</span> <span class="nx">startingX</span> <span class="o">-</span> <span class="nx">dx</span><span class="p">;</span></div><div class='line' id='LC11763'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">targetY</span> <span class="o">=</span> <span class="nx">startingY</span> <span class="o">-</span> <span class="nx">dy</span><span class="p">;</span></div><div class='line' id='LC11764'><br/></div><div class='line' id='LC11765'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">easing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span><span class="p">(</span><span class="nx">time</span><span class="p">);</span></div><div class='line' id='LC11766'><br/></div><div class='line' id='LC11767'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// bind to event, using uniqueBind prevents multiple copies from being bound</span></div><div class='line' id='LC11768'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="nx">enterFrame</span><span class="p">);</span></div><div class='line' id='LC11769'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC11770'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11771'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC11772'><br/></div><div class='line' id='LC11773'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11774'><span class="cm">         * #Crafty.viewport.follow</span></div><div class='line' id='LC11775'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11776'><span class="cm">         * @sign public void Crafty.viewport.follow(Object target, Number offsetx, Number offsety)</span></div><div class='line' id='LC11777'><span class="cm">         * @param Object target - An entity with the 2D component</span></div><div class='line' id='LC11778'><span class="cm">         * @param Number offsetx - Follow target should be offsetx pixels away from center</span></div><div class='line' id='LC11779'><span class="cm">         * @param Number offsety - Positive puts target to the right of center</span></div><div class='line' id='LC11780'><span class="cm">         *</span></div><div class='line' id='LC11781'><span class="cm">         * Follows a given entity with the 2D component. If following target will take a portion of</span></div><div class='line' id='LC11782'><span class="cm">         * the viewport out of bounds of the world, following will stop until the target moves away.</span></div><div class='line' id='LC11783'><span class="cm">         *</span></div><div class='line' id='LC11784'><span class="cm">         * @example</span></div><div class='line' id='LC11785'><span class="cm">         * ~~~</span></div><div class='line' id='LC11786'><span class="cm">         * var ent = Crafty.e(&#39;2D, DOM&#39;).attr({w: 100, h: 100:});</span></div><div class='line' id='LC11787'><span class="cm">         * Crafty.viewport.follow(ent, 0, 0);</span></div><div class='line' id='LC11788'><span class="cm">         * ~~~</span></div><div class='line' id='LC11789'><span class="cm">         */</span></div><div class='line' id='LC11790'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">follow</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">oldTarget</span><span class="p">,</span> <span class="nx">offx</span><span class="p">,</span> <span class="nx">offy</span><span class="p">;</span></div><div class='line' id='LC11792'><br/></div><div class='line' id='LC11793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">change</span><span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11794'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nx">offx</span><span class="p">));</span></div><div class='line' id='LC11795'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nx">offy</span><span class="p">));</span></div><div class='line' id='LC11796'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_clamp</span><span class="p">();</span></div><div class='line' id='LC11797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11798'><br/></div><div class='line' id='LC11799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">stopFollow</span><span class="p">(){</span></div><div class='line' id='LC11800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">oldTarget</span><span class="p">)</span></div><div class='line' id='LC11801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oldTarget</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;Move&#39;</span><span class="p">,</span> <span class="nx">change</span><span class="p">);</span></div><div class='line' id='LC11802'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11803'><br/></div><div class='line' id='LC11804'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">,</span> <span class="nx">stopFollow</span><span class="p">);</span></div><div class='line' id='LC11805'><br/></div><div class='line' id='LC11806'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">offsetx</span><span class="p">,</span> <span class="nx">offsety</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11807'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span> <span class="o">||</span> <span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;2D&#39;</span><span class="p">))</span></div><div class='line' id='LC11808'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11809'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">);</span></div><div class='line' id='LC11810'><br/></div><div class='line' id='LC11811'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">oldTarget</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span></div><div class='line' id='LC11812'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offx</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">offsetx</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">offsetx</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC11813'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offy</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">offsety</span> <span class="o">!=</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">offsety</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC11814'><br/></div><div class='line' id='LC11815'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">target</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;Move&#39;</span><span class="p">,</span> <span class="nx">change</span><span class="p">);</span></div><div class='line' id='LC11816'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">change</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span></div><div class='line' id='LC11817'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11818'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC11819'><br/></div><div class='line' id='LC11820'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11821'><span class="cm">         * #Crafty.viewport.centerOn</span></div><div class='line' id='LC11822'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11823'><span class="cm">         * @sign public void Crafty.viewport.centerOn(Object target, Number time)</span></div><div class='line' id='LC11824'><span class="cm">         * @param Object target - An entity with the 2D component</span></div><div class='line' id='LC11825'><span class="cm">         * @param Number time - The duration in ms of the camera motion</span></div><div class='line' id='LC11826'><span class="cm">         *</span></div><div class='line' id='LC11827'><span class="cm">         * Centers the viewport on the given entity.</span></div><div class='line' id='LC11828'><span class="cm">         */</span></div><div class='line' id='LC11829'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">centerOn</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">targ</span><span class="p">,</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11830'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC11831'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC11832'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mid_x</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC11833'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mid_y</span> <span class="o">=</span> <span class="nx">targ</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC11834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cent_x</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC11835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cent_y</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span></div><div class='line' id='LC11836'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">new_x</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">mid_x</span> <span class="o">-</span> <span class="nx">cent_x</span><span class="p">,</span></div><div class='line' id='LC11837'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">new_y</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">mid_y</span> <span class="o">-</span> <span class="nx">cent_y</span><span class="p">;</span></div><div class='line' id='LC11838'><br/></div><div class='line' id='LC11839'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">pan</span><span class="p">(</span><span class="nx">new_x</span><span class="p">,</span> <span class="nx">new_y</span><span class="p">,</span> <span class="nx">time</span><span class="p">);</span></div><div class='line' id='LC11840'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC11841'><br/></div><div class='line' id='LC11842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11843'><span class="cm">         * #Crafty.viewport.zoom</span></div><div class='line' id='LC11844'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11845'><span class="cm">         * @sign public void Crafty.viewport.zoom(Number amt, Number cent_x, Number cent_y, Number time)</span></div><div class='line' id='LC11846'><span class="cm">         * @param Number amt - amount to zoom in on the target by (eg. 2, 4, 0.5)</span></div><div class='line' id='LC11847'><span class="cm">         * @param Number cent_x - the center to zoom on</span></div><div class='line' id='LC11848'><span class="cm">         * @param Number cent_y - the center to zoom on</span></div><div class='line' id='LC11849'><span class="cm">         * @param Number time - the duration in ms of the entire zoom operation</span></div><div class='line' id='LC11850'><span class="cm">         *</span></div><div class='line' id='LC11851'><span class="cm">         * Zooms the camera in on a given point. amt &gt; 1 will bring the camera closer to the subject</span></div><div class='line' id='LC11852'><span class="cm">         * amt &lt; 1 will bring it farther away. amt = 0 will reset to the default zoom level</span></div><div class='line' id='LC11853'><span class="cm">         * Zooming is multiplicative. To reset the zoom amount, pass 0.</span></div><div class='line' id='LC11854'><span class="cm">         */</span></div><div class='line' id='LC11855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">zoom</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC11857'><br/></div><div class='line' id='LC11858'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">stopZoom</span><span class="p">(){</span></div><div class='line' id='LC11859'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="nx">enterFrame</span><span class="p">);</span></div><div class='line' id='LC11860'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11861'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">,</span> <span class="nx">stopZoom</span><span class="p">);</span></div><div class='line' id='LC11862'><br/></div><div class='line' id='LC11863'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">startingZoom</span><span class="p">,</span> <span class="nx">finalZoom</span><span class="p">,</span> <span class="nx">finalAmount</span><span class="p">,</span> <span class="nx">startingX</span><span class="p">,</span> <span class="nx">finalX</span><span class="p">,</span> <span class="nx">startingY</span><span class="p">,</span> <span class="nx">finalY</span><span class="p">,</span> <span class="nx">easing</span><span class="p">;</span></div><div class='line' id='LC11864'><br/></div><div class='line' id='LC11865'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">enterFrame</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span></div><div class='line' id='LC11866'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC11867'><br/></div><div class='line' id='LC11868'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">easing</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">dt</span><span class="p">);</span></div><div class='line' id='LC11869'><br/></div><div class='line' id='LC11870'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The scaling should happen smoothly -- start at 1, end at finalAmount, and at half way scaling should be by finalAmount^(1/2)</span></div><div class='line' id='LC11871'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Since value goes smoothly from 0 to 1, this fufills those requirements</span></div><div class='line' id='LC11872'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">amount</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">finalAmount</span><span class="p">,</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">value</span><span class="p">()</span> <span class="p">);</span></div><div class='line' id='LC11873'><br/></div><div class='line' id='LC11874'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// The viewport should move in such a way that no point reverses</span></div><div class='line' id='LC11875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If a and b are the top left/bottom right of the viewport, then the below can be derived from</span></div><div class='line' id='LC11876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//      (a_0-b_0)/(a-b) = amount,</span></div><div class='line' id='LC11877'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// and the assumption that both a and b have the same form</span></div><div class='line' id='LC11878'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//      a = a_0 * (1-v) + a_f * v,</span></div><div class='line' id='LC11879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//      b = b_0 * (1-v) + b_f * v.</span></div><div class='line' id='LC11880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// This is just an arbitrary parameterization of the only sensible path for the viewport corners to take.</span></div><div class='line' id='LC11881'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// And by symmetry they should be parameterized in the same way!  So not much choice here.</span></div><div class='line' id='LC11882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">finalAmount</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span></div><div class='line' id='LC11883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">v</span> <span class="o">=</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span>  <span class="c1">// prevent NaN!  If zoom is used this way, it&#39;ll just become a pan.</span></div><div class='line' id='LC11884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC11885'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">amount</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">finalAmount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC11886'><br/></div><div class='line' id='LC11887'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Set new scale and viewport position</span></div><div class='line' id='LC11888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span> <span class="nx">amount</span> <span class="o">*</span> <span class="nx">startingZoom</span> <span class="p">);</span></div><div class='line' id='LC11889'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s2">&quot;_x&quot;</span><span class="p">,</span> <span class="nx">startingX</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">v</span><span class="p">)</span> <span class="o">+</span> <span class="nx">finalX</span> <span class="o">*</span> <span class="nx">v</span> <span class="p">);</span></div><div class='line' id='LC11890'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s2">&quot;_y&quot;</span><span class="p">,</span> <span class="nx">startingY</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">v</span><span class="p">)</span> <span class="o">+</span> <span class="nx">finalY</span> <span class="o">*</span> <span class="nx">v</span> <span class="p">);</span></div><div class='line' id='LC11891'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_clamp</span><span class="p">();</span></div><div class='line' id='LC11892'><br/></div><div class='line' id='LC11893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">easing</span><span class="p">.</span><span class="nx">complete</span><span class="p">){</span></div><div class='line' id='LC11894'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stopZoom</span><span class="p">();</span></div><div class='line' id='LC11895'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;CameraAnimationDone&quot;</span><span class="p">);</span></div><div class='line' id='LC11896'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11897'><br/></div><div class='line' id='LC11898'><br/></div><div class='line' id='LC11899'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11900'><br/></div><div class='line' id='LC11901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amt</span><span class="p">,</span> <span class="nx">cent_x</span><span class="p">,</span> <span class="nx">cent_y</span><span class="p">,</span> <span class="nx">time</span><span class="p">){</span></div><div class='line' id='LC11902'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// we&#39;re resetting to defaults</span></div><div class='line' id='LC11903'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC11904'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11905'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11906'><br/></div><div class='line' id='LC11907'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11908'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">time</span> <span class="o">=</span> <span class="nx">cent_x</span><span class="p">;</span></div><div class='line' id='LC11909'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cent_x</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC11910'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">cent_y</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC11911'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11912'><br/></div><div class='line' id='LC11913'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">);</span></div><div class='line' id='LC11914'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startingZoom</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC11915'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalAmount</span> <span class="o">=</span> <span class="nx">amt</span><span class="p">;</span></div><div class='line' id='LC11916'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalZoom</span> <span class="o">=</span> <span class="nx">startingZoom</span> <span class="o">*</span> <span class="nx">finalAmount</span><span class="p">;</span></div><div class='line' id='LC11917'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC11918'><br/></div><div class='line' id='LC11919'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startingX</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC11920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">startingY</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC11921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalX</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="nx">cent_x</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span>  <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">finalZoom</span><span class="p">)</span> <span class="p">);</span></div><div class='line' id='LC11922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">finalY</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="nx">cent_y</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">finalZoom</span><span class="p">)</span> <span class="p">);</span></div><div class='line' id='LC11923'><br/></div><div class='line' id='LC11924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">easing</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">easing</span><span class="p">(</span><span class="nx">time</span><span class="p">);</span></div><div class='line' id='LC11925'><br/></div><div class='line' id='LC11926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;EnterFrame&quot;</span><span class="p">,</span> <span class="nx">enterFrame</span><span class="p">);</span></div><div class='line' id='LC11927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11928'><br/></div><div class='line' id='LC11929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC11930'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC11931'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11932'><span class="cm">         * #Crafty.viewport.scale</span></div><div class='line' id='LC11933'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11934'><span class="cm">         * @sign public void Crafty.viewport.scale(Number amt)</span></div><div class='line' id='LC11935'><span class="cm">         * @param Number amt - amount to zoom/scale in on the elements</span></div><div class='line' id='LC11936'><span class="cm">         *</span></div><div class='line' id='LC11937'><span class="cm">         * Adjusts the scale (zoom). When `amt` is 1, it is set to the normal scale,</span></div><div class='line' id='LC11938'><span class="cm">         * e.g. an entity with `this.w == 20` would appear exactly 20 pixels wide.</span></div><div class='line' id='LC11939'><span class="cm">         * When `amt` is 10, that same entity would appear 200 pixels wide (i.e., zoomed in</span></div><div class='line' id='LC11940'><span class="cm">         * by a factor of 10), and when `amt` is 0.1, that same entity would be 2 pixels wide</span></div><div class='line' id='LC11941'><span class="cm">         * (i.e., zoomed out by a factor of `(1 / 0.1)`).</span></div><div class='line' id='LC11942'><span class="cm">         * </span></div><div class='line' id='LC11943'><span class="cm">         * If you pass an `amt` of 0, it is treated the same as passing 1, i.e. the scale is reset.</span></div><div class='line' id='LC11944'><span class="cm">         *</span></div><div class='line' id='LC11945'><span class="cm">         * This method sets the absolute scale, while `Crafty.viewport.zoom` sets the scale relative to the existing value.</span></div><div class='line' id='LC11946'><span class="cm">         * @see Crafty.viewport.zoom</span></div><div class='line' id='LC11947'><span class="cm">         *</span></div><div class='line' id='LC11948'><span class="cm">         * @example</span></div><div class='line' id='LC11949'><span class="cm">         * ~~~</span></div><div class='line' id='LC11950'><span class="cm">         * Crafty.viewport.scale(2); // Zoom in -- all entities will appear twice as large.</span></div><div class='line' id='LC11951'><span class="cm">         * ~~~</span></div><div class='line' id='LC11952'><span class="cm">         */</span></div><div class='line' id='LC11953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">scale</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amt</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_scale</span> <span class="o">=</span> <span class="nx">amt</span> <span class="o">?</span> <span class="nx">amt</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span></div><div class='line' id='LC11956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;InvalidateViewport&quot;</span><span class="p">);</span></div><div class='line' id='LC11957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportScale&quot;</span><span class="p">);</span></div><div class='line' id='LC11958'><br/></div><div class='line' id='LC11959'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC11960'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC11961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC11962'><span class="cm">         * #Crafty.viewport.mouselook</span></div><div class='line' id='LC11963'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC11964'><span class="cm">         * @sign public void Crafty.viewport.mouselook(Boolean active)</span></div><div class='line' id='LC11965'><span class="cm">         * @param Boolean active - Activate or deactivate mouselook</span></div><div class='line' id='LC11966'><span class="cm">         *</span></div><div class='line' id='LC11967'><span class="cm">         * Toggle mouselook on the current viewport.</span></div><div class='line' id='LC11968'><span class="cm">         * Simply call this function and the user will be able to</span></div><div class='line' id='LC11969'><span class="cm">         * drag the viewport around.</span></div><div class='line' id='LC11970'><span class="cm">         *</span></div><div class='line' id='LC11971'><span class="cm">         * If the user starts a drag, &quot;StopCamera&quot; will be triggered, which will cancel any existing camera animations.</span></div><div class='line' id='LC11972'><span class="cm">         */</span></div><div class='line' id='LC11973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">mouselook</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC11974'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC11975'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC11976'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastMouse</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC11977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">old</span> <span class="o">=</span> <span class="p">{};</span></div><div class='line' id='LC11978'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">function</span> <span class="nx">stopLook</span><span class="p">(){</span></div><div class='line' id='LC11979'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC11980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11981'><br/></div><div class='line' id='LC11982'><br/></div><div class='line' id='LC11983'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">op</span><span class="p">,</span> <span class="nx">arg</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11984'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">op</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11985'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">active</span> <span class="o">=</span> <span class="nx">op</span><span class="p">;</span></div><div class='line' id='LC11986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">active</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC11988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC11989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">mouseObjs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC11990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11992'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC11993'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">active</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11994'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">switch</span> <span class="p">(</span><span class="nx">op</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC11995'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s1">&#39;move&#39;</span><span class="o">:</span></div><div class='line' id='LC11996'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s1">&#39;drag&#39;</span><span class="o">:</span></div><div class='line' id='LC11997'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dragging</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC11998'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">diff</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC11999'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">lastMouse</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span></div><div class='line' id='LC12000'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">lastMouse</span><span class="p">.</span><span class="nx">y</span></div><div class='line' id='LC12001'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12002'><br/></div><div class='line' id='LC12003'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastMouse</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span></div><div class='line' id='LC12004'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastMouse</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span></div><div class='line' id='LC12005'><br/></div><div class='line' id='LC12006'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">+=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12007'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="nx">diff</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">_clamp</span><span class="p">();</span></div><div class='line' id='LC12009'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC12010'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s1">&#39;start&#39;</span><span class="o">:</span></div><div class='line' id='LC12011'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">);</span></div><div class='line' id='LC12012'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastMouse</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span></div><div class='line' id='LC12013'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">lastMouse</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">arg</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span></div><div class='line' id='LC12014'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dragging</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12015'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC12016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">case</span> <span class="s1">&#39;stop&#39;</span><span class="o">:</span></div><div class='line' id='LC12017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">dragging</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC12018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">break</span><span class="p">;</span></div><div class='line' id='LC12019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">})(),</span></div><div class='line' id='LC12022'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_clamp</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12023'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// clamps the viewport to the viewable area</span></div><div class='line' id='LC12024'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// under no circumstances should the viewport see something outside the boundary of the &#39;world&#39;</span></div><div class='line' id='LC12025'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">clampToEntities</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC12026'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">bound</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bounds</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">boundaries</span><span class="p">();</span></div><div class='line' id='LC12027'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC12028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC12029'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC12030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span> <span class="o">*=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scale</span><span class="p">;</span></div><div class='line' id='LC12031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC12034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC12038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></div><div class='line' id='LC12039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12040'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC12043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC12047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">bound</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span></div><div class='line' id='LC12048'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12050'><br/></div><div class='line' id='LC12051'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12052'><span class="cm">         * #Crafty.viewport.init</span></div><div class='line' id='LC12053'><span class="cm">         * @comp Crafty.viewport</span></div><div class='line' id='LC12054'><span class="cm">         * @sign public void Crafty.viewport.init([Number width, Number height, String stage_elem])</span></div><div class='line' id='LC12055'><span class="cm">         * @sign public void Crafty.viewport.init([Number width, Number height, HTMLElement stage_elem])</span></div><div class='line' id='LC12056'><span class="cm">         * @param Number width - Width of the viewport</span></div><div class='line' id='LC12057'><span class="cm">         * @param Number height - Height of the viewport</span></div><div class='line' id='LC12058'><span class="cm">         * @param String or HTMLElement stage_elem - the element to use as the stage (either its id or the actual element).</span></div><div class='line' id='LC12059'><span class="cm">         *</span></div><div class='line' id='LC12060'><span class="cm">         * Initialize the viewport. If the arguments &#39;width&#39; or &#39;height&#39; are missing, use Crafty.DOM.window.width and Crafty.DOM.window.height (full screen model).</span></div><div class='line' id='LC12061'><span class="cm">         *</span></div><div class='line' id='LC12062'><span class="cm">         * The argument &#39;stage_elem&#39; is used to specify a stage element other than the default, and can be either a string or an HTMLElement.  If a string is provided, it will look for an element with that id and, if none exists, create a div.  If an HTMLElement is provided, that is used directly.  Omitting this argument is the same as passing an id of &#39;cr-stage&#39;.</span></div><div class='line' id='LC12063'><span class="cm">         *</span></div><div class='line' id='LC12064'><span class="cm">         * @see Crafty.device, Crafty.DOM, Crafty.stage</span></div><div class='line' id='LC12065'><span class="cm">         */</span></div><div class='line' id='LC12066'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">stage_elem</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12067'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC12068'><br/></div><div class='line' id='LC12069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// setters+getters for the viewport</span></div><div class='line' id='LC12070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_defineViewportProperties</span><span class="p">();</span></div><div class='line' id='LC12071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// If no width or height is defined, the width and height is set to fullscreen</span></div><div class='line' id='LC12072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_width</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">w</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">width</span> <span class="o">:</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC12073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_height</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">)</span> <span class="o">?</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">height</span> <span class="o">:</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC12074'><br/></div><div class='line' id='LC12075'><br/></div><div class='line' id='LC12076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if stage exists</span></div><div class='line' id='LC12077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stage_elem</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC12078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">stage_elem</span> <span class="o">=</span> <span class="s2">&quot;cr-stage&quot;</span><span class="p">;</span></div><div class='line' id='LC12079'><br/></div><div class='line' id='LC12080'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">crstage</span><span class="p">;</span></div><div class='line' id='LC12081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">stage_elem</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span></div><div class='line' id='LC12082'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">crstage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">stage_elem</span><span class="p">);</span></div><div class='line' id='LC12083'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">HTMLElement</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span> <span class="nx">stage_elem</span> <span class="k">instanceof</span> <span class="nx">HTMLElement</span> <span class="o">:</span> <span class="nx">stage_elem</span> <span class="k">instanceof</span> <span class="nx">Element</span><span class="p">)</span></div><div class='line' id='LC12084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">crstage</span> <span class="o">=</span> <span class="nx">stage_elem</span><span class="p">;</span></div><div class='line' id='LC12085'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span></div><div class='line' id='LC12086'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;stage_elem must be a string or an HTMLElement&quot;</span><span class="p">);</span></div><div class='line' id='LC12087'><br/></div><div class='line' id='LC12088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12089'><span class="cm">             * #Crafty.stage</span></div><div class='line' id='LC12090'><span class="cm">             * @category Core</span></div><div class='line' id='LC12091'><span class="cm">             * The stage where all the DOM entities will be placed.</span></div><div class='line' id='LC12092'><span class="cm">             */</span></div><div class='line' id='LC12093'><br/></div><div class='line' id='LC12094'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12095'><span class="cm">             * #Crafty.stage.elem</span></div><div class='line' id='LC12096'><span class="cm">             * @comp Crafty.stage</span></div><div class='line' id='LC12097'><span class="cm">             * The `#cr-stage` div element.</span></div><div class='line' id='LC12098'><span class="cm">             */</span></div><div class='line' id='LC12099'><br/></div><div class='line' id='LC12100'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12101'><span class="cm">             * #Crafty.stage.inner</span></div><div class='line' id='LC12102'><span class="cm">             * @comp Crafty.stage</span></div><div class='line' id='LC12103'><span class="cm">             * `Crafty.stage.inner` is a div inside the `#cr-stage` div that holds all DOM entities.</span></div><div class='line' id='LC12104'><span class="cm">             * If you use canvas, a `canvas` element is created at the same level in the dom</span></div><div class='line' id='LC12105'><span class="cm">             * as the the `Crafty.stage.inner` div. So the hierarchy in the DOM is</span></div><div class='line' id='LC12106'><span class="cm">             *  </span></div><div class='line' id='LC12107'><span class="cm">             * ~~~</span></div><div class='line' id='LC12108'><span class="cm">             * Crafty.stage.elem</span></div><div class='line' id='LC12109'><span class="cm">             *  - Crafty.stage.inner (a div HTMLElement)</span></div><div class='line' id='LC12110'><span class="cm">             *  - Crafty.canvas._canvas (a canvas HTMLElement)</span></div><div class='line' id='LC12111'><span class="cm">             * ~~~</span></div><div class='line' id='LC12112'><span class="cm">             */</span></div><div class='line' id='LC12113'><br/></div><div class='line' id='LC12114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create stage div to contain everything</span></div><div class='line' id='LC12115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC12116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC12117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC12118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">fullscreen</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div><div class='line' id='LC12119'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="o">:</span> <span class="p">(</span><span class="nx">crstage</span> <span class="o">?</span> <span class="nx">crstage</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">)),</span></div><div class='line' id='LC12120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">inner</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">)</span></div><div class='line' id='LC12121'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12122'><br/></div><div class='line' id='LC12123'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//fullscreen, stop scrollbars</span></div><div class='line' id='LC12124'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">w</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12125'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span></div><div class='line' id='LC12126'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">fullscreen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12127'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12128'><br/></div><div class='line' id='LC12129'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;resize&quot;</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">reload</span><span class="p">);</span></div><div class='line' id='LC12130'><br/></div><div class='line' id='LC12131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;blur&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;autoPause&quot;</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC12133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">_paused</span><span class="p">)</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC12134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="s2">&quot;focus&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">_paused</span> <span class="o">&amp;&amp;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;autoPause&quot;</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC12138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span></div><div class='line' id='LC12139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12141'><br/></div><div class='line' id='LC12142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//make the stage unselectable</span></div><div class='line' id='LC12143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;stageSelectable&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">onselectstart</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12147'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC12148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12150'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">modify</span><span class="p">(</span><span class="s2">&quot;stageSelectable&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC12151'><br/></div><div class='line' id='LC12152'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//make the stage have no context menu</span></div><div class='line' id='LC12153'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;stageContextMenu&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12154'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">oncontextmenu</span> <span class="o">=</span> <span class="nx">v</span> <span class="o">?</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12155'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12156'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC12158'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12159'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12160'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">modify</span><span class="p">(</span><span class="s2">&quot;stageContextMenu&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC12161'><br/></div><div class='line' id='LC12162'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;autoPause&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{});</span></div><div class='line' id='LC12163'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">modify</span><span class="p">(</span><span class="s2">&quot;autoPause&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></div><div class='line' id='LC12164'><br/></div><div class='line' id='LC12165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//add to the body and give it an ID if not exists</span></div><div class='line' id='LC12166'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">crstage</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12167'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">);</span></div><div class='line' id='LC12168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">stage_elem</span><span class="p">;</span></div><div class='line' id='LC12169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12170'><br/></div><div class='line' id='LC12171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span></div><div class='line' id='LC12172'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12173'><br/></div><div class='line' id='LC12174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">);</span></div><div class='line' id='LC12175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">;</span></div><div class='line' id='LC12176'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">zIndex</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">;</span></div><div class='line' id='LC12177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">inner</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transformStyle</span> <span class="o">=</span> <span class="s2">&quot;preserve-3d&quot;</span><span class="p">;</span> <span class="c1">// Seems necessary for Firefox to preserve zIndexes?</span></div><div class='line' id='LC12178'><br/></div><div class='line' id='LC12179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//css style</span></div><div class='line' id='LC12180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC12181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span></div><div class='line' id='LC12182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span></div><div class='line' id='LC12183'><br/></div><div class='line' id='LC12184'><br/></div><div class='line' id='LC12185'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// resize events</span></div><div class='line' id='LC12186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;InvalidateViewport&quot;</span><span class="p">);});</span></div><div class='line' id='LC12187'><br/></div><div class='line' id='LC12188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">mobile</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12189'><br/></div><div class='line' id='LC12190'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// remove default gray highlighting after touch</span></div><div class='line' id='LC12191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">webkitTapHighlightColor</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">webkitTapHighlightColor</span> <span class="o">=</span> <span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">;</span></div><div class='line' id='LC12193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12194'><br/></div><div class='line' id='LC12195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">meta</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">),</span></div><div class='line' id='LC12196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;HEAD&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC12197'><br/></div><div class='line' id='LC12198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//hide the address bar</span></div><div class='line' id='LC12199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">meta</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">);</span></div><div class='line' id='LC12200'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">meta</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;apple-mobile-web-app-capable&quot;</span><span class="p">);</span></div><div class='line' id='LC12201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">meta</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">);</span></div><div class='line' id='LC12202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span></div><div class='line' id='LC12203'><br/></div><div class='line' id='LC12204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span> <span class="s2">&quot;touchmove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></div><div class='line' id='LC12206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12207'><br/></div><div class='line' id='LC12208'><br/></div><div class='line' id='LC12209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC12210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">elem</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;relative&quot;</span><span class="p">;</span></div><div class='line' id='LC12211'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//find out the offset position of the stage</span></div><div class='line' id='LC12212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offset</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">inner</span><span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">);</span></div><div class='line' id='LC12213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12216'><br/></div><div class='line' id='LC12217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12219'><br/></div><div class='line' id='LC12220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Create setters/getters for x, y, width, height</span></div><div class='line' id='LC12221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_defineViewportProperties</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">setter</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//define getters and setters to scroll the viewport</span></div><div class='line' id='LC12224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC12226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC12229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_width</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC12232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">);</span></div><div class='line' id='LC12233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_height</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC12236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">);</span></div><div class='line' id='LC12237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC12240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC12243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_width</span><span class="p">;</span></div><div class='line' id='LC12246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12248'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_height</span><span class="p">;</span></div><div class='line' id='LC12249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12250'><br/></div><div class='line' id='LC12251'><br/></div><div class='line' id='LC12252'><br/></div><div class='line' id='LC12253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//IE9</span></div><div class='line' id='LC12254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12256'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12257'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC12258'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12259'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12260'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">;</span></div><div class='line' id='LC12261'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12262'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span> <span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC12263'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12264'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12265'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12266'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span></div><div class='line' id='LC12267'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12268'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12269'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">;</span></div><div class='line' id='LC12270'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12271'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span> <span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC12272'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12273'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12274'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12275'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_width</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC12276'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">);</span></div><div class='line' id='LC12277'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12278'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12279'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_width</span><span class="p">;</span></div><div class='line' id='LC12280'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12281'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span> <span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC12282'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12283'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12284'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12285'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_height</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span></div><div class='line' id='LC12286'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">);</span></div><div class='line' id='LC12287'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12288'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12289'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_height</span><span class="p">;</span></div><div class='line' id='LC12290'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12291'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">configurable</span> <span class="o">:</span> <span class="kc">true</span></div><div class='line' id='LC12292'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12293'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12294'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12295'><br/></div><div class='line' id='LC12296'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12297'><span class="cm">         * #Crafty.viewport.reload</span></div><div class='line' id='LC12298'><span class="cm">         * @comp Crafty.stage</span></div><div class='line' id='LC12299'><span class="cm">         *</span></div><div class='line' id='LC12300'><span class="cm">         * @sign public Crafty.viewport.reload()</span></div><div class='line' id='LC12301'><span class="cm">         *</span></div><div class='line' id='LC12302'><span class="cm">         * Recalculate and reload stage width, height and position.</span></div><div class='line' id='LC12303'><span class="cm">         * Useful when browser return wrong results on init (like safari on Ipad2).</span></div><div class='line' id='LC12304'><span class="cm">         *</span></div><div class='line' id='LC12305'><span class="cm">         */</span></div><div class='line' id='LC12306'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">reload</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12307'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC12308'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12309'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span></div><div class='line' id='LC12310'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12311'><br/></div><div class='line' id='LC12312'><br/></div><div class='line' id='LC12313'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">fullscreen</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12314'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_width</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC12315'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_height</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span></div><div class='line' id='LC12316'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">);</span></div><div class='line' id='LC12317'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12318'><br/></div><div class='line' id='LC12319'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">offset</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">inner</span><span class="p">(</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">);</span></div><div class='line' id='LC12320'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12321'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12322'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12323'><br/></div><div class='line' id='LC12324'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12325'><span class="cm">         * #Crafty.viewport.reset</span></div><div class='line' id='LC12326'><span class="cm">         * @comp Crafty.stage</span></div><div class='line' id='LC12327'><span class="cm">         * @trigger StopCamera - called to cancel camera animations</span></div><div class='line' id='LC12328'><span class="cm">         *</span></div><div class='line' id='LC12329'><span class="cm">         * @sign public Crafty.viewport.reset()</span></div><div class='line' id='LC12330'><span class="cm">         *</span></div><div class='line' id='LC12331'><span class="cm">         * Resets the viewport to starting values, and cancels any existing camera animations.</span></div><div class='line' id='LC12332'><span class="cm">         * Called when scene() is run.</span></div><div class='line' id='LC12333'><span class="cm">         */</span></div><div class='line' id='LC12334'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12335'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">mouselook</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">);</span></div><div class='line' id='LC12336'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;StopCamera&quot;</span><span class="p">);</span></div><div class='line' id='LC12337'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></div><div class='line' id='LC12338'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12339'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12340'><span class="p">});</span></div><div class='line' id='LC12341'><br/></div><div class='line' id='LC12342'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}],</span><span class="mi">30</span><span class="o">:</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span><span class="nx">module</span><span class="p">,</span><span class="nx">exports</span><span class="p">){</span></div><div class='line' id='LC12343'><span class="kd">var</span> <span class="nx">Crafty</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core.js&#39;</span><span class="p">),</span></div><div class='line' id='LC12344'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">document</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></div><div class='line' id='LC12345'><br/></div><div class='line' id='LC12346'><span class="c1">// test fragment shader -- everything is white!</span></div><div class='line' id='LC12347'><span class="kd">var</span> <span class="nx">FRAGMENT_SHADER_SRC</span> <span class="o">=</span> </div><div class='line' id='LC12348'>&nbsp;&nbsp;<span class="s2">&quot;precision mediump float;&quot;</span></div><div class='line' id='LC12349'><br/></div><div class='line' id='LC12350'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;void main(void) {&quot;</span></div><div class='line' id='LC12351'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;gl_FragColor = vec4(0.0, 1.0, 1.0, 0.5);&quot;</span></div><div class='line' id='LC12352'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">;</span></div><div class='line' id='LC12353'><br/></div><div class='line' id='LC12354'><span class="kd">var</span> <span class="nx">FRAGMENT_SHADER_SRC_2</span> <span class="o">=</span> </div><div class='line' id='LC12355'>&nbsp;&nbsp;<span class="s2">&quot;precision mediump float;&quot;</span></div><div class='line' id='LC12356'><br/></div><div class='line' id='LC12357'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;void main(void) {&quot;</span></div><div class='line' id='LC12358'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);&quot;</span></div><div class='line' id='LC12359'>&nbsp;&nbsp;<span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">;</span></div><div class='line' id='LC12360'><br/></div><div class='line' id='LC12361'><span class="c1">// test vertex shader</span></div><div class='line' id='LC12362'><span class="kd">var</span> <span class="nx">VERTEX_SHADER_SRC_OLD</span> <span class="o">=</span> </div><div class='line' id='LC12363'>&nbsp;&nbsp;<span class="s2">&quot;attribute vec2 aVertexPosition;&quot;</span></div><div class='line' id='LC12364'>&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;uniform mat2 uGlobalScaleMatrix;&quot;</span></div><div class='line' id='LC12365'>&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;void main(void) {&quot;</span></div><div class='line' id='LC12366'>&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot; gl_Position = vec4(aVertexPosition, 0, 1);&quot;</span></div><div class='line' id='LC12367'>&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">;</span></div><div class='line' id='LC12368'><br/></div><div class='line' id='LC12369'><br/></div><div class='line' id='LC12370'><span class="nx">glHelpers</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC12371'><span class="c1">// Either x,y signature or x1, y1, x2, y2, etc</span></div><div class='line' id='LC12372'>&nbsp;&nbsp;<span class="nx">writeVec2</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span></div><div class='line' id='LC12373'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(arguments);</span></div><div class='line' id='LC12374'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">5</span><span class="p">){</span></div><div class='line' id='LC12375'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span></div><div class='line' id='LC12376'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12377'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12378'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12379'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC12380'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span></div><div class='line' id='LC12381'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC12382'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC12383'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12384'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12385'><br/></div><div class='line' id='LC12386'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12387'><br/></div><div class='line' id='LC12388'>&nbsp;&nbsp;<span class="c1">// Either x,y, z, w signature or x1, y1, x2, y2, etc</span></div><div class='line' id='LC12389'>&nbsp;&nbsp;<span class="nx">writeVec4</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">w</span><span class="p">){</span></div><div class='line' id='LC12390'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">7</span><span class="p">){</span></div><div class='line' id='LC12391'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span></div><div class='line' id='LC12392'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12393'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12394'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">z</span><span class="p">;</span></div><div class='line' id='LC12395'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC12396'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12397'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></div><div class='line' id='LC12398'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span></div><div class='line' id='LC12399'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span></div><div class='line' id='LC12400'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span></div><div class='line' id='LC12401'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">5</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span></div><div class='line' id='LC12402'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">data</span><span class="p">[</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">stride</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">6</span> <span class="o">+</span> <span class="nx">i</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span></div><div class='line' id='LC12403'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12404'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12405'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12406'><br/></div><div class='line' id='LC12407'>&nbsp;&nbsp;<span class="nx">makeProgram</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">fragment_src</span><span class="p">,</span> <span class="nx">vertex_src</span><span class="p">){</span></div><div class='line' id='LC12408'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12409'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">fragment_shader</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">fragment_src</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">);</span></div><div class='line' id='LC12410'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vertex_shader</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vertex_src</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">);</span></div><div class='line' id='LC12411'><br/></div><div class='line' id='LC12412'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span></div><div class='line' id='LC12413'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertex_shader</span><span class="p">);</span></div><div class='line' id='LC12414'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragment_shader</span><span class="p">);</span></div><div class='line' id='LC12415'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span></div><div class='line' id='LC12416'><br/></div><div class='line' id='LC12417'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC12418'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Could not initialise shaders&quot;</span><span class="p">);</span></div><div class='line' id='LC12419'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12420'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12421'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s2">&quot;uViewport&quot;</span><span class="p">);</span></div><div class='line' id='LC12422'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span></div><div class='line' id='LC12423'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12424'>&nbsp;&nbsp;<span class="nx">compileShader</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">type</span><span class="p">){</span></div><div class='line' id='LC12425'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span></div><div class='line' id='LC12426'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">src</span><span class="p">);</span></div><div class='line' id='LC12427'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span></div><div class='line' id='LC12428'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC12429'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span></div><div class='line' id='LC12430'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12431'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">shader</span><span class="p">;</span></div><div class='line' id='LC12432'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12433'><span class="p">};</span></div><div class='line' id='LC12434'><br/></div><div class='line' id='LC12435'><br/></div><div class='line' id='LC12436'><br/></div><div class='line' id='LC12437'><span class="c1">// fragment shader source for an image/etc</span></div><div class='line' id='LC12438'><span class="cm">/*</span></div><div class='line' id='LC12439'><span class="cm">varying highp vec2 vTextureCoord;</span></div><div class='line' id='LC12440'><span class="cm">      </span></div><div class='line' id='LC12441'><span class="cm">uniform sampler2D uSampler;</span></div><div class='line' id='LC12442'><span class="cm">uniform highp vec2 uTextureDimensions;</span></div><div class='line' id='LC12443'><span class="cm">uniform highp vec4 uSpriteCoords;</span></div><div class='line' id='LC12444'><br/></div><div class='line' id='LC12445'><span class="cm">void main(void) {</span></div><div class='line' id='LC12446'><span class="cm">  highp vec2 coord =  ( uSpriteCoords.zw * vTextureCoord + uSpriteCoords.xy) / uTextureDimensions;</span></div><div class='line' id='LC12447'><span class="cm">  gl_FragColor = texture2D(uSampler, coord);</span></div><div class='line' id='LC12448'><span class="cm">}</span></div><div class='line' id='LC12449'><span class="cm">*/</span></div><div class='line' id='LC12450'><span class="kd">var</span> <span class="nx">TEXTURE_FRAGMENT_SHADER_SRC</span> <span class="o">=</span> </div><div class='line' id='LC12451'>&nbsp;&nbsp;<span class="s2">&quot;varying highp vec2 vTextureCoord;\r\n      \r\nuniform sampler2D uSampler;\r\nuniform highp vec2 uTextureDimensions;\r\nuniform highp vec4 uSpriteCoords;\r\n\r\nvoid main(void) {\r\n  highp vec2 coord =  ( uSpriteCoords.zw * vTextureCoord + uSpriteCoords.xy) \/ uTextureDimensions;\r\n  gl_FragColor = texture2D(uSampler, coord);\r\n}&quot;</span><span class="p">;</span></div><div class='line' id='LC12452'><br/></div><div class='line' id='LC12453'><br/></div><div class='line' id='LC12454'><span class="c1">// Vertex shader source, unformatted</span></div><div class='line' id='LC12455'><span class="cm">/*</span></div><div class='line' id='LC12456'><span class="cm">attribute vec2 a_position;</span></div><div class='line' id='LC12457'><span class="cm">uniform  vec4 uViewport;</span></div><div class='line' id='LC12458'><span class="cm">uniform  vec4 uEntityPos;</span></div><div class='line' id='LC12459'><span class="cm">uniform  vec4 uEntityExtra;</span></div><div class='line' id='LC12460'><br/></div><div class='line' id='LC12461'><br/></div><div class='line' id='LC12462'><span class="cm">varying highp vec2 vTextureCoord;</span></div><div class='line' id='LC12463'><br/></div><div class='line' id='LC12464'><span class="cm">mat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);</span></div><div class='line' id='LC12465'><span class="cm">vec4 viewportTranslation = vec4(uViewport.xy, 0, 0);</span></div><div class='line' id='LC12466'><br/></div><div class='line' id='LC12467'><span class="cm">vec2 entityScale = uEntityPos.zw;</span></div><div class='line' id='LC12468'><span class="cm">vec2 entityTranslation = uEntityPos.xy;</span></div><div class='line' id='LC12469'><span class="cm">vec2 entityOrigin = uEntityExtra.xy;</span></div><div class='line' id='LC12470'><span class="cm">mat2 entityRotationMatrix = mat2(cos(uEntityExtra.w), sin(uEntityExtra.w), -sin(uEntityExtra.w), cos(uEntityExtra.w));</span></div><div class='line' id='LC12471'><br/></div><div class='line' id='LC12472'><span class="cm">void main() {</span></div><div class='line' id='LC12473'><span class="cm">  vec2 pos = entityScale * a_position;</span></div><div class='line' id='LC12474'><span class="cm">  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin + entityTranslation;</span></div><div class='line' id='LC12475'><span class="cm">  gl_Position = viewportScale * (viewportTranslation + vec4(pos, uEntityExtra.z, 1) );</span></div><div class='line' id='LC12476'><span class="cm">  vTextureCoord = a_position;</span></div><div class='line' id='LC12477'><span class="cm">}</span></div><div class='line' id='LC12478'><span class="cm">*/</span></div><div class='line' id='LC12479'><br/></div><div class='line' id='LC12480'><span class="c1">// Escape using a tool like [this one](http://www.freeformatter.com/javascript-escape.html).</span></div><div class='line' id='LC12481'><span class="kd">var</span> <span class="nx">VERTEX_SHADER_SRC</span> <span class="o">=</span> </div><div class='line' id='LC12482'><span class="s2">&quot;attribute vec2 a_position;\r\nuniform  vec4 uViewport;\r\nuniform  vec4 uEntityPos;\r\nuniform  vec4 uEntityExtra;\r\n\r\n\r\nvarying highp vec2 vTextureCoord;\r\n\r\nmat4 viewportScale = mat4(2.0 \/ uViewport.z, 0, 0, 0,    0, -2.0 \/ uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\r\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\r\n\r\nvec2 entityScale = uEntityPos.zw;\r\nvec2 entityTranslation = uEntityPos.xy;\r\nvec2 entityOrigin = uEntityExtra.xy;\r\nmat2 entityRotationMatrix = mat2(cos(uEntityExtra.w), sin(uEntityExtra.w), -sin(uEntityExtra.w), cos(uEntityExtra.w));\r\n\r\nvoid main() {\r\n  vec2 pos = entityScale * a_position;\r\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin + entityTranslation;\r\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, uEntityExtra.z, 1) );\r\n  vTextureCoord = a_position;\r\n}&quot;</span><span class="p">;</span></div><div class='line' id='LC12483'><br/></div><div class='line' id='LC12484'><br/></div><div class='line' id='LC12485'><span class="c1">// New fragmetn/vertex for color</span></div><div class='line' id='LC12486'><br/></div><div class='line' id='LC12487'><br/></div><div class='line' id='LC12488'><span class="cm">/*</span></div><div class='line' id='LC12489'><span class="cm">attribute vec2 aPosition;</span></div><div class='line' id='LC12490'><span class="cm">attribute vec4 aExtras;</span></div><div class='line' id='LC12491'><span class="cm">attribute vec4 aColor;</span></div><div class='line' id='LC12492'><br/></div><div class='line' id='LC12493'><span class="cm">varying lowp vec4 vColor;</span></div><div class='line' id='LC12494'><br/></div><div class='line' id='LC12495'><span class="cm">uniform  vec4 uViewport;</span></div><div class='line' id='LC12496'><br/></div><div class='line' id='LC12497'><span class="cm">mat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);</span></div><div class='line' id='LC12498'><span class="cm">vec4 viewportTranslation = vec4(uViewport.xy, 0, 0);</span></div><div class='line' id='LC12499'><br/></div><div class='line' id='LC12500'><span class="cm">vec2 entityOrigin = aExtras.xy;</span></div><div class='line' id='LC12501'><span class="cm">mat2 entityRotationMatrix = mat2(cos(aExtras.w), sin(aExtras.w), -sin(aExtras.w), cos(aExtras.w));</span></div><div class='line' id='LC12502'><br/></div><div class='line' id='LC12503'><span class="cm">void main() {</span></div><div class='line' id='LC12504'><span class="cm">  vec2 pos = aPosition;</span></div><div class='line' id='LC12505'><span class="cm">  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;</span></div><div class='line' id='LC12506'><span class="cm">  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aExtras.z) ), 1) );</span></div><div class='line' id='LC12507'><span class="cm">  vColor = aColor;</span></div><div class='line' id='LC12508'><span class="cm">}</span></div><div class='line' id='LC12509'><br/></div><div class='line' id='LC12510'><span class="cm">*/</span></div><div class='line' id='LC12511'><br/></div><div class='line' id='LC12512'><br/></div><div class='line' id='LC12513'><span class="kd">var</span> <span class="nx">COLOR_VERTEX_SHADER</span> <span class="o">=</span> </div><div class='line' id='LC12514'>&nbsp;&nbsp;<span class="s2">&quot;attribute vec2 aPosition;\r\nattribute vec4 aExtras;\r\nattribute vec4 aColor;\r\n\r\nvarying lowp vec4 vColor;\r\n\r\nuniform  vec4 uViewport;\r\n\r\nmat4 viewportScale = mat4(2.0 \/ uViewport.z, 0, 0, 0,    0, -2.0 \/ uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\r\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\r\n\r\nvec2 entityOrigin = aExtras.xy;\r\nmat2 entityRotationMatrix = mat2(cos(aExtras.w), sin(aExtras.w), -sin(aExtras.w), cos(aExtras.w));\r\n\r\nvoid main() {\r\n  vec2 pos = aPosition;\r\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\r\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0\/(1.0+exp(aExtras.z) ), 1) );\r\n  vColor = aColor;\r\n}&quot;</span><span class="p">;</span></div><div class='line' id='LC12515'><br/></div><div class='line' id='LC12516'><br/></div><div class='line' id='LC12517'><span class="kd">var</span> <span class="nx">COLOR_FRAGMENT_SHADER</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div><div class='line' id='LC12518'><br/></div><div class='line' id='LC12519'><br/></div><div class='line' id='LC12520'><span class="cm">/*</span></div><div class='line' id='LC12521'><span class="cm">attribute vec2 aPosition;</span></div><div class='line' id='LC12522'><span class="cm">attribute vec4 aExtras;</span></div><div class='line' id='LC12523'><span class="cm">attribute vec2 aTextureCoord;</span></div><div class='line' id='LC12524'><br/></div><div class='line' id='LC12525'><span class="cm">varying mediump vec2 vTextureCoord;</span></div><div class='line' id='LC12526'><br/></div><div class='line' id='LC12527'><span class="cm">uniform vec4 uViewport;</span></div><div class='line' id='LC12528'><span class="cm">uniform mediump vec2 uTextureDimensions;</span></div><div class='line' id='LC12529'><br/></div><div class='line' id='LC12530'><span class="cm">mat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);</span></div><div class='line' id='LC12531'><span class="cm">vec4 viewportTranslation = vec4(uViewport.xy, 0, 0);</span></div><div class='line' id='LC12532'><br/></div><div class='line' id='LC12533'><span class="cm">vec2 entityOrigin = aExtras.xy;</span></div><div class='line' id='LC12534'><span class="cm">mat2 entityRotationMatrix = mat2(cos(aExtras.w), sin(aExtras.w), -sin(aExtras.w), cos(aExtras.w));</span></div><div class='line' id='LC12535'><br/></div><div class='line' id='LC12536'><span class="cm">void main() {</span></div><div class='line' id='LC12537'><span class="cm">  vec2 pos = aPosition;</span></div><div class='line' id='LC12538'><span class="cm">  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;</span></div><div class='line' id='LC12539'><span class="cm">  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aExtras.z) ), 1) );</span></div><div class='line' id='LC12540'><span class="cm">  vTextureCoord = aTextureCoord;</span></div><div class='line' id='LC12541'><span class="cm">}</span></div><div class='line' id='LC12542'><br/></div><div class='line' id='LC12543'><span class="cm">*/</span></div><div class='line' id='LC12544'><br/></div><div class='line' id='LC12545'><span class="kd">var</span> <span class="nx">SPRITE_VERTEX_SHADER</span> <span class="o">=</span> </div><div class='line' id='LC12546'>&nbsp;&nbsp;<span class="s2">&quot;attribute vec2 aPosition;\r\nattribute vec4 aExtras;\r\nattribute vec2 aTextureCoord;\r\n\r\nvarying mediump vec2 vTextureCoord;\r\n\r\nuniform vec4 uViewport;\r\nuniform mediump vec2 uTextureDimensions;\r\n\r\nmat4 viewportScale = mat4(2.0 \/ uViewport.z, 0, 0, 0,    0, -2.0 \/ uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\r\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\r\n\r\nvec2 entityOrigin = aExtras.xy;\r\nmat2 entityRotationMatrix = mat2(cos(aExtras.w), sin(aExtras.w), -sin(aExtras.w), cos(aExtras.w));\r\n\r\nvoid main() {\r\n  vec2 pos = aPosition;\r\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\r\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0\/(1.0+exp(aExtras.z) ), 1) );\r\n  vTextureCoord = aTextureCoord;\r\n}\r\n&quot;</span><span class="p">;</span></div><div class='line' id='LC12547'><br/></div><div class='line' id='LC12548'><span class="cm">/*</span></div><div class='line' id='LC12549'><span class="cm">    varying mediump vec2 vTextureCoord;</span></div><div class='line' id='LC12550'><span class="cm">      </span></div><div class='line' id='LC12551'><span class="cm">    uniform sampler2D uSampler;</span></div><div class='line' id='LC12552'><span class="cm">    uniform mediump vec2 uTextureDimensions;</span></div><div class='line' id='LC12553'><br/></div><div class='line' id='LC12554'><span class="cm">    void main(void) {</span></div><div class='line' id='LC12555'><span class="cm">      highp vec2 coord =   vTextureCoord / uTextureDimensions;</span></div><div class='line' id='LC12556'><span class="cm">      gl_FragColor = texture2D(uSampler, coord);</span></div><div class='line' id='LC12557'><span class="cm">    }</span></div><div class='line' id='LC12558'><span class="cm">*/</span></div><div class='line' id='LC12559'><br/></div><div class='line' id='LC12560'><br/></div><div class='line' id='LC12561'><span class="kd">var</span> <span class="nx">SPRITE_FRAGMENT_SHADER</span> <span class="o">=</span> </div><div class='line' id='LC12562'>&nbsp;&nbsp;<span class="s2">&quot;    varying mediump vec2 vTextureCoord;\r\n      \r\n    uniform sampler2D uSampler;\r\n    uniform mediump vec2 uTextureDimensions;\r\n\r\n    void main(void) {\r\n      highp vec2 coord =   vTextureCoord \/ uTextureDimensions;\r\n      gl_FragColor = texture2D(uSampler, coord);\r\n    }&quot;</span><span class="p">;</span></div><div class='line' id='LC12563'><br/></div><div class='line' id='LC12564'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;TestSquare&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12565'>&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12566'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;WebGL&quot;</span><span class="p">)){</span></div><div class='line' id='LC12567'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_establishShader</span><span class="p">(</span><span class="s2">&quot;TestSquare&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentShader</span><span class="p">)</span></div><div class='line' id='LC12568'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12569'><br/></div><div class='line' id='LC12570'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12571'><br/></div><div class='line' id='LC12572'>&nbsp;&nbsp;<span class="nx">_fragmentShader</span><span class="o">:</span> <span class="nx">FRAGMENT_SHADER_SRC</span></div><div class='line' id='LC12573'><br/></div><div class='line' id='LC12574'><span class="p">});</span></div><div class='line' id='LC12575'><br/></div><div class='line' id='LC12576'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;TestSquareWhite&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12577'>&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12578'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;WebGL&quot;</span><span class="p">)){</span></div><div class='line' id='LC12579'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_establishShader</span><span class="p">(</span><span class="s2">&quot;TestSquareWhite&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentShader</span><span class="p">)</span></div><div class='line' id='LC12580'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12581'><br/></div><div class='line' id='LC12582'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12583'><br/></div><div class='line' id='LC12584'>&nbsp;&nbsp;<span class="nx">_fragmentShader</span><span class="o">:</span> <span class="nx">FRAGMENT_SHADER_SRC_2</span></div><div class='line' id='LC12585'><br/></div><div class='line' id='LC12586'><span class="p">});</span></div><div class='line' id='LC12587'><br/></div><div class='line' id='LC12588'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;TestColor&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12589'>&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12590'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;WebGL&quot;</span><span class="p">)){</span></div><div class='line' id='LC12591'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12592'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_establishShader</span><span class="p">(</span><span class="s2">&quot;TestColor&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentShader</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_vertexShader</span><span class="p">);</span></div><div class='line' id='LC12593'><br/></div><div class='line' id='LC12594'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">.</span><span class="nx">posLocation</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">){</span></div><div class='line' id='LC12595'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_specializeProgram</span><span class="p">();</span></div><div class='line' id='LC12596'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12597'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">.</span><span class="nx">_elementCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC12598'><br/></div><div class='line' id='LC12599'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12600'><br/></div><div class='line' id='LC12601'><br/></div><div class='line' id='LC12602'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_red</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_blue</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_green</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span></div><div class='line' id='LC12603'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drawColor</span><span class="p">);</span></div><div class='line' id='LC12604'><br/></div><div class='line' id='LC12605'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12606'><br/></div><div class='line' id='LC12607'>&nbsp;&nbsp;<span class="nx">_specializeProgram</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12608'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12609'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;setting positions&#39;</span><span class="p">);</span></div><div class='line' id='LC12610'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">prog</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">;</span></div><div class='line' id='LC12611'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12612'><br/></div><div class='line' id='LC12613'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span></div><div class='line' id='LC12614'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span></div><div class='line' id='LC12615'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="mi">600</span><span class="p">);</span></div><div class='line' id='LC12616'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_indexBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span></div><div class='line' id='LC12617'><br/></div><div class='line' id='LC12618'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aPosition&quot;</span><span class="p">);</span></div><div class='line' id='LC12619'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span><span class="p">);</span></div><div class='line' id='LC12620'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aExtras&quot;</span><span class="p">);</span></div><div class='line' id='LC12621'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span><span class="p">);</span></div><div class='line' id='LC12622'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">colLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aColor&quot;</span><span class="p">);</span></div><div class='line' id='LC12623'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">colLocation</span><span class="p">);</span></div><div class='line' id='LC12624'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_elementCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC12625'><br/></div><div class='line' id='LC12626'><br/></div><div class='line' id='LC12627'><br/></div><div class='line' id='LC12628'><br/></div><div class='line' id='LC12629'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">Float32Array</span><span class="p">.</span><span class="nx">BYTES_PER_ELEMENT</span><span class="p">;</span></div><div class='line' id='LC12630'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">stride</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC12631'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">stride</span> <span class="o">=</span> <span class="nx">stride</span><span class="p">;</span></div><div class='line' id='LC12632'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">switchTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12633'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">prog</span><span class="p">);</span></div><div class='line' id='LC12634'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span><span class="p">);</span></div><div class='line' id='LC12635'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12636'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC12637'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">colLocation</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC12638'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12639'><br/></div><div class='line' id='LC12640'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">renderBatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12641'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span><span class="p">);</span></div><div class='line' id='LC12642'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span> </div><div class='line' id='LC12643'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_indexBuffer</span><span class="p">);</span></div><div class='line' id='LC12644'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span></div><div class='line' id='LC12645'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">drawElements</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_SHORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12646'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12647'><br/></div><div class='line' id='LC12648'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12649'><br/></div><div class='line' id='LC12650'>&nbsp;&nbsp;<span class="nx">_fragmentShader</span><span class="o">:</span> </div><div class='line' id='LC12651'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="s2">&quot;precision mediump float;&quot;</span></div><div class='line' id='LC12652'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;varying lowp vec4 vColor;&quot;</span></div><div class='line' id='LC12653'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;void main(void) {&quot;</span></div><div class='line' id='LC12654'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;  gl_FragColor = vColor;&quot;</span></div><div class='line' id='LC12655'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">,</span></div><div class='line' id='LC12656'><br/></div><div class='line' id='LC12657'>&nbsp;&nbsp;<span class="nx">_vertexShader</span><span class="o">:</span> <span class="nx">COLOR_VERTEX_SHADER</span><span class="p">,</span></div><div class='line' id='LC12658'><br/></div><div class='line' id='LC12659'>&nbsp;&nbsp;<span class="nx">_drawColor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">drawVars</span><span class="p">){</span></div><div class='line' id='LC12660'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(&quot;Drawing color&quot;);</span></div><div class='line' id='LC12661'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">drawVars</span><span class="p">.</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">prog</span> <span class="o">=</span> <span class="nx">drawVars</span><span class="p">.</span><span class="nx">program</span><span class="p">;</span></div><div class='line' id='LC12662'><br/></div><div class='line' id='LC12663'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write the vertex data into the array</span></div><div class='line' id='LC12664'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_writeToArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span><span class="p">);</span></div><div class='line' id='LC12665'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(prog._bufferArray);</span></div><div class='line' id='LC12666'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12667'><br/></div><div class='line' id='LC12668'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Register the vertex groups to be drawn</span></div><div class='line' id='LC12669'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Two triangles; (0, 1, 2) and (1, 2, 3)</span></div><div class='line' id='LC12670'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span></div><div class='line' id='LC12671'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span></div><div class='line' id='LC12672'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span><span class="p">;</span></div><div class='line' id='LC12673'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12674'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12675'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12676'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12677'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12678'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">5</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12679'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span></div><div class='line' id='LC12680'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12681'><br/></div><div class='line' id='LC12682'>&nbsp;&nbsp;<span class="nx">_writeToArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span></div><div class='line' id='LC12683'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//intermediate: just CREATE the matrix right here</span></div><div class='line' id='LC12684'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12685'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span></div><div class='line' id='LC12686'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span><span class="p">;</span></div><div class='line' id='LC12687'><br/></div><div class='line' id='LC12688'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write position; x, y, w, h</span></div><div class='line' id='LC12689'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec2</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12690'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> </div><div class='line' id='LC12691'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">,</span></div><div class='line' id='LC12692'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC12693'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span></div><div class='line' id='LC12694'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12695'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write orientation and z level</span></div><div class='line' id='LC12696'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec4</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12697'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC12698'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC12699'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">,</span></div><div class='line' id='LC12700'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span></div><div class='line' id='LC12701'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12702'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec4</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12703'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_red</span><span class="p">,</span></div><div class='line' id='LC12704'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_green</span><span class="p">,</span></div><div class='line' id='LC12705'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_blue</span><span class="p">,</span></div><div class='line' id='LC12706'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="mi">1</span></div><div class='line' id='LC12707'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12708'><br/></div><div class='line' id='LC12709'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12710'><br/></div><div class='line' id='LC12711'>&nbsp;&nbsp;<span class="nx">color</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span></div><div class='line' id='LC12712'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_red</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span></div><div class='line' id='LC12713'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_green</span> <span class="o">=</span> <span class="nx">g</span><span class="p">;</span></div><div class='line' id='LC12714'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_blue</span> <span class="o">=</span> <span class="nx">b</span><span class="p">;</span></div><div class='line' id='LC12715'><br/></div><div class='line' id='LC12716'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC12717'>&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12718'><br/></div><div class='line' id='LC12719'><span class="p">});</span></div><div class='line' id='LC12720'><br/></div><div class='line' id='LC12721'><span class="cm">/*</span></div><div class='line' id='LC12722'><span class="cm">console.log(&quot;Initing webgl sprite&quot;);</span></div><div class='line' id='LC12723'><span class="cm">                var webgl = this.webgl;</span></div><div class='line' id='LC12724'><span class="cm">                this._establishShader(url, TEXTURE_FRAGMENT_SHADER_SRC)</span></div><div class='line' id='LC12725'><span class="cm">                this.__texture = webgl.makeTexture(this.__image, this.img);</span></div><div class='line' id='LC12726'><span class="cm">                console.log(&quot;Made texture&quot;)</span></div><div class='line' id='LC12727'><span class="cm">                console.log(this.__texture);</span></div><div class='line' id='LC12728'><span class="cm">                console.log(&quot;Image complete? &quot; + img.complete)</span></div><div class='line' id='LC12729'><span class="cm">                webgl.bindTexture(this._shaderProgram, this.__texture)</span></div><div class='line' id='LC12730'><span class="cm">              */</span></div><div class='line' id='LC12731'><br/></div><div class='line' id='LC12732'><br/></div><div class='line' id='LC12733'><br/></div><div class='line' id='LC12734'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;GLSprite&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12735'>&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12736'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s2">&quot;WebGL&quot;</span><span class="p">)){</span></div><div class='line' id='LC12737'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12738'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_establishShader</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__image</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentShader</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_vertexShader</span><span class="p">);</span></div><div class='line' id='LC12739'><br/></div><div class='line' id='LC12740'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">.</span><span class="nx">posLocation</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">){</span></div><div class='line' id='LC12741'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_specializeProgram</span><span class="p">();</span></div><div class='line' id='LC12742'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12743'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">.</span><span class="nx">_elementCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC12744'><br/></div><div class='line' id='LC12745'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12746'><br/></div><div class='line' id='LC12747'><br/></div><div class='line' id='LC12748'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12749'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_drawSprite</span><span class="p">);</span></div><div class='line' id='LC12750'><br/></div><div class='line' id='LC12751'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12752'><br/></div><div class='line' id='LC12753'><br/></div><div class='line' id='LC12754'>&nbsp;&nbsp;<span class="c1">// For sprite</span></div><div class='line' id='LC12755'>&nbsp;&nbsp;<span class="nx">_specializeProgram</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12756'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12757'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">webgl</span> <span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">;</span></div><div class='line' id='LC12758'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;setting sprite positions&#39;</span><span class="p">);</span></div><div class='line' id='LC12759'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">prog</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">;</span></div><div class='line' id='LC12760'><br/></div><div class='line' id='LC12761'><br/></div><div class='line' id='LC12762'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">__texture</span> <span class="o">=</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">makeTexture</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">__image</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">img</span><span class="p">);</span></div><div class='line' id='LC12763'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(&quot;Made texture&quot;)</span></div><div class='line' id='LC12764'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(this.__texture);</span></div><div class='line' id='LC12765'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(&quot;Image complete? &quot; + img.complete)</span></div><div class='line' id='LC12766'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">__texture</span><span class="p">);</span></div><div class='line' id='LC12767'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12768'><br/></div><div class='line' id='LC12769'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span></div><div class='line' id='LC12770'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span></div><div class='line' id='LC12771'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="mi">600</span><span class="p">);</span></div><div class='line' id='LC12772'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_indexBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span></div><div class='line' id='LC12773'><br/></div><div class='line' id='LC12774'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aPosition&quot;</span><span class="p">);</span></div><div class='line' id='LC12775'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span><span class="p">);</span></div><div class='line' id='LC12776'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aExtras&quot;</span><span class="p">);</span></div><div class='line' id='LC12777'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span><span class="p">);</span></div><div class='line' id='LC12778'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">textureLocation</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">prog</span><span class="p">,</span> <span class="s2">&quot;aTextureCoord&quot;</span><span class="p">);</span></div><div class='line' id='LC12779'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">textureLocation</span><span class="p">);</span></div><div class='line' id='LC12780'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">_elementCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC12781'><br/></div><div class='line' id='LC12782'><br/></div><div class='line' id='LC12783'><br/></div><div class='line' id='LC12784'><br/></div><div class='line' id='LC12785'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">Float32Array</span><span class="p">.</span><span class="nx">BYTES_PER_ELEMENT</span><span class="p">;</span></div><div class='line' id='LC12786'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">stride</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">size</span><span class="p">;</span></div><div class='line' id='LC12787'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">stride</span> <span class="o">=</span> <span class="nx">stride</span><span class="p">;</span></div><div class='line' id='LC12788'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">switchTo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12789'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">prog</span><span class="p">);</span></div><div class='line' id='LC12790'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span><span class="p">);</span></div><div class='line' id='LC12791'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">posLocation</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12792'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">extrasLocation</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC12793'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">colLocation</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stride</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="nx">size</span><span class="p">);</span></div><div class='line' id='LC12794'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12795'><br/></div><div class='line' id='LC12796'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">renderBatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC12797'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_kingBuffer</span><span class="p">);</span></div><div class='line' id='LC12798'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span> </div><div class='line' id='LC12799'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">_indexBuffer</span><span class="p">);</span></div><div class='line' id='LC12800'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span></div><div class='line' id='LC12801'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">drawElements</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_SHORT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12802'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC12803'><br/></div><div class='line' id='LC12804'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12805'><br/></div><div class='line' id='LC12806'><br/></div><div class='line' id='LC12807'><br/></div><div class='line' id='LC12808'>&nbsp;&nbsp;<span class="nx">_fragmentShader</span><span class="o">:</span> <span class="nx">SPRITE_FRAGMENT_SHADER</span><span class="p">,</span></div><div class='line' id='LC12809'><br/></div><div class='line' id='LC12810'>&nbsp;&nbsp;<span class="nx">_vertexShader</span><span class="o">:</span> <span class="nx">SPRITE_VERTEX_SHADER</span><span class="p">,</span></div><div class='line' id='LC12811'><br/></div><div class='line' id='LC12812'>&nbsp;&nbsp;<span class="nx">_drawSprite</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">drawVars</span><span class="p">){</span></div><div class='line' id='LC12813'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(&quot;Drawing color&quot;);</span></div><div class='line' id='LC12814'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">drawVars</span><span class="p">.</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">prog</span> <span class="o">=</span> <span class="nx">drawVars</span><span class="p">.</span><span class="nx">program</span><span class="p">;</span></div><div class='line' id='LC12815'><br/></div><div class='line' id='LC12816'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write the vertex data into the array</span></div><div class='line' id='LC12817'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_writeToArray</span><span class="p">(</span><span class="nx">prog</span><span class="p">.</span><span class="nx">_bufferArray</span><span class="p">,</span> <span class="nx">drawVars</span><span class="p">.</span><span class="nx">co</span><span class="p">);</span></div><div class='line' id='LC12818'><br/></div><div class='line' id='LC12819'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Register the vertex groups to be drawn</span></div><div class='line' id='LC12820'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Two triangles; (0, 1, 2) and (1, 2, 3)</span></div><div class='line' id='LC12821'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span></div><div class='line' id='LC12822'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span></div><div class='line' id='LC12823'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span><span class="p">;</span></div><div class='line' id='LC12824'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12825'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12826'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12827'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12828'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12829'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">index</span><span class="p">[</span><span class="mi">5</span><span class="o">+</span><span class="nx">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span></div><div class='line' id='LC12830'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">prog</span><span class="p">.</span><span class="nx">pointer</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span></div><div class='line' id='LC12831'>&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12832'><br/></div><div class='line' id='LC12833'>&nbsp;&nbsp;<span class="nx">_writeToArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">co</span><span class="p">){</span></div><div class='line' id='LC12834'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//intermediate: just CREATE the matrix right here</span></div><div class='line' id='LC12835'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12836'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span></div><div class='line' id='LC12837'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">_glNum</span><span class="p">;</span></div><div class='line' id='LC12838'><br/></div><div class='line' id='LC12839'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write position; x, y, w, h</span></div><div class='line' id='LC12840'><br/></div><div class='line' id='LC12841'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec2</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12842'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> </div><div class='line' id='LC12843'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">,</span></div><div class='line' id='LC12844'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC12845'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span></div><div class='line' id='LC12846'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12847'><br/></div><div class='line' id='LC12848'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write orientation and z level</span></div><div class='line' id='LC12849'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec4</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12850'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span></div><div class='line' id='LC12851'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span></div><div class='line' id='LC12852'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_z</span><span class="p">,</span></div><div class='line' id='LC12853'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_rotation</span></div><div class='line' id='LC12854'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12855'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12856'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Write array coordinates</span></div><div class='line' id='LC12857'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">glHelpers</span><span class="p">.</span><span class="nx">writeVec2</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC12858'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">co</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC12859'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">co</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">h</span><span class="p">,</span></div><div class='line' id='LC12860'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">co</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span></div><div class='line' id='LC12861'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">co</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">co</span><span class="p">.</span><span class="nx">h</span></div><div class='line' id='LC12862'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">);</span></div><div class='line' id='LC12863'><br/></div><div class='line' id='LC12864'>&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12865'><br/></div><div class='line' id='LC12866'><br/></div><div class='line' id='LC12867'><br/></div><div class='line' id='LC12868'><span class="p">});</span></div><div class='line' id='LC12869'><br/></div><div class='line' id='LC12870'><br/></div><div class='line' id='LC12871'><br/></div><div class='line' id='LC12872'><span class="c1">// This will totally assume, for now, that gl-matrix is available</span></div><div class='line' id='LC12873'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">c</span><span class="p">(</span><span class="s2">&quot;WebGL&quot;</span><span class="p">,</span> <span class="p">{</span></div><div class='line' id='LC12874'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12875'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12876'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></div><div class='line' id='LC12877'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12878'><br/></div><div class='line' id='LC12879'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">webgl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">webgl</span><span class="p">;</span></div><div class='line' id='LC12880'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12881'><br/></div><div class='line' id='LC12882'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//increment the amount of canvas objs</span></div><div class='line' id='LC12883'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">entities</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC12884'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12885'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12886'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC12887'><br/></div><div class='line' id='LC12888'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12889'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//flag if changed</span></div><div class='line' id='LC12890'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12891'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12892'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC12893'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12894'><br/></div><div class='line' id='LC12895'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12896'><br/></div><div class='line' id='LC12897'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC12898'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">entities</span><span class="o">--</span><span class="p">;</span></div><div class='line' id='LC12899'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12900'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></div><div class='line' id='LC12901'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">});</span></div><div class='line' id='LC12902'><br/></div><div class='line' id='LC12903'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12904'><br/></div><div class='line' id='LC12905'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC12906'><span class="cm">     * #.draw</span></div><div class='line' id='LC12907'><span class="cm">     * @comp WebGL</span></div><div class='line' id='LC12908'><span class="cm">     * @sign public this .draw([[Context ctx, ]Number x, Number y, Number w, Number h])</span></div><div class='line' id='LC12909'><span class="cm">     * @param ctx - Canvas 2D context if drawing on another canvas is required</span></div><div class='line' id='LC12910'><span class="cm">     * @param x - X offset for drawing a segment</span></div><div class='line' id='LC12911'><span class="cm">     * @param y - Y offset for drawing a segment</span></div><div class='line' id='LC12912'><span class="cm">     * @param w - Width of the segment to draw</span></div><div class='line' id='LC12913'><span class="cm">     * @param h - Height of the segment to draw</span></div><div class='line' id='LC12914'><span class="cm">     *</span></div><div class='line' id='LC12915'><span class="cm">     * Method to draw the entity on the canvas element. Can pass rect values for redrawing a segment of the entity.</span></div><div class='line' id='LC12916'><span class="cm">     */</span></div><div class='line' id='LC12917'><br/></div><div class='line' id='LC12918'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Cache the various objects and arrays used in draw</span></div><div class='line' id='LC12919'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">drawVars</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC12920'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;webgl&quot;</span><span class="p">,</span></div><div class='line' id='LC12921'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC12922'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC12923'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">coord</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span></div><div class='line' id='LC12924'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC12925'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC12926'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC12927'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC12928'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span><span class="o">:</span> <span class="mi">0</span></div><div class='line' id='LC12929'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12930'><br/></div><div class='line' id='LC12931'><br/></div><div class='line' id='LC12932'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12933'><br/></div><div class='line' id='LC12934'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12935'><br/></div><div class='line' id='LC12936'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ready</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></div><div class='line' id='LC12937'><br/></div><div class='line' id='LC12938'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12939'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">h</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span></div><div class='line' id='LC12940'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">w</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span></div><div class='line' id='LC12941'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span></div><div class='line' id='LC12942'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">x</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span></div><div class='line' id='LC12943'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">ctx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12944'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12945'><br/></div><div class='line' id='LC12946'><br/></div><div class='line' id='LC12947'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">pos</span><span class="p">;</span></div><div class='line' id='LC12948'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_x</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span></div><div class='line' id='LC12949'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_y</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span></div><div class='line' id='LC12950'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_w</span><span class="p">);</span></div><div class='line' id='LC12951'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">pos</span><span class="p">.</span><span class="nx">_h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">h</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_h</span><span class="p">);</span></div><div class='line' id='LC12952'><br/></div><div class='line' id='LC12953'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">coord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">__coord</span> <span class="o">||</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span></div><div class='line' id='LC12954'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">co</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">co</span><span class="p">;</span></div><div class='line' id='LC12955'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12956'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span></div><div class='line' id='LC12957'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">||</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span></div><div class='line' id='LC12958'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">co</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">||</span> <span class="nx">coord</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span></div><div class='line' id='LC12959'><br/></div><div class='line' id='LC12960'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Handle flipX, flipY</span></div><div class='line' id='LC12961'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_flipX</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_flipY</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12962'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12963'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12964'><br/></div><div class='line' id='LC12965'><br/></div><div class='line' id='LC12966'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//set alpha</span></div><div class='line' id='LC12967'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_alpha</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC12968'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12969'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12970'><br/></div><div class='line' id='LC12971'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Draw entity</span></div><div class='line' id='LC12972'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC12973'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">gl</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">;</span></div><div class='line' id='LC12974'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">.</span><span class="nx">program</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">;</span></div><div class='line' id='LC12975'><br/></div><div class='line' id='LC12976'><br/></div><div class='line' id='LC12977'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;Draw&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">drawVars</span><span class="p">);</span></div><div class='line' id='LC12978'><br/></div><div class='line' id='LC12979'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);</span></div><div class='line' id='LC12980'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12981'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC12982'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12983'><br/></div><div class='line' id='LC12984'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// v_src is optional, there&#39;s a default vertex shader that works for regular rectangular entities</span></div><div class='line' id='LC12985'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_establishShader</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">compName</span><span class="p">,</span> <span class="nx">f_src</span><span class="p">,</span> <span class="nx">v_src</span><span class="p">){</span></div><div class='line' id='LC12986'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Establishing shader&quot;</span><span class="p">);</span></div><div class='line' id='LC12987'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">wgl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">;</span></div><div class='line' id='LC12988'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">wgl</span><span class="p">.</span><span class="nx">programs</span><span class="p">[</span><span class="nx">compName</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">){</span></div><div class='line' id='LC12989'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">wgl</span><span class="p">.</span><span class="nx">programs</span><span class="p">[</span><span class="nx">compName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">glHelpers</span><span class="p">.</span><span class="nx">makeProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">f_src</span><span class="p">,</span> <span class="nx">v_src</span><span class="p">);</span></div><div class='line' id='LC12990'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC12991'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC12992'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_shaderProgram</span> <span class="o">=</span> <span class="nx">wgl</span><span class="p">.</span><span class="nx">programs</span><span class="p">[</span><span class="nx">compName</span><span class="p">];</span></div><div class='line' id='LC12993'><br/></div><div class='line' id='LC12994'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Shader program means ready</span></div><div class='line' id='LC12995'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC12996'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC12997'><span class="p">});</span></div><div class='line' id='LC12998'><br/></div><div class='line' id='LC12999'><span class="cm">/**@</span></div><div class='line' id='LC13000'><span class="cm"> * #Crafty.webgl</span></div><div class='line' id='LC13001'><span class="cm"> * @category Graphics</span></div><div class='line' id='LC13002'><span class="cm"> *</span></div><div class='line' id='LC13003'><span class="cm"> * Collection of methods to draw on canvas.</span></div><div class='line' id='LC13004'><span class="cm"> */</span></div><div class='line' id='LC13005'><span class="nx">Crafty</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div><div class='line' id='LC13006'><br/></div><div class='line' id='LC13007'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="o">:</span> <span class="p">{</span></div><div class='line' id='LC13008'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC13009'><span class="cm">         * #Crafty.webgl.context</span></div><div class='line' id='LC13010'><span class="cm">         * @comp Crafty.webgl</span></div><div class='line' id='LC13011'><span class="cm">         *</span></div><div class='line' id='LC13012'><span class="cm">         * This will return the context of the webgl canvas element.</span></div><div class='line' id='LC13013'><span class="cm">         * FIXME The value returned from `Crafty.canvas._canvas.getContext(&#39;2d&#39;)`.</span></div><div class='line' id='LC13014'><span class="cm">         */</span></div><div class='line' id='LC13015'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">context</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></div><div class='line' id='LC13016'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">entities</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC13017'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">changed_objects</span><span class="o">:</span> <span class="p">[],</span></div><div class='line' id='LC13018'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span></div><div class='line' id='LC13019'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="k">this</span><span class="p">.</span><span class="nx">changed_objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span></div><div class='line' id='LC13020'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13021'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC13022'><span class="cm">         * #Crafty.canvas._glCanvas</span></div><div class='line' id='LC13023'><span class="cm">         * @comp Crafty.webgl</span></div><div class='line' id='LC13024'><span class="cm">         *</span></div><div class='line' id='LC13025'><span class="cm">         * WebGL Canvas element</span></div><div class='line' id='LC13026'><span class="cm">         */</span></div><div class='line' id='LC13027'><br/></div><div class='line' id='LC13028'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">programs</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC13029'><br/></div><div class='line' id='LC13030'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">compileShader</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">type</span><span class="p">){</span></div><div class='line' id='LC13031'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC13032'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span></div><div class='line' id='LC13033'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">src</span><span class="p">);</span></div><div class='line' id='LC13034'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span></div><div class='line' id='LC13035'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC13036'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span></div><div class='line' id='LC13037'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC13038'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">shader</span><span class="p">;</span></div><div class='line' id='LC13039'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13040'><br/></div><div class='line' id='LC13041'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">makeProgram</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fragment_src</span><span class="p">,</span> <span class="nx">vertex_src</span><span class="p">){</span></div><div class='line' id='LC13042'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13043'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Making program&quot;</span><span class="p">);</span></div><div class='line' id='LC13044'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fragment_src</span><span class="p">);</span></div><div class='line' id='LC13045'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC13046'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">fragment_shader</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">fragment_src</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">);</span></div><div class='line' id='LC13047'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">vertex_shader</span> <span class="o">=</span> <span class="p">(</span><span class="nx">vertex_src</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">vertex_src</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">)</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultVertexShader</span><span class="p">;</span></div><div class='line' id='LC13048'><br/></div><div class='line' id='LC13049'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span></div><div class='line' id='LC13050'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertex_shader</span><span class="p">);</span></div><div class='line' id='LC13051'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragment_shader</span><span class="p">);</span></div><div class='line' id='LC13052'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span></div><div class='line' id='LC13053'><br/></div><div class='line' id='LC13054'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span></div><div class='line' id='LC13055'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">throw</span><span class="p">(</span><span class="s2">&quot;Could not initialise shaders&quot;</span><span class="p">);</span></div><div class='line' id='LC13056'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13057'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13058'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s2">&quot;uViewport&quot;</span><span class="p">);</span></div><div class='line' id='LC13059'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span></div><div class='line' id='LC13060'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13061'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13062'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">textures</span><span class="o">:</span> <span class="p">{},</span></div><div class='line' id='LC13063'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">textureCount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC13064'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">makeTexture</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">image</span><span class="p">){</span></div><div class='line' id='LC13065'><br/></div><div class='line' id='LC13066'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">webgl</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC13067'><br/></div><div class='line' id='LC13068'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span></div><div class='line' id='LC13069'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span></div><div class='line' id='LC13070'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC13071'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13072'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createTexture</span><span class="p">();</span></div><div class='line' id='LC13073'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span></div><div class='line' id='LC13074'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">,</span> <span class="nx">image</span><span class="p">);</span></div><div class='line' id='LC13075'><br/></div><div class='line' id='LC13076'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span> <span class="c1">//gl.NEAREST is also allowed, instead of gl.LINEAR, as neither mipmap.</span></div><div class='line' id='LC13077'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_S</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span> <span class="c1">//Prevents s-coordinate wrapping (repeating).</span></div><div class='line' id='LC13078'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_T</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span> <span class="c1">//Prevents t-coordinate wrapping (repeating).</span></div><div class='line' id='LC13079'><br/></div><div class='line' id='LC13080'><br/></div><div class='line' id='LC13081'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">NEAREST</span><span class="p">);</span></div><div class='line' id='LC13082'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);</span></div><div class='line' id='LC13083'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.generateMipmap(gl.TEXTURE_2D);</span></div><div class='line' id='LC13084'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span></div><div class='line' id='LC13085'><br/></div><div class='line' id='LC13086'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">activeTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">[</span><span class="s2">&quot;TEXTURE&quot;</span> <span class="o">+</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textureCount</span><span class="p">]);</span></div><div class='line' id='LC13087'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span></div><div class='line' id='LC13088'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></div><div class='line' id='LC13089'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">t</span><span class="o">:</span> <span class="nx">texture</span><span class="p">,</span></div><div class='line' id='LC13090'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">sampler</span><span class="o">:</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textureCount</span><span class="p">,</span></div><div class='line' id='LC13091'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;TEXTURE&quot;</span> <span class="o">+</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textureCount</span><span class="p">,</span></div><div class='line' id='LC13092'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">width</span><span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span></div><div class='line' id='LC13093'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">height</span><span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span></div><div class='line' id='LC13094'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span></div><div class='line' id='LC13095'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">};</span></div><div class='line' id='LC13096'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">textureCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC13097'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">activeTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">[</span><span class="s2">&quot;TEXTURE&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">textureCount</span><span class="p">)]);</span></div><div class='line' id='LC13098'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">textures</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span></div><div class='line' id='LC13099'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13100'><br/></div><div class='line' id='LC13101'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">bindTexture</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">program</span><span class="p">,</span> <span class="nx">texture_obj</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">program</span><span class="p">.</span><span class="nx">texture_obj</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span></div><div class='line' id='LC13103'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC13104'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC13105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">webgl</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC13106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">program</span><span class="p">);</span></div><div class='line' id='LC13107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Set the texture buffer to use</span></div><div class='line' id='LC13108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">uniform1i</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">program</span><span class="p">,</span> <span class="s2">&quot;uSampler&quot;</span><span class="p">),</span> <span class="nx">texture_obj</span><span class="p">.</span><span class="nx">sampler</span><span class="p">);</span></div><div class='line' id='LC13109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Set the image dimensions</span></div><div class='line' id='LC13110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">uniform2f</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">program</span><span class="p">,</span> <span class="s2">&quot;uTextureDimensions&quot;</span><span class="p">),</span> <span class="nx">texture_obj</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">texture_obj</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div><div class='line' id='LC13111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13112'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">program</span><span class="p">.</span><span class="nx">texture_obj</span> <span class="o">=</span> <span class="nx">texture_obj</span><span class="p">;</span></div><div class='line' id='LC13113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13114'><br/></div><div class='line' id='LC13115'><br/></div><div class='line' id='LC13116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">/**@</span></div><div class='line' id='LC13117'><span class="cm">         * #Crafty.webgl.init</span></div><div class='line' id='LC13118'><span class="cm">         * @comp Crafty.webgl</span></div><div class='line' id='LC13119'><span class="cm">         * @sign public void Crafty.webgl.init(void)</span></div><div class='line' id='LC13120'><span class="cm">         * @trigger NoWebGL - triggered if `Crafty.support.webgl` is false FIXME actually implement!</span></div><div class='line' id='LC13121'><span class="cm">         *</span></div><div class='line' id='LC13122'><span class="cm">         * Creates a `canvas` element inside `Crafty.stage.elem`. Must be called</span></div><div class='line' id='LC13123'><span class="cm">         * before any entities with the WebGL component can be drawn.</span></div><div class='line' id='LC13124'><span class="cm">         *</span></div><div class='line' id='LC13125'><span class="cm">         * This method will automatically be called if no `Crafty.webgl.context` is</span></div><div class='line' id='LC13126'><span class="cm">         * found.</span></div><div class='line' id='LC13127'><span class="cm">         */</span></div><div class='line' id='LC13128'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div><div class='line' id='LC13129'><br/></div><div class='line' id='LC13130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//check if canvas is supported</span></div><div class='line' id='LC13131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Crafty</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">webgl</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NoWebGL&quot;</span><span class="p">);</span></div><div class='line' id='LC13133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span></div><div class='line' id='LC13134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC13135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13136'><br/></div><div class='line' id='LC13137'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//create an empty canvas element</span></div><div class='line' id='LC13138'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC13139'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span></div><div class='line' id='LC13140'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC13141'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC13142'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span></div><div class='line' id='LC13143'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC13144'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span></div><div class='line' id='LC13145'><br/></div><div class='line' id='LC13146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span></div><div class='line' id='LC13147'><br/></div><div class='line' id='LC13148'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Equivalent of initGL in sample prog</span></div><div class='line' id='LC13149'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">gl</span><span class="p">;</span></div><div class='line' id='LC13150'>&nbsp;&nbsp;&nbsp;&nbsp;		    <span class="k">try</span> <span class="p">{</span></div><div class='line' id='LC13151'>&nbsp;&nbsp;&nbsp;&nbsp;		      <span class="nx">gl</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;webgl&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;experimental-webgl&quot;</span><span class="p">);</span></div><div class='line' id='LC13152'>&nbsp;&nbsp;&nbsp;&nbsp;		      <span class="nx">gl</span><span class="p">.</span><span class="nx">viewportWidth</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC13153'>&nbsp;&nbsp;&nbsp;&nbsp;		      <span class="nx">gl</span><span class="p">.</span><span class="nx">viewportHeight</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC13154'>&nbsp;&nbsp;&nbsp;&nbsp;		    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13155'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Do nothing!</span></div><div class='line' id='LC13156'>&nbsp;&nbsp;&nbsp;&nbsp;		    <span class="p">}</span></div><div class='line' id='LC13157'><br/></div><div class='line' id='LC13158'>&nbsp;&nbsp;&nbsp;&nbsp;		    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13159'>&nbsp;&nbsp;&nbsp;&nbsp;		      <span class="nx">Crafty</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;NoWebGL&quot;</span><span class="p">);</span></div><div class='line' id='LC13160'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">return</span><span class="p">;</span></div><div class='line' id='LC13161'>&nbsp;&nbsp;&nbsp;&nbsp;		    <span class="p">}</span></div><div class='line' id='LC13162'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">;</span></div><div class='line' id='LC13163'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">_canvas</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span></div><div class='line' id='LC13164'><br/></div><div class='line' id='LC13165'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span></div><div class='line' id='LC13166'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span></div><div class='line' id='LC13167'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.disable(gl.DEPTH_TEST);</span></div><div class='line' id='LC13169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);</span></div><div class='line' id='LC13170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//gl.enable(gl.BLEND);</span></div><div class='line' id='LC13171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13172'><br/></div><div class='line' id='LC13173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Bind rendering of canvas context (see drawing.js)</span></div><div class='line' id='LC13174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">webgl</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div><div class='line' id='LC13175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;RenderScene&quot;</span><span class="p">,</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span></div><div class='line' id='LC13176'><br/></div><div class='line' id='LC13177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;ViewportResize&quot;</span><span class="p">,</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">_resize</span><span class="p">)</span></div><div class='line' id='LC13178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">Crafty</span><span class="p">.</span><span class="nx">uniqueBind</span><span class="p">(</span><span class="s2">&quot;InvalidateViewport&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;})</span></div><div class='line' id='LC13180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">this</span><span class="p">.</span><span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div><div class='line' id='LC13181'><br/></div><div class='line' id='LC13182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;webgl inited&quot;</span><span class="p">);</span></div><div class='line' id='LC13183'><br/></div><div class='line' id='LC13184'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13185'><br/></div><div class='line' id='LC13186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">_resize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div><div class='line' id='LC13187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">_canvas</span><span class="p">;</span></div><div class='line' id='LC13188'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span></div><div class='line' id='LC13189'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">c</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC13190'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">viewportWidth</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">widtxh</span><span class="p">;</span></div><div class='line' id='LC13191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">viewportHeight</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span></div><div class='line' id='LC13192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13193'><br/></div><div class='line' id='LC13194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">setViewportUniforms</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">){</span></div><div class='line' id='LC13195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span></div><div class='line' id='LC13196'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span></div><div class='line' id='LC13197'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">viewport</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span></div><div class='line' id='LC13198'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">uniform4f</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">viewport</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">_x</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">_y</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">_width</span><span class="p">,</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">_height</span><span class="p">);</span></div><div class='line' id='LC13199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">},</span></div><div class='line' id='LC13200'><br/></div><div class='line' id='LC13201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rect</span><span class="p">){</span></div><div class='line' id='LC13202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//console.log(&quot;Rendering webgl context&quot;)</span></div><div class='line' id='LC13203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">rect</span> <span class="o">=</span> <span class="nx">rect</span> <span class="o">||</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">rect</span><span class="p">();</span></div><div class='line' id='LC13204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">rect</span><span class="p">),</span></div><div class='line' id='LC13205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span></div><div class='line' id='LC13206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">l</span> <span class="o">=</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span></div><div class='line' id='LC13207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">webgl</span><span class="p">,</span></div><div class='line' id='LC13208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span> <span class="o">=</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span></div><div class='line' id='LC13209'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">;</span></div><div class='line' id='LC13210'><br/></div><div class='line' id='LC13211'><br/></div><div class='line' id='LC13212'><br/></div><div class='line' id='LC13213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">// Set viewport and clear it</span></div><div class='line' id='LC13214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">viewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">viewportWidth</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">viewportHeight</span><span class="p">);</span></div><div class='line' id='LC13215'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span></div><div class='line' id='LC13216'><br/></div><div class='line' id='LC13217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//We don&#39;t set the perspective because the default is what we WANT -- no depth </span></div><div class='line' id='LC13218'><br/></div><div class='line' id='LC13219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="c1">//Set the viewport uniform variables</span></div><div class='line' id='LC13220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">shaderProgram</span><span class="p">;</span>            </div><div class='line' id='LC13221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">programs</span> <span class="o">=</span> <span class="nx">webgl</span><span class="p">.</span><span class="nx">programs</span><span class="p">;</span></div><div class='line' id='LC13222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">webgl</span><span class="p">.</span><span class="nx">dirtyViewport</span><span class="p">){</span></div><div class='line' id='LC13223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">comp</span> <span class="k">in</span> <span class="nx">programs</span><span class="p">){</span></div><div class='line' id='LC13224'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">setViewportUniforms</span><span class="p">(</span><span class="nx">programs</span><span class="p">[</span><span class="nx">comp</span><span class="p">]);</span></div><div class='line' id='LC13225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13226'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">webgl</span><span class="p">.</span><span class="nx">dirtyViewport</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC13227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13228'><br/></div><div class='line' id='LC13229'><br/></div><div class='line' id='LC13230'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kd">var</span> <span class="nx">batchCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC13231'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></div><div class='line' id='LC13232'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13233'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span></div><div class='line' id='LC13234'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">_visible</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">.</span><span class="nx">__c</span><span class="p">.</span><span class="nx">WebGL</span><span class="p">)</span> <span class="p">{</span></div><div class='line' id='LC13235'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">shaderProgram</span> <span class="o">!==</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">){</span></div><div class='line' id='LC13236'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">shaderProgram</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">){</span></div><div class='line' id='LC13237'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">renderBatch</span><span class="p">();</span></div><div class='line' id='LC13238'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">batchCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC13239'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13240'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">_shaderProgram</span><span class="p">;</span></div><div class='line' id='LC13241'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">pointer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></div><div class='line' id='LC13242'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">();</span></div><div class='line' id='LC13243'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span> </div><div class='line' id='LC13244'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span></div><div class='line' id='LC13245'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">current</span><span class="p">.</span><span class="nx">_changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></div><div class='line' id='LC13246'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13247'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13248'><br/></div><div class='line' id='LC13249'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="p">(</span><span class="nx">shaderProgram</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">){</span></div><div class='line' id='LC13250'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">shaderProgram</span><span class="p">.</span><span class="nx">renderBatch</span><span class="p">();</span></div><div class='line' id='LC13251'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">batchCount</span><span class="o">++</span><span class="p">;</span></div><div class='line' id='LC13252'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13253'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Batches: &quot;</span> <span class="o">+</span> <span class="nx">batchCount</span><span class="p">)</span></div><div class='line' id='LC13254'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC13255'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13256'><br/></div><div class='line' id='LC13257'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="p">}</span></div><div class='line' id='LC13258'><span class="p">});</span></div><div class='line' id='LC13259'><br/></div><div class='line' id='LC13260'><br/></div><div class='line' id='LC13261'><span class="p">},{</span><span class="s2">&quot;./core.js&quot;</span><span class="o">:</span><span class="mi">9</span><span class="p">}]},{},[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span></div><div class='line' id='LC13262'><span class="p">;</span></div></pre></div></td>
          </tr>
        </table>
  </div>

  </div>
</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" class="js-jump-to-line" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" class="js-jump-to-line-form">
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="button">Go</button>
  </form>
</div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="http://training.github.com">Training</a></li>
      <li><a href="http://shop.github.com">Shop</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/about">About</a></li>

    </ul>

    <a href="/">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2014 <span title="0.07758s from github-fe121-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="/site/terms">Terms</a></li>
        <li><a href="/site/privacy">Privacy</a></li>
        <li><a href="/security">Security</a></li>
        <li><a href="/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-remove-close close js-ajax-error-dismiss"></a>
      Something went wrong with that request. Please try again.
    </div>

  </body>
</html>

